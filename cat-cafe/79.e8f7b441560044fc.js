"use strict";(self.webpackChunkcat_cafe=self.webpackChunkcat_cafe||[]).push([[79],{4079:(ni,te,g)=>{g.r(te),g.d(te,{StoreModule:()=>O});var _=g(1390),f=g(6895),c=g(4006),oe=g(5141),G=g(7579),p=g(136),e=g(4650),h=g(7253),D=g(1481),b=g(7392);function re(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"li")(1,"a",9),e.NdJ("click",function(){const s=e.CHM(t).$implicit,u=e.oxw();return e.KtG(u.onMenuClick(s))}),e.TgZ(2,"span",10)(3,"mat-icon"),e._uU(4),e.qZA(),e._uU(5),e.qZA()()()}if(2&i){const t=o.$implicit;e.xp6(1),e.ekj("current",t.active),e.Q6J("routerLink",t.link),e.xp6(3),e.Oqu(t.icon),e.xp6(1),e.hij(" ",t.title," ")}}class J{constructor(o,t,n,r){this.router=o,this.userService=t,this.authService=n,this.menuList=[],this.ngUnsubscribe=new G.x,r.setTitle(`\u0421\u043a\u043b\u0430\u0434 | ${p.XI}`),this.userName=this.userService.getShortName()}get getClass(){return"animate__animated animate__zoomIn"}ngOnInit(){this.initMenuList(),this.selectedByUrl(this.router.url,!0),this.router.events.subscribe(o=>{o instanceof _.m2&&this.selectedByUrl(o.url)})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}onLockScreen(){this.authService.lockScreen()}onMenuClick(o){for(const t of this.menuList)t.active=t.link===o.link;this.router.navigate([o.link])}selectedByUrl(o,t=!1){o.length>0&&"/"===o[0]&&(o=o.slice(1));for(const n of this.menuList)n.active=n.compare.test(o);t&&(this.menuList.some(n=>n.compare.test(o))||this.router.navigate(this.menuList.length>0?[this.menuList[0].link]:["/"]))}initMenuList(){const o=[];this.userService.hasPermissions([p.jE.storeGoodsEdit,p.jE.storeGoodsView])&&(o.push({title:"\u0411\u043b\u044e\u0434\u0430",link:"store/dishes",icon:"fastfood",active:!0,compare:/store\/dishes/}),o.push({title:"\u041c\u043e\u0434\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0440\u044b",link:"store/modifiers",icon:"fastfood",active:!0,compare:/store\/modifiers/}),o.push({title:"\u0418\u043d\u0433\u0440\u0435\u0434\u0438\u0435\u043d\u0442\u044b",link:"store/ingredients",icon:"fastfood",active:!0,compare:/store\/ingredients/})),this.userService.hasPermissions([p.jE.storeDocIncomingEdit,p.jE.storeDocIncomingView])&&o.push({title:"\u041f\u0440\u0438\u0445\u043e\u0434\u043d\u044b\u0435 \u043d\u0430\u043a\u043b\u0430\u0434\u043d\u044b\u0435",link:"store/docs-incoming",icon:"receipt",active:!0,compare:/store\/docs-incoming/}),this.menuList=o}}J.\u0275fac=function(o){return new(o||J)(e.Y36(_.F0),e.Y36(h.KD),e.Y36(h.e8),e.Y36(D.Dx))},J.\u0275cmp=e.Xpm({type:J,selectors:[["store-home"]],hostVars:1,hostBindings:function(o,t){2&o&&e.uIk("class",t.getClass)},decls:11,vars:2,consts:[[1,"head"],["routerLink","/",1,"logo"],[1,"flex-auto"],[1,"tabs"],[4,"ngFor","ngForOf"],[1,"user-place"],[1,"user-place__name"],["title","\u0412\u044b\u0445\u043e\u0434 \u0438\u0437 \u0441\u0438\u0441\u0442\u0435\u043c\u044b",1,"logout-button",3,"click"],[1,"content"],[3,"routerLink","click"],[1,"inside-container"]],template:function(o,t){1&o&&(e.TgZ(0,"div",0),e._UZ(1,"div",1),e.TgZ(2,"div",2)(3,"ul",3),e.YNc(4,re,6,5,"li",4),e.qZA()(),e.TgZ(5,"div",5)(6,"div",6),e._uU(7),e.qZA(),e.TgZ(8,"button",7),e.NdJ("click",function(){return t.onLockScreen()}),e.qZA()()(),e.TgZ(9,"div",8),e._UZ(10,"router-outlet"),e.qZA()),2&o&&(e.xp6(4),e.Q6J("ngForOf",t.menuList),e.xp6(3),e.hij(" ",t.userName," "))},dependencies:[f.sg,_.lC,_.rH,b.Hw],styles:['[_nghost-%COMP%]{flex:auto;display:flex;flex-direction:column;overflow:hidden;padding:10px}.head[_ngcontent-%COMP%]{position:relative;display:flex;height:48px;box-sizing:border-box;align-items:flex-end}.head[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{position:relative;width:86px;height:42px;top:-5px;left:5px;margin-right:15px;cursor:pointer;background-color:transparent;background-position:center center;background-repeat:no-repeat;background-size:contain;background-image:url(logo.3246863ca3fff759.png)}.content[_ngcontent-%COMP%]{flex:auto;display:flex;flex-direction:column;background-color:#fff;border-radius:0 0 6px 6px;box-shadow:2px 2px 2px #0006}.tabs[_ngcontent-%COMP%]{overflow:hidden;width:100%;margin:0;padding:0;list-style:none}.tabs[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{float:left;margin:0 8px 0 0}.tabs[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{position:relative;background:#dddddd;background-image:linear-gradient(to bottom,#ffffff,#dddddd);padding:10px 15px;outline:none;float:left;text-decoration:none;color:#444;text-shadow:0 1px 0 rgba(255,255,255,.8);border-radius:5px 0 0;box-shadow:0 2px 2px #0006}.tabs[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   .inside-container[_ngcontent-%COMP%]{display:flex;align-items:center}.tabs[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   .inside-container[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{margin-right:5px}.tabs[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover, .tabs[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover:after, .tabs[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:focus, .tabs[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:focus:after{background:#ffffff}.tabs[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:after{content:"";position:absolute;z-index:1;top:0;right:-.5em;bottom:0;width:1em;background:#dddddd;background-image:linear-gradient(to bottom,#ffffff,#dddddd);box-shadow:2px 2px 2px #0006;transform:skew(10deg);border-radius:0 5px 0 0}.tabs[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a.current[_ngcontent-%COMP%]{background:#ffffff;z-index:3}.tabs[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a.current[_ngcontent-%COMP%]:after{background:#fff;z-index:3}.user-place[_ngcontent-%COMP%]{display:flex;align-items:center;padding-bottom:5px}.user-place[_ngcontent-%COMP%]   .user-place__name[_ngcontent-%COMP%]{font-weight:700;margin-right:15px}.user-place[_ngcontent-%COMP%]   .logout-button[_ngcontent-%COMP%]{width:32px;height:32px;outline:none;border:none;border-radius:16px;cursor:pointer;transition:.2s;box-shadow:2px 2px 2px #0006;background-color:transparent;background-position:center center;background-repeat:no-repeat;background-size:contain;background-image:url(logout.1a9e8ae9a251b4ad.png)}.user-place[_ngcontent-%COMP%]   .logout-button[_ngcontent-%COMP%]:hover{background-color:#0000001a}']});var w=g(3555),m=g(8746),M=g(4128),X=g(9751),A=g(4130);class N{static blurActiveElement(){document.activeElement.blur&&document.activeElement.blur()}}var l=g(3448),C=g(4859);class E{constructor(){this.controlName=new l.jn(null,c.kI.required)}ngOnInit(){this.modalChildData?.name&&this.controlName.setValue(this.modalChildData.name)}apply(){this.dialogRef?.close({name:this.controlName.value})}close(){this.dialogRef?.close()}}E.\u0275fac=function(o){return new(o||E)},E.\u0275cmp=e.Xpm({type:E,selectors:[["common-text-edit-modal"]],decls:7,vars:2,consts:[[1,"inside-modal-body-container"],["label","\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435",3,"formControl","clearButton","enterClick"],[1,"footer-buttons"],["mat-raised-button","","color","primary",3,"click"],["mat-raised-button","","color","accent",3,"click"]],template:function(o,t){1&o&&(e.TgZ(0,"div",0)(1,"kui-input",1),e.NdJ("enterClick",function(){return t.apply()}),e.qZA()(),e.TgZ(2,"div",2)(3,"button",3),e.NdJ("click",function(){return t.apply()}),e._uU(4,"\u041f\u0440\u0438\u043c\u0435\u043d\u0438\u0442\u044c"),e.qZA(),e.TgZ(5,"button",4),e.NdJ("click",function(){return t.close()}),e._uU(6,"\u0417\u0430\u043a\u0440\u044b\u0442\u044c"),e.qZA()()),2&o&&(e.xp6(1),e.Q6J("formControl",t.controlName)("clearButton",!1))},dependencies:[l.y0,C.lW],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;flex:auto;width:400px;max-width:100%;box-sizing:border-box}"]});var x=(()=>{return(i=x||(x={})).DISHES="cc-store-selected-category-dishes",i.INGREDIENTS="cc-store-selected-category-ingredients",i.MODIFIERS="cc-store-selected-category-modifiers",x;var i})(),v=g(2173),T=g(811),a=g(671),W=g(8739),I=g(266);function se(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"button",36),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.onAddCategory())}),e.TgZ(1,"mat-icon"),e._uU(2,"add"),e.qZA(),e.TgZ(3,"span"),e._uU(4,"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u044e"),e.qZA()()}}function ue(i,o){1&i&&(e.TgZ(0,"div",37)(1,"div",38),e._uU(2,"\u041d\u0435\u0442 \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u0439"),e.qZA()())}function ae(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"button",46),e.NdJ("click",function(r){e.CHM(t);const s=e.oxw().$implicit,u=e.oxw(2);return e.KtG(u.onEditCategory(r,s))}),e.TgZ(1,"mat-icon"),e._uU(2,"edit"),e.qZA()()}}function ce(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"button",47),e.NdJ("click",function(r){e.CHM(t);const s=e.oxw(),u=s.index,d=s.$implicit,S=e.oxw(2);return e.KtG(S.onRemoveCategory(r,u,d.id))}),e.TgZ(1,"mat-icon"),e._uU(2,"highlight_off"),e.qZA()()}}function le(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"div",42),e.NdJ("dragover",function(r){const u=e.CHM(t).$implicit,d=e.oxw(2);return e.KtG(d.onCategoryDragOver(r,u))})("dragleave",function(){e.CHM(t);const r=e.oxw(2);return e.KtG(r.onCategoryDragLeave())})("dragend",function(r){e.CHM(t);const s=e.oxw(2);return e.KtG(s.onCategoryDragEnd(r))})("drop",function(r){const u=e.CHM(t).$implicit,d=e.oxw(2);return e.KtG(d.onCategoryDrop(r,u))})("click",function(){const s=e.CHM(t).$implicit,u=e.oxw(2);return e.KtG(u.onSelectCategory(s))}),e.TgZ(1,"div",43),e._uU(2),e.qZA(),e.YNc(3,ae,3,0,"button",44),e.YNc(4,ce,3,0,"button",45),e.qZA()}if(2&i){const t=o.$implicit,n=e.oxw(2);e.ekj("goods-categories__item--selected",t.selected),e.xp6(2),e.Oqu(t.name),e.xp6(1),e.Q6J("ngIf",n.isPermissionEdit),e.xp6(1),e.Q6J("ngIf",n.isPermissionEdit&&n.isPermissionRemove)}}function de(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"div",39)(1,"div",16)(2,"div",40),e.NdJ("cdkDropListDropped",function(r){e.CHM(t);const s=e.oxw();return e.KtG(s.onDropCategory(r))}),e.YNc(3,le,5,5,"div",41),e.qZA()()()}if(2&i){const t=e.oxw();e.xp6(2),e.Q6J("cdkDropListData",t.categoriesList),e.xp6(1),e.Q6J("ngForOf",t.categoriesList)}}function me(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"mat-button-toggle-group",48),e.NdJ("ngModelChange",function(r){e.CHM(t);const s=e.oxw();return e.KtG(s.modeState=r)}),e.TgZ(1,"mat-button-toggle",49)(2,"mat-icon"),e._uU(3,"home"),e.qZA()(),e.TgZ(4,"mat-button-toggle",50)(5,"mat-icon"),e._uU(6,"delete"),e.qZA()()()}if(2&i){const t=e.oxw();e.Q6J("ngModel",t.modeState)}}function ge(i,o){1&i&&(e.TgZ(0,"button",51)(1,"mat-icon"),e._uU(2,"add"),e.qZA(),e.TgZ(3,"span"),e._uU(4,"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0431\u043b\u044e\u0434\u043e"),e.qZA()())}function _e(i,o){1&i&&(e.TgZ(0,"th",52),e._uU(1,"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435"),e.qZA())}function pe(i,o){if(1&i&&(e.TgZ(0,"td",53),e._uU(1),e.qZA()),2&i){const t=o.$implicit;e.xp6(1),e.hij(" ",t.name," ")}}function fe(i,o){1&i&&(e.TgZ(0,"th",54),e._uU(1," \u0410\u0440\u0442\u0438\u043a\u0443\u043b "),e.qZA())}function he(i,o){if(1&i&&(e.TgZ(0,"td",55),e._uU(1),e.qZA()),2&i){const t=o.$implicit;e.xp6(1),e.hij(" ",t.code," ")}}function Ce(i,o){1&i&&(e.TgZ(0,"th",56),e._uU(1," \u041e\u0441\u0442\u0430\u0442\u043e\u043a, \u0435\u0434. \u0438\u0437\u043c\u0435\u0440\u0435\u043d\u0438\u044f "),e.qZA())}function xe(i,o){if(1&i&&(e.TgZ(0,"td",57),e._uU(1),e.qZA()),2&i){const t=o.$implicit;e.xp6(1),e.AsE(" ",t.storeQuantity," ",t.unit," ")}}function ve(i,o){1&i&&(e.TgZ(0,"th",58),e._uU(1," \xa0 "),e.qZA())}function be(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"button",63),e.NdJ("click",function(r){e.CHM(t);const s=e.oxw().$implicit,u=e.oxw();return e.KtG(u.onRemoveRow(r,s))}),e.TgZ(1,"mat-icon"),e._uU(2,"highlight_off"),e.qZA()()}}function Se(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"button",64),e.NdJ("click",function(r){e.CHM(t);const s=e.oxw().$implicit,u=e.oxw();return e.KtG(u.onRestoreRow(r,s))}),e.TgZ(1,"mat-icon"),e._uU(2,"done"),e.qZA()()}}function Te(i,o){if(1&i&&(e.TgZ(0,"td",59)(1,"div",60),e.YNc(2,be,3,0,"button",61),e.YNc(3,Se,3,0,"button",62),e.qZA()()),2&i){const t=e.oxw();e.xp6(2),e.Q6J("ngIf","standart"===t.modeState),e.xp6(1),e.Q6J("ngIf","deleted"===t.modeState)}}function De(i,o){if(1&i&&(e.TgZ(0,"td",65)(1,"div",66),e._uU(2,"\u041d\u0435\u0442 \u0431\u043b\u044e\u0434"),e.qZA()()),2&i){const t=e.oxw();e.uIk("colspan",t.colspanTable)}}function we(i,o){1&i&&e._UZ(0,"tr",67)}const Ze=function(i){return{selected:i}};function ye(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"tr",68),e.NdJ("dragstart",function(r){const u=e.CHM(t).$implicit,d=e.oxw();return e.KtG(d.onGoodsDragStart(r,u))})("dragend",function(r){const u=e.CHM(t).index,d=e.oxw();return e.KtG(d.onGoodsDragEnd(r,u))})("click",function(){const s=e.CHM(t).$implicit,u=e.oxw();return e.KtG(u.onSelectRow(s))}),e.qZA()}2&i&&e.Q6J("ngClass",e.VKq(1,Ze,o.$implicit.selected))}function Ee(i,o){1&i&&e._UZ(0,"tr",69)}const Ie=function(){return[]},ke=function(){return["notFound"]};class F extends A.D{constructor(o,t,n,r,s,u){super(),this.router=o,this.dialogService=t,this.sessionStorageService=n,this.apiGoodsService=r,this.userService=s,this.categoriesList=[],this.selectedCategoryName="\u0411\u043b\u044e\u0434\u0430 \u0431\u0435\u0437 \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u0438",this.modeStateValue="standart",this.dragOverCategoryId=null,this.selectedCategoryId=null,u.setTitle(`\u0411\u043b\u044e\u0434\u0430 | \u0421\u043a\u043b\u0430\u0434 | ${p.XI}`);const d=this.sessionStorageService.get(x.DISHES);d&&(this.selectedCategoryId=d)}get isPermissionEdit(){return this.userService.hasPermissions(p.jE.storeGoodsEdit)}get isPermissionRemove(){return this.userService.hasPermissions(p.jE.storeGoodsRemove)}get modeState(){return this.modeStateValue}set modeState(o){this.modeStateValue=o,this.getList(this.pageIndex)}ngOnInit(){this.displayedColumns=this.isPermissionRemove?["name","code","storeQuantity","buttons"]:["name","code","storeQuantity"],this.initialize()}onCategoryDrop(o,t){if(o.dataTransfer){const n=o.dataTransfer.getData("drag-goods");isNaN(Number(n))||(this.dragOverCategoryId=null,o.dataTransfer.dropEffect="move",o.preventDefault(),this.apiGoodsService.saveGoods({id:Number(n),categoryId:-1===t.id?null:t.id}).subscribe({error:r=>this.dialogService.showToastError(r.message,"\u041f\u0435\u0440\u0435\u043c\u0435\u0449\u0435\u043d\u0438\u0435 \u0442\u043e\u0432\u0430\u0440\u0430 \u0432 \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u044e")}))}}onCategoryDragLeave(){this.dragOverCategoryId=null}onCategoryDragEnd(o){this.dragOverCategoryId=null,o.preventDefault()}onCategoryDragOver(o,t){o.dataTransfer&&this.isPermissionEdit&&o.dataTransfer.getData("drag-goods")&&(this.dragOverCategoryId=Number(t.id),o.preventDefault())}onGoodsDragEnd(o,t){"move"===o.dataTransfer?.dropEffect&&(this.dataSource.splice(t,1),this.dataSource=[...this.dataSource])}onGoodsDragStart(o,t){o.dataTransfer?.setData("drag-goods",String(t.id))}getCategoryStyle(o){return o.id===this.dragOverCategoryId?"is-valid-drop":""}onRestoreRow(o,t){o.stopPropagation(),this.dialogService.showConfirm("\u0412\u044b \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u044d\u0442\u043e\u0442 \u0442\u043e\u0432\u0430\u0440?").subscribe(n=>{n&&t.id&&(this.dialogService.showWait("\u0412\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435..."),this.apiGoodsService.restoreGoods(t.id).pipe((0,m.x)(()=>this.dialogService.hideWait())).subscribe({next:()=>{this.getList(this.pageIndex)},error:r=>this.dialogService.showToastError(r.message)}))})}onRemoveRow(o,t){o.stopPropagation(),this.dialogService.showConfirm("\u0412\u044b \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u044d\u0442\u043e\u0442 \u0442\u043e\u0432\u0430\u0440?").subscribe(n=>{n&&t.id&&(this.dialogService.showWait("\u0423\u0434\u0430\u043b\u0435\u043d\u0438\u0435..."),this.apiGoodsService.removeGoods(t.id).pipe((0,m.x)(()=>this.dialogService.hideWait())).subscribe({next:()=>{this.getList(this.pageIndex)},error:r=>this.dialogService.showToastError(r.message)}))})}onSelectRow(o){this.router.navigate(["/store/dishes",o.id])}onEditCategory(o,t){o.stopPropagation(),N.blurActiveElement(),this.editCategory(t)}onAddCategory(){this.editCategory()}onRemoveCategory(o,t,n){o.stopPropagation(),N.blurActiveElement(),n&&this.dialogService.showConfirm("\u0412\u044b \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u044d\u0442\u0443 \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u044e \u0441\u043e \u0432\u0441\u0435\u043c\u0438 \u0442\u043e\u0432\u0430\u0440\u0430\u043c\u0438?").subscribe(r=>{r&&(this.dialogService.showWait("\u0423\u0434\u0430\u043b\u0435\u043d\u0438\u0435..."),this.apiGoodsService.removeCategory(n).pipe((0,m.x)(()=>this.dialogService.hideWait())).subscribe({next:()=>{this.categoriesList.splice(t,1),this.selectedCategoryId===n&&this.onHomeCategory()},error:s=>this.dialogService.showToastError(s.message)}))})}onHomeCategory(){this.categoriesList.forEach(o=>o.selected=!1),this.selectedCategoryId=null,this.selectedCategoryName="\u0411\u043b\u044e\u0434\u0430 \u0431\u0435\u0437 \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u0438",this.sessionStorageService.remove(x.DISHES),this.getList(this.pageIndex)}onSelectCategory(o){this.categoriesList.forEach(t=>t.selected=!1),o.selected=!0,this.selectedCategoryId=o.id,this.selectedCategoryName=`\u041a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u044f: ${o.name}`,this.sessionStorageService.set(x.DISHES,o.id),this.getList(this.pageIndex)}onDropCategory(o){if(o.isPointerOverContainer&&o.previousContainer===o.container){const t={...o.container.data[o.previousIndex]},n={...o.container.data[o.currentIndex]},r=t.orderValue;t.orderValue=n.orderValue,n.orderValue=r,this.dialogService.showWait("\u0421\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0435..."),(0,M.D)([this.apiGoodsService.saveCategory({id:t.id,orderValue:t.orderValue}),this.apiGoodsService.saveCategory({id:n.id,orderValue:n.orderValue})]).pipe((0,m.x)(()=>this.dialogService.hideWait())).subscribe({next:()=>{(0,w.bA)(o.container.data,o.previousIndex,o.currentIndex)},error:s=>this.dialogService.showToastError(s.message)})}}editCategory(o=null){this.dialogService.showModal(o?"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u0438":"\u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u0438",E,{name:o?.name??null},!0).subscribe(n=>{n?.name&&(this.dialogService.showWait("\u0421\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0435..."),o?this.apiGoodsService.saveCategory({id:o.id,name:n.name}).pipe((0,m.x)(()=>this.dialogService.hideWait())).subscribe({next:()=>{o.name=n.name},error:r=>this.dialogService.showToastError(r.message)}):this.apiGoodsService.saveCategory({id:null,type:"dish",name:n.name}).pipe((0,m.x)(()=>this.dialogService.hideWait())).subscribe({next:r=>{const s={...r,selected:!0};this.categoriesList.push(s),this.onSelectCategory(s)},error:r=>this.dialogService.showToastError(r.message)}))})}initialize(){this.dialogService.showWait("\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0434\u0430\u043d\u043d\u044b\u0445..."),(0,M.D)([this.apiGoodsService.getListCategories("dish"),this.getListObservable(0)]).pipe((0,m.x)(()=>this.dialogService.hideWait())).subscribe({next:([o])=>{this.categoriesList=o.map(t=>{const n=t.id===this.selectedCategoryId;return n&&(this.selectedCategoryName=`\u041a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u044f: ${t.name}`),{...t,selected:n}})},error:o=>this.dialogService.showToastError(o.message)})}getList(o){this.getListObservable(o).subscribe()}getListObservable(o,t=!0){return new X.y(n=>{this.dialogService.showWait("\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0434\u0430\u043d\u043d\u044b\u0445..."),this.apiGoodsService.getListGoods({type:"dish",categoryId:this.selectedCategoryId,page:o,pageSize:this.pageSize,deleted:"deleted"===this.modeState}).pipe((0,m.x)(()=>this.dialogService.hideWait())).subscribe({next:r=>{this.total=r.count,this.dataSource=r.values,n.next(),n.complete()},error:r=>{t&&this.dialogService.showToastError(r.message),n.error(r)}})})}}function Me(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"button",36),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.onAddCategory())}),e.TgZ(1,"mat-icon"),e._uU(2,"add"),e.qZA(),e.TgZ(3,"span"),e._uU(4,"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u044e"),e.qZA()()}}function Ae(i,o){1&i&&(e.TgZ(0,"div",37)(1,"div",38),e._uU(2,"\u041d\u0435\u0442 \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u0439"),e.qZA()())}function Ne(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"button",46),e.NdJ("click",function(r){e.CHM(t);const s=e.oxw().$implicit,u=e.oxw(2);return e.KtG(u.onEditCategory(r,s))}),e.TgZ(1,"mat-icon"),e._uU(2,"edit"),e.qZA()()}}function Pe(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"button",47),e.NdJ("click",function(r){e.CHM(t);const s=e.oxw(),u=s.index,d=s.$implicit,S=e.oxw(2);return e.KtG(S.onRemoveCategory(r,u,d.id))}),e.TgZ(1,"mat-icon"),e._uU(2,"highlight_off"),e.qZA()()}}function Ue(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"div",42),e.NdJ("dragover",function(r){const u=e.CHM(t).$implicit,d=e.oxw(2);return e.KtG(d.onCategoryDragOver(r,u))})("dragleave",function(){e.CHM(t);const r=e.oxw(2);return e.KtG(r.onCategoryDragLeave())})("dragend",function(r){e.CHM(t);const s=e.oxw(2);return e.KtG(s.onCategoryDragEnd(r))})("drop",function(r){const u=e.CHM(t).$implicit,d=e.oxw(2);return e.KtG(d.onCategoryDrop(r,u))})("click",function(){const s=e.CHM(t).$implicit,u=e.oxw(2);return e.KtG(u.onSelectCategory(s))}),e.TgZ(1,"div",43),e._uU(2),e.qZA(),e.YNc(3,Ne,3,0,"button",44),e.YNc(4,Pe,3,0,"button",45),e.qZA()}if(2&i){const t=o.$implicit,n=e.oxw(2);e.ekj("goods-categories__item--selected",t.selected),e.Q6J("ngClass",n.getCategoryStyle(t)),e.xp6(2),e.Oqu(t.name),e.xp6(1),e.Q6J("ngIf",n.isPermissionEdit),e.xp6(1),e.Q6J("ngIf",n.isPermissionEdit)}}function qe(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"div",39)(1,"div",16)(2,"div",40),e.NdJ("cdkDropListDropped",function(r){e.CHM(t);const s=e.oxw();return e.KtG(s.onDropCategory(r))}),e.YNc(3,Ue,5,6,"div",41),e.qZA()()()}if(2&i){const t=e.oxw();e.xp6(2),e.Q6J("cdkDropListData",t.categoriesList),e.xp6(1),e.Q6J("ngForOf",t.categoriesList)}}function Oe(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"mat-button-toggle-group",48),e.NdJ("ngModelChange",function(r){e.CHM(t);const s=e.oxw();return e.KtG(s.modeState=r)}),e.TgZ(1,"mat-button-toggle",49)(2,"mat-icon"),e._uU(3,"home"),e.qZA()(),e.TgZ(4,"mat-button-toggle",50)(5,"mat-icon"),e._uU(6,"delete"),e.qZA()()()}if(2&i){const t=e.oxw();e.Q6J("ngModel",t.modeState)}}function Ge(i,o){1&i&&(e.TgZ(0,"button",51)(1,"mat-icon"),e._uU(2,"add"),e.qZA(),e.TgZ(3,"span"),e._uU(4,"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0438\u043d\u0433\u0440\u0435\u0434\u0438\u0435\u043d\u0442"),e.qZA()())}function Je(i,o){1&i&&(e.TgZ(0,"th",52),e._uU(1,"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435"),e.qZA())}function Fe(i,o){if(1&i&&(e.TgZ(0,"td",53),e._uU(1),e.qZA()),2&i){const t=o.$implicit;e.xp6(1),e.hij(" ",t.name," ")}}function Re(i,o){1&i&&(e.TgZ(0,"th",54),e._uU(1," \u0410\u0440\u0442\u0438\u043a\u0443\u043b "),e.qZA())}function Ye(i,o){if(1&i&&(e.TgZ(0,"td",55),e._uU(1),e.qZA()),2&i){const t=o.$implicit;e.xp6(1),e.hij(" ",t.code," ")}}function Qe(i,o){1&i&&(e.TgZ(0,"th",56),e._uU(1," \u041e\u0441\u0442\u0430\u0442\u043e\u043a, \u0435\u0434. \u0438\u0437\u043c\u0435\u0440\u0435\u043d\u0438\u044f "),e.qZA())}function He(i,o){if(1&i&&(e.TgZ(0,"td",57),e._uU(1),e.qZA()),2&i){const t=o.$implicit;e.xp6(1),e.AsE(" ",t.storeQuantity," ",t.unit," ")}}function Le(i,o){1&i&&(e.TgZ(0,"th",58),e._uU(1," \xa0 "),e.qZA())}function Be(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"button",63),e.NdJ("click",function(r){e.CHM(t);const s=e.oxw().$implicit,u=e.oxw();return e.KtG(u.onRemoveRow(r,s))}),e.TgZ(1,"mat-icon"),e._uU(2,"highlight_off"),e.qZA()()}}function Ke(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"button",64),e.NdJ("click",function(r){e.CHM(t);const s=e.oxw().$implicit,u=e.oxw();return e.KtG(u.onRestoreRow(r,s))}),e.TgZ(1,"mat-icon"),e._uU(2,"done"),e.qZA()()}}function $e(i,o){if(1&i&&(e.TgZ(0,"td",59)(1,"div",60),e.YNc(2,Be,3,0,"button",61),e.YNc(3,Ke,3,0,"button",62),e.qZA()()),2&i){const t=e.oxw();e.xp6(2),e.Q6J("ngIf","standart"===t.modeState),e.xp6(1),e.Q6J("ngIf","deleted"===t.modeState)}}function je(i,o){if(1&i&&(e.TgZ(0,"td",65)(1,"div",66),e._uU(2,"\u041d\u0435\u0442 \u0438\u043d\u0433\u0440\u0435\u0434\u0438\u0435\u043d\u0442\u043e\u0432"),e.qZA()()),2&i){const t=e.oxw();e.uIk("colspan",t.colspanTable)}}function We(i,o){1&i&&e._UZ(0,"tr",67)}F.\u0275fac=function(o){return new(o||F)(e.Y36(_.F0),e.Y36(l.xA),e.Y36(h.uR),e.Y36(v.oh),e.Y36(h.KD),e.Y36(D.Dx))},F.\u0275cmp=e.Xpm({type:F,selectors:[["store-dishes"]],features:[e.qOj],decls:40,vars:18,consts:[[1,"flex-row","flex-auto"],[1,"side-container"],[1,"page-table-head"],[1,"page-table-head__title","flex-auto"],["mat-icon-button","","color","primary","matTooltip","\u0418\u043d\u0433\u0440\u0435\u0434\u0438\u0435\u043d\u0442\u044b \u0431\u0435\u0437 \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u0438",3,"dragover","dragleave","dragend","drop","click"],["mat-raised-button","","color","primary","class","mat-button-with-icon",3,"click",4,"ngIf"],[1,"flex-col","flex-auto","mt-10"],["class","flex-col-centered flex-auto",4,"ngIf"],["class","scroll-container",4,"ngIf"],[1,"flex-col","flex-auto"],[3,"ngModel","ngModelChange",4,"ngIf"],[1,"page-table-head__title","flex-auto","ml-10"],[3,"length","pageSize","pageSizeOptions","changes","page"],["mat-raised-button","","color","primary","class","mat-button-with-icon w-250","routerLink","/store/dishes/add",4,"ngIf"],[1,"page-content"],[1,"scroll-container","content"],[1,"scroll"],["scrollElement",""],["mat-table","",1,"table","with-borders",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","code"],["mat-header-cell","","class","td-width-code",4,"matHeaderCellDef"],["mat-cell","","class","td-width-code",4,"matCellDef"],["matColumnDef","storeQuantity"],["mat-header-cell","","class","td-width-quantity",4,"matHeaderCellDef"],["mat-cell","","class","text-right td-width-quantity",4,"matCellDef"],["matColumnDef","buttons"],["mat-header-cell","","class","buttons-cell",4,"matHeaderCellDef"],["mat-cell","","class","buttons-cell",4,"matCellDef"],["matColumnDef","notFound"],["mat-footer-cell","",4,"matFooterCellDef"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","","class","table-row","draggable","true",3,"ngClass","dragstart","dragend","click",4,"matRowDef","matRowDefColumns"],["mat-footer-row","",4,"matFooterRowDef"],["mat-raised-button","","color","primary",1,"mat-button-with-icon",3,"click"],[1,"flex-col-centered","flex-auto"],[1,"text-danger"],[1,"scroll-container"],["cdkDropList","",1,"goods-categories",3,"cdkDropListData","cdkDropListDropped"],["cdkDrag","","class","goods-categories__item",3,"goods-categories__item--selected","dragover","dragleave","dragend","drop","click",4,"ngFor","ngForOf"],["cdkDrag","",1,"goods-categories__item",3,"dragover","dragleave","dragend","drop","click"],[1,"flex-auto"],["mat-icon-button","","color","primary",3,"click",4,"ngIf"],["mat-icon-button","","color","accent",3,"click",4,"ngIf"],["mat-icon-button","","color","primary",3,"click"],["mat-icon-button","","color","accent",3,"click"],[3,"ngModel","ngModelChange"],["value","standart","matTooltip","\u0421\u0442\u0430\u043d\u0434\u0430\u0440\u0442\u043d\u044b\u0439 \u0440\u0435\u0436\u0438\u043c"],["value","deleted","matTooltip","\u0420\u0435\u0436\u0438\u043c \u0443\u0434\u0430\u043b\u0435\u043d\u043d\u044b\u0445 \u0442\u043e\u0432\u0430\u0440\u043e\u0432"],["mat-raised-button","","color","primary","routerLink","/store/dishes/add",1,"mat-button-with-icon","w-250"],["mat-header-cell",""],["mat-cell",""],["mat-header-cell","",1,"td-width-code"],["mat-cell","",1,"td-width-code"],["mat-header-cell","",1,"td-width-quantity"],["mat-cell","",1,"text-right","td-width-quantity"],["mat-header-cell","",1,"buttons-cell"],["mat-cell","",1,"buttons-cell"],[1,"container"],["mat-icon-button","","color","accent","matTooltip","\u041f\u043e\u043c\u0435\u0442\u0438\u0442\u044c \u0442\u043e\u0432\u0430\u0440 \u043a\u0430\u043a \u0443\u0434\u0430\u043b\u0435\u043d\u043d\u044b\u0439",3,"click",4,"ngIf"],["mat-icon-button","","color","primary","matTooltip","\u0412\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0442\u043e\u0432\u0430\u0440",3,"click",4,"ngIf"],["mat-icon-button","","color","accent","matTooltip","\u041f\u043e\u043c\u0435\u0442\u0438\u0442\u044c \u0442\u043e\u0432\u0430\u0440 \u043a\u0430\u043a \u0443\u0434\u0430\u043b\u0435\u043d\u043d\u044b\u0439",3,"click"],["mat-icon-button","","color","primary","matTooltip","\u0412\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0442\u043e\u0432\u0430\u0440",3,"click"],["mat-footer-cell",""],[1,"text-center","text-danger"],["mat-header-row",""],["mat-row","","draggable","true",1,"table-row",3,"ngClass","dragstart","dragend","click"],["mat-footer-row",""]],template:function(o,t){1&o&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"button",4),e.NdJ("dragover",function(r){return t.onCategoryDragOver(r,{id:-1})})("dragleave",function(){return t.onCategoryDragLeave()})("dragend",function(r){return t.onCategoryDragEnd(r)})("drop",function(r){return t.onCategoryDrop(r,{id:-1})})("click",function(){return t.onHomeCategory()}),e.TgZ(5,"mat-icon"),e._uU(6,"home"),e.qZA()()(),e.YNc(7,se,5,0,"button",5),e.qZA(),e.TgZ(8,"div",6),e.YNc(9,ue,3,0,"div",7),e.YNc(10,de,4,2,"div",8),e.qZA()(),e.TgZ(11,"div",9)(12,"div",2),e.YNc(13,me,7,1,"mat-button-toggle-group",10),e.TgZ(14,"div",11),e._uU(15),e.qZA(),e.TgZ(16,"mat-paginator",12),e.NdJ("changes",function(){return t.updatePaginator})("page",function(r){return t.onPageChanged(r)}),e.qZA(),e.YNc(17,ge,5,0,"button",13),e.qZA(),e.TgZ(18,"div",14)(19,"div",15)(20,"div",16,17)(22,"table",18),e.ynx(23,19),e.YNc(24,_e,2,0,"th",20),e.YNc(25,pe,2,1,"td",21),e.BQk(),e.ynx(26,22),e.YNc(27,fe,2,0,"th",23),e.YNc(28,he,2,1,"td",24),e.BQk(),e.ynx(29,25),e.YNc(30,Ce,2,0,"th",26),e.YNc(31,xe,2,2,"td",27),e.BQk(),e.ynx(32,28),e.YNc(33,ve,2,0,"th",29),e.YNc(34,Te,4,2,"td",30),e.BQk(),e.ynx(35,31),e.YNc(36,De,3,1,"td",32),e.BQk(),e.YNc(37,we,1,0,"tr",33),e.YNc(38,ye,1,3,"tr",34),e.YNc(39,Ee,1,0,"tr",35),e.qZA()()()()()()),2&o&&(e.xp6(4),e.ekj("is-valid-drop",-1===t.dragOverCategoryId),e.xp6(3),e.Q6J("ngIf",t.isPermissionEdit),e.xp6(2),e.Q6J("ngIf",0===t.categoriesList.length),e.xp6(1),e.Q6J("ngIf",t.categoriesList.length>0),e.xp6(3),e.Q6J("ngIf",t.isPermissionEdit&&t.isPermissionRemove),e.xp6(2),e.hij(" ",t.selectedCategoryName," "),e.xp6(1),e.Q6J("length",t.total)("pageSize",t.pageSize)("pageSizeOptions",t.pageSizeOptions),e.xp6(1),e.Q6J("ngIf",t.isPermissionEdit),e.xp6(5),e.Q6J("dataSource",t.dataSource),e.xp6(15),e.Q6J("matHeaderRowDef",t.displayedColumns)("matHeaderRowDefSticky",!0),e.xp6(1),e.Q6J("matRowDefColumns",t.displayedColumns),e.xp6(1),e.Q6J("matFooterRowDef",t.dataSource&&t.dataSource.length?e.DdM(16,Ie):e.DdM(17,ke)))},dependencies:[f.mk,f.sg,f.O5,c.JJ,c.On,_.rH,b.Hw,w.Wj,w.Zt,T.A9,T.Yi,C.lW,C.RK,a.BZ,a.fO,a.as,a.w1,a.Dz,a.nj,a.mD,a.Ke,a.ge,a.ev,a.yh,a.XQ,a.Gk,a.Q2,W.NW,I.gM],styles:["[_nghost-%COMP%]{flex:auto;display:flex;flex-direction:column}.side-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:300px;border-right:1px solid #004990}.goods-categories[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding-left:5px}.goods-categories[_ngcontent-%COMP%]   .goods-categories__item[_ngcontent-%COMP%]{display:flex;align-items:center;padding:3px 3px 3px 10px;cursor:default}.goods-categories[_ngcontent-%COMP%]   .goods-categories__item[_ngcontent-%COMP%]:hover{background-color:#d6e6fc}.goods-categories[_ngcontent-%COMP%]   .goods-categories__item.goods-categories__item--selected[_ngcontent-%COMP%]{background-color:#004990;color:#fff}.goods-categories[_ngcontent-%COMP%]   .goods-categories__item.goods-categories__item--selected[_ngcontent-%COMP%]   .mat-primary[_ngcontent-%COMP%]{color:#fff}.goods-categories.cdk-drop-list-dragging[_ngcontent-%COMP%]   .goods-categories__item[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}.goods-categories__item.cdk-drag-preview[_ngcontent-%COMP%]{display:flex}.is-valid-drop[_ngcontent-%COMP%]{background-color:#349d1780!important}.td-width-code[_ngcontent-%COMP%], .td-width-quantity[_ngcontent-%COMP%]{width:200px}"]});const ze=function(i){return{selected:i}};function Ve(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"tr",68),e.NdJ("dragstart",function(r){const u=e.CHM(t).$implicit,d=e.oxw();return e.KtG(d.onGoodsDragStart(r,u))})("dragend",function(r){const u=e.CHM(t).index,d=e.oxw();return e.KtG(d.onGoodsDragEnd(r,u))})("click",function(){const s=e.CHM(t).$implicit,u=e.oxw();return e.KtG(u.onSelectRow(s))}),e.qZA()}2&i&&e.Q6J("ngClass",e.VKq(1,ze,o.$implicit.selected))}function Xe(i,o){1&i&&e._UZ(0,"tr",69)}const et=function(){return[]},tt=function(){return["notFound"]};class R extends A.D{constructor(o,t,n,r,s,u){super(),this.router=o,this.dialogService=t,this.sessionStorageService=n,this.apiGoodsService=r,this.userService=s,this.categoriesList=[],this.selectedCategoryName="\u0418\u043d\u0433\u0440\u0435\u0434\u0438\u0435\u043d\u0442\u044b \u0431\u0435\u0437 \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u0438",this.modeStateValue="standart",this.dragOverCategoryId=null,this.selectedCategoryId=null,u.setTitle(`\u0418\u043d\u0433\u0440\u0435\u0434\u0438\u0435\u043d\u0442\u044b | \u0421\u043a\u043b\u0430\u0434 | ${p.XI}`);const d=this.sessionStorageService.get(x.INGREDIENTS);d&&(this.selectedCategoryId=d)}get isPermissionEdit(){return this.userService.hasPermissions(p.jE.storeGoodsEdit)}get isPermissionRemove(){return this.userService.hasPermissions(p.jE.storeGoodsRemove)}get modeState(){return this.modeStateValue}set modeState(o){this.modeStateValue=o,this.getList(this.pageIndex)}ngOnInit(){this.displayedColumns=this.isPermissionRemove?["name","code","storeQuantity","buttons"]:["name","code","storeQuantity"],this.initialize()}onCategoryDrop(o,t){if(o.dataTransfer){const n=o.dataTransfer.getData("drag-goods");isNaN(Number(n))||(this.dragOverCategoryId=null,o.dataTransfer.dropEffect="move",o.preventDefault(),this.apiGoodsService.saveGoods({id:Number(n),categoryId:-1===t.id?null:t.id}).subscribe({error:r=>this.dialogService.showToastError(r.message,"\u041f\u0435\u0440\u0435\u043c\u0435\u0449\u0435\u043d\u0438\u0435 \u0442\u043e\u0432\u0430\u0440\u0430 \u0432 \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u044e")}))}}onCategoryDragLeave(){this.dragOverCategoryId=null}onCategoryDragEnd(o){this.dragOverCategoryId=null,o.preventDefault()}onCategoryDragOver(o,t){o.dataTransfer&&this.isPermissionEdit&&o.dataTransfer.getData("drag-goods")&&(this.dragOverCategoryId=Number(t.id),o.preventDefault())}onGoodsDragEnd(o,t){"move"===o.dataTransfer?.dropEffect&&(this.dataSource.splice(t,1),this.dataSource=[...this.dataSource])}onGoodsDragStart(o,t){o.dataTransfer?.setData("drag-goods",String(t.id))}getCategoryStyle(o){return o.id===this.dragOverCategoryId?"is-valid-drop":""}onRestoreRow(o,t){o.stopPropagation(),this.dialogService.showConfirm("\u0412\u044b \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u044d\u0442\u043e\u0442 \u0442\u043e\u0432\u0430\u0440?").subscribe(n=>{n&&t.id&&(this.dialogService.showWait("\u0412\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435..."),this.apiGoodsService.restoreGoods(t.id).pipe((0,m.x)(()=>this.dialogService.hideWait())).subscribe({next:()=>{this.getList(this.pageIndex)},error:r=>this.dialogService.showToastError(r.message)}))})}onRemoveRow(o,t){o.stopPropagation(),this.dialogService.showConfirm("\u0412\u044b \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u044d\u0442\u043e\u0442 \u0442\u043e\u0432\u0430\u0440?").subscribe(n=>{n&&t.id&&(this.dialogService.showWait("\u0423\u0434\u0430\u043b\u0435\u043d\u0438\u0435..."),this.apiGoodsService.removeGoods(t.id).pipe((0,m.x)(()=>this.dialogService.hideWait())).subscribe({next:()=>{this.getList(this.pageIndex)},error:r=>this.dialogService.showToastError(r.message)}))})}onSelectRow(o){"standart"===this.modeState&&this.router.navigate(["/store/ingredients",o.id])}onEditCategory(o,t){o.stopPropagation(),N.blurActiveElement(),this.editCategory(t)}onAddCategory(){this.editCategory()}onRemoveCategory(o,t,n){o.stopPropagation(),N.blurActiveElement(),n&&this.dialogService.showConfirm("\u0412\u044b \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u044d\u0442\u0443 \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u044e \u0441\u043e \u0432\u0441\u0435\u043c\u0438 \u0442\u043e\u0432\u0430\u0440\u0430\u043c\u0438?").subscribe(r=>{r&&(this.dialogService.showWait("\u0423\u0434\u0430\u043b\u0435\u043d\u0438\u0435..."),this.apiGoodsService.removeCategory(n).pipe((0,m.x)(()=>this.dialogService.hideWait())).subscribe({next:()=>{this.categoriesList.splice(t,1),this.selectedCategoryId===n&&this.onHomeCategory()},error:s=>this.dialogService.showToastError(s.message)}))})}onHomeCategory(){this.categoriesList.forEach(o=>o.selected=!1),this.selectedCategoryId=null,this.selectedCategoryName="\u0418\u043d\u0433\u0440\u0435\u0434\u0438\u0435\u043d\u0442\u044b \u0431\u0435\u0437 \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u0438",this.sessionStorageService.remove(x.INGREDIENTS),this.getList(this.pageIndex)}onSelectCategory(o){this.categoriesList.forEach(t=>t.selected=!1),o.selected=!0,this.selectedCategoryId=o.id,this.selectedCategoryName=`\u041a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u044f: ${o.name}`,this.sessionStorageService.set(x.INGREDIENTS,o.id),this.getList(this.pageIndex)}onDropCategory(o){if(o.isPointerOverContainer&&o.previousContainer===o.container){const t={...o.container.data[o.previousIndex]},n={...o.container.data[o.currentIndex]},r=t.orderValue;t.orderValue=n.orderValue,n.orderValue=r,this.dialogService.showWait("\u0421\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0435..."),(0,M.D)([this.apiGoodsService.saveCategory({id:t.id,orderValue:t.orderValue}),this.apiGoodsService.saveCategory({id:n.id,orderValue:n.orderValue})]).pipe((0,m.x)(()=>this.dialogService.hideWait())).subscribe({next:()=>{(0,w.bA)(o.container.data,o.previousIndex,o.currentIndex)},error:s=>this.dialogService.showToastError(s.message)})}}editCategory(o=null){this.dialogService.showModal(o?"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u0438":"\u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u0438",E,{name:o?.name??null},!0).subscribe(n=>{n?.name&&(this.dialogService.showWait("\u0421\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0435..."),this.dialogService.hideWait(),o?this.apiGoodsService.saveCategory({id:o.id,name:n.name}).pipe((0,m.x)(()=>this.dialogService.hideWait())).subscribe({next:()=>{o.name=n.name},error:r=>this.dialogService.showToastError(r.message)}):this.apiGoodsService.saveCategory({id:null,type:"ingredient",name:n.name}).pipe((0,m.x)(()=>this.dialogService.hideWait())).subscribe({next:r=>{const s={...r,selected:!0};this.categoriesList.push(s),this.onSelectCategory(s)},error:r=>this.dialogService.showToastError(r.message)}))})}initialize(){this.dialogService.showWait("\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0434\u0430\u043d\u043d\u044b\u0445..."),(0,M.D)([this.apiGoodsService.getListCategories("ingredient"),this.getListObservable(0,!1)]).pipe((0,m.x)(()=>this.dialogService.hideWait())).subscribe({next:([o])=>{this.categoriesList=o.map(t=>{const n=t.id===this.selectedCategoryId;return n&&(this.selectedCategoryName=`\u041a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u044f: ${t.name}`),{...t,selected:n}})},error:o=>this.dialogService.showToastError(o.message)})}getList(o){this.getListObservable(o).subscribe()}getListObservable(o,t=!0){return new X.y(n=>{this.dialogService.showWait("\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0434\u0430\u043d\u043d\u044b\u0445..."),this.apiGoodsService.getListGoods({type:"ingredient",categoryId:this.selectedCategoryId,page:o,pageSize:this.pageSize,deleted:"deleted"===this.modeState}).pipe((0,m.x)(()=>this.dialogService.hideWait())).subscribe({next:r=>{this.total=r.count,this.dataSource=r.values,n.next(),n.complete()},error:r=>{t&&this.dialogService.showToastError(r.message),n.error(r)}})})}}R.\u0275fac=function(o){return new(o||R)(e.Y36(_.F0),e.Y36(l.xA),e.Y36(h.uR),e.Y36(v.oh),e.Y36(h.KD),e.Y36(D.Dx))},R.\u0275cmp=e.Xpm({type:R,selectors:[["store-ingredients"]],features:[e.qOj],decls:40,vars:18,consts:[[1,"flex-row","flex-auto"],[1,"side-container"],[1,"page-table-head"],[1,"page-table-head__title","flex-auto"],["mat-icon-button","","color","primary","matTooltip","\u0418\u043d\u0433\u0440\u0435\u0434\u0438\u0435\u043d\u0442\u044b \u0431\u0435\u0437 \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u0438",3,"dragover","dragleave","dragend","drop","click"],["mat-raised-button","","color","primary","class","mat-button-with-icon",3,"click",4,"ngIf"],[1,"flex-col","flex-auto","mt-10"],["class","flex-col-centered flex-auto",4,"ngIf"],["class","scroll-container",4,"ngIf"],[1,"flex-col","flex-auto"],[3,"ngModel","ngModelChange",4,"ngIf"],[1,"page-table-head__title","flex-auto","ml-10"],[3,"length","pageSize","pageSizeOptions","changes","page"],["mat-raised-button","","color","primary","class","mat-button-with-icon w-250","routerLink","/store/ingredients/add",4,"ngIf"],[1,"page-content"],[1,"scroll-container","content"],[1,"scroll"],["scrollElement",""],["mat-table","",1,"table","with-borders",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","code"],["mat-header-cell","","class","td-width-code",4,"matHeaderCellDef"],["mat-cell","","class","td-width-code",4,"matCellDef"],["matColumnDef","storeQuantity"],["mat-header-cell","","class","td-width-quantity",4,"matHeaderCellDef"],["mat-cell","","class","text-right td-width-quantity",4,"matCellDef"],["matColumnDef","buttons"],["mat-header-cell","","class","buttons-cell",4,"matHeaderCellDef"],["mat-cell","","class","buttons-cell",4,"matCellDef"],["matColumnDef","notFound"],["mat-footer-cell","",4,"matFooterCellDef"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","","class","table-row","draggable","true",3,"ngClass","dragstart","dragend","click",4,"matRowDef","matRowDefColumns"],["mat-footer-row","",4,"matFooterRowDef"],["mat-raised-button","","color","primary",1,"mat-button-with-icon",3,"click"],[1,"flex-col-centered","flex-auto"],[1,"text-danger"],[1,"scroll-container"],["cdkDropList","",1,"goods-categories",3,"cdkDropListData","cdkDropListDropped"],["class","goods-categories__item",3,"goods-categories__item--selected","ngClass","dragover","dragleave","dragend","drop","click",4,"ngFor","ngForOf"],[1,"goods-categories__item",3,"ngClass","dragover","dragleave","dragend","drop","click"],[1,"flex-auto"],["mat-icon-button","","color","primary",3,"click",4,"ngIf"],["mat-icon-button","","color","accent",3,"click",4,"ngIf"],["mat-icon-button","","color","primary",3,"click"],["mat-icon-button","","color","accent",3,"click"],[3,"ngModel","ngModelChange"],["value","standart","matTooltip","\u0421\u0442\u0430\u043d\u0434\u0430\u0440\u0442\u043d\u044b\u0439 \u0440\u0435\u0436\u0438\u043c"],["value","deleted","matTooltip","\u0420\u0435\u0436\u0438\u043c \u0443\u0434\u0430\u043b\u0435\u043d\u043d\u044b\u0445 \u0442\u043e\u0432\u0430\u0440\u043e\u0432"],["mat-raised-button","","color","primary","routerLink","/store/ingredients/add",1,"mat-button-with-icon","w-250"],["mat-header-cell",""],["mat-cell",""],["mat-header-cell","",1,"td-width-code"],["mat-cell","",1,"td-width-code"],["mat-header-cell","",1,"td-width-quantity"],["mat-cell","",1,"text-right","td-width-quantity"],["mat-header-cell","",1,"buttons-cell"],["mat-cell","",1,"buttons-cell"],[1,"container"],["mat-icon-button","","color","accent","matTooltip","\u041f\u043e\u043c\u0435\u0442\u0438\u0442\u044c \u0442\u043e\u0432\u0430\u0440 \u043a\u0430\u043a \u0443\u0434\u0430\u043b\u0435\u043d\u043d\u044b\u0439",3,"click",4,"ngIf"],["mat-icon-button","","color","primary","matTooltip","\u0412\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0442\u043e\u0432\u0430\u0440",3,"click",4,"ngIf"],["mat-icon-button","","color","accent","matTooltip","\u041f\u043e\u043c\u0435\u0442\u0438\u0442\u044c \u0442\u043e\u0432\u0430\u0440 \u043a\u0430\u043a \u0443\u0434\u0430\u043b\u0435\u043d\u043d\u044b\u0439",3,"click"],["mat-icon-button","","color","primary","matTooltip","\u0412\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0442\u043e\u0432\u0430\u0440",3,"click"],["mat-footer-cell",""],[1,"text-center","text-danger"],["mat-header-row",""],["mat-row","","draggable","true",1,"table-row",3,"ngClass","dragstart","dragend","click"],["mat-footer-row",""]],template:function(o,t){1&o&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"button",4),e.NdJ("dragover",function(r){return t.onCategoryDragOver(r,{id:-1})})("dragleave",function(){return t.onCategoryDragLeave()})("dragend",function(r){return t.onCategoryDragEnd(r)})("drop",function(r){return t.onCategoryDrop(r,{id:-1})})("click",function(){return t.onHomeCategory()}),e.TgZ(5,"mat-icon"),e._uU(6,"home"),e.qZA()()(),e.YNc(7,Me,5,0,"button",5),e.qZA(),e.TgZ(8,"div",6),e.YNc(9,Ae,3,0,"div",7),e.YNc(10,qe,4,2,"div",8),e.qZA()(),e.TgZ(11,"div",9)(12,"div",2),e.YNc(13,Oe,7,1,"mat-button-toggle-group",10),e.TgZ(14,"div",11),e._uU(15),e.qZA(),e.TgZ(16,"mat-paginator",12),e.NdJ("changes",function(){return t.updatePaginator})("page",function(r){return t.onPageChanged(r)}),e.qZA(),e.YNc(17,Ge,5,0,"button",13),e.qZA(),e.TgZ(18,"div",14)(19,"div",15)(20,"div",16,17)(22,"table",18),e.ynx(23,19),e.YNc(24,Je,2,0,"th",20),e.YNc(25,Fe,2,1,"td",21),e.BQk(),e.ynx(26,22),e.YNc(27,Re,2,0,"th",23),e.YNc(28,Ye,2,1,"td",24),e.BQk(),e.ynx(29,25),e.YNc(30,Qe,2,0,"th",26),e.YNc(31,He,2,2,"td",27),e.BQk(),e.ynx(32,28),e.YNc(33,Le,2,0,"th",29),e.YNc(34,$e,4,2,"td",30),e.BQk(),e.ynx(35,31),e.YNc(36,je,3,1,"td",32),e.BQk(),e.YNc(37,We,1,0,"tr",33),e.YNc(38,Ve,1,3,"tr",34),e.YNc(39,Xe,1,0,"tr",35),e.qZA()()()()()()),2&o&&(e.xp6(4),e.ekj("is-valid-drop",-1===t.dragOverCategoryId),e.xp6(3),e.Q6J("ngIf",t.isPermissionEdit),e.xp6(2),e.Q6J("ngIf",0===t.categoriesList.length),e.xp6(1),e.Q6J("ngIf",t.categoriesList.length>0),e.xp6(3),e.Q6J("ngIf",t.isPermissionEdit),e.xp6(2),e.hij(" ",t.selectedCategoryName," "),e.xp6(1),e.Q6J("length",t.total)("pageSize",t.pageSize)("pageSizeOptions",t.pageSizeOptions),e.xp6(1),e.Q6J("ngIf",t.isPermissionEdit),e.xp6(5),e.Q6J("dataSource",t.dataSource),e.xp6(15),e.Q6J("matHeaderRowDef",t.displayedColumns)("matHeaderRowDefSticky",!0),e.xp6(1),e.Q6J("matRowDefColumns",t.displayedColumns),e.xp6(1),e.Q6J("matFooterRowDef",t.dataSource&&t.dataSource.length?e.DdM(16,et):e.DdM(17,tt)))},dependencies:[f.mk,f.sg,f.O5,c.JJ,c.On,_.rH,b.Hw,w.Wj,T.A9,T.Yi,C.lW,C.RK,a.BZ,a.fO,a.as,a.w1,a.Dz,a.nj,a.mD,a.Ke,a.ge,a.ev,a.yh,a.XQ,a.Gk,a.Q2,W.NW,I.gM],styles:["[_nghost-%COMP%]{flex:auto;display:flex;flex-direction:column}.side-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:300px;border-right:1px solid #004990}.goods-categories[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding-left:5px}.goods-categories[_ngcontent-%COMP%]   .goods-categories__item[_ngcontent-%COMP%]{display:flex;align-items:center;padding:3px 3px 3px 10px;cursor:default}.goods-categories[_ngcontent-%COMP%]   .goods-categories__item[_ngcontent-%COMP%]:hover{background-color:#d6e6fc}.goods-categories[_ngcontent-%COMP%]   .goods-categories__item.goods-categories__item--selected[_ngcontent-%COMP%]{background-color:#004990;color:#fff}.goods-categories[_ngcontent-%COMP%]   .goods-categories__item.goods-categories__item--selected[_ngcontent-%COMP%]   .mat-primary[_ngcontent-%COMP%]{color:#fff}.goods-categories.cdk-drop-list-dragging[_ngcontent-%COMP%]   .goods-categories__item[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}.goods-categories__item.cdk-drag-preview[_ngcontent-%COMP%]{display:flex}.is-valid-drop[_ngcontent-%COMP%]{background-color:#349d1780!important}.td-width-code[_ngcontent-%COMP%], .td-width-quantity[_ngcontent-%COMP%]{width:200px}"]});var Z=g(2722);function ot(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"button",9),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.onSave())}),e.TgZ(1,"mat-icon"),e._uU(2,"save"),e.qZA(),e.TgZ(3,"span"),e._uU(4,"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c"),e.qZA()()}if(2&i){const t=e.oxw();e.Q6J("disabled",t.savedState)}}function it(i,o){1&i&&(e.TgZ(0,"div",10),e._uU(1,"\u0418\u043d\u0433\u0440\u0435\u0434\u0438\u0435\u043d\u0442 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d"),e.qZA())}function nt(i,o){1&i&&(e.TgZ(0,"div",11),e._uU(1,"\u0414\u043e\u0441\u0442\u0443\u043f \u0437\u0430\u043f\u0440\u0435\u0449\u0435\u043d"),e.qZA())}function rt(i,o){if(1&i&&(e.TgZ(0,"div",12)(1,"div",13)(2,"div"),e._UZ(3,"kui-input",14),e.qZA(),e.TgZ(4,"div",15)(5,"div"),e._UZ(6,"kui-input",16),e.qZA(),e.TgZ(7,"div"),e._UZ(8,"kui-select",17),e.qZA(),e.TgZ(9,"div"),e._UZ(10,"kui-input",18),e.qZA()()()()),2&i){const t=e.oxw();e.xp6(3),e.Q6J("readonly",!t.isPermissionEdit),e.xp6(3),e.Q6J("readonly",!t.isPermissionEdit),e.xp6(2),e.Q6J("options",t.unitList)("clearButton",!1)("readonly",!t.isPermissionEdit),e.xp6(2),e.Q6J("readonly",!0)("value",t.storeQuantity)}}class Y{constructor(o,t,n,r,s,u,d,S){this.titleService=o,this.router=t,this.activatedRoute=n,this.dialogService=r,this.userService=s,this.apiDictionariesService=u,this.apiGoodsService=d,this.subTitle="",this.is404=!1,this.isForbidden=!1,this.savedState=!0,this.unitList=[],this.formGroup=new c.cw({name:new l.jn(null,c.kI.required),code:new l.jn(null,c.kI.required),unitId:new l.jn(null,c.kI.required)}),this.storeQuantity="",this.ngUnsubscribe=new G.x,this.goodsId=null,this.categoryId=null;const k=S.get(x.INGREDIENTS);k&&(this.categoryId=k)}get isPermissionEdit(){return this.userService.hasPermissions(p.jE.storeGoodsEdit)}ngOnInit(){this.apiDictionariesService.getUnitList().subscribe({next:o=>{this.unitList=(o||[]).map(t=>({value:t.id,title:t.name}))},error:o=>this.dialogService.showToastError(o.message,"\u0421\u043f\u0440\u0430\u0432\u043e\u0447\u043d\u0438\u043a: \u0415\u0434\u0438\u043d\u0438\u0446\u044b \u0438\u0437\u043c\u0435\u0440\u0435\u043d\u0438\u044f")}),this.formGroup.valueChanges.pipe((0,Z.R)(this.ngUnsubscribe)).subscribe(()=>this.savedState=!1),this.activatedRoute.paramMap.pipe((0,Z.R)(this.ngUnsubscribe)).subscribe(o=>{const t=o.get("id");"add"===t?(this.titleService.setTitle(`\u041d\u043e\u0432\u044b\u0439 \u0438\u043d\u0433\u0440\u0435\u0434\u0438\u0435\u043d\u0442 | \u0421\u043a\u043b\u0430\u0434 | ${p.XI}`),this.subTitle="&nbsp;&#10148;&nbsp;\u041d\u043e\u0432\u044b\u0439 \u0438\u043d\u0433\u0440\u0435\u0434\u0438\u0435\u043d\u0442",this.isPermissionEdit||(this.isForbidden=!0)):t?this.getGoods(+t):this.is404=!0})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}onSave(){if(!this.formGroup.valid)return void this.formGroup.markAllAsTouched();this.dialogService.showWait("\u0421\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0435...");const o={id:this.goodsId,categoryId:this.categoryId,type:"ingredient",...this.formGroup.value};this.apiGoodsService.saveGoods(o).pipe((0,m.x)(()=>this.dialogService.hideWait())).subscribe({next:t=>{null===this.goodsId&&this.router.navigate(["/store/ingredients",t.id]),this.savedState=!0},error:t=>{this.dialogService.showToastError(t.message)}})}getGoods(o){const t=this.isPermissionEdit?"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0438\u043d\u0433\u0440\u0435\u0434\u0438\u0435\u043d\u0442\u0430":"\u041f\u0440\u043e\u0441\u043c\u043e\u0442\u0440 \u0438\u043d\u0433\u0440\u0435\u0434\u0438\u0435\u043d\u0442\u0430";this.titleService.setTitle(`${t} | \u0421\u043a\u043b\u0430\u0434 | ${p.XI}`),this.subTitle="&nbsp;&#10148;&nbsp;"+t,this.dialogService.showWait("\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0434\u0430\u043d\u043d\u044b\u0445..."),this.apiGoodsService.getGoods(o).pipe((0,m.x)(()=>this.dialogService.hideWait())).subscribe({next:n=>{this.formGroup.patchValue(n),this.goodsId=Number(n.id),this.savedState=!0;const r=Number(n.storeQuantity);this.storeQuantity=isNaN(r)?"0":l.ZH.numberFormat(r,3)},error:n=>{this.dialogService.showToastError(n.message),this.is404=!0,this.goodsId=null}})}}function st(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"button",36),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.onAddCategory())}),e.TgZ(1,"mat-icon"),e._uU(2,"add"),e.qZA(),e.TgZ(3,"span"),e._uU(4,"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u044e"),e.qZA()()}}function ut(i,o){1&i&&(e.TgZ(0,"div",37)(1,"div",38),e._uU(2,"\u041d\u0435\u0442 \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u0439"),e.qZA()())}function at(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"button",46),e.NdJ("click",function(r){e.CHM(t);const s=e.oxw().$implicit,u=e.oxw(2);return e.KtG(u.onEditCategory(r,s))}),e.TgZ(1,"mat-icon"),e._uU(2,"edit"),e.qZA()()}}function ct(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"button",47),e.NdJ("click",function(r){e.CHM(t);const s=e.oxw(),u=s.index,d=s.$implicit,S=e.oxw(2);return e.KtG(S.onRemoveCategory(r,u,d.id))}),e.TgZ(1,"mat-icon"),e._uU(2,"highlight_off"),e.qZA()()}}function lt(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"div",42),e.NdJ("dragover",function(r){const u=e.CHM(t).$implicit,d=e.oxw(2);return e.KtG(d.onCategoryDragOver(r,u))})("dragleave",function(){e.CHM(t);const r=e.oxw(2);return e.KtG(r.onCategoryDragLeave())})("dragend",function(r){e.CHM(t);const s=e.oxw(2);return e.KtG(s.onCategoryDragEnd(r))})("drop",function(r){const u=e.CHM(t).$implicit,d=e.oxw(2);return e.KtG(d.onCategoryDrop(r,u))})("click",function(){const s=e.CHM(t).$implicit,u=e.oxw(2);return e.KtG(u.onSelectCategory(s))}),e.TgZ(1,"div",43),e._uU(2),e.qZA(),e.YNc(3,at,3,0,"button",44),e.YNc(4,ct,3,0,"button",45),e.qZA()}if(2&i){const t=o.$implicit,n=e.oxw(2);e.ekj("goods-categories__item--selected",t.selected),e.xp6(2),e.Oqu(t.name),e.xp6(1),e.Q6J("ngIf",n.isPermissionEdit),e.xp6(1),e.Q6J("ngIf",n.isPermissionEdit)}}function dt(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"div",39)(1,"div",16)(2,"div",40),e.NdJ("cdkDropListDropped",function(r){e.CHM(t);const s=e.oxw();return e.KtG(s.onDropCategory(r))}),e.YNc(3,lt,5,5,"div",41),e.qZA()()()}if(2&i){const t=e.oxw();e.xp6(2),e.Q6J("cdkDropListData",t.categoriesList),e.xp6(1),e.Q6J("ngForOf",t.categoriesList)}}function mt(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"mat-button-toggle-group",48),e.NdJ("ngModelChange",function(r){e.CHM(t);const s=e.oxw();return e.KtG(s.modeState=r)}),e.TgZ(1,"mat-button-toggle",49)(2,"mat-icon"),e._uU(3,"home"),e.qZA()(),e.TgZ(4,"mat-button-toggle",50)(5,"mat-icon"),e._uU(6,"delete"),e.qZA()()()}if(2&i){const t=e.oxw();e.Q6J("ngModel",t.modeState)}}function gt(i,o){1&i&&(e.TgZ(0,"button",51)(1,"mat-icon"),e._uU(2,"add"),e.qZA(),e.TgZ(3,"span"),e._uU(4,"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043c\u043e\u0434\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0440"),e.qZA()())}function _t(i,o){1&i&&(e.TgZ(0,"th",52),e._uU(1,"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435"),e.qZA())}function pt(i,o){if(1&i&&(e.TgZ(0,"td",53),e._uU(1),e.qZA()),2&i){const t=o.$implicit;e.xp6(1),e.hij(" ",t.name," ")}}function ft(i,o){1&i&&(e.TgZ(0,"th",54),e._uU(1," \u0410\u0440\u0442\u0438\u043a\u0443\u043b "),e.qZA())}function ht(i,o){if(1&i&&(e.TgZ(0,"td",55),e._uU(1),e.qZA()),2&i){const t=o.$implicit;e.xp6(1),e.hij(" ",t.code," ")}}function Ct(i,o){1&i&&(e.TgZ(0,"th",56),e._uU(1," \u041e\u0441\u0442\u0430\u0442\u043e\u043a, \u0435\u0434. \u0438\u0437\u043c\u0435\u0440\u0435\u043d\u0438\u044f "),e.qZA())}function xt(i,o){if(1&i&&(e.TgZ(0,"td",57),e._uU(1),e.qZA()),2&i){const t=o.$implicit;e.xp6(1),e.AsE(" ",t.storeQuantity," ",t.unit," ")}}function vt(i,o){1&i&&(e.TgZ(0,"th",58),e._uU(1," \xa0 "),e.qZA())}function bt(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"button",63),e.NdJ("click",function(r){e.CHM(t);const s=e.oxw().$implicit,u=e.oxw();return e.KtG(u.onRemoveRow(r,s))}),e.TgZ(1,"mat-icon"),e._uU(2,"highlight_off"),e.qZA()()}}function St(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"button",64),e.NdJ("click",function(r){e.CHM(t);const s=e.oxw().$implicit,u=e.oxw();return e.KtG(u.onRestoreRow(r,s))}),e.TgZ(1,"mat-icon"),e._uU(2,"done"),e.qZA()()}}function Tt(i,o){if(1&i&&(e.TgZ(0,"td",59)(1,"div",60),e.YNc(2,bt,3,0,"button",61),e.YNc(3,St,3,0,"button",62),e.qZA()()),2&i){const t=e.oxw();e.xp6(2),e.Q6J("ngIf","standart"===t.modeState),e.xp6(1),e.Q6J("ngIf","deleted"===t.modeState)}}function Dt(i,o){if(1&i&&(e.TgZ(0,"td",65)(1,"div",66),e._uU(2,"\u041d\u0435\u0442 \u043c\u043e\u0434\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0440\u043e\u0432"),e.qZA()()),2&i){const t=e.oxw();e.uIk("colspan",t.colspanTable)}}function wt(i,o){1&i&&e._UZ(0,"tr",67)}Y.\u0275fac=function(o){return new(o||Y)(e.Y36(D.Dx),e.Y36(_.F0),e.Y36(_.gz),e.Y36(l.xA),e.Y36(h.KD),e.Y36(v.Br),e.Y36(v.oh),e.Y36(h.uR))},Y.\u0275cmp=e.Xpm({type:Y,selectors:[["store-ingredient-edit"]],decls:10,vars:6,consts:[[1,"page-table-head"],["routerLink","/store/ingredients",1,"page-table-head__title","page-table-head__title--link"],[1,"page-table-head__subtitle",3,"innerHTML"],[1,"page-table-head__buttons"],["mat-raised-button","","color","success","class","mat-button-with-icon w-250",3,"disabled","click",4,"ngIf"],[1,"content",3,"formGroup"],["class","alert-message warning",4,"ngIf"],["class","alert-message danger",4,"ngIf"],["class","flex-col flex-auto",4,"ngIf"],["mat-raised-button","","color","success",1,"mat-button-with-icon","w-250",3,"disabled","click"],[1,"alert-message","warning"],[1,"alert-message","danger"],[1,"flex-col","flex-auto"],[1,"base-info-container"],["label","\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435","formControlName","name",3,"readonly"],[1,"grid-3-cell"],["label","\u0410\u0440\u0442\u0438\u043a\u0443\u043b","formControlName","code",3,"readonly"],["label","\u0415\u0434\u0438\u043d\u0438\u0446\u0430 \u0438\u0437\u043c\u0435\u0440\u0435\u043d\u0438\u044f","formControlName","unitId",3,"options","clearButton","readonly"],["label","\u041e\u0441\u0442\u0430\u0442\u043e\u043a \u043d\u0430 \u0441\u043a\u043b\u0430\u0434\u0435, \u0435\u0434.\u0438\u0437\u043c.",3,"readonly","value"]],template:function(o,t){1&o&&(e.TgZ(0,"div",0)(1,"div",1),e._uU(2," \u0418\u043d\u0433\u0440\u0435\u0434\u0438\u0435\u043d\u0442\u044b "),e.qZA(),e._UZ(3,"div",2),e.TgZ(4,"div",3),e.YNc(5,ot,5,1,"button",4),e.qZA()(),e.TgZ(6,"div",5),e.YNc(7,it,2,0,"div",6),e.YNc(8,nt,2,0,"div",7),e.YNc(9,rt,11,7,"div",8),e.qZA()),2&o&&(e.xp6(3),e.Q6J("innerHTML",t.subTitle,e.oJD),e.xp6(2),e.Q6J("ngIf",!t.is404&&!t.isForbidden&&t.isPermissionEdit),e.xp6(1),e.Q6J("formGroup",t.formGroup),e.xp6(1),e.Q6J("ngIf",t.is404),e.xp6(1),e.Q6J("ngIf",t.isForbidden),e.xp6(1),e.Q6J("ngIf",!t.is404&&!t.isForbidden))},dependencies:[f.O5,c.JJ,c.JL,c.sg,c.u,_.rH,l.y0,l.os,b.Hw,C.lW],styles:["[_nghost-%COMP%]{flex:auto;display:flex;flex-direction:column}"]});const Zt=function(i){return{selected:i}};function yt(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"tr",68),e.NdJ("dragstart",function(r){const u=e.CHM(t).$implicit,d=e.oxw();return e.KtG(d.onGoodsDragStart(r,u))})("dragend",function(r){const u=e.CHM(t).index,d=e.oxw();return e.KtG(d.onGoodsDragEnd(r,u))})("click",function(){const s=e.CHM(t).$implicit,u=e.oxw();return e.KtG(u.onSelectRow(s))}),e.qZA()}2&i&&e.Q6J("ngClass",e.VKq(1,Zt,o.$implicit.selected))}function Et(i,o){1&i&&e._UZ(0,"tr",69)}const It=function(){return[]},kt=function(){return["notFound"]};class Q extends A.D{constructor(o,t,n,r,s,u){super(),this.router=o,this.dialogService=t,this.sessionStorageService=n,this.apiGoodsService=r,this.userService=s,this.categoriesList=[],this.selectedCategoryName="\u041c\u043e\u0434\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0440\u044b \u0431\u0435\u0437 \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u0438",this.modeStateValue="standart",this.dragOverCategoryId=null,this.selectedCategoryId=null,u.setTitle(`\u041c\u043e\u0434\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0440\u044b | \u0421\u043a\u043b\u0430\u0434 | ${p.XI}`);const d=this.sessionStorageService.get(x.MODIFIERS);d&&(this.selectedCategoryId=d)}get isPermissionEdit(){return this.userService.hasPermissions(p.jE.storeGoodsEdit)}get isPermissionRemove(){return this.userService.hasPermissions(p.jE.storeGoodsRemove)}get modeState(){return this.modeStateValue}set modeState(o){this.modeStateValue=o,this.getList(this.pageIndex)}ngOnInit(){this.displayedColumns=this.isPermissionRemove?["name","code","storeQuantity","buttons"]:["name","code","storeQuantity"],this.initialize()}onCategoryDrop(o,t){if(o.dataTransfer){const n=o.dataTransfer.getData("drag-goods");isNaN(Number(n))||(this.dragOverCategoryId=null,o.dataTransfer.dropEffect="move",o.preventDefault(),this.apiGoodsService.saveGoods({id:Number(n),categoryId:-1===t.id?null:t.id}).subscribe({error:r=>this.dialogService.showToastError(r.message,"\u041f\u0435\u0440\u0435\u043c\u0435\u0449\u0435\u043d\u0438\u0435 \u0442\u043e\u0432\u0430\u0440\u0430 \u0432 \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u044e")}))}}onCategoryDragLeave(){this.dragOverCategoryId=null}onCategoryDragEnd(o){this.dragOverCategoryId=null,o.preventDefault()}onCategoryDragOver(o,t){o.dataTransfer&&this.isPermissionEdit&&o.dataTransfer.getData("drag-goods")&&(this.dragOverCategoryId=Number(t.id),o.preventDefault())}onGoodsDragEnd(o,t){"move"===o.dataTransfer?.dropEffect&&(this.dataSource.splice(t,1),this.dataSource=[...this.dataSource])}onGoodsDragStart(o,t){o.dataTransfer?.setData("drag-goods",String(t.id))}getCategoryStyle(o){return o.id===this.dragOverCategoryId?"is-valid-drop":""}onRestoreRow(o,t){o.stopPropagation(),this.dialogService.showConfirm("\u0412\u044b \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u044d\u0442\u043e\u0442 \u0442\u043e\u0432\u0430\u0440?").subscribe(n=>{n&&t.id&&(this.dialogService.showWait("\u0412\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435..."),this.apiGoodsService.restoreGoods(t.id).pipe((0,m.x)(()=>this.dialogService.hideWait())).subscribe({next:()=>{this.getList(this.pageIndex)},error:r=>this.dialogService.showToastError(r.message)}))})}onRemoveRow(o,t){o.stopPropagation(),this.dialogService.showConfirm("\u0412\u044b \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u044d\u0442\u043e\u0442 \u0442\u043e\u0432\u0430\u0440?").subscribe(n=>{n&&t.id&&(this.dialogService.showWait("\u0423\u0434\u0430\u043b\u0435\u043d\u0438\u0435..."),this.apiGoodsService.removeGoods(t.id).pipe((0,m.x)(()=>this.dialogService.hideWait())).subscribe({next:()=>{this.getList(this.pageIndex)},error:r=>this.dialogService.showToastError(r.message)}))})}onSelectRow(o){this.router.navigate(["/store/modifiers",o.id])}onEditCategory(o,t){o.stopPropagation(),N.blurActiveElement(),this.editCategory(t)}onAddCategory(){this.editCategory()}onRemoveCategory(o,t,n){o.stopPropagation(),N.blurActiveElement(),n&&this.dialogService.showConfirm("\u0412\u044b \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u044d\u0442\u0443 \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u044e \u0441\u043e \u0432\u0441\u0435\u043c\u0438 \u0442\u043e\u0432\u0430\u0440\u0430\u043c\u0438?").subscribe(r=>{r&&(this.dialogService.showWait("\u0423\u0434\u0430\u043b\u0435\u043d\u0438\u0435..."),this.apiGoodsService.removeCategory(n).pipe((0,m.x)(()=>this.dialogService.hideWait())).subscribe({next:()=>{this.categoriesList.splice(t,1),this.selectedCategoryId===n&&this.onHomeCategory()},error:s=>this.dialogService.showToastError(s.message)}))})}onHomeCategory(){this.categoriesList.forEach(o=>o.selected=!1),this.selectedCategoryId=null,this.selectedCategoryName="\u041c\u043e\u0434\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0440\u044b \u0431\u0435\u0437 \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u0438",this.sessionStorageService.remove(x.MODIFIERS),this.getList(this.pageIndex)}onSelectCategory(o){this.categoriesList.forEach(t=>t.selected=!1),o.selected=!0,this.selectedCategoryId=o.id,this.selectedCategoryName=`\u041a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u044f: ${o.name}`,this.sessionStorageService.set(x.MODIFIERS,o.id),this.getList(this.pageIndex)}onDropCategory(o){if(o.isPointerOverContainer&&o.previousContainer===o.container){const t={...o.container.data[o.previousIndex]},n={...o.container.data[o.currentIndex]},r=t.orderValue;t.orderValue=n.orderValue,n.orderValue=r,this.dialogService.showWait("\u0421\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0435..."),(0,M.D)([this.apiGoodsService.saveCategory({id:t.id,orderValue:t.orderValue}),this.apiGoodsService.saveCategory({id:n.id,orderValue:n.orderValue})]).pipe((0,m.x)(()=>this.dialogService.hideWait())).subscribe({next:()=>{(0,w.bA)(o.container.data,o.previousIndex,o.currentIndex)},error:s=>this.dialogService.showToastError(s.message)})}}editCategory(o=null){this.dialogService.showModal(o?"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u0438":"\u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u0438",E,{name:o?.name??null},!0).subscribe(n=>{n?.name&&(this.dialogService.showWait("\u0421\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0435..."),o?this.apiGoodsService.saveCategory({id:o.id,name:n.name}).pipe((0,m.x)(()=>this.dialogService.hideWait())).subscribe({next:()=>{o.name=n.name},error:r=>this.dialogService.showToastError(r.message)}):this.apiGoodsService.saveCategory({id:null,type:"modifier",name:n.name}).pipe((0,m.x)(()=>this.dialogService.hideWait())).subscribe({next:r=>{const s={...r,selected:!0};this.categoriesList.push(s),this.onSelectCategory(s)},error:r=>this.dialogService.showToastError(r.message)}))})}initialize(){this.dialogService.showWait("\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0434\u0430\u043d\u043d\u044b\u0445..."),(0,M.D)([this.apiGoodsService.getListCategories("modifier"),this.getListObservable(0,!1)]).pipe((0,m.x)(()=>this.dialogService.hideWait())).subscribe({next:([o])=>{this.categoriesList=o.map(t=>{const n=t.id===this.selectedCategoryId;return n&&(this.selectedCategoryName=`\u041a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u044f: ${t.name}`),{...t,selected:n}})},error:o=>this.dialogService.showToastError(o.message)})}getList(o){this.getListObservable(o).subscribe()}getListObservable(o,t=!0){return new X.y(n=>{this.dialogService.showWait("\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0434\u0430\u043d\u043d\u044b\u0445..."),this.apiGoodsService.getListGoods({type:"modifier",categoryId:this.selectedCategoryId,page:o,pageSize:this.pageSize,deleted:"deleted"===this.modeState}).pipe((0,m.x)(()=>this.dialogService.hideWait())).subscribe({next:r=>{this.total=r.count,this.dataSource=r.values,n.next(),n.complete()},error:r=>{t&&this.dialogService.showToastError(r.message),n.error(r)}})})}}Q.\u0275fac=function(o){return new(o||Q)(e.Y36(_.F0),e.Y36(l.xA),e.Y36(h.uR),e.Y36(v.oh),e.Y36(h.KD),e.Y36(D.Dx))},Q.\u0275cmp=e.Xpm({type:Q,selectors:[["store-modifiers"]],features:[e.qOj],decls:40,vars:18,consts:[[1,"flex-row","flex-auto"],[1,"side-container"],[1,"page-table-head"],[1,"page-table-head__title","flex-auto"],["mat-icon-button","","color","primary","matTooltip","\u0418\u043d\u0433\u0440\u0435\u0434\u0438\u0435\u043d\u0442\u044b \u0431\u0435\u0437 \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u0438",3,"dragover","dragleave","dragend","drop","click"],["mat-raised-button","","color","primary","class","mat-button-with-icon",3,"click",4,"ngIf"],[1,"flex-col","flex-auto","mt-10"],["class","flex-col-centered flex-auto",4,"ngIf"],["class","scroll-container",4,"ngIf"],[1,"flex-col","flex-auto"],[3,"ngModel","ngModelChange",4,"ngIf"],[1,"page-table-head__title","flex-auto","ml-10"],[3,"length","pageSize","pageSizeOptions","changes","page"],["mat-raised-button","","color","primary","class","mat-button-with-icon w-250","routerLink","/store/modifiers/add",4,"ngIf"],[1,"page-content"],[1,"scroll-container","content"],[1,"scroll"],["scrollElement",""],["mat-table","",1,"table","with-borders",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","code"],["mat-header-cell","","class","td-width-code",4,"matHeaderCellDef"],["mat-cell","","class","td-width-code",4,"matCellDef"],["matColumnDef","storeQuantity"],["mat-header-cell","","class","td-width-quantity",4,"matHeaderCellDef"],["mat-cell","","class","text-right td-width-quantity",4,"matCellDef"],["matColumnDef","buttons"],["mat-header-cell","","class","buttons-cell",4,"matHeaderCellDef"],["mat-cell","","class","buttons-cell",4,"matCellDef"],["matColumnDef","notFound"],["mat-footer-cell","",4,"matFooterCellDef"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","","class","table-row","draggable","true",3,"ngClass","dragstart","dragend","click",4,"matRowDef","matRowDefColumns"],["mat-footer-row","",4,"matFooterRowDef"],["mat-raised-button","","color","primary",1,"mat-button-with-icon",3,"click"],[1,"flex-col-centered","flex-auto"],[1,"text-danger"],[1,"scroll-container"],["cdkDropList","",1,"goods-categories",3,"cdkDropListData","cdkDropListDropped"],["cdkDrag","","class","goods-categories__item",3,"goods-categories__item--selected","dragover","dragleave","dragend","drop","click",4,"ngFor","ngForOf"],["cdkDrag","",1,"goods-categories__item",3,"dragover","dragleave","dragend","drop","click"],[1,"flex-auto"],["mat-icon-button","","color","primary",3,"click",4,"ngIf"],["mat-icon-button","","color","accent",3,"click",4,"ngIf"],["mat-icon-button","","color","primary",3,"click"],["mat-icon-button","","color","accent",3,"click"],[3,"ngModel","ngModelChange"],["value","standart","matTooltip","\u0421\u0442\u0430\u043d\u0434\u0430\u0440\u0442\u043d\u044b\u0439 \u0440\u0435\u0436\u0438\u043c"],["value","deleted","matTooltip","\u0420\u0435\u0436\u0438\u043c \u0443\u0434\u0430\u043b\u0435\u043d\u043d\u044b\u0445 \u0442\u043e\u0432\u0430\u0440\u043e\u0432"],["mat-raised-button","","color","primary","routerLink","/store/modifiers/add",1,"mat-button-with-icon","w-250"],["mat-header-cell",""],["mat-cell",""],["mat-header-cell","",1,"td-width-code"],["mat-cell","",1,"td-width-code"],["mat-header-cell","",1,"td-width-quantity"],["mat-cell","",1,"text-right","td-width-quantity"],["mat-header-cell","",1,"buttons-cell"],["mat-cell","",1,"buttons-cell"],[1,"container"],["mat-icon-button","","color","accent","matTooltip","\u041f\u043e\u043c\u0435\u0442\u0438\u0442\u044c \u0442\u043e\u0432\u0430\u0440 \u043a\u0430\u043a \u0443\u0434\u0430\u043b\u0435\u043d\u043d\u044b\u0439",3,"click",4,"ngIf"],["mat-icon-button","","color","primary","matTooltip","\u0412\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0442\u043e\u0432\u0430\u0440",3,"click",4,"ngIf"],["mat-icon-button","","color","accent","matTooltip","\u041f\u043e\u043c\u0435\u0442\u0438\u0442\u044c \u0442\u043e\u0432\u0430\u0440 \u043a\u0430\u043a \u0443\u0434\u0430\u043b\u0435\u043d\u043d\u044b\u0439",3,"click"],["mat-icon-button","","color","primary","matTooltip","\u0412\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0442\u043e\u0432\u0430\u0440",3,"click"],["mat-footer-cell",""],[1,"text-center","text-danger"],["mat-header-row",""],["mat-row","","draggable","true",1,"table-row",3,"ngClass","dragstart","dragend","click"],["mat-footer-row",""]],template:function(o,t){1&o&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"button",4),e.NdJ("dragover",function(r){return t.onCategoryDragOver(r,{id:-1})})("dragleave",function(){return t.onCategoryDragLeave()})("dragend",function(r){return t.onCategoryDragEnd(r)})("drop",function(r){return t.onCategoryDrop(r,{id:-1})})("click",function(){return t.onHomeCategory()}),e.TgZ(5,"mat-icon"),e._uU(6,"home"),e.qZA()()(),e.YNc(7,st,5,0,"button",5),e.qZA(),e.TgZ(8,"div",6),e.YNc(9,ut,3,0,"div",7),e.YNc(10,dt,4,2,"div",8),e.qZA()(),e.TgZ(11,"div",9)(12,"div",2),e.YNc(13,mt,7,1,"mat-button-toggle-group",10),e.TgZ(14,"div",11),e._uU(15),e.qZA(),e.TgZ(16,"mat-paginator",12),e.NdJ("changes",function(){return t.updatePaginator})("page",function(r){return t.onPageChanged(r)}),e.qZA(),e.YNc(17,gt,5,0,"button",13),e.qZA(),e.TgZ(18,"div",14)(19,"div",15)(20,"div",16,17)(22,"table",18),e.ynx(23,19),e.YNc(24,_t,2,0,"th",20),e.YNc(25,pt,2,1,"td",21),e.BQk(),e.ynx(26,22),e.YNc(27,ft,2,0,"th",23),e.YNc(28,ht,2,1,"td",24),e.BQk(),e.ynx(29,25),e.YNc(30,Ct,2,0,"th",26),e.YNc(31,xt,2,2,"td",27),e.BQk(),e.ynx(32,28),e.YNc(33,vt,2,0,"th",29),e.YNc(34,Tt,4,2,"td",30),e.BQk(),e.ynx(35,31),e.YNc(36,Dt,3,1,"td",32),e.BQk(),e.YNc(37,wt,1,0,"tr",33),e.YNc(38,yt,1,3,"tr",34),e.YNc(39,Et,1,0,"tr",35),e.qZA()()()()()()),2&o&&(e.xp6(4),e.ekj("is-valid-drop",-1===t.dragOverCategoryId),e.xp6(3),e.Q6J("ngIf",t.isPermissionEdit),e.xp6(2),e.Q6J("ngIf",0===t.categoriesList.length),e.xp6(1),e.Q6J("ngIf",t.categoriesList.length>0),e.xp6(3),e.Q6J("ngIf",t.isPermissionEdit),e.xp6(2),e.hij(" ",t.selectedCategoryName," "),e.xp6(1),e.Q6J("length",t.total)("pageSize",t.pageSize)("pageSizeOptions",t.pageSizeOptions),e.xp6(1),e.Q6J("ngIf",t.isPermissionEdit),e.xp6(5),e.Q6J("dataSource",t.dataSource),e.xp6(15),e.Q6J("matHeaderRowDef",t.displayedColumns)("matHeaderRowDefSticky",!0),e.xp6(1),e.Q6J("matRowDefColumns",t.displayedColumns),e.xp6(1),e.Q6J("matFooterRowDef",t.dataSource&&t.dataSource.length?e.DdM(16,It):e.DdM(17,kt)))},dependencies:[f.mk,f.sg,f.O5,c.JJ,c.On,_.rH,b.Hw,w.Wj,w.Zt,T.A9,T.Yi,C.lW,C.RK,a.BZ,a.fO,a.as,a.w1,a.Dz,a.nj,a.mD,a.Ke,a.ge,a.ev,a.yh,a.XQ,a.Gk,a.Q2,W.NW,I.gM],styles:["[_nghost-%COMP%]{flex:auto;display:flex;flex-direction:column}.side-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:300px;border-right:1px solid #004990}.goods-categories[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding-left:5px}.goods-categories[_ngcontent-%COMP%]   .goods-categories__item[_ngcontent-%COMP%]{display:flex;align-items:center;padding:3px 3px 3px 10px;cursor:default}.goods-categories[_ngcontent-%COMP%]   .goods-categories__item[_ngcontent-%COMP%]:hover{background-color:#d6e6fc}.goods-categories[_ngcontent-%COMP%]   .goods-categories__item.goods-categories__item--selected[_ngcontent-%COMP%]{background-color:#004990;color:#fff}.goods-categories[_ngcontent-%COMP%]   .goods-categories__item.goods-categories__item--selected[_ngcontent-%COMP%]   .mat-primary[_ngcontent-%COMP%]{color:#fff}.goods-categories.cdk-drop-list-dragging[_ngcontent-%COMP%]   .goods-categories__item[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}.goods-categories__item.cdk-drag-preview[_ngcontent-%COMP%]{display:flex}.is-valid-drop[_ngcontent-%COMP%]{background-color:#349d1780!important}.td-width-code[_ngcontent-%COMP%], .td-width-quantity[_ngcontent-%COMP%]{width:200px}"]});var P=g(3848),z=g(7445),V=g(2529),y=g(7258);class H{constructor(o,t){this.dialogService=o,this.apiGoodsService=t,this.goodsList=[],this.formGroup=new c.cw({goodsId:new l.jn(null,c.kI.required),countUses:new l.jn(null,c.kI.required)})}ngOnInit(){this.apiGoodsService.getListGoods({type:"ingredient",deleted:!1}).subscribe({next:o=>{this.goodsList=(o.values||[]).map(t=>({value:t.id,title:t.name}))},error:o=>this.dialogService.showToastError(o.message)})}apply(){this.formGroup.valid&&this.dialogRef?.close({...this.formGroup.value})}close(){this.dialogRef?.close(null)}}function Mt(i,o){1&i&&(e.TgZ(0,"th",23),e._uU(1,"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435"),e.qZA())}function At(i,o){if(1&i&&(e.TgZ(0,"td",24)(1,"div",25)(2,"button",26)(3,"mat-icon"),e._uU(4,"open_in_new"),e.qZA()(),e.TgZ(5,"span",27),e._uU(6),e.qZA()()()),2&i){const t=o.$implicit;e.xp6(2),e.MGl("routerLink","/store/ingredients/",t.goodsId,""),e.xp6(4),e.hij(" ",t.goodsName," ")}}function Nt(i,o){1&i&&(e.TgZ(0,"th",28),e._uU(1,"\u0410\u0440\u0442\u0438\u043a\u0443\u043b"),e.qZA())}function Pt(i,o){if(1&i&&(e.TgZ(0,"td",29),e._uU(1),e.qZA()),2&i){const t=o.$implicit;e.xp6(1),e.hij(" ",t.goodsCode," ")}}function Ut(i,o){1&i&&(e.TgZ(0,"th",30),e._uU(1," \u0415\u0434\u0438\u043d\u0438\u0446\u0430 \u0438\u0437\u043c\u0435\u0440\u0435\u043d\u0438\u044f "),e.qZA())}function qt(i,o){if(1&i&&(e.TgZ(0,"td",31),e._uU(1),e.qZA()),2&i){const t=o.$implicit;e.xp6(1),e.hij(" ",t.unit," ")}}function Ot(i,o){1&i&&(e.TgZ(0,"th",32),e._uU(1," \u041a\u043e\u043b-\u0432\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u044f "),e.qZA())}function Gt(i,o){if(1&i&&(e.TgZ(0,"div"),e._uU(1),e.qZA()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.hij(" ",t.countUses," ")}}function Jt(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"div",36)(1,"button",37),e.NdJ("mousedown",function(){e.CHM(t);const r=e.oxw().$implicit,s=e.oxw();return e.KtG(s.onSpeedDecrementMouseDown(r))})("mouseup",function(){e.CHM(t);const r=e.oxw(2);return e.KtG(r.onSpeedStop())})("mouseout",function(){e.CHM(t);const r=e.oxw(2);return e.KtG(r.onSpeedStop())})("click",function(){e.CHM(t);const r=e.oxw().$implicit,s=e.oxw();return e.KtG(s.onSpeedDecrementClick(r))}),e.TgZ(2,"mat-icon"),e._uU(3,"remove_circle_outline"),e.qZA()(),e.TgZ(4,"input",38),e.NdJ("keydown",function(r){e.CHM(t);const s=e.oxw().$implicit,u=e.oxw();return e.KtG(u.onTextNumberKeyDown(r,s))})("focus",function(r){e.CHM(t);const s=e.oxw().$implicit,u=e.oxw();return e.KtG(u.onSelectText(r,s))})("blur",function(){e.CHM(t);const r=e.oxw().$implicit,s=e.oxw();return e.KtG(s.onBlurText(r))})("ngModelChange",function(r){e.CHM(t);const s=e.oxw().$implicit;return e.KtG(s.countUses=r)}),e.qZA(),e.TgZ(5,"button",37),e.NdJ("mousedown",function(){e.CHM(t);const r=e.oxw().$implicit,s=e.oxw();return e.KtG(s.onSpeedIncrementMouseDown(r))})("mouseup",function(){e.CHM(t);const r=e.oxw(2);return e.KtG(r.onSpeedStop())})("mouseout",function(){e.CHM(t);const r=e.oxw(2);return e.KtG(r.onSpeedStop())})("click",function(){e.CHM(t);const r=e.oxw().$implicit,s=e.oxw();return e.KtG(s.onSpeedIncrementClick(r))}),e.TgZ(6,"mat-icon"),e._uU(7,"add_circle_outline"),e.qZA()()()}if(2&i){const t=e.oxw().$implicit;e.xp6(4),e.Q6J("maxlength",5)("ngModel",t.countUses)}}function Ft(i,o){if(1&i&&(e.TgZ(0,"td",33),e.YNc(1,Gt,2,1,"div",34),e.YNc(2,Jt,8,2,"div",35),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",!t.isPermissionEdit),e.xp6(1),e.Q6J("ngIf",t.isPermissionEdit)}}function Rt(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"th",39)(1,"button",40),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.onAddRecord())}),e.TgZ(2,"mat-icon"),e._uU(3,"add_circle_outline"),e.qZA()()()}}function Yt(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"td",41)(1,"div",42)(2,"button",43),e.NdJ("click",function(){const s=e.CHM(t).$implicit,u=e.oxw();return e.KtG(u.onRemove(s.id))}),e.TgZ(3,"mat-icon"),e._uU(4,"highlight_off"),e.qZA()()()()}}function Qt(i,o){if(1&i&&(e.TgZ(0,"td",44)(1,"div",45),e._uU(2,"\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445"),e.qZA()()),2&i){const t=e.oxw();e.uIk("colspan",t.colspanTable)}}function Ht(i,o){1&i&&e._UZ(0,"tr",46)}function Lt(i,o){1&i&&e._UZ(0,"tr",47)}function Bt(i,o){1&i&&e._UZ(0,"tr",48)}H.\u0275fac=function(o){return new(o||H)(e.Y36(l.xA),e.Y36(v.oh))},H.\u0275cmp=e.Xpm({type:H,selectors:[["store-routing-edit"]],decls:8,vars:7,consts:[[1,"inside-modal-body-container",3,"formGroup"],["label","\u0422\u043e\u0432\u0430\u0440","formControlName","goodsId",3,"options","clearButton"],["label","\u041a\u043e\u043b-\u0432\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u044f","formControlName","countUses",3,"min","allowDecimals","decimals","clearButton"],[1,"footer-buttons"],["mat-raised-button","","color","primary",3,"click"],["mat-raised-button","","color","accent",3,"click"]],template:function(o,t){1&o&&(e.TgZ(0,"div",0),e._UZ(1,"kui-select",1)(2,"kui-touchspin",2),e.qZA(),e.TgZ(3,"div",3)(4,"button",4),e.NdJ("click",function(){return t.apply()}),e._uU(5,"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c"),e.qZA(),e.TgZ(6,"button",5),e.NdJ("click",function(){return t.close()}),e._uU(7,"\u0417\u0430\u043a\u0440\u044b\u0442\u044c"),e.qZA()()),2&o&&(e.Q6J("formGroup",t.formGroup),e.xp6(1),e.Q6J("options",t.goodsList)("clearButton",!1),e.xp6(1),e.Q6J("min",0)("allowDecimals",!0)("decimals",3)("clearButton",!1))},dependencies:[c.JJ,c.JL,c.sg,c.u,l.f5,l.os,C.lW],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;width:450px}"]});const Kt=function(){return[]},$t=function(){return["notFound"]};class U extends A.D{constructor(o,t){super(),this.dialogService=o,this.apiGoodsService=t,this.isPermissionEdit=!0,this.speedProcessing=!1,this.editableRouting=null}ngOnInit(){this.displayedColumns=this.isPermissionEdit?["goodsName","goodsCode","unit","countUses","buttons"]:["goodsName","goodsCode","unit","countUses"],this.getList()}onRemove(o){this.dialogService.showConfirm("\u0412\u044b \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u044d\u0442\u0443 \u043a\u0430\u0440\u0442\u0443?").subscribe(t=>{t&&this.apiGoodsService.removeRouting(o).subscribe({next:()=>this.getList(),error:n=>this.dialogService.showToastError(n.message)})})}onSpeedIncrementMouseDown(o){this.speedProcessing=!0,setTimeout(()=>this.autoSpeedIncrement(o),500)}onSpeedDecrementMouseDown(o){this.speedProcessing=!0,setTimeout(()=>this.autoSpeedDecrement(o),500)}onSpeedIncrementClick(o){this.speedProcessing=!1,this.increment(o),this.saveRouting({id:o.id,countUses:o.countUses})}onSpeedDecrementClick(o){this.speedProcessing=!1,this.decrement(o),this.saveRouting({id:o.id,countUses:o.countUses})}onSpeedStop(){this.speedProcessing=!1,this.editableRouting&&(this.saveRouting({id:this.editableRouting.id,countUses:this.editableRouting.countUses}),this.editableRouting=null)}onBlurText(o){this.editableRouting&&this.editableRouting.countUses!==o.countUses&&this.saveRouting({id:o.id,countUses:o.countUses}),this.editableRouting=null}onSelectText(o,t){o.target?.select(),this.editableRouting={...t}}onTextNumberKeyDown(o,t){if(!["ArrowLeft","ArrowRight","ArrowUp","ArrowDown","ArrowUp","Backspace","Delete"].includes(o.key)){if("."===o.key)return void((!l.ZH.hasValue(t.countUses)||String(t.countUses).indexOf(".")>=0)&&o.preventDefault());/[0-9]/.test(o.key)||o.preventDefault()}}onAddRecord(){this.dialogService.showModal("\u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0442\u043e\u0432\u0430\u0440\u0430",H,{},!0).subscribe(o=>{o&&this.saveRouting(o,!0)})}getList(){this.dialogService.showWait("\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0434\u0430\u043d\u043d\u044b\u0445..."),this.apiGoodsService.getListRouting(this.goodsId).pipe((0,m.x)(()=>this.dialogService.hideWait())).subscribe({next:o=>{this.dataSource=o},error:o=>this.dialogService.showToastError(o.message)})}saveRouting(o,t=!1){this.dialogService.showWait("\u0421\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0435..."),this.apiGoodsService.saveRouting({ownerId:this.goodsId,...o}).pipe((0,m.x)(()=>this.dialogService.hideWait())).subscribe({next:()=>{t&&this.getList()},error:n=>this.dialogService.showToastError(n.message)})}autoSpeedIncrement(o){this.editableRouting=o,(0,z.F)(100).pipe((0,V.o)(()=>this.speedProcessing)).subscribe(()=>{this.speedProcessing&&this.increment(o)})}autoSpeedDecrement(o){this.editableRouting=o,(0,z.F)(100).pipe((0,V.o)(()=>this.speedProcessing)).subscribe(()=>{this.speedProcessing&&this.decrement(o)})}increment(o){let t=new y.Z(o.countUses?o.countUses:0);t=t.plus(.01),o.countUses=Number(t.toFixed(3))}decrement(o){let t=new y.Z(o.countUses?o.countUses:0);t=t.minus(.01),o.countUses=t.lessThan(0)?0:Number(t.toFixed(3))}}function jt(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"button",9),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.onSave())}),e.TgZ(1,"mat-icon"),e._uU(2,"save"),e.qZA(),e.TgZ(3,"span"),e._uU(4,"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c"),e.qZA()()}if(2&i){const t=e.oxw();e.Q6J("disabled",t.savedState)}}function Wt(i,o){1&i&&(e.TgZ(0,"div",10),e._uU(1,"\u041c\u043e\u0434\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0440 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d"),e.qZA())}function zt(i,o){1&i&&(e.TgZ(0,"div",11),e._uU(1,"\u0414\u043e\u0441\u0442\u0443\u043f \u0437\u0430\u043f\u0440\u0435\u0449\u0435\u043d"),e.qZA())}function Vt(i,o){if(1&i&&(e.TgZ(0,"div",12)(1,"mat-tab-group",33)(2,"mat-tab",34),e._UZ(3,"store-routing-list",35),e.qZA()()()),2&i){const t=e.oxw(2);e.xp6(1),e.Q6J("mat-stretch-tabs",!1),e.xp6(2),e.Q6J("goodsId",t.goodsId)("isPermissionEdit",t.isPermissionEdit)}}function Xt(i,o){if(1&i&&(e.TgZ(0,"div",12)(1,"div",13)(2,"div",14)(3,"div"),e._UZ(4,"kui-input",15),e.qZA(),e.TgZ(5,"div",16)(6,"div"),e._UZ(7,"kui-input",17),e.qZA(),e.TgZ(8,"div"),e._UZ(9,"kui-select",18),e.qZA(),e.TgZ(10,"div"),e._UZ(11,"kui-touchspin",19),e.qZA()()(),e.TgZ(12,"div",20)(13,"div",21)(14,"div",22),e._UZ(15,"kui-touchspin",23),e.qZA(),e.TgZ(16,"div",24),e._UZ(17,"kui-touchspin",25),e.qZA(),e.TgZ(18,"div",24),e._UZ(19,"kui-touchspin",26),e.qZA()(),e.TgZ(20,"div",27)(21,"label",28),e._uU(22,"\u041c\u0435\u0442\u043e\u0434 \u0441\u043f\u0438\u0441\u0430\u043d\u0438\u044f"),e.qZA(),e.TgZ(23,"div")(24,"mat-button-toggle-group",29)(25,"mat-button-toggle",30),e._uU(26," \u041d\u0435 \u0441\u043f\u0438\u0441\u044b\u0432\u0430\u0442\u044c "),e.qZA(),e.TgZ(27,"mat-button-toggle",31),e._uU(28," \u041f\u043e \u0442\u0435\u0445. \u043a\u0430\u0440\u0442\u0435 "),e.qZA(),e.TgZ(29,"mat-button-toggle",32),e._uU(30," \u041f\u043e \u043f\u0440\u043e\u0434\u0443\u043a\u0442\u0443 "),e.qZA()()()()()(),e.YNc(31,Vt,4,3,"div",8),e.qZA()),2&i){const t=e.oxw();e.xp6(4),e.Q6J("readonly",!t.isPermissionEdit),e.xp6(3),e.Q6J("readonly",!t.isPermissionEdit),e.xp6(2),e.Q6J("options",t.unitList)("clearButton",!1)("readonly",!t.isPermissionEdit),e.xp6(2),e.Q6J("readonly",!t.isPermissionEdit),e.xp6(4),e.Q6J("readonly",!t.isPermissionEdit),e.xp6(2),e.Q6J("readonly",!t.isPermissionEdit),e.xp6(2),e.Q6J("readonly",!t.isPermissionEdit),e.xp6(12),e.Q6J("ngIf",t.goodsId)}}U.\u0275fac=function(o){return new(o||U)(e.Y36(l.xA),e.Y36(v.oh))},U.\u0275cmp=e.Xpm({type:U,selectors:[["store-routing-list"]],inputs:{goodsId:"goodsId",isPermissionEdit:"isPermissionEdit"},features:[e.qOj],decls:23,vars:7,consts:[[1,"scroll-container","content"],[1,"scroll"],["mat-table","",1,"table","with-borders",3,"dataSource"],["matColumnDef","goodsName"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","goodsCode"],["mat-header-cell","","class","cell-code",4,"matHeaderCellDef"],["mat-cell","","class","cell-code",4,"matCellDef"],["matColumnDef","unit"],["mat-header-cell","","class","cell-unit",4,"matHeaderCellDef"],["mat-cell","","class","cell-unit",4,"matCellDef"],["matColumnDef","countUses"],["mat-header-cell","","class","cell-count",4,"matHeaderCellDef"],["mat-cell","","class","cell-count",4,"matCellDef"],["matColumnDef","buttons"],["mat-header-cell","","class","buttons-cell",4,"matHeaderCellDef"],["mat-cell","","class","buttons-cell",4,"matCellDef"],["matColumnDef","notFound"],["mat-footer-cell","",4,"matFooterCellDef"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","","class","table-row","draggable","true",4,"matRowDef","matRowDefColumns"],["mat-footer-row","",4,"matFooterRowDef"],["mat-header-cell",""],["mat-cell",""],[1,"flex-align-center"],["mat-icon-button","","color","primary",3,"routerLink"],[1,"ml-10"],["mat-header-cell","",1,"cell-code"],["mat-cell","",1,"cell-code"],["mat-header-cell","",1,"cell-unit"],["mat-cell","",1,"cell-unit"],["mat-header-cell","",1,"cell-count"],["mat-cell","",1,"cell-count"],[4,"ngIf"],["class","flex-row-centered",4,"ngIf"],[1,"flex-row-centered"],["mat-icon-button","","color","primary",3,"mousedown","mouseup","mouseout","click"],["type","number","min","0","max","10","step","0.01",1,"table-input",3,"maxlength","ngModel","keydown","focus","blur","ngModelChange"],["mat-header-cell","",1,"buttons-cell"],["mat-icon-button","","color","primary","matTooltip","\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0442\u043e\u0432\u0430\u0440",3,"click"],["mat-cell","",1,"buttons-cell"],[1,"container"],["mat-icon-button","","color","accent",3,"click"],["mat-footer-cell",""],[1,"text-center","text-danger"],["mat-header-row",""],["mat-row","","draggable","true",1,"table-row"],["mat-footer-row",""]],template:function(o,t){1&o&&(e.TgZ(0,"div",0)(1,"div",1)(2,"table",2),e.ynx(3,3),e.YNc(4,Mt,2,0,"th",4),e.YNc(5,At,7,2,"td",5),e.BQk(),e.ynx(6,6),e.YNc(7,Nt,2,0,"th",7),e.YNc(8,Pt,2,1,"td",8),e.BQk(),e.ynx(9,9),e.YNc(10,Ut,2,0,"th",10),e.YNc(11,qt,2,1,"td",11),e.BQk(),e.ynx(12,12),e.YNc(13,Ot,2,0,"th",13),e.YNc(14,Ft,3,2,"td",14),e.BQk(),e.ynx(15,15),e.YNc(16,Rt,4,0,"th",16),e.YNc(17,Yt,5,0,"td",17),e.BQk(),e.ynx(18,18),e.YNc(19,Qt,3,1,"td",19),e.BQk(),e.YNc(20,Ht,1,0,"tr",20),e.YNc(21,Lt,1,0,"tr",21),e.YNc(22,Bt,1,0,"tr",22),e.qZA()()()),2&o&&(e.xp6(2),e.Q6J("dataSource",t.dataSource),e.xp6(18),e.Q6J("matHeaderRowDef",t.displayedColumns)("matHeaderRowDefSticky",!0),e.xp6(1),e.Q6J("matRowDefColumns",t.displayedColumns),e.xp6(1),e.Q6J("matFooterRowDef",t.dataSource&&t.dataSource.length?e.DdM(5,Kt):e.DdM(6,$t)))},dependencies:[f.O5,c.Fj,c.wV,c.JJ,c.nD,c.qQ,c.Fd,c.On,_.rH,b.Hw,C.RK,a.BZ,a.fO,a.as,a.w1,a.Dz,a.nj,a.mD,a.Ke,a.ge,a.ev,a.yh,a.XQ,a.Gk,a.Q2,I.gM],styles:["[_nghost-%COMP%]{flex:auto;display:flex;flex-direction:column}.table-input[_ngcontent-%COMP%]{border:none;text-align:center;font-size:16px;width:100px;outline:none;background:transparent;appearance:textfield;-webkit-appearance:none;-moz-appearance:textfield}"]});class L{constructor(o,t,n,r,s,u,d,S){this.titleService=o,this.router=t,this.activatedRoute=n,this.dialogService=r,this.userService=s,this.apiDictionariesService=u,this.apiGoodsService=d,this.subTitle="",this.is404=!1,this.isForbidden=!1,this.savedState=!0,this.unitList=[],this.formGroup=new c.cw({name:new l.jn(null,c.kI.required),code:new l.jn(null,c.kI.required),unitId:new l.jn(null,c.kI.required),price:new l.jn(null,c.kI.required),minCount:new l.jn(null,c.kI.required),maxCount:new l.jn(null,c.kI.required),defCount:new l.jn(null,c.kI.required),routeBy:new l.jn("bynull")}),this.goodsId=null,this.ngUnsubscribe=new G.x,this.categoryId=null;const k=S.get(x.MODIFIERS);k&&(this.categoryId=k)}get isPermissionEdit(){return this.userService.hasPermissions(p.jE.storeGoodsEdit)}ngOnInit(){this.apiDictionariesService.getUnitList().subscribe({next:o=>{this.unitList=(o||[]).map(t=>({value:t.id,title:t.name}))},error:o=>this.dialogService.showToastError(o.message,"\u0421\u043f\u0440\u0430\u0432\u043e\u0447\u043d\u0438\u043a: \u0415\u0434\u0438\u043d\u0438\u0446\u044b \u0438\u0437\u043c\u0435\u0440\u0435\u043d\u0438\u044f")}),this.formGroup.valueChanges.pipe((0,Z.R)(this.ngUnsubscribe)).subscribe(()=>this.savedState=!1),this.activatedRoute.paramMap.pipe((0,Z.R)(this.ngUnsubscribe)).subscribe(o=>{const t=o.get("id");"add"===t?(this.titleService.setTitle(`\u041d\u043e\u0432\u044b\u0439 \u043c\u043e\u0434\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0440 | \u0421\u043a\u043b\u0430\u0434 | ${p.XI}`),this.subTitle="&nbsp;&#10148;&nbsp;\u041d\u043e\u0432\u044b\u0439 \u043c\u043e\u0434\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0440",this.isPermissionEdit||(this.isForbidden=!0)):t?this.getGoods(+t):this.is404=!0})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}onSave(){if(!this.formGroup.valid)return void this.formGroup.markAllAsTouched();this.dialogService.showWait("\u0421\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0435...");const o={id:this.goodsId,categoryId:this.categoryId,type:"modifier",...this.formGroup.value};this.apiGoodsService.saveGoods(o).pipe((0,m.x)(()=>this.dialogService.hideWait())).subscribe({next:t=>{null===this.goodsId&&this.router.navigate(["/store/modifiers",t.id]),this.savedState=!0},error:t=>{this.dialogService.showToastError(t.message)}})}getGoods(o){const t=this.isPermissionEdit?"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u043c\u043e\u0434\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0440\u0430":"\u041f\u0440\u043e\u0441\u043c\u043e\u0442\u0440 \u043c\u043e\u0434\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0440\u0430";this.titleService.setTitle(`${t} | \u0421\u043a\u043b\u0430\u0434 | ${p.XI}`),this.subTitle="&nbsp;&#10148;&nbsp;"+t,this.dialogService.showWait("\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0434\u0430\u043d\u043d\u044b\u0445..."),this.apiGoodsService.getGoods(o).pipe((0,m.x)(()=>this.dialogService.hideWait())).subscribe({next:n=>{this.formGroup.patchValue(n),this.goodsId=Number(n.id),this.isPermissionEdit||this.formGroup.get("routeBy")?.disable(),this.savedState=!0},error:n=>{this.dialogService.showToastError(n.message),this.is404=!0,this.goodsId=null}})}}L.\u0275fac=function(o){return new(o||L)(e.Y36(D.Dx),e.Y36(_.F0),e.Y36(_.gz),e.Y36(l.xA),e.Y36(h.KD),e.Y36(v.Br),e.Y36(v.oh),e.Y36(h.uR))},L.\u0275cmp=e.Xpm({type:L,selectors:[["store-modifier-edit"]],decls:10,vars:6,consts:[[1,"page-table-head"],["routerLink","/store/modifiers",1,"page-table-head__title","page-table-head__title--link"],[1,"page-table-head__subtitle",3,"innerHTML"],[1,"page-table-head__buttons"],["mat-raised-button","","color","success","class","mat-button-with-icon w-250",3,"disabled","click",4,"ngIf"],[1,"content",3,"formGroup"],["class","alert-message warning",4,"ngIf"],["class","alert-message danger",4,"ngIf"],["class","flex-col flex-auto",4,"ngIf"],["mat-raised-button","","color","success",1,"mat-button-with-icon","w-250",3,"disabled","click"],[1,"alert-message","warning"],[1,"alert-message","danger"],[1,"flex-col","flex-auto"],[1,"flex-row"],[1,"base-info-container"],["label","\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435","formControlName","name",3,"readonly"],[1,"grid-3-cell"],["label","\u0410\u0440\u0442\u0438\u043a\u0443\u043b","formControlName","code",3,"readonly"],["label","\u0415\u0434\u0438\u043d\u0438\u0446\u0430 \u0438\u0437\u043c\u0435\u0440\u0435\u043d\u0438\u044f","formControlName","unitId",3,"options","clearButton","readonly"],["label","\u0411\u0430\u0437\u043e\u0432\u0430\u044f \u0446\u0435\u043d\u0430, \u0440\u0443\u0431","formControlName","price",3,"readonly"],[1,"flex-col","ml-30"],[1,"flex-row","mt-10"],[1,"min-max-container"],["label","\u041c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u043e\u0435 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e","formControlName","minCount",3,"readonly"],[1,"min-max-container","ml-10"],["label","\u041c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u043e\u0435 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e","formControlName","maxCount",3,"readonly"],["label","\u041a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e","formControlName","defCount",3,"readonly"],[1,"flex-col"],[1,"text-bold","mb-10"],["formControlName","routeBy"],["value","bynull"],["value","byrouting"],["value","bygoods"],[1,"tabs-panel-container","flex-auto",3,"mat-stretch-tabs"],["label","\u0422\u0435\u0445\u043d\u043e\u043b\u043e\u0433\u0438\u0447\u0435\u0441\u043a\u0430\u044f \u043a\u0430\u0440\u0442\u0430"],[3,"goodsId","isPermissionEdit"]],template:function(o,t){1&o&&(e.TgZ(0,"div",0)(1,"div",1),e._uU(2," \u041c\u043e\u0434\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0440\u044b "),e.qZA(),e._UZ(3,"div",2),e.TgZ(4,"div",3),e.YNc(5,jt,5,1,"button",4),e.qZA()(),e.TgZ(6,"div",5),e.YNc(7,Wt,2,0,"div",6),e.YNc(8,zt,2,0,"div",7),e.YNc(9,Xt,32,10,"div",8),e.qZA()),2&o&&(e.xp6(3),e.Q6J("innerHTML",t.subTitle,e.oJD),e.xp6(2),e.Q6J("ngIf",!t.is404&&!t.isForbidden&&t.isPermissionEdit),e.xp6(1),e.Q6J("formGroup",t.formGroup),e.xp6(1),e.Q6J("ngIf",t.is404),e.xp6(1),e.Q6J("ngIf",t.isForbidden),e.xp6(1),e.Q6J("ngIf",!t.is404&&!t.isForbidden))},dependencies:[f.O5,c.JJ,c.JL,c.sg,c.u,_.rH,l.y0,l.f5,l.os,b.Hw,T.A9,T.Yi,C.lW,P.uX,P.SP,U],styles:["[_nghost-%COMP%]{flex:auto;display:flex;flex-direction:column}.min-max-container[_ngcontent-%COMP%]{width:270px}"]});var ie=g(5861),ee=g(9808);function eo(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"button",9),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.onSave())}),e.TgZ(1,"mat-icon"),e._uU(2,"save"),e.qZA(),e._uU(3," \u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c "),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("disabled",t.savedState)}}function to(i,o){1&i&&(e.TgZ(0,"div",10),e._uU(1,"\u0411\u043b\u044e\u0434\u043e \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e"),e.qZA())}function oo(i,o){1&i&&(e.TgZ(0,"div",11),e._uU(1,"\u0414\u043e\u0441\u0442\u0443\u043f \u0437\u0430\u043f\u0440\u0435\u0449\u0435\u043d"),e.qZA())}function io(i,o){if(1&i&&e._UZ(0,"div",31),2&i){const t=e.oxw(2);e.Udp("background-image",t.imageBgUrl)}}function no(i,o){1&i&&(e.TgZ(0,"div",32),e._uU(1,"\u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c"),e.qZA())}function ro(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"div",33),e.NdJ("click",function(r){e.CHM(t);const s=e.oxw(2);return e.KtG(s.onRemoveImage(r))}),e.TgZ(1,"mat-icon",34),e._uU(2,"cancel"),e.qZA()()}}function so(i,o){if(1&i&&(e.TgZ(0,"div",12)(1,"mat-tab-group",35)(2,"mat-tab",36),e._UZ(3,"store-routing-list",37),e.qZA()()()),2&i){const t=e.oxw(2);e.xp6(1),e.Q6J("mat-stretch-tabs",!1),e.xp6(2),e.Q6J("goodsId",t.goodsId)("isPermissionEdit",t.isPermissionEdit)}}function uo(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"div",12)(1,"div",13)(2,"div",14),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.onUploadImage())}),e.YNc(3,io,1,2,"div",15),e.YNc(4,no,2,0,"div",16),e.YNc(5,ro,3,0,"div",17),e.qZA(),e.TgZ(6,"div",18)(7,"div"),e._UZ(8,"kui-input",19),e.qZA(),e.TgZ(9,"div",20)(10,"div"),e._UZ(11,"kui-input",21),e.qZA(),e.TgZ(12,"div"),e._UZ(13,"kui-select",22),e.qZA(),e.TgZ(14,"div"),e._UZ(15,"kui-touchspin",23),e.qZA()()(),e.TgZ(16,"div",24)(17,"div",25)(18,"label",26),e._uU(19,"\u041c\u0435\u0442\u043e\u0434 \u0441\u043f\u0438\u0441\u0430\u043d\u0438\u044f"),e.qZA(),e.TgZ(20,"div")(21,"mat-button-toggle-group",27)(22,"mat-button-toggle",28),e._uU(23," \u041d\u0435 \u0441\u043f\u0438\u0441\u044b\u0432\u0430\u0442\u044c "),e.qZA(),e.TgZ(24,"mat-button-toggle",29),e._uU(25," \u041f\u043e \u0442\u0435\u0445. \u043a\u0430\u0440\u0442\u0435 "),e.qZA(),e.TgZ(26,"mat-button-toggle",30),e._uU(27," \u041f\u043e \u043f\u0440\u043e\u0434\u0443\u043a\u0442\u0443 "),e.qZA()()()()()(),e.YNc(28,so,4,3,"div",8),e.qZA()}if(2&i){const t=e.oxw();e.xp6(2),e.ekj("cursor-pointer",t.isPermissionEdit),e.xp6(1),e.Q6J("ngIf",t.imageBgUrl),e.xp6(1),e.Q6J("ngIf",t.isPermissionEdit),e.xp6(1),e.Q6J("ngIf",t.imageBgUrl&&t.isPermissionEdit),e.xp6(3),e.Q6J("readonly",!t.isPermissionEdit)("clearButton",!1),e.xp6(3),e.Q6J("readonly",!t.isPermissionEdit)("clearButton",!1),e.xp6(2),e.Q6J("options",t.unitList)("readonly",!t.isPermissionEdit)("clearButton",!1),e.xp6(2),e.Q6J("readonly",!t.isPermissionEdit)("clearButton",!1),e.xp6(13),e.Q6J("ngIf",t.goodsId)}}class B{constructor(o,t,n,r,s,u,d,S,k){this.titleService=o,this.router=t,this.activatedRoute=n,this.dialogService=r,this.userService=s,this.apiDictionariesService=u,this.apiGoodsService=d,this.apiFilesService=S,this.subTitle="",this.is404=!1,this.isForbidden=!1,this.savedState=!0,this.unitList=[],this.formGroup=new c.cw({name:new l.jn(null,c.kI.required),code:new l.jn(null,c.kI.required),unitId:new l.jn(null,c.kI.required),price:new l.jn(null,c.kI.required),routeBy:new l.jn("bynull")}),this.goodsId=null,this.imageBgUrl=null,this.ngUnsubscribe=new G.x,this.categoryId=null,this.imageFile=null,this.imageId=null;const ne=k.get(x.DISHES);ne&&(this.categoryId=ne)}get isPermissionEdit(){return this.userService.hasPermissions(p.jE.storeGoodsEdit)}ngOnInit(){this.apiDictionariesService.getUnitList().subscribe({next:o=>{this.unitList=(o||[]).map(t=>({value:t.id,title:t.name}))},error:o=>this.dialogService.showToastError(o.message,"\u0421\u043f\u0440\u0430\u0432\u043e\u0447\u043d\u0438\u043a: \u0415\u0434\u0438\u043d\u0438\u0446\u044b \u0438\u0437\u043c\u0435\u0440\u0435\u043d\u0438\u044f")}),this.formGroup.valueChanges.pipe((0,Z.R)(this.ngUnsubscribe)).subscribe(()=>this.savedState=!1),this.activatedRoute.paramMap.pipe((0,Z.R)(this.ngUnsubscribe)).subscribe(o=>{const t=o.get("id");"add"===t?(this.titleService.setTitle(`\u041d\u043e\u0432\u043e\u0435 \u0431\u043b\u044e\u0434\u043e | \u0421\u043a\u043b\u0430\u0434 | ${p.XI}`),this.subTitle="&nbsp;&#10148;&nbsp;\u041d\u043e\u0432\u043e\u0435 \u0431\u043b\u044e\u0434\u043e",this.isPermissionEdit||(this.isForbidden=!0)):t?this.getGoods(+t):this.is404=!0})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}onRemoveImage(o){o.stopPropagation(),this.imageBgUrl=null,this.savedState=!1}onUploadImage(){this.isPermissionEdit&&l.ZH.uploadFile("image/*").subscribe(o=>{this.imageFile=o,this.savedState=!1,this.imageBgUrl=`url(${URL.createObjectURL(this.imageFile)})`})}onSave(){var o=this;return(0,ie.Z)(function*(){if(!o.formGroup.valid)return void o.formGroup.markAllAsTouched();o.dialogService.showWait("\u0421\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0435...");const t=yield o.saveImage(),n={id:o.goodsId,categoryId:o.categoryId,type:"dish",imageId:t,...o.formGroup.value};o.apiGoodsService.saveGoods(n).pipe((0,m.x)(()=>o.dialogService.hideWait())).subscribe({next:r=>{null===o.goodsId&&o.router.navigate(["/store/dishes",r.id]),o.savedState=!0},error:r=>{o.dialogService.showToastError(r.message)}})})()}getGoods(o){const t=this.isPermissionEdit?"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0431\u043b\u044e\u0434\u0430":"\u041f\u0440\u043e\u0441\u043c\u043e\u0442\u0440 \u0431\u043b\u044e\u0434\u0430";this.titleService.setTitle(`${t} | \u0421\u043a\u043b\u0430\u0434 | ${p.XI}`),this.subTitle="&nbsp;&#10148;&nbsp;"+t,this.dialogService.showWait("\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0434\u0430\u043d\u043d\u044b\u0445..."),this.apiGoodsService.getGoods(o).pipe((0,m.x)(()=>this.dialogService.hideWait())).subscribe({next:n=>{this.imageId=n.imageId??null,this.formGroup.patchValue(n),this.goodsId=Number(n.id),this.savedState=!0,this.isPermissionEdit||this.formGroup.get("routeBy")?.disable(),this.loadImage()},error:n=>{this.dialogService.showToastError(n.message),this.is404=!0,this.goodsId=null}})}loadImage(){this.imageId&&this.apiFilesService.getFile(this.imageId).subscribe({next:o=>{this.imageBgUrl=`url(${URL.createObjectURL(o.file)})`},error:o=>this.dialogService.showToastError(o.message)})}saveImage(){var o=this;return(0,ie.Z)(function*(){if(!o.imageFile&&!o.imageBgUrl){if(o.imageId)try{yield(0,ee.n)(o.apiFilesService.removeFile(o.imageId))}catch{}return null}if(o.imageFile)try{return o.imageId?(yield(0,ee.n)(o.apiFilesService.updateFile(o.imageId,o.imageFile)),o.imageId):yield(0,ee.n)(o.apiFilesService.addFile(o.imageFile))}catch(t){return o.dialogService.showToastError(t.message),null}return o.imageId})()}}function ao(i,o){1&i&&(e.TgZ(0,"button",29)(1,"mat-icon"),e._uU(2,"add"),e.qZA(),e.TgZ(3,"span"),e._uU(4,"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043d\u0430\u043a\u043b\u0430\u0434\u043d\u0443\u044e"),e.qZA()())}function co(i,o){1&i&&(e.TgZ(0,"th",30),e._uU(1," \u041d\u043e\u043c\u0435\u0440 \u043d\u0430\u043a\u043b\u0430\u0434\u043d\u043e\u0439 "),e.qZA())}function lo(i,o){if(1&i&&(e.TgZ(0,"td",31),e._uU(1),e.qZA()),2&i){const t=o.$implicit;e.xp6(1),e.hij(" ",t.docNumber," ")}}function mo(i,o){1&i&&(e.TgZ(0,"th",32),e._uU(1," \u0414\u0430\u0442\u0430 \u043f\u043e\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u044f "),e.qZA())}function go(i,o){if(1&i&&(e.TgZ(0,"td",33),e._uU(1),e.qZA()),2&i){const t=o.$implicit;e.xp6(1),e.hij(" ",t.receiptDate," ")}}function _o(i,o){1&i&&(e.TgZ(0,"th",34),e._uU(1," \u041f\u043e\u0441\u0442\u0430\u0432\u0449\u0438\u043a "),e.qZA())}function po(i,o){if(1&i&&(e.TgZ(0,"td",35),e._uU(1),e.qZA()),2&i){const t=o.$implicit;e.xp6(1),e.hij(" ",t.supplierName," ")}}function fo(i,o){1&i&&(e.TgZ(0,"th",36),e._uU(1," \u041f\u0440\u043e\u0432\u0435\u0434\u0435\u043d "),e.qZA())}function ho(i,o){1&i&&(e.TgZ(0,"div",40)(1,"mat-icon"),e._uU(2,"done"),e.qZA()())}function Co(i,o){1&i&&(e.TgZ(0,"div",41)(1,"mat-icon"),e._uU(2,"close"),e.qZA()())}function xo(i,o){if(1&i&&(e.TgZ(0,"td",37),e.YNc(1,ho,3,0,"div",38),e.YNc(2,Co,3,0,"div",39),e.qZA()),2&i){const t=o.$implicit;e.xp6(1),e.Q6J("ngIf",t.posting),e.xp6(1),e.Q6J("ngIf",!t.posting)}}function vo(i,o){1&i&&(e.TgZ(0,"th",42),e._uU(1,"\xa0"),e.qZA())}function bo(i,o){if(1&i&&(e.TgZ(0,"td",43)(1,"div",44)(2,"button",45)(3,"mat-icon"),e._uU(4,"done"),e.qZA()()()()),2&i){const t=o.$implicit;e.xp6(2),e.Q6J("disabled",t.posting)}}function So(i,o){if(1&i&&(e.TgZ(0,"td",46)(1,"div",47),e._uU(2,"\u041d\u0435\u0442 \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u043e\u0432"),e.qZA()()),2&i){const t=e.oxw();e.uIk("colspan",t.colspanTable)}}function To(i,o){1&i&&e._UZ(0,"tr",48)}function Do(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"tr",49),e.NdJ("click",function(){const s=e.CHM(t).$implicit,u=e.oxw();return e.KtG(u.onSelectRow(s))}),e.qZA()}}function wo(i,o){1&i&&e._UZ(0,"tr",50)}B.\u0275fac=function(o){return new(o||B)(e.Y36(D.Dx),e.Y36(_.F0),e.Y36(_.gz),e.Y36(l.xA),e.Y36(h.KD),e.Y36(v.Br),e.Y36(v.oh),e.Y36(v.tX),e.Y36(h.uR))},B.\u0275cmp=e.Xpm({type:B,selectors:[["store-dishes-edit"]],decls:10,vars:6,consts:[[1,"page-table-head"],["routerLink","/store/dishes",1,"page-table-head__title","page-table-head__title--link"],[1,"page-table-head__subtitle",3,"innerHTML"],[1,"page-table-head__buttons"],["mat-raised-button","","color","success","class","mat-button-with-icon w-250",3,"disabled","click",4,"ngIf"],[1,"content",3,"formGroup"],["class","alert-message warning",4,"ngIf"],["class","alert-message danger",4,"ngIf"],["class","flex-col flex-auto",4,"ngIf"],["mat-raised-button","","color","success",1,"mat-button-with-icon","w-250",3,"disabled","click"],[1,"alert-message","warning"],[1,"alert-message","danger"],[1,"flex-col","flex-auto"],[1,"flex-row"],[1,"image-container",3,"click"],["class","bg-image",3,"background-image",4,"ngIf"],["class","hover",4,"ngIf"],["class","remove","matTooltip","\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435",3,"click",4,"ngIf"],[1,"base-info-container","ml-30"],["label","\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435","formControlName","name",3,"readonly","clearButton"],[1,"grid-3-cell"],["label","\u0410\u0440\u0442\u0438\u043a\u0443\u043b","formControlName","code",3,"readonly","clearButton"],["label","\u0415\u0434\u0438\u043d\u0438\u0446\u0430 \u0438\u0437\u043c\u0435\u0440\u0435\u043d\u0438\u044f","formControlName","unitId",3,"options","readonly","clearButton"],["label","\u0411\u0430\u0437\u043e\u0432\u0430\u044f \u0446\u0435\u043d\u0430, \u0440\u0443\u0431","formControlName","price",3,"readonly","clearButton"],[1,"flex-col","flex-auto","ml-30"],[1,"flex-col"],[1,"text-bold","mb-10"],["formControlName","routeBy"],["value","bynull"],["value","byrouting"],["value","bygoods"],[1,"bg-image"],[1,"hover"],["matTooltip","\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435",1,"remove",3,"click"],["color","accent"],[1,"tabs-panel-container","flex-auto",3,"mat-stretch-tabs"],["label","\u0422\u0435\u0445\u043d\u043e\u043b\u043e\u0433\u0438\u0447\u0435\u0441\u043a\u0430\u044f \u043a\u0430\u0440\u0442\u0430"],[3,"goodsId","isPermissionEdit"]],template:function(o,t){1&o&&(e.TgZ(0,"div",0)(1,"div",1),e._uU(2," \u0411\u043b\u044e\u0434\u0430 "),e.qZA(),e._UZ(3,"div",2),e.TgZ(4,"div",3),e.YNc(5,eo,4,1,"button",4),e.qZA()(),e.TgZ(6,"div",5),e.YNc(7,to,2,0,"div",6),e.YNc(8,oo,2,0,"div",7),e.YNc(9,uo,29,15,"div",8),e.qZA()),2&o&&(e.xp6(3),e.Q6J("innerHTML",t.subTitle,e.oJD),e.xp6(2),e.Q6J("ngIf",!t.is404&&!t.isForbidden&&t.isPermissionEdit),e.xp6(1),e.Q6J("formGroup",t.formGroup),e.xp6(1),e.Q6J("ngIf",t.is404),e.xp6(1),e.Q6J("ngIf",t.isForbidden),e.xp6(1),e.Q6J("ngIf",!t.is404&&!t.isForbidden))},dependencies:[f.O5,c.JJ,c.JL,c.sg,c.u,_.rH,l.y0,l.f5,l.os,b.Hw,T.A9,T.Yi,C.lW,P.uX,P.SP,I.gM,U],styles:["[_nghost-%COMP%]{flex:auto;display:flex;flex-direction:column}.image-container[_ngcontent-%COMP%]{position:relative;width:140px;height:140px;margin-top:8px;box-sizing:border-box;border:1px solid #004990;border-radius:6px;box-shadow:2px 2px 2px #0006;background-color:#ddd;background-repeat:no-repeat;background-position:center center;background-size:auto;background-image:url(ico-photo.c066a472b5ba8cd8.png)}.image-container[_ngcontent-%COMP%]:hover   .hover[_ngcontent-%COMP%], .image-container[_ngcontent-%COMP%]:hover   .remove[_ngcontent-%COMP%]{display:block}.image-container[_ngcontent-%COMP%]   .bg-image[_ngcontent-%COMP%]{position:absolute;inset:0;border-radius:6px;background-color:#ddd;background-repeat:no-repeat;background-position:center center;background-size:contain}.image-container[_ngcontent-%COMP%]   .remove[_ngcontent-%COMP%]{display:none;position:absolute;top:0;right:0;width:24px;height:24px;cursor:pointer}.image-container[_ngcontent-%COMP%]   .hover[_ngcontent-%COMP%]{display:none;position:absolute;left:0;right:0;bottom:0;height:36px;background-color:#00000080;line-height:36px;color:#fff;text-align:center;z-index:1}"]});const Zo=function(){return[]},yo=function(){return["notFound"]};class K extends A.D{constructor(o,t,n,r,s){super(),this.router=o,this.dialogService=t,this.userService=n,this.apiDocsService=r,s.setTitle(`\u041f\u0440\u0438\u0445\u043e\u0434\u043d\u044b\u0435 \u043d\u0430\u043a\u043b\u0430\u0434\u043d\u044b\u0435 | \u0421\u043a\u043b\u0430\u0434 | ${p.XI}`)}get isPermissionEdit(){return this.userService.hasPermissions(p.jE.storeDocIncomingEdit)}ngOnInit(){this.displayedColumns=this.isPermissionEdit?["docNumber","receiptDate","supplierName","posting","buttons"]:["docNumber","receiptDate","supplierName","posting"],this.getList(0)}onSelectRow(o){this.router.navigate(["/store/docs-incoming",o.id])}getList(o){this.dialogService.showWait("\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0434\u0430\u043d\u043d\u044b\u0445..."),this.apiDocsService.getDocIncomingList({page:o,pageSize:this.pageSize}).pipe((0,m.x)(()=>this.dialogService.hideWait())).subscribe({next:t=>{this.total=t.count,this.dataSource=t.values},error:t=>this.dialogService.showToastError(t.message)})}}function Eo(i,o){1&i&&(e.TgZ(0,"th",27),e._uU(1,"\u0410\u0440\u0442\u0438\u043a\u0443\u043b"),e.qZA())}function Io(i,o){if(1&i&&(e.TgZ(0,"td",28),e._uU(1),e.qZA()),2&i){const t=o.$implicit;e.xp6(1),e.hij(" ",t.goodsCode," ")}}function ko(i,o){1&i&&(e.TgZ(0,"th",29),e._uU(1,"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435"),e.qZA())}function Mo(i,o){if(1&i&&(e.TgZ(0,"td",30)(1,"div",31)(2,"button",32)(3,"mat-icon"),e._uU(4,"open_in_new"),e.qZA()(),e.TgZ(5,"span",33),e._uU(6),e.qZA()()()),2&i){const t=o.$implicit;e.xp6(2),e.MGl("routerLink","/store/ingredients/",t.goodsId,""),e.xp6(4),e.hij(" ",t.goodsName," ")}}function Ao(i,o){1&i&&(e.TgZ(0,"th",34),e._uU(1," \u0415\u0434\u0438\u043d\u0438\u0446\u0430 \u0438\u0437\u043c\u0435\u0440\u0435\u043d\u0438\u044f "),e.qZA())}function No(i,o){if(1&i&&(e.TgZ(0,"td",35),e._uU(1),e.qZA()),2&i){const t=o.$implicit;e.xp6(1),e.hij(" ",t.goodsUnit," ")}}function Po(i,o){1&i&&(e.TgZ(0,"th",36),e._uU(1,"\u041a\u043e\u043b-\u0432\u043e"),e.qZA())}function Uo(i,o){if(1&i&&(e.TgZ(0,"div"),e._uU(1),e.qZA()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.hij(" ",t.quantity," ")}}function qo(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"div",40)(1,"button",41),e.NdJ("mousedown",function(){e.CHM(t);const r=e.oxw().$implicit,s=e.oxw();return e.KtG(s.onSpeedDecrementMouseDown(r,"quantity"))})("mouseup",function(){e.CHM(t);const r=e.oxw(2);return e.KtG(r.onSpeedStop())})("mouseout",function(){e.CHM(t);const r=e.oxw(2);return e.KtG(r.onSpeedStop())})("click",function(){e.CHM(t);const r=e.oxw().$implicit,s=e.oxw();return e.KtG(s.onSpeedDecrementClick(r,"quantity"))}),e.TgZ(2,"mat-icon"),e._uU(3,"remove_circle_outline"),e.qZA()(),e.TgZ(4,"input",42),e.NdJ("keydown",function(r){e.CHM(t);const s=e.oxw().$implicit,u=e.oxw();return e.KtG(u.onTextNumberKeyDown(r,s,"quantity"))})("focus",function(r){e.CHM(t);const s=e.oxw(2);return e.KtG(s.onSelectText(r))})("ngModelChange",function(r){e.CHM(t);const s=e.oxw().$implicit;return e.KtG(s.quantity=r)}),e.qZA(),e.TgZ(5,"button",41),e.NdJ("mousedown",function(){e.CHM(t);const r=e.oxw().$implicit,s=e.oxw();return e.KtG(s.onSpeedIncrementMouseDown(r,"quantity"))})("mouseup",function(){e.CHM(t);const r=e.oxw(2);return e.KtG(r.onSpeedStop())})("mouseout",function(){e.CHM(t);const r=e.oxw(2);return e.KtG(r.onSpeedStop())})("click",function(){e.CHM(t);const r=e.oxw().$implicit,s=e.oxw();return e.KtG(s.onSpeedIncrementClick(r,"quantity"))}),e.TgZ(6,"mat-icon"),e._uU(7,"add_circle_outline"),e.qZA()()()}if(2&i){const t=e.oxw().$implicit;e.xp6(4),e.Q6J("maxlength",5)("ngModel",t.quantity)}}function Oo(i,o){if(1&i&&(e.TgZ(0,"td",37),e.YNc(1,Uo,2,1,"div",38),e.YNc(2,qo,8,2,"div",39),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",!t.isCanEdit),e.xp6(1),e.Q6J("ngIf",t.isCanEdit)}}function Go(i,o){1&i&&(e.TgZ(0,"th",36),e._uU(1,"\u0426\u0435\u043d\u0430"),e.qZA())}function Jo(i,o){if(1&i&&(e.TgZ(0,"div"),e._uU(1),e.qZA()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.hij(" ",t.price," ")}}function Fo(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"div",40)(1,"button",41),e.NdJ("mousedown",function(){e.CHM(t);const r=e.oxw().$implicit,s=e.oxw();return e.KtG(s.onSpeedDecrementMouseDown(r,"price"))})("mouseup",function(){e.CHM(t);const r=e.oxw(2);return e.KtG(r.onSpeedStop())})("mouseout",function(){e.CHM(t);const r=e.oxw(2);return e.KtG(r.onSpeedStop())})("click",function(){e.CHM(t);const r=e.oxw().$implicit,s=e.oxw();return e.KtG(s.onSpeedDecrementClick(r,"price"))}),e.TgZ(2,"mat-icon"),e._uU(3,"remove_circle_outline"),e.qZA()(),e.TgZ(4,"input",42),e.NdJ("keydown",function(r){e.CHM(t);const s=e.oxw().$implicit,u=e.oxw();return e.KtG(u.onTextNumberKeyDown(r,s,"price"))})("focus",function(r){e.CHM(t);const s=e.oxw(2);return e.KtG(s.onSelectText(r))})("ngModelChange",function(r){e.CHM(t);const s=e.oxw().$implicit;return e.KtG(s.price=r)}),e.qZA(),e.TgZ(5,"button",41),e.NdJ("mousedown",function(){e.CHM(t);const r=e.oxw().$implicit,s=e.oxw();return e.KtG(s.onSpeedIncrementMouseDown(r,"price"))})("mouseup",function(){e.CHM(t);const r=e.oxw(2);return e.KtG(r.onSpeedStop())})("mouseout",function(){e.CHM(t);const r=e.oxw(2);return e.KtG(r.onSpeedStop())})("click",function(){e.CHM(t);const r=e.oxw().$implicit,s=e.oxw();return e.KtG(s.onSpeedIncrementClick(r,"price"))}),e.TgZ(6,"mat-icon"),e._uU(7,"add_circle_outline"),e.qZA()()()}if(2&i){const t=e.oxw().$implicit;e.xp6(4),e.Q6J("maxlength",5)("ngModel",t.price)}}function Ro(i,o){if(1&i&&(e.TgZ(0,"td",37),e.YNc(1,Jo,2,1,"div",38),e.YNc(2,Fo,8,2,"div",39),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",!t.isCanEdit),e.xp6(1),e.Q6J("ngIf",t.isCanEdit)}}function Yo(i,o){1&i&&(e.TgZ(0,"th",43),e._uU(1,"\u0421\u0443\u043c\u043c\u0430"),e.qZA())}function Qo(i,o){if(1&i&&(e.TgZ(0,"td",44),e._uU(1),e.qZA()),2&i){const t=o.$implicit,n=e.oxw();e.xp6(1),e.hij(" ",n.calcSumma(t)," ")}}function Ho(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"th",45)(1,"button",46),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.onAddRecord())}),e.TgZ(2,"mat-icon"),e._uU(3,"add_circle_outline"),e.qZA()()()}}function Lo(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"td",47)(1,"div",48)(2,"button",49),e.NdJ("click",function(){const s=e.CHM(t).$implicit,u=e.oxw();return e.KtG(u.onRemove(s.id))}),e.TgZ(3,"mat-icon"),e._uU(4,"highlight_off"),e.qZA()()()()}}function Bo(i,o){if(1&i&&(e.TgZ(0,"td",50)(1,"div",51),e._uU(2,"\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445"),e.qZA()()),2&i){const t=e.oxw();e.uIk("colspan",t.colspanTable)}}function Ko(i,o){1&i&&e._UZ(0,"tr",52)}function $o(i,o){1&i&&e._UZ(0,"tr",53)}function jo(i,o){1&i&&e._UZ(0,"tr",54)}K.\u0275fac=function(o){return new(o||K)(e.Y36(_.F0),e.Y36(l.xA),e.Y36(h.KD),e.Y36(v.St),e.Y36(D.Dx))},K.\u0275cmp=e.Xpm({type:K,selectors:[["store-docs-incoming"]],features:[e.qOj],decls:30,vars:11,consts:[[1,"page-table-head"],[1,"page-table-head__title","flex-auto"],[3,"length","pageSize","pageSizeOptions","changes","page"],["mat-raised-button","","color","primary","class","mat-button-with-icon w-250","routerLink","/store/docs-incoming/add",4,"ngIf"],[1,"page-content"],[1,"scroll-container","content"],[1,"scroll"],["scrollElement",""],["mat-table","",1,"table","with-borders",3,"dataSource"],["matColumnDef","docNumber"],["mat-header-cell","","class","cell-doc-number",4,"matHeaderCellDef"],["mat-cell","","class","cell-doc-number",4,"matCellDef"],["matColumnDef","receiptDate"],["mat-header-cell","","class","cell-receipt-date",4,"matHeaderCellDef"],["mat-cell","","class","cell-receipt-date",4,"matCellDef"],["matColumnDef","supplierName"],["mat-header-cell","","class","cell-supplier-name",4,"matHeaderCellDef"],["mat-cell","","class","cell-supplier-name",4,"matCellDef"],["matColumnDef","posting"],["mat-header-cell","","class","cell-posting",4,"matHeaderCellDef"],["mat-cell","","class","cell-posting",4,"matCellDef"],["matColumnDef","buttons"],["mat-header-cell","","class","buttons-cell",4,"matHeaderCellDef"],["mat-cell","","class","buttons-cell",4,"matCellDef"],["matColumnDef","notFound"],["mat-footer-cell","",4,"matFooterCellDef"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","","class","table-row",3,"click",4,"matRowDef","matRowDefColumns"],["mat-footer-row","",4,"matFooterRowDef"],["mat-raised-button","","color","primary","routerLink","/store/docs-incoming/add",1,"mat-button-with-icon","w-250"],["mat-header-cell","",1,"cell-doc-number"],["mat-cell","",1,"cell-doc-number"],["mat-header-cell","",1,"cell-receipt-date"],["mat-cell","",1,"cell-receipt-date"],["mat-header-cell","",1,"cell-supplier-name"],["mat-cell","",1,"cell-supplier-name"],["mat-header-cell","",1,"cell-posting"],["mat-cell","",1,"cell-posting"],["class","flex-col-centered text-success","matTooltip","\u0414\u0430",4,"ngIf"],["class","flex-col-centered text-danger","matTooltip","\u041d\u0435\u0442",4,"ngIf"],["matTooltip","\u0414\u0430",1,"flex-col-centered","text-success"],["matTooltip","\u041d\u0435\u0442",1,"flex-col-centered","text-danger"],["mat-header-cell","",1,"buttons-cell"],["mat-cell","",1,"buttons-cell"],[1,"container"],["mat-icon-button","","color","primary","matTooltip","\u041f\u0440\u043e\u0432\u0435\u0441\u0442\u0438 \u043f\u0440\u0438\u0445\u043e\u0434\u043d\u0443\u044e \u043d\u0430\u043a\u043b\u0430\u0434\u043d\u0443\u044e",3,"disabled"],["mat-footer-cell",""],[1,"text-center","text-danger"],["mat-header-row",""],["mat-row","",1,"table-row",3,"click"],["mat-footer-row",""]],template:function(o,t){1&o&&(e.TgZ(0,"div",0)(1,"div",1),e._uU(2,"\u041f\u0440\u0438\u0445\u043e\u0434\u043d\u044b\u0435 \u043d\u0430\u043a\u043b\u0430\u0434\u043d\u044b\u0435"),e.qZA(),e.TgZ(3,"mat-paginator",2),e.NdJ("changes",function(){return t.updatePaginator})("page",function(r){return t.onPageChanged(r)}),e.qZA(),e.YNc(4,ao,5,0,"button",3),e.qZA(),e.TgZ(5,"div",4)(6,"div",5)(7,"div",6,7)(9,"table",8),e.ynx(10,9),e.YNc(11,co,2,0,"th",10),e.YNc(12,lo,2,1,"td",11),e.BQk(),e.ynx(13,12),e.YNc(14,mo,2,0,"th",13),e.YNc(15,go,2,1,"td",14),e.BQk(),e.ynx(16,15),e.YNc(17,_o,2,0,"th",16),e.YNc(18,po,2,1,"td",17),e.BQk(),e.ynx(19,18),e.YNc(20,fo,2,0,"th",19),e.YNc(21,xo,3,2,"td",20),e.BQk(),e.ynx(22,21),e.YNc(23,vo,2,0,"th",22),e.YNc(24,bo,5,1,"td",23),e.BQk(),e.ynx(25,24),e.YNc(26,So,3,1,"td",25),e.BQk(),e.YNc(27,To,1,0,"tr",26),e.YNc(28,Do,1,0,"tr",27),e.YNc(29,wo,1,0,"tr",28),e.qZA()()()()),2&o&&(e.xp6(3),e.Q6J("length",t.total)("pageSize",t.pageSize)("pageSizeOptions",t.pageSizeOptions),e.xp6(1),e.Q6J("ngIf",t.isPermissionEdit),e.xp6(5),e.Q6J("dataSource",t.dataSource),e.xp6(18),e.Q6J("matHeaderRowDef",t.displayedColumns)("matHeaderRowDefSticky",!0),e.xp6(1),e.Q6J("matRowDefColumns",t.displayedColumns),e.xp6(1),e.Q6J("matFooterRowDef",t.dataSource&&t.dataSource.length?e.DdM(9,Zo):e.DdM(10,yo)))},dependencies:[f.O5,_.rH,b.Hw,C.lW,C.RK,a.BZ,a.fO,a.as,a.w1,a.Dz,a.nj,a.mD,a.Ke,a.ge,a.ev,a.yh,a.XQ,a.Gk,a.Q2,W.NW,I.gM],styles:["[_nghost-%COMP%]{flex:auto;display:flex;flex-direction:column}.cell-doc-number[_ngcontent-%COMP%]{width:150px;text-align:center}.cell-receipt-date[_ngcontent-%COMP%]{width:150px}.cell-posting[_ngcontent-%COMP%]{width:100px;text-align:center}"]});const Wo=function(){return[]},zo=function(){return["notFound"]};class $ extends A.D{constructor(){super(),this.isCanEdit=!0,this.speedProcessing=!1}ngOnInit(){this.displayedColumns=["goodsCode","goodsName","goodsUnit","quantity","price","summa"],this.isCanEdit&&this.displayedColumns.push("buttons")}onAddRecord(){}onRemove(o){}onSelectText(o){o.target?.select()}calcSumma(o){let t=Number(o.quantity);t=isNaN(t)?0:t;let n=Number(o.price);return n=isNaN(n)?0:n,l.ZH.numberFormat(t*n,3)}onSpeedIncrementMouseDown(o,t){this.speedProcessing=!0,setTimeout(()=>this.autoSpeedIncrement(o,t),500)}onSpeedDecrementMouseDown(o,t){this.speedProcessing=!0,setTimeout(()=>this.autoSpeedDecrement(o,t),500)}onSpeedIncrementClick(o,t){this.speedProcessing=!1,this.increment(o,t)}onSpeedDecrementClick(o,t){this.speedProcessing=!1,this.decrement(o,t)}onSpeedStop(){this.speedProcessing=!1}onTextNumberKeyDown(o,t,n){if(!["ArrowLeft","ArrowRight","ArrowUp","ArrowDown","ArrowUp","Backspace","Delete"].includes(o.key)){if("."===o.key)return void((!l.ZH.hasValue(t[n])||String(t[n]).indexOf(".")>=0)&&o.preventDefault());/[0-9]/.test(o.key)||o.preventDefault()}}autoSpeedIncrement(o,t){(0,z.F)(100).pipe((0,V.o)(()=>this.speedProcessing)).subscribe(()=>{this.speedProcessing&&this.increment(o,t)})}autoSpeedDecrement(o,t){(0,z.F)(100).pipe((0,V.o)(()=>this.speedProcessing)).subscribe(()=>{this.speedProcessing&&this.decrement(o,t)})}increment(o,t){let n=new y.Z(o[t]?o[t]:0);n=n.plus(.01),o[t]=Number(n.toFixed(3))}decrement(o,t){let n=new y.Z(o[t]?o[t]:0);n=n.minus(.01),o[t]=n.lessThan(0)?0:Number(n.toFixed(3))}}function Vo(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"button",9),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.onSave())}),e.TgZ(1,"mat-icon"),e._uU(2,"save"),e.qZA(),e.TgZ(3,"span"),e._uU(4,"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c"),e.qZA()()}if(2&i){const t=e.oxw();e.Q6J("disabled",t.savedState)}}function Xo(i,o){1&i&&(e.TgZ(0,"div",10),e._uU(1,"\u041d\u0430\u043a\u043b\u0430\u0434\u043d\u0430\u044f \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u0430"),e.qZA())}function ei(i,o){1&i&&(e.TgZ(0,"div",11),e._uU(1,"\u0414\u043e\u0441\u0442\u0443\u043f \u0437\u0430\u043f\u0440\u0435\u0449\u0435\u043d"),e.qZA())}function ti(i,o){1&i&&(e.TgZ(0,"div",12)(1,"mat-tab-group",20)(2,"mat-tab",21),e._UZ(3,"store-elements-incoming"),e.qZA()()()),2&i&&(e.xp6(1),e.Q6J("mat-stretch-tabs",!1))}function oi(i,o){if(1&i&&(e.TgZ(0,"div",12)(1,"div",13)(2,"div",14),e._UZ(3,"kui-input",15),e.qZA(),e.TgZ(4,"div",16),e._UZ(5,"kui-datepicker",17),e.qZA(),e.TgZ(6,"div",18),e._UZ(7,"kui-input",19),e.qZA()(),e.YNc(8,ti,4,1,"div",8),e.qZA()),2&i){const t=e.oxw();e.xp6(3),e.Q6J("clearButton",!1)("readonly",!t.isPermissionEdit),e.xp6(2),e.Q6J("clearButton",!1)("readonly",!t.isPermissionEdit),e.xp6(2),e.Q6J("clearButton",!1)("readonly",!t.isPermissionEdit),e.xp6(1),e.Q6J("ngIf",t.docId)}}$.\u0275fac=function(o){return new(o||$)},$.\u0275cmp=e.Xpm({type:$,selectors:[["store-elements-incoming"]],inputs:{isCanEdit:"isCanEdit"},features:[e.qOj],decls:29,vars:7,consts:[[1,"scroll-container","content"],[1,"scroll"],["mat-table","",1,"table","with-borders",3,"dataSource"],["matColumnDef","goodsCode"],["mat-header-cell","","class","cell-code",4,"matHeaderCellDef"],["mat-cell","","class","cell-code",4,"matCellDef"],["matColumnDef","goodsName"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","goodsUnit"],["mat-header-cell","","class","cell-unit",4,"matHeaderCellDef"],["mat-cell","","class","cell-unit",4,"matCellDef"],["matColumnDef","quantity"],["mat-header-cell","","class","cell-count",4,"matHeaderCellDef"],["mat-cell","","class","cell-count",4,"matCellDef"],["matColumnDef","price"],["matColumnDef","summa"],["mat-header-cell","","class","cell-summa",4,"matHeaderCellDef"],["mat-cell","","class","cell-summa",4,"matCellDef"],["matColumnDef","buttons"],["mat-header-cell","","class","buttons-cell",4,"matHeaderCellDef"],["mat-cell","","class","buttons-cell",4,"matCellDef"],["matColumnDef","notFound"],["mat-footer-cell","",4,"matFooterCellDef"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","","class","table-row","draggable","true",4,"matRowDef","matRowDefColumns"],["mat-footer-row","",4,"matFooterRowDef"],["mat-header-cell","",1,"cell-code"],["mat-cell","",1,"cell-code"],["mat-header-cell",""],["mat-cell",""],[1,"flex-align-center"],["mat-icon-button","","color","primary",3,"routerLink"],[1,"ml-10"],["mat-header-cell","",1,"cell-unit"],["mat-cell","",1,"cell-unit"],["mat-header-cell","",1,"cell-count"],["mat-cell","",1,"cell-count"],[4,"ngIf"],["class","flex-row-centered",4,"ngIf"],[1,"flex-row-centered"],["mat-icon-button","","color","primary",3,"mousedown","mouseup","mouseout","click"],["type","number","min","0","max","10","step","0.01",1,"table-input",3,"maxlength","ngModel","keydown","focus","ngModelChange"],["mat-header-cell","",1,"cell-summa"],["mat-cell","",1,"cell-summa"],["mat-header-cell","",1,"buttons-cell"],["mat-icon-button","","color","primary","matTooltip","\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0442\u043e\u0432\u0430\u0440",3,"click"],["mat-cell","",1,"buttons-cell"],[1,"container"],["mat-icon-button","","color","accent",3,"click"],["mat-footer-cell",""],[1,"text-center","text-danger"],["mat-header-row",""],["mat-row","","draggable","true",1,"table-row"],["mat-footer-row",""]],template:function(o,t){1&o&&(e.TgZ(0,"div",0)(1,"div",1)(2,"table",2),e.ynx(3,3),e.YNc(4,Eo,2,0,"th",4),e.YNc(5,Io,2,1,"td",5),e.BQk(),e.ynx(6,6),e.YNc(7,ko,2,0,"th",7),e.YNc(8,Mo,7,2,"td",8),e.BQk(),e.ynx(9,9),e.YNc(10,Ao,2,0,"th",10),e.YNc(11,No,2,1,"td",11),e.BQk(),e.ynx(12,12),e.YNc(13,Po,2,0,"th",13),e.YNc(14,Oo,3,2,"td",14),e.BQk(),e.ynx(15,15),e.YNc(16,Go,2,0,"th",13),e.YNc(17,Ro,3,2,"td",14),e.BQk(),e.ynx(18,16),e.YNc(19,Yo,2,0,"th",17),e.YNc(20,Qo,2,1,"td",18),e.BQk(),e.ynx(21,19),e.YNc(22,Ho,4,0,"th",20),e.YNc(23,Lo,5,0,"td",21),e.BQk(),e.ynx(24,22),e.YNc(25,Bo,3,1,"td",23),e.BQk(),e.YNc(26,Ko,1,0,"tr",24),e.YNc(27,$o,1,0,"tr",25),e.YNc(28,jo,1,0,"tr",26),e.qZA()()()),2&o&&(e.xp6(2),e.Q6J("dataSource",t.dataSource),e.xp6(24),e.Q6J("matHeaderRowDef",t.displayedColumns)("matHeaderRowDefSticky",!0),e.xp6(1),e.Q6J("matRowDefColumns",t.displayedColumns),e.xp6(1),e.Q6J("matFooterRowDef",t.dataSource&&t.dataSource.length?e.DdM(5,Wo):e.DdM(6,zo)))},dependencies:[f.O5,c.Fj,c.wV,c.JJ,c.nD,c.qQ,c.Fd,c.On,_.rH,b.Hw,C.RK,a.BZ,a.fO,a.as,a.w1,a.Dz,a.nj,a.mD,a.Ke,a.ge,a.ev,a.yh,a.XQ,a.Gk,a.Q2,I.gM],styles:["[_nghost-%COMP%]{flex:auto;display:flex;flex-direction:column}.cell-code[_ngcontent-%COMP%]{width:100px;text-align:center}.cell-unit[_ngcontent-%COMP%]{width:170px;text-align:center}.cell-count[_ngcontent-%COMP%], .cell-summa[_ngcontent-%COMP%]{width:180px;text-align:center}"]});class j{constructor(o,t,n,r,s,u,d){this.titleService=o,this.router=t,this.activatedRoute=n,this.dialogService=r,this.userService=s,this.apiDictionariesService=u,this.apiDocsService=d,this.subTitle="",this.is404=!1,this.isForbidden=!1,this.savedState=!0,this.unitList=[],this.formGroup=new c.cw({docNumber:new l.jn(null,c.kI.required),receiptDate:new l.jn(null,c.kI.required),supplierName:new l.jn(null,c.kI.required)}),this.docId=null,this.ngUnsubscribe=new G.x,this.postingState=!1}get isPermissionEdit(){return this.userService.hasPermissions(p.jE.storeDocIncomingEdit)&&!this.postingState}ngOnInit(){this.apiDictionariesService.getUnitList().subscribe({next:o=>{this.unitList=(o||[]).map(t=>({value:t.id,title:t.name}))},error:o=>this.dialogService.showToastError(o.message,"\u0421\u043f\u0440\u0430\u0432\u043e\u0447\u043d\u0438\u043a: \u0415\u0434\u0438\u043d\u0438\u0446\u044b \u0438\u0437\u043c\u0435\u0440\u0435\u043d\u0438\u044f")}),this.formGroup.valueChanges.pipe((0,Z.R)(this.ngUnsubscribe)).subscribe(()=>this.savedState=!1),this.activatedRoute.paramMap.pipe((0,Z.R)(this.ngUnsubscribe)).subscribe(o=>{const t=o.get("id");"add"===t?(this.titleService.setTitle(`\u041d\u043e\u0432\u0430\u044f \u043d\u0430\u043a\u043b\u0430\u0434\u043d\u0430\u044f | \u0421\u043a\u043b\u0430\u0434 | ${p.XI}`),this.subTitle="&nbsp;&#10148;&nbsp;\u041d\u043e\u0432\u0430\u044f \u043d\u0430\u043a\u043b\u0430\u0434\u043d\u0430\u044f",this.isPermissionEdit||(this.isForbidden=!0)):t?this.getDoc(+t):this.is404=!0})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}onSave(){this.formGroup.valid?(this.dialogService.showWait("\u0421\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0435..."),this.apiDocsService.saveDocIncoming({id:this.docId,...this.formGroup.value}).pipe((0,m.x)(()=>this.dialogService.hideWait())).subscribe({next:o=>{this.docId||this.router.navigate(["/store/docs-incoming",o.id]),this.savedState=!0},error:o=>this.dialogService.showToastError(o.message)})):this.formGroup.markAllAsTouched()}getDoc(o){this.dialogService.showWait("\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0434\u0430\u043d\u043d\u044b\u0445..."),this.apiDocsService.getDocIncoming(o).pipe((0,m.x)(()=>this.dialogService.hideWait())).subscribe({next:t=>{this.postingState=t.posting;const n=this.isPermissionEdit?"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u043d\u0430\u043a\u043b\u0430\u0434\u043d\u043e\u0439":"\u041f\u0440\u043e\u0441\u043c\u043e\u0442\u0440 \u043d\u0430\u043a\u043b\u0430\u0434\u043d\u043e\u0439";this.titleService.setTitle(`${n} | \u0421\u043a\u043b\u0430\u0434 | ${p.XI}`),this.subTitle="&nbsp;&#10148;&nbsp;"+n,this.formGroup.patchValue(t),this.docId=Number(t.id),this.savedState=!0},error:t=>{this.dialogService.showToastError(t.message),this.is404=!0,this.docId=null}})}}j.\u0275fac=function(o){return new(o||j)(e.Y36(D.Dx),e.Y36(_.F0),e.Y36(_.gz),e.Y36(l.xA),e.Y36(h.KD),e.Y36(v.Br),e.Y36(v.St))},j.\u0275cmp=e.Xpm({type:j,selectors:[["store-docs-incoming-edit"]],decls:10,vars:6,consts:[[1,"page-table-head"],["routerLink","/store/docs-incoming",1,"page-table-head__title","page-table-head__title--link"],[1,"page-table-head__subtitle",3,"innerHTML"],[1,"page-table-head__buttons"],["mat-raised-button","","color","success","class","mat-button-with-icon w-250",3,"disabled","click",4,"ngIf"],[1,"content",3,"formGroup"],["class","alert-message warning",4,"ngIf"],["class","alert-message danger",4,"ngIf"],["class","flex-col flex-auto",4,"ngIf"],["mat-raised-button","","color","success",1,"mat-button-with-icon","w-250",3,"disabled","click"],[1,"alert-message","warning"],[1,"alert-message","danger"],[1,"flex-col","flex-auto"],[1,"info-container"],[1,"w-150"],["label","\u041d\u043e\u043c\u0435\u0440 \u043d\u0430\u043a\u043b\u0430\u0434\u043d\u043e\u0439","formControlName","docNumber",3,"clearButton","readonly"],[1,"w-170","ml-10"],["label","\u0414\u0430\u0442\u0430 \u043f\u043e\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u044f","formControlName","receiptDate",3,"clearButton","readonly"],[1,"flex-auto","ml-10"],["label","\u041f\u043e\u0441\u0442\u0430\u0432\u0449\u0438\u043a","formControlName","supplierName",3,"clearButton","readonly"],[1,"tabs-panel-container","flex-auto",3,"mat-stretch-tabs"],["label","\u042d\u043b\u0435\u043c\u0435\u043d\u0442\u044b \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430"]],template:function(o,t){1&o&&(e.TgZ(0,"div",0)(1,"div",1),e._uU(2," \u041f\u0440\u0438\u0445\u043e\u0434\u043d\u044b\u0435 \u043d\u0430\u043a\u043b\u0430\u0434\u043d\u044b\u0435 "),e.qZA(),e._UZ(3,"div",2),e.TgZ(4,"div",3),e.YNc(5,Vo,5,1,"button",4),e.qZA()(),e.TgZ(6,"div",5),e.YNc(7,Xo,2,0,"div",6),e.YNc(8,ei,2,0,"div",7),e.YNc(9,oi,9,7,"div",8),e.qZA()),2&o&&(e.xp6(3),e.Q6J("innerHTML",t.subTitle,e.oJD),e.xp6(2),e.Q6J("ngIf",!t.is404&&!t.isForbidden&&t.isPermissionEdit),e.xp6(1),e.Q6J("formGroup",t.formGroup),e.xp6(1),e.Q6J("ngIf",t.is404),e.xp6(1),e.Q6J("ngIf",t.isForbidden),e.xp6(1),e.Q6J("ngIf",!t.is404&&!t.isForbidden))},dependencies:[f.O5,c.JJ,c.JL,c.sg,c.u,_.rH,l.y0,l.qC,b.Hw,C.lW,P.uX,P.SP,$],styles:["[_nghost-%COMP%]{flex:auto;display:flex;flex-direction:column}.info-container[_ngcontent-%COMP%]{width:670px;display:flex;background-color:#ddddddb3;border-radius:6px;padding:5px 10px 0;border:1px solid #c6c6c6;box-shadow:2px 2px 2px #0006}.info-container[_ngcontent-%COMP%]   .w-150[_ngcontent-%COMP%]{width:150px}.info-container[_ngcontent-%COMP%]   .w-170[_ngcontent-%COMP%]{width:170px}"]});class q{}q.\u0275fac=function(o){return new(o||q)},q.\u0275mod=e.oAB({type:q}),q.\u0275inj=e.cJS({imports:[f.ez,_.Bz,oe.m,l.HH]});const ii=[{path:"",component:J,children:[{path:"",redirectTo:"dishes",pathMatch:"full"},{path:"dishes/:id",component:B},{path:"dishes",component:F},{path:"ingredients/:id",component:Y},{path:"ingredients",component:R},{path:"modifiers/:id",component:L},{path:"modifiers",component:Q},{path:"docs-incoming/:id",component:j},{path:"docs-incoming",component:K}]}];class O{}O.\u0275fac=function(o){return new(o||O)},O.\u0275mod=e.oAB({type:O}),O.\u0275inj=e.cJS({imports:[f.ez,c.u5,c.UX,_.Bz.forChild(ii),oe.m,q]})}}]);