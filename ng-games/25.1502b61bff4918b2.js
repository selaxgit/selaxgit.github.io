"use strict";(self.webpackChunkng_games=self.webpackChunkng_games||[]).push([[25],{25:(B,w,u)=>{u.r(w),u.d(w,{PixelantasyModule:()=>P});var L=u(9808),b=u(2074),R=u(2722),v=u(136),k=u(2961),i=u(8977),S=u(7579),C=u(8306);const y="assets/games/pixelantasy";var r=(()=>{return(a=r||(r={}))[a.left=0]="left",a[a.right=1]="right",r;var a})(),n=(()=>{return(a=n||(n={}))[a.None=0]="None",a[a.Idle=1]="Idle",a[a.Attack=2]="Attack",a[a.Crouch=3]="Crouch",a[a.Die=4]="Die",a[a.Hit=5]="Hit",a[a.Jump=6]="Jump",a[a.Run=7]="Run",a[a.Walk=8]="Walk",n;var a})();class T extends i.W20{constructor(t,e){super(),this.keysStore=t,this.deadLineY=e,this.crossDieLine=new S.x,this.actorDirection=r.right,this.velocity={x:0,y:0},this.friction=1.8,this.gravity=.2,this.jumping=!1,this.speed=3,this.actorBoundsRect={x:27,y:24,width:15,height:28},this.groundObjects=[],this.wallObjects=[],this.crossDieLine$=this.crossDieLine.asObservable(),this.init()}update(t){this.keysStore.KeyA&&!this.keysStore.KeyD?(this.velocity.x=-1,this.setDirection(r.left)):this.keysStore.KeyD&&!this.keysStore.KeyA?(this.setDirection(r.right),this.velocity.x=1):(this.velocity.x=0,!this.jumping&&!this.keysStore.KeyS&&this.setState(n.Idle)),!this.jumping&&(this.keysStore.KeyA||this.keysStore.KeyD)&&this.setState(n.Walk),!this.jumping&&this.keysStore.KeyS&&this.setState(n.Crouch),!this.jumping&&(this.keysStore.Space||this.keysStore.KeyW)&&(this.setState(n.Jump),this.jumping=!0,this.velocity.y=2*-this.speed),this.velocity.x*=this.friction,this.velocity.y+=this.gravity;const s=this.y+this.velocity.y*t;this.leanToWall(this.x+this.velocity.x*t,s)?this.velocity.x=0:this.x+=this.velocity.x*t,this.landing(s)?(this.velocity.y=0,this.jumping=!1):s+this.actorBoundsRect.y+this.actorBoundsRect.height>=this.deadLineY?(this.y=this.deadLineY-this.height+(this.height-(this.actorBoundsRect.y+this.actorBoundsRect.height)),this.velocity.y=0,this.jumping=!1,this.crossDieLine.next()):this.y=s}leanToWall(t,e){let s;const h=e+this.actorBoundsRect.y+this.actorBoundsRect.height;for(const o of this.wallObjects)if(s=this.actorDirection==r.left?t+this.actorBoundsRect.x:t+this.actorBoundsRect.x+this.actorBoundsRect.width,s>=o.x&&s<=o.x+o.width&&h>=o.y&&h<=o.y+o.height)return!0;return!1}landing(t){const e=this.x+this.actorBoundsRect.x+this.actorBoundsRect.width/2,s=t+this.actorBoundsRect.y+this.actorBoundsRect.height;for(const h of this.groundObjects)if(e>=h.x&&e<=h.x+h.width&&s>=h.y&&s<=h.y+h.height)return this.y=h.y-this.height+(this.height-(this.actorBoundsRect.y+this.actorBoundsRect.height)),!0;return!1}setGroundObjects(t){this.groundObjects=t}setWallObjects(t){this.wallObjects=t}setInitialPosition(t){this.x=t.x,this.y=t.y+(72-(this.actorBoundsRect.y+this.actorBoundsRect.height))}getDirection(){return this.actorDirection}setDirection(t){this.actorDirection!==t&&(this.actorDirection=t,this.setState(this.actorState,!0))}getState(){return this.actorState}setState(t,e=!1){this.setStateObservable(t,e).subscribe()}setStateObservable(t,e=!1){return new C.y(s=>{if(!e&&(this.actorState===t||[n.Attack].includes(this.actorState)))return s.next(),void s.complete();switch(this.actorState=t,this.stateIdleToLeft.visible=!1,this.stateAttackToLeft.visible=!1,this.stateCrouchToLeft.visible=!1,this.stateDieToLeft.visible=!1,this.stateHitToLeft.visible=!1,this.stateJumpToLeft.visible=!1,this.stateRunToLeft.visible=!1,this.stateWalkToLeft.visible=!1,this.stateIdleToRight.visible=!1,this.stateAttackToRight.visible=!1,this.stateCrouchToRight.visible=!1,this.stateDieToRight.visible=!1,this.stateHitToRight.visible=!1,this.stateJumpToRight.visible=!1,this.stateRunToRight.visible=!1,this.stateWalkToRight.visible=!1,t){case n.Attack:this.actorDirection===r.left?(this.stateAttackToLeft.visible=!0,this.stateAttackToLeft.gotoAndPlay(0),this.stateAttackToLeft.onComplete=()=>{this.actorState=n.None,this.setState(n.Idle),s.next(),s.complete()}):(this.stateAttackToRight.visible=!0,this.stateAttackToRight.gotoAndPlay(0),this.stateAttackToRight.onComplete=()=>{this.actorState=n.None,this.setState(n.Idle),s.next(),s.complete()});break;case n.Crouch:this.actorDirection===r.left?(this.stateCrouchToLeft.visible=!0,this.stateCrouchToLeft.gotoAndPlay(0),this.stateCrouchToLeft.onComplete=()=>{s.next(),s.complete()}):(this.stateCrouchToRight.visible=!0,this.stateCrouchToRight.gotoAndPlay(0),this.stateCrouchToRight.onComplete=()=>{s.next(),s.complete()});break;case n.Die:this.actorDirection===r.left?(this.stateDieToLeft.visible=!0,this.stateDieToLeft.gotoAndPlay(0),this.stateDieToLeft.onComplete=()=>{s.next(),s.complete()}):(this.stateDieToRight.visible=!0,this.stateDieToRight.gotoAndPlay(0),this.stateDieToRight.onComplete=()=>{s.next(),s.complete()});break;case n.Hit:this.actorDirection===r.left?(this.stateHitToLeft.visible=!0,this.stateHitToLeft.gotoAndPlay(0),this.stateHitToLeft.onComplete=()=>{this.setState(n.Idle),s.next(),s.complete()}):(this.stateHitToRight.visible=!0,this.stateHitToRight.gotoAndPlay(0),this.stateHitToRight.onComplete=()=>{this.setState(n.Idle),s.next(),s.complete()});break;case n.Idle:this.actorDirection===r.left?this.stateIdleToLeft.visible=!0:this.stateIdleToRight.visible=!0,s.next(),s.complete();break;case n.Jump:this.actorDirection===r.left?(this.stateJumpToLeft.visible=!0,this.stateJumpToLeft.gotoAndPlay(0),this.stateJumpToLeft.onComplete=()=>{s.next(),s.complete()}):(this.stateJumpToRight.visible=!0,this.stateJumpToRight.gotoAndPlay(0),this.stateJumpToRight.onComplete=()=>{s.next(),s.complete()});break;case n.Run:this.actorDirection===r.left?(this.stateRunToLeft.visible=!0,this.stateRunToLeft.gotoAndPlay(0)):(this.stateRunToRight.visible=!0,this.stateRunToRight.gotoAndPlay(0)),s.next(),s.complete();break;case n.Walk:this.actorDirection===r.left?(this.stateWalkToLeft.visible=!0,this.stateWalkToLeft.gotoAndPlay(0)):(this.stateWalkToRight.visible=!0,this.stateWalkToRight.gotoAndPlay(0)),s.next(),s.complete()}})}init(){const t=i.VL4.from("assets/games/pixelantasy/barbarian.actor.png");let e;const s=new i.xEZ(t,new i.AeJ(0,0,72,72));this.stateIdleToLeft=new i.jyi(s),this.stateIdleToLeft.anchor.x=1,this.stateIdleToLeft.scale.x*=-1,this.stateIdleToLeft.visible=!1,this.addChild(this.stateIdleToLeft),this.stateIdleToRight=new i.jyi(s),this.stateIdleToRight.visible=!1,this.addChild(this.stateIdleToRight),e=[new i.xEZ(t,new i.AeJ(72,0,72,72)),new i.xEZ(t,new i.AeJ(144,0,72,72)),new i.xEZ(t,new i.AeJ(216,0,72,72))],this.stateAttackToLeft=this.createSprite(e,.2,!1,!0),this.stateAttackToRight=this.createSprite(e,.2),e=[new i.xEZ(t,new i.AeJ(288,0,72,72)),new i.xEZ(t,new i.AeJ(360,0,72,72))],this.stateCrouchToLeft=this.createSprite(e,.3,!1,!0),this.stateCrouchToRight=this.createSprite(e,.3),e=[new i.xEZ(t,new i.AeJ(432,0,72,72)),new i.xEZ(t,new i.AeJ(504,0,72,72)),new i.xEZ(t,new i.AeJ(576,0,72,72)),new i.xEZ(t,new i.AeJ(648,0,72,72)),new i.xEZ(t,new i.AeJ(720,0,72,72))],this.stateDieToLeft=this.createSprite(e,.3,!1,!0),this.stateDieToRight=this.createSprite(e,.3),e=[new i.xEZ(t,new i.AeJ(792,0,72,72)),new i.xEZ(t,new i.AeJ(864,0,72,72))],this.stateHitToLeft=this.createSprite(e,.3,!1,!0),this.stateHitToRight=this.createSprite(e,.3),e=[new i.xEZ(t,new i.AeJ(936,0,72,72)),new i.xEZ(t,new i.AeJ(1008,0,72,72)),new i.xEZ(t,new i.AeJ(1080,0,72,72)),new i.xEZ(t,new i.AeJ(1152,0,72,72))],this.stateJumpToLeft=this.createSprite(e,.5,!1,!0),this.stateJumpToRight=this.createSprite(e,.5),e=[new i.xEZ(t,new i.AeJ(936,0,72,72)),new i.xEZ(t,new i.AeJ(1008,0,72,72)),new i.xEZ(t,new i.AeJ(1080,0,72,72)),new i.xEZ(t,new i.AeJ(1152,0,72,72))],this.stateRunToLeft=this.createSprite(e,.1,!0,!0),this.stateRunToRight=this.createSprite(e,.1,!0),e=[new i.xEZ(t,new i.AeJ(1800,0,72,72)),new i.xEZ(t,new i.AeJ(1872,0,72,72)),new i.xEZ(t,new i.AeJ(1944,0,72,72)),new i.xEZ(t,new i.AeJ(2016,0,72,72)),new i.xEZ(t,new i.AeJ(2088,0,72,72)),new i.xEZ(t,new i.AeJ(2160,0,72,72)),new i.xEZ(t,new i.AeJ(2232,0,72,72)),new i.xEZ(t,new i.AeJ(2304,0,72,72))],this.stateWalkToLeft=this.createSprite(e,.3,!0,!0),this.stateWalkToRight=this.createSprite(e,.3,!0),this.setState(n.Idle)}createSprite(t,e=.1,s=!1,h=!1){const o=new i.KgH(t);return o.animationSpeed=e,o.loop=s,o.visible=!1,h&&(o.anchor.x=1,o.scale.x*=-1),this.addChild(o),o}}class A extends i.W20{constructor(t,e,s,h,o,c){switch(super(),t.type){case"imagelayer":this.createImageLayer(t);break;case"tilelayer":this.createTileLayer(t,e,s,h);break;case"objectgroup":this.createObjectsLayer(t,e,o,c)}}createObjectsLayer(t,e,s,h){this.addChild((new i.TCu).beginFill(0,0).drawRect(0,0,s,h).endFill()),t.objects.forEach(o=>{o.visible&&this.addChild((new i.TCu).beginFill(16711680,.5).drawRect(o.x,o.y,o.width,o.height).endFill())})}createTileLayer(t,e,s,h){this.addChild((new i.TCu).beginFill(0,0).drawRect(0,0,t.width*s,t.height*h).endFill());let o=0,c=0;t.data.forEach(g=>{if(0!==g){const l=e.getTexture(g);if(l){const p=new i.jyi(l);p.x=o*s,p.y=c*h,this.addChild(p)}}o++,o>=t.width&&(o=0,c++)})}createImageLayer(t){const e=i.xEZ.from(`${y}/${t.image}`),s=new i.jyi(e);this.addChild(s)}}class J{constructor(){this.textureStore={}}getTexture(t){var e;return null!==(e=this.textureStore[t])&&void 0!==e?e:null}updateTilesets(t){let e=1;this.textureStore={},t.forEach(s=>{const h=i.VL4.from(`${y}/${s.image}`);for(let o=0;o<s.imageheight;o+=s.tileheight)for(let c=0;c<s.imagewidth;c+=s.tilewidth)this.textureStore[e]=new i.xEZ(h,new i.AeJ(c,o,s.tilewidth,s.tileheight)),e++})}}class j extends i.W20{constructor(t){super(),this.screenBox=t,this.tilesetStore=new J,this.groundObjects=[],this.wallObjects=[],this.mainActorRect={x:0,y:0,width:72,height:72}}getMainActorCoords(){return this.mainActorRect}getGroundObjects(){return this.groundObjects}getWallObjects(){return this.wallObjects}loadLevel(t){console.log("loadLevel",t),this.removeChildren(),this.tilesetStore.updateTilesets(t.tilesets);const e=t.width*t.tilewidth,s=t.height*t.tileheight;this.groundObjects=[],this.addChild((new i.TCu).beginFill(0,0).drawRect(0,0,e,s).endFill()),t.layers.forEach(h=>{const o=new A(h,this.tilesetStore,t.tilewidth,t.tileheight,e,s);if(o.x=void 0!==h.offsetx?h.offsetx:h.x,o.y=void 0!==h.offsety?h.offsety:o.height>this.screenBox.height?h.y-(o.height-this.screenBox.height):h.y,"objectgroup"===h.type){let c=0;o.y!==h.y&&(c=h.y-o.y);const g=h.objects.find(l=>"main-actor"===l.type);this.mainActorRect=g?{x:g.x,y:g.y-c,width:g.width,height:g.height}:{x:0,y:0,width:72,height:72},h.objects.filter(l=>"ground"===l.type).forEach(l=>{this.groundObjects.push({x:l.x,y:l.y-c,width:l.width,height:l.height})}),h.objects.filter(l=>"wall"===l.type).forEach(l=>{this.wallObjects.push({x:l.x,y:l.y-c,width:l.width,height:l.height})})}this.addChild(o)})}}var d=u(5e3),f=(()=>{return(a=f||(f={}))[a.LOADING=0]="LOADING",a[a.GAME=1]="GAME",f;var a})();const D=[{path:"",component:(()=>{class a extends k.a{constructor(){super(...arguments),this.title=`PixelAntasy | ${v.X}`,this.appBgColor=18832,this.keysStore={},this.gameMode=f.LOADING}init(){super.init(),this.levelContainer=new j(this.screenBox),this.gameContainer.addChild(this.levelContainer),this.actor=new T(this.keysStore,this.screenBox.height),this.actor.x=300,this.actor.y=300,this.actor.crossDieLine$.pipe((0,R.R)(this.ngUnsubscribe)).subscribe(()=>{this.actor.setInitialPosition(this.levelContainer.getMainActorCoords())}),this.gameContainer.addChild(this.actor),this.newGame()}tickerLoop(e){this.gameMode===f.GAME&&this.actor.update(e)}onMouseUp(){this.actor.setState(n.Attack)}onKeyDown(e){this.keysStore[e.code]=!0}onKeyUp(e){"Digit1"===e.code&&(this.actor.x=10,this.actor.y=50),Object.prototype.hasOwnProperty.call(this.keysStore,e.code)&&(this.keysStore[e.code]=!1)}loadLevel(e){this.gameMode=f.LOADING,this.levelContainer.loadLevel(e),this.actor.setInitialPosition(this.levelContainer.getMainActorCoords()),this.actor.setGroundObjects(this.levelContainer.getGroundObjects()),this.actor.setWallObjects(this.levelContainer.getWallObjects()),this.gameMode=f.GAME}newGame(){fetch(`${y}/level-1.json?time=${(new Date).getTime()}`).then(e=>{if(!e.ok)throw new Error(e.statusText);return e.json()}).then(e=>{this.loadLevel(e)}).catch(e=>{throw e})}}return a.\u0275fac=function(){let t;return function(s){return(t||(t=d.n5z(a)))(s||a)}}(),a.\u0275cmp=d.Xpm({type:a,selectors:[["app-games-pixelantasy"]],hostBindings:function(e,s){1&e&&d.NdJ("mouseup",function(){return s.onMouseUp()},!1,d.evT)("keydown",function(o){return s.onKeyDown(o)},!1,d.evT)("keyup",function(o){return s.onKeyUp(o)},!1,d.evT)},features:[d.qOj],decls:2,vars:0,consts:[[1,"game-container"],["gameContainer",""]],template:function(e,s){1&e&&d._UZ(0,"div",0,1)},styles:["[_nghost-%COMP%]{flex:auto;display:flex;flex-direction:column;background-color:#004990;padding-left:10px;padding-top:10px}"]}),a})()}];let P=(()=>{class a{}return a.\u0275fac=function(e){return new(e||a)},a.\u0275mod=d.oAB({type:a}),a.\u0275inj=d.cJS({imports:[[L.ez,b.Bz.forChild(D)]]}),a})()}}]);