"use strict";(self.webpackChunkng_games=self.webpackChunkng_games||[]).push([[892],{6892:(x,p,r)=>{r.r(p),r.d(p,{ArkanoidEditorModule:()=>T});var a=r(9808),u=r(3075),v=r(2074),C=r(7706),c=r(2741),e=r(5e3),m=r(3489),y=r(4107),f=r(7423),k=r(508);function b(n,s){if(1&n&&(e.TgZ(0,"mat-option",10),e.TgZ(1,"div",11),e.TgZ(2,"div",12),e._UZ(3,"img",13),e.qZA(),e.TgZ(4,"div",14),e._uU(5),e.qZA(),e.qZA(),e.qZA()),2&n){const t=s.$implicit;e.Q6J("value",t.value),e.xp6(3),e.Q6J("src",t.iconUrl,e.LSH),e.xp6(2),e.Oqu(t.title)}}let h=(()=>{class n{constructor(){this.formGroup=new u.cw({type:new u.NI("brick-grey"),score:new u.NI("10")}),this.listTypes=[{title:"\u0421\u0435\u0440\u044b\u0439",value:"brick-grey",iconUrl:"assets/arkanoid-editor/brick-grey.png"}]}onClear(){var t;null===(t=this.dialogRef)||void 0===t||t.close(Object.assign({},this.formGroup.getRawValue(),{mode:"clear"}))}onApply(){var t;null===(t=this.dialogRef)||void 0===t||t.close(Object.assign({},this.formGroup.getRawValue(),{mode:"apply"}))}close(){var t;null===(t=this.dialogRef)||void 0===t||t.close()}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-brick-edit"]],decls:17,vars:4,consts:[[1,"inside-modal-body-container",3,"formGroup"],[1,"flex-row"],[1,"form-group","flex-auto"],["formControlName","type"],[3,"value",4,"ngFor","ngForOf"],["label","\u041a\u043e\u043b-\u0432\u043e \u043e\u0447\u043a\u043e\u0432 \u0437\u0430 \u0431\u043b\u043e\u043a","formControlName","score",3,"min","max"],[1,"footer-buttons"],["mat-raised-button","","color","accent",1,"button-left",3,"click"],["mat-raised-button","","color","success",3,"click"],["mat-raised-button","","color","accent",3,"click"],[3,"value"],[1,"type-item"],[1,"icon"],[3,"src"],[1,"text"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e.TgZ(2,"div",2),e.TgZ(3,"mat-form-field"),e.TgZ(4,"mat-label"),e._uU(5,"\u0422\u0438\u043f \u0431\u043b\u043e\u043a\u0430"),e.qZA(),e.TgZ(6,"mat-select",3),e.YNc(7,b,6,3,"mat-option",4),e.qZA(),e.qZA(),e.qZA(),e.TgZ(8,"div",2),e._UZ(9,"uf-touchspin",5),e.qZA(),e.qZA(),e.qZA(),e.TgZ(10,"div",6),e.TgZ(11,"button",7),e.NdJ("click",function(){return o.onClear()}),e._uU(12," \u041e\u0447\u0438\u0441\u0442\u0438\u0442\u044c "),e.qZA(),e.TgZ(13,"button",8),e.NdJ("click",function(){return o.onApply()}),e._uU(14," \u041f\u0440\u0438\u043c\u0435\u043d\u0438\u0442\u044c "),e.qZA(),e.TgZ(15,"button",9),e.NdJ("click",function(){return o.close()}),e._uU(16,"\u0417\u0430\u043a\u0440\u044b\u0442\u044c"),e.qZA(),e.qZA()),2&t&&(e.Q6J("formGroup",o.formGroup),e.xp6(7),e.Q6J("ngForOf",o.listTypes),e.xp6(2),e.Q6J("min",1)("max",1e3))},directives:[u.JL,u.sg,m.KE,m.hX,y.gD,u.JJ,u.u,a.sg,c.TC,f.lW,k.ey],styles:[".type-item[_ngcontent-%COMP%]{display:flex}.type-item[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;padding-right:10px}.button-left[_ngcontent-%COMP%]{position:absolute;left:10px}"]}),n})();var E=r(7268);let g=(()=>{class n{constructor(t,o){this.elementRef=t,this.dialogService=o,this.selected=!1,this.type=null,this.score=null}setSelectionByRect(t){const i=E.k.pointInRect({x:this.elementRef.nativeElement.offsetLeft+44,y:this.elementRef.nativeElement.offsetTop+22},t);i&&!this.selected?this.selected=!0:!i&&this.selected&&(this.selected=!1)}onDblClick(){this.dialogService.showModal("\u041f\u0440\u0438\u043c\u0435\u043d\u0438\u0442\u044c \u043a\u0438\u0440\u043f\u0438\u0447\u0438\u043a\u0438",h).subscribe(t=>{t&&("clear"===t.mode?(this.type=null,this.score=null):(this.type=t.type,this.score=t.score))})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(e.SBq),e.Y36(c.xA))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-brick"]],inputs:{position:"position"},decls:2,vars:4,consts:[[1,"brick",3,"dblclick"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0),e.NdJ("dblclick",function(){return o.onDblClick()}),e._uU(1," \xa0\n"),e.qZA()),2&t&&(e.Tol(o.type),e.ekj("selected",o.selected))},styles:["[_nghost-%COMP%]{display:flex;border-right:1px solid #c6c6c6;border-bottom:1px solid #c6c6c6}.brick[_ngcontent-%COMP%]{flex:auto;-webkit-user-select:none;user-select:none;background-position:center;background-repeat:no-repeat;background-size:cover}.brick.brick-grey[_ngcontent-%COMP%]{background-image:url(brick-grey.b3279a1b23d044be.png)}.brick.selected[_ngcontent-%COMP%]{background-color:#d6e6fc;background-image:none}"]}),n})();const _=["grid"],A=["mouseRect"];function Z(n,s){1&n&&e._UZ(0,"app-brick",10),2&n&&e.Q6J("position",s.$implicit.position)}const M=[{path:"",component:(()=>{class n{constructor(t){this.dialogService=t,this.levelName="",this.bricks=[],this.visibleMouseRect=!1,this.mouseCoords=null;for(let o=0;o<15;o++)for(let i=0;i<21;i++)this.bricks.push({position:{x:i,y:o}})}onClearLevel(){this.clearLevel()}onUploadLevel(){c.ZH.uploadJson().subscribe(t=>{this.clearLevel(),this.levelName=t&&t.name&&t.name.label?t.name.label:"",Array.isArray(t.bricks)&&this.brickChildren.forEach(o=>{const i=t.bricks.find(l=>l.position.x===o.position.x&&l.position.y===o.position.y);i&&(o.type=i.textureName,o.score=i.score)})},t=>{console.log("error",t)})}onSaveLevel(){const t=[];this.brickChildren.forEach(i=>{i.type&&t.push({position:i.position,textureName:i.type,score:c.ZH.hasValue(i.score)?Number(i.score):0})}),c.ZH.downloadJson({name:{label:this.levelName,color:16777215},bricks:t},"level.json")}onGridMouseMove(t){if(this.visibleMouseRect&&this.mouseCoords){let o,i,l,d;t.layerX>this.mouseCoords.x?(o=this.mouseCoords.x,i=t.layerX-this.mouseCoords.x):(o=t.layerX,i=this.mouseCoords.x-t.layerX),t.layerY>this.mouseCoords.y?(l=this.mouseCoords.y,d=t.layerY-this.mouseCoords.y):(l=t.layerY,d=this.mouseCoords.y-t.layerY),this.setMouseRectBounding({x:o,y:l,width:i,height:d}),this.brickChildren.forEach(R=>R.setSelectionByRect({x:o,y:l,width:i,height:d}))}}onMouseUp(){this.visibleMouseRect&&this.applyMouseRect()}onGridMouseUp(t){t.target!==this.gridElementRef.nativeElement||null===this.mouseCoords||this.applyMouseRect()}onGridMouseDown(t){this.setMouseRectBounding({x:t.layerX,y:t.layerY,width:0,height:0}),this.mouseCoords={x:t.layerX,y:t.layerY},this.visibleMouseRect=!0}applyMouseRect(){this.mouseCoords=null,this.visibleMouseRect=!1,this.countSelection()>0&&this.dialogService.showModal("\u041f\u0440\u0438\u043c\u0435\u043d\u0438\u0442\u044c \u043a\u0438\u0440\u043f\u0438\u0447\u0438\u043a\u0438",h).subscribe(t=>{t&&this.brickChildren.forEach(o=>{o.selected&&("clear"===t.mode?(o.type=null,o.score=null):(o.type=t.type,o.score=t.score))}),this.clearSelection()})}setMouseRectBounding(t){this.mouseRectElementRef&&this.mouseRectElementRef.nativeElement&&(this.mouseRectElementRef.nativeElement.style.left=`${t.x}px`,this.mouseRectElementRef.nativeElement.style.top=`${t.y}px`,this.mouseRectElementRef.nativeElement.style.width=`${t.width}px`,this.mouseRectElementRef.nativeElement.style.height=`${t.height}px`)}countSelection(){return this.brickChildren.filter(o=>o.selected).length}clearSelection(){this.brickChildren.forEach(t=>t.selected=!1)}clearLevel(){this.brickChildren.forEach(t=>{t.type=null,t.score=null})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(c.xA))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-arkanoid-editor"]],viewQuery:function(t,o){if(1&t&&(e.Gf(_,5),e.Gf(A,5),e.Gf(g,5)),2&t){let i;e.iGM(i=e.CRH())&&(o.gridElementRef=i.first),e.iGM(i=e.CRH())&&(o.mouseRectElementRef=i.first),e.iGM(i=e.CRH())&&(o.brickChildren=i)}},hostBindings:function(t,o){1&t&&e.NdJ("mouseup",function(){return o.onMouseUp()},!1,e.evT)},decls:16,vars:4,consts:[[1,"topbar"],["label","\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435 \u0443\u0440\u043e\u0432\u043d\u044f",1,"flex-auto",3,"ngModel","ngModelChange"],[1,"ml-10"],["mat-raised-button","","color","primary",3,"click"],["mat-raised-button","","color","accent",3,"click"],[1,"grid",3,"mousedown","mouseup","mousemove"],["grid",""],[3,"position",4,"ngFor","ngForOf"],["id","mouse-rect"],["mouseRect",""],[3,"position"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0),e.TgZ(1,"uf-input",1),e.NdJ("ngModelChange",function(l){return o.levelName=l}),e.qZA(),e.TgZ(2,"div",2),e.TgZ(3,"button",3),e.NdJ("click",function(){return o.onSaveLevel()}),e._uU(4," \u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0443\u0440\u043e\u0432\u0435\u043d\u044c "),e.qZA(),e.qZA(),e.TgZ(5,"div",2),e.TgZ(6,"button",3),e.NdJ("click",function(){return o.onUploadLevel()}),e._uU(7," \u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u0443\u0440\u043e\u0432\u0435\u043d\u044c "),e.qZA(),e.qZA(),e.TgZ(8,"div",2),e.TgZ(9,"button",4),e.NdJ("click",function(){return o.onClearLevel()}),e._uU(10," \u041e\u0447\u0438\u0441\u0442\u0438\u0442\u044c \u0443\u0440\u043e\u0432\u0435\u043d\u044c "),e.qZA(),e.qZA(),e.qZA(),e.TgZ(11,"div",5,6),e.NdJ("mousedown",function(l){return o.onGridMouseDown(l)})("mouseup",function(l){return o.onGridMouseUp(l)})("mousemove",function(l){return o.onGridMouseMove(l)}),e.YNc(13,Z,1,1,"app-brick",7),e._UZ(14,"div",8,9),e.qZA()),2&t&&(e.xp6(1),e.Q6J("ngModel",o.levelName),e.xp6(12),e.Q6J("ngForOf",o.bricks),e.xp6(1),e.ekj("visible",o.visibleMouseRect))},directives:[c.Oy,u.JJ,u.On,f.lW,a.sg,g],styles:["[_nghost-%COMP%]{flex:auto;display:flex;flex-direction:column;padding:10px}.topbar[_ngcontent-%COMP%]{display:flex;align-items:center}.grid[_ngcontent-%COMP%]{position:relative;display:grid;width:1848px;left:50%;margin-left:-924px;grid-template-columns:repeat(21,88px);grid-template-rows:repeat(15,44px);border-top:1px solid #c6c6c6;border-left:1px solid #c6c6c6}#mouse-rect[_ngcontent-%COMP%]{position:absolute;z-index:10;border:2px dotted #000000;display:none;width:100px;height:100px;pointer-events:none}#mouse-rect.visible[_ngcontent-%COMP%]{display:block}"]}),n})()}];let T=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[a.ez,u.u5,u.UX,v.Bz.forChild(M),C.m]]}),n})()}}]);