"use strict";(self.webpackChunkng_games=self.webpackChunkng_games||[]).push([[447],{5447:(Y,v,d)=>{d.r(v),d.d(v,{SpaceInvadersModule:()=>$});var M=d(9808),T=d(2074),S=d(6797),r=d(8977);class b extends r.W20{constructor(){super();const i=r.xEZ.from("assets/games/space-invaders/ship-tug.png");this.ship=new r.jyi(i),this.ship.width=78,this.ship.height=78,this.ship.anchor.set(.5,.5),this.addChild(this.ship)}}var g=d(7579),y=d(8306),f=d(6695);class I extends r.jyi{constructor(i,e,t,n,h){super(new r.xEZ(i,new r.AeJ(e.x,e.y,e.width,e.height))),this.score=h,this.width=64,this.height=64,this.x=t,this.y=n}}var l=(()=>{return(o=l||(l={}))[o.TO_RIGHT=0]="TO_RIGHT",o[o.TO_LEFT=1]="TO_LEFT",o[o.TO_DOWN=2]="TO_DOWN",l;var o})();class F extends r.W20{constructor(i,e){super(),this.screenWidth=i,this.screenHeight=e,this.winLevel=new g.x,this.failLevel=new g.x,this.speedEnemyDown=2,this.speedEnemyRight=1,this.speedEnemyLeft=1,this.winLevel$=this.winLevel.asObservable(),this.failLevel$=this.failLevel.asObservable(),this.enemiesBaseTexture=r.VL4.from("assets/games/space-invaders/enemies.png"),this.addChild((new r.TCu).beginFill(255,.01).drawRect(0,0,i,e).endFill())}initLevel(){return new y.y(i=>{let e=Math.floor(this.screenWidth/104);e>11&&(e=11);const t=Math.round((this.screenWidth-104*e)/2)+52,n={x:0,y:0,width:64,height:64},s=[];for(let a=0;a<3;a++){const x=[],p=50+74*a;for(let w=0;w<e;w++){const C=new I(this.enemiesBaseTexture,n,t+104*w,p,10);this.addChild(C),x.push(C)}s.push(x)}this.enemyMatrix={direction:l.TO_RIGHT,coordY:50,lines:s},i.next(),i.complete()})}update(i){var e,t,n;if(Array.isArray(null===(e=this.enemyMatrix)||void 0===e?void 0:e.lines)){let h=!1,s=0;if(null===(t=this.enemyMatrix)||void 0===t||t.lines.forEach(a=>{Array.isArray(a)&&(s+=a.length,a.forEach(x=>{var p;switch(null===(p=this.enemyMatrix)||void 0===p?void 0:p.direction){case l.TO_RIGHT:x.x+=this.speedEnemyRight*i;break;case l.TO_LEFT:x.x-=this.speedEnemyLeft*i;break;case l.TO_DOWN:x.y+=this.speedEnemyDown*i,x.y+64>=this.deadLineCoordY&&(h=!0)}}))}),0===s)this.onWinLevel();else if(h)this.onFailLevel();else if(this.enemyMatrix&&this.enemyMatrix.direction===l.TO_DOWN)this.enemyMatrix.coordY||(this.enemyMatrix.coordY=0),this.enemyMatrix.coordY+=this.speedEnemyDown*i,void 0!==this.enemyMatrix.stopDownY&&this.enemyMatrix.nextDirection&&this.enemyMatrix.coordY>=this.enemyMatrix.stopDownY&&(this.enemyMatrix.direction=this.enemyMatrix.nextDirection);else if(null===(n=this.enemyMatrix)||void 0===n?void 0:n.lines)for(const a of this.enemyMatrix.lines)Array.isArray(a)&&a.length>0&&(this.enemyMatrix.direction===l.TO_RIGHT?a[a.length-1].x>=this.screenWidth-64-20&&(this.enemyMatrix.nextDirection=l.TO_LEFT,this.enemyMatrix.direction=l.TO_DOWN,this.enemyMatrix.stopDownY=this.enemyMatrix.coordY||64,this.speedEnemyLeft=f.M.getRandomInt(1,10)):this.enemyMatrix.direction===l.TO_LEFT&&a[0].x<=20&&(this.enemyMatrix.nextDirection=l.TO_RIGHT,this.enemyMatrix.direction=l.TO_DOWN,this.enemyMatrix.stopDownY=this.enemyMatrix.coordY||64,this.speedEnemyRight=f.M.getRandomInt(1,10)))}}fireCollision(i){var e,t;if((null===(e=this.enemyMatrix)||void 0===e?void 0:e.lines)&&Array.isArray(null===(t=this.enemyMatrix)||void 0===t?void 0:t.lines))for(const n of this.enemyMatrix.lines)if(Array.isArray(n))for(let h=0;h<n.length;h++){const s=n[h];if(s&&f.M.isRectangleCollision(i,s.getBounds())){const a=s.x+s.width/2,x=s.y+s.height/2;return s.destroy(),n.splice(h,1),{x:a,y:x,score:s.score}}}return null}onWinLevel(){this.enemyMatrix=null,this.removeChildren(),this.winLevel.next()}onFailLevel(){this.enemyMatrix=null,this.removeChildren(),this.failLevel.next()}}class O extends r.KgH{constructor(i,e,t){super(i),this.loop=!0,this.animationSpeed=.5,this.anchor.set(.5,.5),this.x=e,this.y=t,this.onLoop=()=>this.destroy()}}class L extends r.KgH{constructor(i,e,t){super(i),this.fireSpeed=10,this.gotoAndPlay(0),this.loop=!0,this.animationSpeed=.3,this.angle=180,this.anchor.set(.5,.5),this.scale.set(.2,.2),this.x=e,this.y=t}}const E=[{height:256,width:128,x:0,y:0},{height:256,width:128,x:128,y:0},{height:256,width:128,x:256,y:0},{height:256,width:128,x:384,y:0},{height:256,width:128,x:512,y:0},{height:256,width:128,x:640,y:0},{height:256,width:128,x:768,y:0},{height:256,width:128,x:896,y:0}],H=[{height:64,width:64,x:0,y:0},{height:64,width:64,x:64,y:0},{height:64,width:64,x:128,y:0},{height:64,width:64,x:192,y:0},{height:64,width:64,x:0,y:64},{height:64,width:64,x:64,y:64},{height:64,width:64,x:128,y:64},{height:64,width:64,x:192,y:64},{height:64,width:64,x:0,y:128},{height:64,width:64,x:64,y:128},{height:64,width:64,x:128,y:128},{height:64,width:64,x:192,y:128},{height:64,width:64,x:0,y:192},{height:64,width:64,x:64,y:192},{height:64,width:64,x:128,y:192},{height:64,width:64,x:192,y:192}];class B extends r.W20{constructor(i,e,t){super(),this.enemyContainer=t,this.scoreEvent=new g.x,this.fireTextures=[],this.explosionTextures=[],this.fires=new Map,this.indexFire=0,this.fireSpeed=15,this.scoreEvent$=this.scoreEvent.asObservable();const n=r.VL4.from("assets/games/space-invaders/fire.png");for(const s of E){const a=new r.xEZ(n,new r.AeJ(s.x,s.y,s.width,s.height));this.fireTextures.push(a)}const h=r.VL4.from("assets/games/space-invaders/explosion.png");for(const s of H){const a=new r.xEZ(h,new r.AeJ(s.x,s.y,s.width,s.height));this.explosionTextures.push(a)}this.addChild((new r.TCu).beginFill(255,.01).drawRect(0,0,i,e).endFill()),this.enemyContainer.winLevel$.subscribe(()=>this.clearFires()),this.enemyContainer.failLevel$.subscribe(()=>this.clearFires())}update(i){this.fires.forEach((e,t)=>{if(e.y-=this.fireSpeed*i,e.y<=0)e.destroy(),this.fires.delete(t);else{const n=this.enemyContainer.fireCollision(e.getBounds());if(null!==n){const h=new O(this.explosionTextures,n.x,n.y);this.addChild(h),h.gotoAndPlay(0),e.destroy(),this.fires.delete(t),this.scoreEvent.next({x:n.x,y:n.y,score:n.score})}else e.fireSpeed>2&&(e.fireSpeed-=.1)}})}fire(i,e){const t=new L(this.fireTextures,i,e);this.addChild(t),this.fires.set(this.indexFire,t),this.indexFire++}clearFires(){this.fires.forEach(i=>i.destroy()),this.fires.clear()}}var u=d(2722),W=d(9646),D=d(4825);class A extends r.W20{constructor(i,e){super(),this.screenWidth=i,this.screenHeight=e,this.msgIndex=0,this.addChild((new r.TCu).beginFill(255,.01).drawRect(0,0,i,e).endFill())}failMessage(i,e=null){return new y.y(t=>{const n=new r.pn8({fontFamily:"pixel",fontSize:64,fontWeight:"bold",fill:["#ffffff","#ff0000"],stroke:"#4a1850",strokeThickness:5,dropShadow:!0,dropShadowColor:"#000000",dropShadowBlur:4,dropShadowAngle:Math.PI/6,dropShadowDistance:6,wordWrap:!1,lineJoin:"round"}),h=`msgText-${this.msgIndex}`,s=new r.xvT(i,n);s.x=(this.screenWidth-s.width)/2,s.y=(this.screenHeight-s.height)/2,s.name=h,this.msgIndex++,this.addChild(s),null===e?(t.next(),t.complete()):(0,W.of)(null).pipe((0,D.g)(e)).subscribe(()=>{this.flyObject(h).subscribe(()=>{t.next(),t.complete()},a=>{t.error(a)})})})}successMessage(i,e=null){return new y.y(t=>{const n=new r.pn8({fontFamily:"pixel",fontSize:64,fontWeight:"bold",fill:["#ffffff","#00ff99"],stroke:"#4a1850",strokeThickness:5,dropShadow:!0,dropShadowColor:"#000000",dropShadowBlur:4,dropShadowAngle:Math.PI/6,dropShadowDistance:6,wordWrap:!1,lineJoin:"round"}),h=`msgText-${this.msgIndex}`,s=new r.xvT(i,n);s.x=(this.screenWidth-s.width)/2,s.y=(this.screenHeight-s.height)/2,s.name=h,this.msgIndex++,this.addChild(s),null===e?(t.next(),t.complete()):this.flyObject(h).subscribe(()=>{t.next(),t.complete()},a=>{t.error(a)})})}flyScore(i,e,t){const n=`flyText-${this.msgIndex}`;this.msgIndex++;const h=new r.Xz2(f.M.numberFormat(t),{align:"left",fontName:"pixel",fontSize:16});h.x=i,h.y=e,h.tint=16777215,h.name=n,this.addChild(h),this.flyObject(n).subscribe(()=>{})}flyObject(i){return new y.y(e=>{f.M.animate({draw:t=>{if(this){const n=this.children.find(h=>h.name===i);n?(n.y-=75*t,t>=1&&(n.destroy(),e.next(),e.complete())):e.error("not object")}},duration:1e3,timing:f.d.back})})}}var N=d(2961),m=d(5e3);const R=[{path:"",component:(()=>{class o extends N.a{constructor(){super(...arguments),this.title="Space invaders | Selax Games",this.fireInterval=null,this.totalScore=0}init(){super.init(),this.app.loader.add("pixel","assets/games/fonts/pixel.fnt.xml"),this.app.loader.load(()=>{this.initScreenGame(),this.shipHero=new b,this.shipHero.x=(this.screenBox.width-this.shipHero.width/2)/2,this.shipHero.y=this.screenBox.height-35-this.shipHero.height/2,this.gameContainer.addChild(this.shipHero),this.enemyContainer=new F(this.screenBox.width,this.screenBox.height),this.gameContainer.addChild(this.enemyContainer),this.fireContainer=new B(this.screenBox.width,this.screenBox.height,this.enemyContainer),this.gameContainer.addChild(this.fireContainer),this.messageContainer=new A(this.screenBox.width,this.screenBox.height),this.gameContainer.addChild(this.messageContainer),this.fireContainer.on("mousemove",this.onMouseMove.bind(this)),this.fireContainer.on("mousedown",this.onMouseDown.bind(this)),this.fireContainer.on("mouseup",this.onMouseUp.bind(this)),this.fireContainer.on("mouseout",this.onMouseOut.bind(this)),this.fireContainer.scoreEvent$.pipe((0,u.R)(this.ngUnsubscribe)).subscribe(e=>{this.messageContainer.flyScore(e.x,e.y,e.score),this.totalScore+=e.score,this.scoreText.text=`\u0421\u0447\u0435\u0442: ${f.M.numberFormat(this.totalScore)}`}),this.enemyContainer.deadLineCoordY=this.shipHero.y-this.shipHero.height/2,this.enemyContainer.failLevel$.pipe((0,u.R)(this.ngUnsubscribe)).subscribe(()=>{this.fireContainer.interactive=!1,this.clearFireInterval(),this.messageContainer.failMessage("\u0423\u0440\u043e\u0432\u0435\u043d\u044c \u043d\u0435 \u043f\u0440\u043e\u0439\u0434\u0435\u043d").subscribe(()=>{})}),this.enemyContainer.winLevel$.pipe((0,u.R)(this.ngUnsubscribe)).subscribe(()=>{this.fireContainer.interactive=!1,this.clearFireInterval(),this.messageContainer.successMessage("\u0423\u0440\u043e\u0432\u0435\u043d\u044c \u043f\u0440\u043e\u0439\u0434\u0435\u043d \u0443\u0441\u043f\u0435\u0448\u043d\u043e").subscribe(()=>{})}),this.enemyContainer.initLevel().subscribe(()=>{this.fireContainer.interactive=!0})})}tickerLoop(e){this.destroying||(this.bgStarNest&&(this.bgStarNest.shader.uniforms.iTime+=e/500),this.fireContainer&&this.fireContainer.update(e),this.enemyContainer&&this.enemyContainer.update(e))}onMouseMove(e){this.shipHero.x=e.data.global.x}onMouseDown(e){this.fireInterval=window.setInterval(()=>{this.fireContainer.fire(this.shipHero.x,this.shipHero.y)},500),this.shipHero.x=e.data.global.x}onMouseUp(e){this.clearFireInterval(),this.fireContainer.fire(this.shipHero.x,this.shipHero.y)}onMouseOut(){this.clearFireInterval()}initScreenGame(){this.bgStarNest=S.V3.getShaderMesh(this.screenBox.width,this.screenBox.height),this.gameContainer.addChild(this.bgStarNest),this.gameContainer.addChild((new r.TCu).beginFill(16777215,.8).drawRect(10,this.screenBox.height-32,this.screenBox.width-20,2).endFill()),this.scoreText=new r.Xz2("\u0421\u0447\u0435\u0442: 0",{align:"left",fontName:"pixel",fontSize:18}),this.scoreText.x=10,this.scoreText.y=this.screenBox.height-26,this.gameContainer.addChild(this.scoreText)}clearFireInterval(){this.fireInterval&&(window.clearInterval(this.fireInterval),this.fireInterval=null)}}return o.\u0275fac=function(){let i;return function(t){return(i||(i=m.n5z(o)))(t||o)}}(),o.\u0275cmp=m.Xpm({type:o,selectors:[["app-games-space-invaders"]],features:[m.qOj],decls:2,vars:0,consts:[[1,"game-container"],["gameContainer",""]],template:function(e,t){1&e&&m._UZ(0,"div",0,1)},styles:["[_nghost-%COMP%]{flex:auto;display:flex;flex-direction:column;background-color:#004990;padding-left:10px;padding-top:10px}"]}),o})()}];let $=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=m.oAB({type:o}),o.\u0275inj=m.cJS({imports:[[M.ez,T.Bz.forChild(R)]]}),o})()}}]);