"use strict";(self.webpackChunku_forms=self.webpackChunku_forms||[]).push([[505],{3505:(U,m,n)=>{n.r(m),n.d(m,{PreviewModule:()=>j});var f=n(9808),v=n(520),p=n(3075),g=n(4100),l=n(5759),O=n(8029),x=n(2959),b=n(7579),T=n(2722),C=n(8746),y=n(136),u=n(4016),P=n(3947),t=n(5e3),D=n(2313),S=n(1969),M=n(5245),A=n(7423);const H=["scrollContainer"];function Z(i,r){1&i&&t._UZ(0,"app-page-not-found")}function k(i,r){if(1&i&&t._UZ(0,"uf-form-container",7),2&i){const e=t.oxw();t.Q6J("rows",e.rows)("dto",e.dto)("config",e.formConfig)}}function w(i,r){if(1&i&&(t.TgZ(0,"div",8)(1,"div"),t._uU(2),t.qZA()()),2&i){const e=t.oxw();t.xp6(2),t.Oqu(e.projectName)}}function I(i,r){if(1&i){const e=t.EpF();t.TgZ(0,"div",22),t.NdJ("click",function(){const d=t.CHM(e).$implicit,c=t.oxw(2);return t.KtG(c.onSelectDTO(d))}),t.TgZ(1,"span",23),t._uU(2),t.qZA(),t.TgZ(3,"button",24),t.NdJ("click",function(s){const c=t.CHM(e).$implicit,a=t.oxw(2);return t.KtG(a.onViewDTO(s,c))}),t.TgZ(4,"mat-icon"),t._uU(5,"visibility"),t.qZA()()()}if(2&i){const e=r.$implicit;t.ekj("selected",e.selected),t.xp6(2),t.Oqu(e.name)}}function _(i,r){if(1&i){const e=t.EpF();t.TgZ(0,"div",9)(1,"div",10)(2,"button",11),t.NdJ("click",function(){t.CHM(e);const s=t.oxw();return t.KtG(s.onEditProject())}),t.TgZ(3,"mat-icon"),t._uU(4,"edit"),t.qZA(),t.TgZ(5,"span"),t._uU(6,"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043f\u0440\u043e\u0435\u043a\u0442"),t.qZA()()(),t.TgZ(7,"div",12)(8,"div",13)(9,"div",14),t._uU(10,"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 DTO"),t.qZA(),t.TgZ(11,"div",15,16)(13,"div",17),t.YNc(14,I,6,3,"div",18),t.qZA()()(),t.TgZ(15,"div",13)(16,"div",14),t._uU(17,"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u0435 DTO"),t.qZA(),t.TgZ(18,"div",10),t._UZ(19,"uf-select",19)(20,"uf-input",20),t.TgZ(21,"button",21),t.NdJ("click",function(){t.CHM(e);const s=t.oxw();return t.KtG(s.onLoadDTO())}),t._uU(22," \u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c DTO "),t.qZA()()()()()}if(2&i){const e=t.oxw();t.xp6(11),t.Udp("height",e.dtoContainerHeight,"px"),t.xp6(3),t.Q6J("ngForOf",e.availableDTO),t.xp6(5),t.Q6J("options",e.dtoTypesList)("clearButton",!1)("formControl",e.controlDTOType),t.xp6(1),t.Q6J("label",e.labelDTOId)("disabled",!e.controlDTOType.value)("formControl",e.controlDTOId),t.xp6(1),t.Q6J("disabled",!e.controlDTOId.value)}}const J=[{path:"",component:(()=>{class i{constructor(e,o,s,d,c,a,h,N,E){this.router=e,this.activatedRoute=o,this.titleService=s,this.dialogService=d,this.projectsService=c,this.dtoService=a,this.userService=h,this.kiasApiService=N,this.is404Error=!1,this.stateLoading=!0,this.projectName="",this.rows=[],this.availableDTO=[],this.dtoContainerHeight=0,this.dtoTypesList=[],this.controlDTOType=new l.M_(null),this.controlDTOId=new l.M_(null),this.labelDTOId="",this.dto=null,this.ngUnsubscribe=new b.x,this.projectId=null,this.scrollContainerOffsetTop=0,this.headerHeight=0,this.footerHeight=0,this.titleService.setTitle(`\u041f\u0440\u043e\u0441\u043c\u043e\u0442\u0440 \u0444\u043e\u0440\u043c\u044b | ${y.X}`),window.addEventListener("resize",this.resizeWin.bind(this)),this.formConfig=E.getUFFormConfig()}ngOnInit(){this.dtoTypesList=[{value:"kiasCalc",title:"\u041a\u043e\u0442\u0438\u0440\u043e\u0432\u043a\u0430 \u041a\u0418\u0410\u0421",disabled:!this.userService.isKiasAuth()},{value:"kiasAgreement",title:"\u0414\u043e\u0433\u043e\u0432\u043e\u0440 \u041a\u0418\u0410\u0421",disabled:!this.userService.isKiasAuth()}],this.controlDTOType.valueChanges.pipe((0,T.R)(this.ngUnsubscribe)).subscribe(e=>{switch(e){case"kiasCalc":this.labelDTOId="ISN \u043a\u043e\u0442\u0438\u0440\u043e\u0432\u043a\u0438";break;case"kiasAgreement":this.labelDTOId="ISN \u0434\u043e\u0433\u043e\u0432\u043e\u0440\u0430";break;default:this.labelDTOId=""}}),this.userService.isKiasAuth()&&this.controlDTOType.setValue("kiasCalc"),this.dtoService.getDTOList(["id","name","type","dto"]).subscribe(e=>{this.availableDTO=(e||[]).map(o=>({id:o.id,type:u.K$.dtoTypeToStr(o.type),name:o.name,dto:JSON.parse(o.dto)}))}),this.activatedRoute.paramMap.pipe((0,T.R)(this.ngUnsubscribe)).subscribe(e=>{const o=e.get("id");this.stateLoading=!0,o&&this.loadProject(+o)})}ngAfterViewInit(){var e;null!==(e=this.scrollContainerRef)&&void 0!==e&&e.nativeElement&&(this.scrollContainerOffsetTop=this.scrollContainerRef.nativeElement.offsetTop);const o=document.querySelector("header"),s=document.querySelector("footer");o&&(this.headerHeight=o.getBoundingClientRect().height),s&&(this.footerHeight=s.getBoundingClientRect().height),setTimeout(()=>this.resizeWin())}ngOnDestroy(){window.removeEventListener("resize",this.resizeWin),this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}onViewDTO(e,o){e.stopPropagation(),this.dialogService.showModal(`\u041f\u0440\u043e\u0441\u043c\u043e\u0442\u0440 DTO: ${o.type} - ${o.name||"\u0411\u0435\u0437 \u043d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u044f"}`,P.M,{dto:o.dto}).subscribe()}onLoadDTO(){switch(this.controlDTOType.value){case"kiasCalc":this.dialogService.showWait("\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u043a\u043e\u0442\u0438\u0440\u043e\u0432\u043a\u0438 \u041a\u0418\u0410\u0421..."),this.kiasApiService.getAgrCalc(this.controlDTOId.value).pipe((0,C.x)(()=>this.dialogService.hideWait())).subscribe(e=>{this.applyDTO(e)});break;case"kiasAgreement":this.dialogService.showWait("\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0434\u043e\u0433\u043e\u0432\u043e\u0440\u0430 \u041a\u0418\u0410\u0421..."),this.kiasApiService.getAgreement(this.controlDTOId.value).pipe((0,C.x)(()=>this.dialogService.hideWait())).subscribe(e=>{this.applyDTO(e)})}}onSelectDTO(e){this.availableDTO.forEach(o=>o.selected=!1),e.selected=!0,this.applyDTO(e.dto)}onEditProject(){this.router.navigate(["builder",this.projectId])}applyDTO(e){this.dto=e}loadProject(e){this.dialogService.showWait("\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u043f\u0440\u043e\u0435\u043a\u0442\u0430..."),this.projectsService.loadProject(e).subscribe({next:o=>{this.projectId=e,this.projectName=o.name,this.stateLoading=!1,this.rows=this.toJSON(o.data)},error:o=>{this.dialogService.showToastError(o.message)},complete:()=>this.dialogService.hideWait()})}toJSON(e){const o=d=>{Array.isArray(d)&&d.forEach(c=>{delete c.idx,Array.isArray(c.children)&&c.children.forEach(a=>{"PANEL"===a.type&&delete a.idx,a.children&&o(a.children),Array.isArray(a.tabs)&&a.tabs.forEach(h=>{h.children&&o(h.children)})})})},s=JSON.parse(JSON.stringify(e));return o(s),s}resizeWin(){const e=window.innerHeight-this.scrollContainerOffsetTop-this.headerHeight-this.footerHeight;this.dtoContainerHeight!=e-300&&(this.dtoContainerHeight=e-300)}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(g.F0),t.Y36(g.gz),t.Y36(D.Dx),t.Y36(l.xA),t.Y36(u.m9),t.Y36(u.K$),t.Y36(u.KD),t.Y36(u.MM),t.Y36(u.E4))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-home"]],viewQuery:function(e,o){if(1&e&&t.Gf(H,5),2&e){let s;t.iGM(s=t.CRH())&&(o.scrollContainerRef=s.first)}},decls:7,vars:8,consts:[[4,"ngIf"],[1,"flex-col","flex-auto","pl-10","pr-10"],[3,"rows","dto","config",4,"ngIf"],[1,"sidebar"],[1,"sidebar-sticky"],["class","project-name",4,"ngIf"],["class","sidebar-container",4,"ngIf"],[3,"rows","dto","config"],[1,"project-name"],[1,"sidebar-container"],[1,"flex-col"],["mat-raised-button","","color","success",1,"flex-auto","mat-button-with-icon",3,"click"],[1,"flex-col","mt-10"],[1,"fieldset"],[1,"legend"],[1,"scroll-container"],["scrollContainer",""],[1,"scroll"],["class","dto-item",3,"selected","click",4,"ngFor","ngForOf"],["label","\u0414\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0435 \u0442\u0438\u043f\u044b DTO",3,"options","clearButton","formControl"],[3,"label","disabled","formControl"],["mat-raised-button","","color","primary",3,"disabled","click"],[1,"dto-item",3,"click"],[1,"flex-auto"],["mat-icon-button","","color","primary",3,"click"]],template:function(e,o){1&e&&(t.YNc(0,Z,1,0,"app-page-not-found",0),t.TgZ(1,"div",1),t.YNc(2,k,1,3,"uf-form-container",2),t.qZA(),t.TgZ(3,"div",3)(4,"div",4),t.YNc(5,w,3,1,"div",5),t.YNc(6,_,23,10,"div",6),t.qZA()()),2&e&&(t.Q6J("ngIf",o.is404Error),t.xp6(1),t.ekj("loading-skeleton",o.stateLoading),t.xp6(1),t.Q6J("ngIf",!o.stateLoading),t.xp6(1),t.ekj("loading-skeleton",o.stateLoading),t.xp6(2),t.Q6J("ngIf",!o.stateLoading&&o.projectName),t.xp6(1),t.Q6J("ngIf",!o.stateLoading))},dependencies:[f.sg,f.O5,p.JJ,p.oH,S.r,M.Hw,A.lW,l.Oy,l.tt,l.q9],styles:["[_nghost-%COMP%]{display:flex;flex:auto}.sidebar[_ngcontent-%COMP%]{width:350px;border-left:1px dotted #004990;box-sizing:border-box;display:flex;flex-direction:column}.sidebar[_ngcontent-%COMP%]:not(.loading-skeleton){background-color:#fff}.sidebar[_ngcontent-%COMP%]   .sidebar-container[_ngcontent-%COMP%]{padding:10px}.sidebar[_ngcontent-%COMP%]   .sidebar-sticky[_ngcontent-%COMP%]{display:flex;flex-direction:column;position:sticky;top:56px}.project-name[_ngcontent-%COMP%]{border-bottom:1px solid #004990;text-align:center;font-size:22px;position:relative;padding:5px 0}.mt-5[_ngcontent-%COMP%]{margin-top:5px}.dto-item[_ngcontent-%COMP%]{cursor:pointer;padding:5px 10px;display:flex;align-items:center}.dto-item[_ngcontent-%COMP%]:hover{background-color:#d6e6fc}.dto-item.selected[_ngcontent-%COMP%]{background-color:#004990;color:#fff}.dto-item.selected[_ngcontent-%COMP%]   .mat-icon-button.mat-primary[_ngcontent-%COMP%]{color:#fff}.dto-item[_ngcontent-%COMP%]   .mat-icon-button[_ngcontent-%COMP%]{width:22px;height:22px;line-height:20px}.dto-item[_ngcontent-%COMP%]   .mat-icon-button[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{line-height:18px;font-size:18px}"]}),i})()}];let j=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({providers:[{provide:v.TP,useClass:O.L,multi:!0}],imports:[f.ez,p.u5,p.UX,v.JF,g.Bz.forChild(J),x.m,l._R]}),i})()}}]);