import{Aa as i,Ba as m,Ca as _,Da as S,Ea as v,Ga as f,Ha as p,Nc as j,Pb as T,Qb as w,Rb as F,S as d,Sa as a,Sb as M,T as h,Ta as E,Tb as I,Td as J,Ud as q,Vd as R,Wc as D,Wd as z,Xc as c,Xd as s,Yc as N,Zc as k,Zd as K,_c as O,be as L,cc as V,cd as A,ce as Q,da as u,dc as P,dd as H,de as U,ea as b,ee as X,ia as G,ja as C,kd as W,oa as B,ob as y,qa as l,ua as x,z as g,za as e}from"./chunk-FGQYVVFQ.js";function Z(r,Y){r&1&&(e(0,"div",0),m(1,"mat-spinner"),i())}function $(r,Y){if(r&1){let t=v();e(0,"div",1)(1,"div",2),m(2,"jst-input",3),i(),e(3,"div",4)(4,"label",5),a(5,"\u0420\u0430\u0437\u043C\u0435\u0440 \u0441\u0435\u0442\u043A\u0438 (\u0432 \u0442\u0430\u0439\u043B\u0430\u0445)"),i(),e(6,"div",6),m(7,"jst-touchspin",7)(8,"jst-touchspin",8),i()(),e(9,"div",9)(10,"label",5),a(11,"\u0420\u0430\u0437\u043C\u0435\u0440 \u0442\u0430\u0439\u043B\u043E\u0432"),i(),e(12,"div",6),m(13,"jst-touchspin",10)(14,"jst-touchspin",11),i()(),e(15,"div",9)(16,"jst-input",12),_(17,13),e(18,"button",14),f("click",function(){d(t);let o=p();return h(o.onClearBgFile())}),e(19,"mat-icon"),a(20,"highlight_off"),i()(),e(21,"button",15),f("click",function(){d(t);let o=p();return h(o.onChoiceBgFile())}),e(22,"mat-icon"),a(23,"more_horiz"),i()(),S(),i(),e(24,"label",5),a(25,"\u041F\u0440\u043E\u0437\u0440\u0430\u0447\u043D\u043E\u0441\u0442\u044C \u043F\u043E\u0434\u043B\u043E\u0436\u043A\u0438"),i(),e(26,"div",16)(27,"mat-slider",17),m(28,"input",18),i()()()(),e(29,"div",19)(30,"button",20),f("click",function(){d(t);let o=p();return h(o.onApply())}),a(31),i(),e(32,"button",21),f("click",function(){d(t);let o=p();return h(o.onClose())}),a(33,"\u0417\u0430\u043A\u0440\u044B\u0442\u044C"),i()()}if(r&2){let t=p();l("formGroup",t.formGroup),u(2),l("clearButton",!1),u(5),l("clearButton",!1)("min",1),u(),l("clearButton",!1)("min",1),u(5),l("clearButton",!1)("min",10),u(),l("clearButton",!1)("min",10),u(2),l("readonlyState",!0)("value",t.bgValue),u(2),l("disabled",!t.hasBgFile),u(13),E(t.applyButtonTitle)}}var Ct=(()=>{class r{constructor(t){this.tilesGridStore=t,this.isProcessing=G(!1),this.applyButtonTitle="\u041F\u0440\u0438\u043C\u0435\u043D\u0438\u0442\u044C",this.formGroup=new O({name:new s(null,c.required),mapWidth:new s(10,c.required),mapHeight:new s(10,c.required),tileWidth:new s(32,c.required),tileHeight:new s(32,c.required),bgOpacity:new s(.6)}),this.projectId=null,this.tileGrid=null,this.tileGridBg=null,this.bgFile=null,this.bgId=null}get bgValue(){return this.bgFile?.name??"\u041F\u043E\u0434\u043B\u043E\u0436\u043A\u0438 \u043D\u0435\u0442"}get hasBgFile(){return!!this.bgFile}onApply(){if(this.formGroup.valid&&this.projectId){this.isProcessing.set(!0);let t={name:String(this.formGroup.value.name),tileInfo:{width:Number(this.formGroup.value.tileWidth),height:Number(this.formGroup.value.tileHeight)}};this.tileGridBg?.id||(t.mapInfo={width:Number(this.formGroup.value.mapWidth),height:Number(this.formGroup.value.mapHeight)},t.items=[]);let n={opacity:this.formGroup.get("bgOpacity")?.value??.6,file:this.bgFile};this.tilesGridStore.saveTileGrid(this.projectId,this.tileGrid?.id??null,t,this.tileGridBg?.id??null,n).pipe(g(()=>this.isProcessing.set(!1))).subscribe({next:o=>{this.dialogRef?.close(o)}})}}onChoiceBgFile(){z.uploadFile("image/*").subscribe(t=>{this.bgFile=t,this.formGroup.get("bgOpacity")?.enable()})}onClearBgFile(){this.bgFile=null,this.formGroup.get("bgOpacity")?.disable()}setData(t){this.projectId=t.projectId??null,this.applyButtonTitle=t.tilesGrid?"\u041F\u0440\u0438\u043C\u0435\u043D\u0438\u0442\u044C":"\u0421\u043E\u0437\u0434\u0430\u0442\u044C \u0441\u0435\u0442\u043A\u0443",this.tileGrid=t.tilesGrid??null,this.tileGridBg=t.tilesGridBg??null,this.tileGrid&&(this.formGroup.get("name")?.setValue(this.tileGrid.name),this.formGroup.get("mapWidth")?.setValue(this.tileGrid.mapInfo?.width),this.formGroup.get("mapHeight")?.setValue(this.tileGrid.mapInfo?.height),this.formGroup.get("tileWidth")?.setValue(this.tileGrid.tileInfo?.width),this.formGroup.get("tileHeight")?.setValue(this.tileGrid.tileInfo?.height),setTimeout(()=>{this.formGroup.get("mapWidth")?.disable(),this.formGroup.get("mapHeight")?.disable()})),this.tileGridBg?(this.bgId=this.tileGridBg.id,this.bgFile=this.tileGridBg.file,this.formGroup.get("bgOpacity")?.setValue(this.tileGridBg.opacity),this.formGroup.get("bgOpacity")?.enable()):this.formGroup.get("bgOpacity")?.disable()}onClose(){this.dialogRef?.close()}static{this.\u0275fac=function(n){return new(n||r)(b(j))}}static{this.\u0275cmp=C({type:r,selectors:[["tge-params"]],decls:2,vars:1,consts:[[1,"loading-container"],[1,"jst-modal-container","flex-col","padding-10","mt-10",3,"formGroup"],[1,"flex-row"],["label","\u041D\u0430\u0438\u043C\u0435\u043D\u043E\u0432\u0430\u043D\u0438\u0435","formControlName","name",3,"clearButton"],[1,"flex-col"],[1,"text-center","text-bold"],[1,"flex-row-centered","mt-10"],["label","\u0428\u0438\u0440\u0438\u043D\u0430","formControlName","mapWidth",1,"w-coords",3,"clearButton","min"],["label","\u0412\u044B\u0441\u043E\u0442\u0430","formControlName","mapHeight",1,"w-coords",3,"clearButton","min"],[1,"flex-col","mt-10"],["label","\u0428\u0438\u0440\u0438\u043D\u0430","formControlName","tileWidth",1,"w-coords",3,"clearButton","min"],["label","\u0412\u044B\u0441\u043E\u0442\u0430","formControlName","tileHeight",1,"w-coords",3,"clearButton","min"],["label","\u0424\u0430\u0439\u043B \u043F\u043E\u0434\u043B\u043E\u0436\u043A\u0438 \u043F\u043E\u0434 \u0441\u0435\u0442\u043A\u0443",3,"readonlyState","value"],["JSTIconSuffix",""],["mat-icon-button","","color","accent","title","\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u0444\u0430\u0439\u043B \u043F\u043E\u0434\u043B\u043E\u0436\u043A\u0438",3,"click","disabled"],["mat-icon-button","","color","primary","title","\u0412\u044B\u0431\u0440\u0430\u0442\u044C \u0444\u0430\u0439\u043B \u043F\u043E\u0434\u043B\u043E\u0436\u043A\u0438",3,"click"],[1,"flex-row",2,"padding","0 10px"],["min","0.1","max","1","step","0.1",1,"flex-auto"],["matSliderThumb","","formControlName","bgOpacity"],[1,"jst-modal-footer-buttons"],["mat-raised-button","","color","primary",3,"click"],["mat-raised-button","","color","accent",3,"click"]],template:function(n,o){n&1&&B(0,Z,2,0,"div",0)(1,$,34,14),n&2&&x(o.isProcessing()?0:1)},dependencies:[y,W,D,N,k,A,H,F,T,w,P,V,I,M,R,J,q,Q,K,L,X,U],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;width:400px;height:510px}.w-coords[_ngcontent-%COMP%]{width:136px;margin-left:15px}.w-coords[_ngcontent-%COMP%]:first-child{margin-left:0}"],changeDetection:0})}}return r})();export{Ct as a};
