(self.webpackChunkzamn=self.webpackChunkzamn||[]).push([[179],{142:(Re,et,re)=>{"use strict";function F(t){return"function"==typeof t}function _e(t){const n=t(r=>{Error.call(r),r.stack=(new Error).stack});return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}const we=_e(t=>function(n){t(this),this.message=n?`${n.length} errors occurred during unsubscription:\n${n.map((r,i)=>`${i+1}) ${r.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=n});function ve(t,e){if(t){const n=t.indexOf(e);0<=n&&t.splice(n,1)}}class ie{constructor(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let e;if(!this.closed){this.closed=!0;const{_parentage:n}=this;if(n)if(this._parentage=null,Array.isArray(n))for(const s of n)s.remove(this);else n.remove(this);const{initialTeardown:r}=this;if(F(r))try{r()}catch(s){e=s instanceof we?s.errors:[s]}const{_finalizers:i}=this;if(i){this._finalizers=null;for(const s of i)try{ge(s)}catch(o){e=e??[],o instanceof we?e=[...e,...o.errors]:e.push(o)}}if(e)throw new we(e)}}add(e){var n;if(e&&e!==this)if(this.closed)ge(e);else{if(e instanceof ie){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(e)}}_hasParent(e){const{_parentage:n}=this;return n===e||Array.isArray(n)&&n.includes(e)}_addParent(e){const{_parentage:n}=this;this._parentage=Array.isArray(n)?(n.push(e),n):n?[n,e]:e}_removeParent(e){const{_parentage:n}=this;n===e?this._parentage=null:Array.isArray(n)&&ve(n,e)}remove(e){const{_finalizers:n}=this;n&&ve(n,e),e instanceof ie&&e._removeParent(this)}}ie.EMPTY=(()=>{const t=new ie;return t.closed=!0,t})();const ae=ie.EMPTY;function ne(t){return t instanceof ie||t&&"closed"in t&&F(t.remove)&&F(t.add)&&F(t.unsubscribe)}function ge(t){F(t)?t():t.unsubscribe()}const le={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Ae={setTimeout(t,e,...n){const{delegate:r}=Ae;return r?.setTimeout?r.setTimeout(t,e,...n):setTimeout(t,e,...n)},clearTimeout(t){const{delegate:e}=Ae;return(e?.clearTimeout||clearTimeout)(t)},delegate:void 0};function xe(t){Ae.setTimeout(()=>{const{onUnhandledError:e}=le;if(!e)throw t;e(t)})}function se(){}const Ee=fe("C",void 0,void 0);function fe(t,e,n){return{kind:t,value:e,error:n}}let R=null;function S(t){if(le.useDeprecatedSynchronousErrorHandling){const e=!R;if(e&&(R={errorThrown:!1,error:null}),t(),e){const{errorThrown:n,error:r}=R;if(R=null,n)throw r}}else t()}class k extends ie{constructor(e){super(),this.isStopped=!1,e?(this.destination=e,ne(e)&&e.add(this)):this.destination=rt}static create(e,n,r){return new K(e,n,r)}next(e){this.isStopped?Oe(function be(t){return fe("N",t,void 0)}(e),this):this._next(e)}error(e){this.isStopped?Oe(function L(t){return fe("E",void 0,t)}(e),this):(this.isStopped=!0,this._error(e))}complete(){this.isStopped?Oe(Ee,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(e){this.destination.next(e)}_error(e){try{this.destination.error(e)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const z=Function.prototype.bind;function G(t,e){return z.call(t,e)}class T{constructor(e){this.partialObserver=e}next(e){const{partialObserver:n}=this;if(n.next)try{n.next(e)}catch(r){E(r)}}error(e){const{partialObserver:n}=this;if(n.error)try{n.error(e)}catch(r){E(r)}else E(e)}complete(){const{partialObserver:e}=this;if(e.complete)try{e.complete()}catch(n){E(n)}}}class K extends k{constructor(e,n,r){let i;if(super(),F(e)||!e)i={next:e??void 0,error:n??void 0,complete:r??void 0};else{let s;this&&le.useDeprecatedNextContext?(s=Object.create(e),s.unsubscribe=()=>this.unsubscribe(),i={next:e.next&&G(e.next,s),error:e.error&&G(e.error,s),complete:e.complete&&G(e.complete,s)}):i=e}this.destination=new T(i)}}function E(t){le.useDeprecatedSynchronousErrorHandling?function B(t){le.useDeprecatedSynchronousErrorHandling&&R&&(R.errorThrown=!0,R.error=t)}(t):xe(t)}function Oe(t,e){const{onStoppedNotification:n}=le;n&&Ae.setTimeout(()=>n(t,e))}const rt={closed:!0,next:se,error:function He(t){throw t},complete:se},Pe="function"==typeof Symbol&&Symbol.observable||"@@observable";function j(t){return t}let x=(()=>{class t{constructor(n){n&&(this._subscribe=n)}lift(n){const r=new t;return r.source=this,r.operator=n,r}subscribe(n,r,i){const s=function b(t){return t&&t instanceof k||function P(t){return t&&F(t.next)&&F(t.error)&&F(t.complete)}(t)&&ne(t)}(n)?n:new K(n,r,i);return S(()=>{const{operator:o,source:a}=this;s.add(o?o.call(s,a):a?this._subscribe(s):this._trySubscribe(s))}),s}_trySubscribe(n){try{return this._subscribe(n)}catch(r){n.error(r)}}forEach(n,r){return new(r=C(r))((i,s)=>{const o=new K({next:a=>{try{n(a)}catch(l){s(l),o.unsubscribe()}},error:s,complete:i});this.subscribe(o)})}_subscribe(n){var r;return null===(r=this.source)||void 0===r?void 0:r.subscribe(n)}[Pe](){return this}pipe(...n){return function w(t){return 0===t.length?j:1===t.length?t[0]:function(n){return t.reduce((r,i)=>i(r),n)}}(n)(this)}toPromise(n){return new(n=C(n))((r,i)=>{let s;this.subscribe(o=>s=o,o=>i(o),()=>r(s))})}}return t.create=e=>new t(e),t})();function C(t){var e;return null!==(e=t??le.Promise)&&void 0!==e?e:Promise}const I=_e(t=>function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let O=(()=>{class t extends x{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(n){const r=new V(this,this);return r.operator=n,r}_throwIfClosed(){if(this.closed)throw new I}next(n){S(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const r of this.currentObservers)r.next(n)}})}error(n){S(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=n;const{observers:r}=this;for(;r.length;)r.shift().error(n)}})}complete(){S(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:n}=this;for(;n.length;)n.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var n;return(null===(n=this.observers)||void 0===n?void 0:n.length)>0}_trySubscribe(n){return this._throwIfClosed(),super._trySubscribe(n)}_subscribe(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)}_innerSubscribe(n){const{hasError:r,isStopped:i,observers:s}=this;return r||i?ae:(this.currentObservers=null,s.push(n),new ie(()=>{this.currentObservers=null,ve(s,n)}))}_checkFinalizedStatuses(n){const{hasError:r,thrownError:i,isStopped:s}=this;r?n.error(i):s&&n.complete()}asObservable(){const n=new x;return n.source=this,n}}return t.create=(e,n)=>new V(e,n),t})();class V extends O{constructor(e,n){super(),this.destination=e,this.source=n}next(e){var n,r;null===(r=null===(n=this.destination)||void 0===n?void 0:n.next)||void 0===r||r.call(n,e)}error(e){var n,r;null===(r=null===(n=this.destination)||void 0===n?void 0:n.error)||void 0===r||r.call(n,e)}complete(){var e,n;null===(n=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===n||n.call(e)}_subscribe(e){var n,r;return null!==(r=null===(n=this.source)||void 0===n?void 0:n.subscribe(e))&&void 0!==r?r:ae}}class W extends O{constructor(e){super(),this._value=e}get value(){return this.getValue()}_subscribe(e){const n=super._subscribe(e);return!n.closed&&e.next(this._value),n}getValue(){const{hasError:e,thrownError:n,_value:r}=this;if(e)throw n;return this._throwIfClosed(),r}next(e){super.next(this._value=e)}}function q(t){return e=>{if(function H(t){return F(t?.lift)}(e))return e.lift(function(n){try{return t(n,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function oe(t,e,n,r,i){return new Ce(t,e,n,r,i)}class Ce extends k{constructor(e,n,r,i,s,o){super(e),this.onFinalize=s,this.shouldUnsubscribe=o,this._next=n?function(a){try{n(a)}catch(l){e.error(l)}}:super._next,this._error=i?function(a){try{i(a)}catch(l){e.error(l)}finally{this.unsubscribe()}}:super._error,this._complete=r?function(){try{r()}catch(a){e.error(a)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var e;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:n}=this;super.unsubscribe(),!n&&(null===(e=this.onFinalize)||void 0===e||e.call(this))}}}function Sr(t){return this instanceof Sr?(this.v=t,this):new Sr(t)}function Ui(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,e=t[Symbol.asyncIterator];return e?e.call(t):(t=function ws(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(t),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(s){n[s]=t[s]&&function(o){return new Promise(function(a,l){!function i(s,o,a,l){Promise.resolve(l).then(function(c){s({value:c,done:a})},o)}(a,l,(o=t[s](o)).done,o.value)})}}}"function"==typeof SuppressedError&&SuppressedError;const Kr=t=>t&&"number"==typeof t.length&&"function"!=typeof t;function Dn(t){return F(t?.then)}function Lo(t){return F(t[Pe])}function Bo(t){return Symbol.asyncIterator&&F(t?.[Symbol.asyncIterator])}function ko(t){return new TypeError(`You provided ${null!==t&&"object"==typeof t?"an invalid object":`'${t}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const Es=function Hi(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function Vi(t){return F(t?.[Es])}function bs(t){return function _l(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,r=n.apply(t,e||[]),s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(d){r[d]&&(i[d]=function(f){return new Promise(function(p,g){s.push([d,f,p,g])>1||a(d,f)})})}function a(d,f){try{!function l(d){d.value instanceof Sr?Promise.resolve(d.value.v).then(c,u):h(s[0][2],d)}(r[d](f))}catch(p){h(s[0][3],p)}}function c(d){a("next",d)}function u(d){a("throw",d)}function h(d,f){d(f),s.shift(),s.length&&a(s[0][0],s[0][1])}}(this,arguments,function*(){const n=t.getReader();try{for(;;){const{value:r,done:i}=yield Sr(n.read());if(i)return yield Sr(void 0);yield yield Sr(r)}}finally{n.releaseLock()}})}function Ds(t){return F(t?.getReader)}function Wn(t){if(t instanceof x)return t;if(null!=t){if(Lo(t))return function xl(t){return new x(e=>{const n=t[Pe]();if(F(n.subscribe))return n.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(t);if(Kr(t))return function Uo(t){return new x(e=>{for(let n=0;n<t.length&&!e.closed;n++)e.next(t[n]);e.complete()})}(t);if(Dn(t))return function wl(t){return new x(e=>{t.then(n=>{e.closed||(e.next(n),e.complete())},n=>e.error(n)).then(null,xe)})}(t);if(Bo(t))return Vo(t);if(Vi(t))return function Ho(t){return new x(e=>{for(const n of t)if(e.next(n),e.closed)return;e.complete()})}(t);if(Ds(t))return function ph(t){return Vo(bs(t))}(t)}throw ko(t)}function Vo(t){return new x(e=>{(function Go(t,e){var n,r,i,s;return function gl(t,e,n,r){return new(n||(n=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(h){o(h)}}function l(u){try{c(r.throw(u))}catch(h){o(h)}}function c(u){u.done?s(u.value):function i(s){return s instanceof n?s:new n(function(o){o(s)})}(u.value).then(a,l)}c((r=r.apply(t,e||[])).next())})}(this,void 0,void 0,function*(){try{for(n=Ui(t);!(r=yield n.next()).done;)if(e.next(r.value),e.closed)return}catch(o){i={error:o}}finally{try{r&&!r.done&&(s=n.return)&&(yield s.call(n))}finally{if(i)throw i.error}}e.complete()})})(t,e).catch(n=>e.error(n))})}function mn(t,e,n,r=0,i=!1){const s=e.schedule(function(){n(),i?t.add(this.schedule(null,r)):this.unsubscribe()},r);if(t.add(s),!i)return s}function El(t,e,n=1/0){return F(e)?El((r,i)=>function Te(t,e){return q((n,r)=>{let i=0;n.subscribe(oe(r,s=>{r.next(t.call(e,s,i++))}))})}((s,o)=>e(r,s,i,o))(Wn(t(r,i))),n):("number"==typeof e&&(n=e),q((r,i)=>function Ss(t,e,n,r,i,s,o,a){const l=[];let c=0,u=0,h=!1;const d=()=>{h&&!l.length&&!c&&e.complete()},f=g=>c<r?p(g):l.push(g),p=g=>{s&&e.next(g),c++;let m=!1;Wn(n(g,u++)).subscribe(oe(e,_=>{i?.(_),s?f(_):e.next(_)},()=>{m=!0},void 0,()=>{if(m)try{for(c--;l.length&&c<r;){const _=l.shift();o?mn(e,o,()=>p(_)):p(_)}d()}catch(_){e.error(_)}}))};return t.subscribe(oe(e,f,()=>{h=!0,d()})),()=>{a?.()}}(r,i,t,n)))}const tm=new x(t=>t.complete());function gh(t){return t[t.length-1]}function nm(t){return function tS(t){return t&&F(t.schedule)}(gh(t))?t.pop():void 0}function rm(t,e=0){return q((n,r)=>{n.subscribe(oe(r,i=>mn(r,t,()=>r.next(i),e),()=>mn(r,t,()=>r.complete(),e),i=>mn(r,t,()=>r.error(i),e)))})}function im(t,e=0){return q((n,r)=>{r.add(t.schedule(()=>n.subscribe(r),e))})}function sm(t,e){if(!t)throw new Error("Iterable cannot be null");return new x(n=>{mn(n,e,()=>{const r=t[Symbol.asyncIterator]();mn(n,e,()=>{r.next().then(i=>{i.done?n.complete():n.next(i.value)})},0,!0)})})}function om(t,e){return e?function lS(t,e){if(null!=t){if(Lo(t))return function rS(t,e){return Wn(t).pipe(im(e),rm(e))}(t,e);if(Kr(t))return function sS(t,e){return new x(n=>{let r=0;return e.schedule(function(){r===t.length?n.complete():(n.next(t[r++]),n.closed||this.schedule())})})}(t,e);if(Dn(t))return function iS(t,e){return Wn(t).pipe(im(e),rm(e))}(t,e);if(Bo(t))return sm(t,e);if(Vi(t))return function oS(t,e){return new x(n=>{let r;return mn(n,e,()=>{r=t[Es](),mn(n,e,()=>{let i,s;try{({value:i,done:s}=r.next())}catch(o){return void n.error(o)}s?n.complete():n.next(i)},0,!0)}),()=>F(r?.return)&&r.return()})}(t,e);if(Ds(t))return function aS(t,e){return sm(bs(t),e)}(t,e)}throw ko(t)}(t,e):Wn(t)}function cS(...t){const e=nm(t),n=function nS(t,e){return"number"==typeof gh(t)?t.pop():e}(t,1/0),r=t;return r.length?1===r.length?Wn(r[0]):function bl(t=1/0){return El(j,t)}(n)(om(r,e)):tm}function am(t={}){const{connector:e=(()=>new O),resetOnError:n=!0,resetOnComplete:r=!0,resetOnRefCountZero:i=!0}=t;return s=>{let o,a,l,c=0,u=!1,h=!1;const d=()=>{a?.unsubscribe(),a=void 0},f=()=>{d(),o=l=void 0,u=h=!1},p=()=>{const g=o;f(),g?.unsubscribe()};return q((g,m)=>{c++,!h&&!u&&d();const _=l=l??e();m.add(()=>{c--,0===c&&!h&&!u&&(a=mh(p,i))}),_.subscribe(m),!o&&c>0&&(o=new K({next:v=>_.next(v),error:v=>{h=!0,d(),a=mh(f,n,v),_.error(v)},complete:()=>{u=!0,d(),a=mh(f,r),_.complete()}}),Wn(g).subscribe(o))})(s)}}function mh(t,e,...n){if(!0===e)return void t();if(!1===e)return;const r=new K({next:()=>{r.unsubscribe(),t()}});return e(...n).subscribe(r)}function fS(t,e){return t===e}function xt(t){for(let e in t)if(t[e]===xt)return e;throw Error("Could not find renamed property on target object.")}function qt(t){if("string"==typeof t)return t;if(Array.isArray(t))return"["+t.map(qt).join(", ")+"]";if(null==t)return""+t;if(t.overriddenName)return`${t.overriddenName}`;if(t.name)return`${t.name}`;const e=t.toString();if(null==e)return""+e;const n=e.indexOf("\n");return-1===n?e:e.substring(0,n)}function yh(t,e){return null==t||""===t?null===e?"":e:null==e||""===e?t:t+" "+e}const pS=xt({__forward_ref__:xt});function _h(t){return t.__forward_ref__=_h,t.toString=function(){return qt(this())},t}function ke(t){return function vh(t){return"function"==typeof t&&t.hasOwnProperty(pS)&&t.__forward_ref__===_h}(t)?t():t}function xh(t){return t&&!!t.\u0275providers}class me extends Error{constructor(e,n){super(function Sl(t,e){return`NG0${Math.abs(t)}${e?": "+e:""}`}(e,n)),this.code=e}}function yt(t){return"function"==typeof t?t.name||t.toString():"object"==typeof t&&null!=t&&"function"==typeof t.type?t.type.name||t.type.toString():function Ge(t){return"string"==typeof t?t:null==t?"":String(t)}(t)}function wh(t,e){throw new me(-201,!1)}function Xn(t,e){null==t&&function Le(t,e,n,r){throw new Error(`ASSERTION ERROR: ${t}`+(null==r?"":` [Expected=> ${n} ${r} ${e} <=Actual]`))}(e,t,null,"!=")}function Et(t){return{token:t.token,providedIn:t.providedIn||null,factory:t.factory,value:void 0}}function Tl(t){return cm(t,Il)||cm(t,um)}function cm(t,e){return t.hasOwnProperty(e)?t[e]:null}function Cl(t){return t&&(t.hasOwnProperty(bh)||t.hasOwnProperty(wS))?t[bh]:null}const Il=xt({\u0275prov:xt}),bh=xt({\u0275inj:xt}),um=xt({ngInjectableDef:xt}),wS=xt({ngInjectorDef:xt});var ot=function(t){return t[t.Default=0]="Default",t[t.Host=1]="Host",t[t.Self=2]="Self",t[t.SkipSelf=4]="SkipSelf",t[t.Optional=8]="Optional",t}(ot||{});let Dh;function Sn(t){const e=Dh;return Dh=t,e}function dm(t,e,n){const r=Tl(t);return r&&"root"==r.providedIn?void 0===r.value?r.value=r.factory():r.value:n&ot.Optional?null:void 0!==e?e:void wh(qt(t))}const bt=globalThis,jo={},Ah="__NG_DI_FLAG__",Al="ngTempTokenPath",DS=/\n/gm,pm="__source";let Ts;function _i(t){const e=Ts;return Ts=t,e}function CS(t,e=ot.Default){if(void 0===Ts)throw new me(-203,!1);return null===Ts?dm(t,void 0,e):Ts.get(t,e&ot.Optional?null:void 0,e)}function dt(t,e=ot.Default){return(function hm(){return Dh}()||CS)(ke(t),e)}function Ct(t,e=ot.Default){return dt(t,Ml(e))}function Ml(t){return typeof t>"u"||"number"==typeof t?t:0|(t.optional&&8)|(t.host&&1)|(t.self&&2)|(t.skipSelf&&4)}function Mh(t){const e=[];for(let n=0;n<t.length;n++){const r=ke(t[n]);if(Array.isArray(r)){if(0===r.length)throw new me(900,!1);let i,s=ot.Default;for(let o=0;o<r.length;o++){const a=r[o],l=IS(a);"number"==typeof l?-1===l?i=a.token:s|=l:i=a}e.push(dt(i,s))}else e.push(dt(r))}return e}function IS(t){return t[Ah]}var Rl=function(t){return t[t.OnPush=0]="OnPush",t[t.Default=1]="Default",t}(Rl||{}),rr=function(t){return t[t.Emulated=0]="Emulated",t[t.None=2]="None",t[t.ShadowDom=3]="ShadowDom",t}(rr||{});const Ir={},pt=[],Pl=xt({\u0275cmp:xt}),Rh=xt({\u0275dir:xt}),Ph=xt({\u0275pipe:xt}),Jr=xt({\u0275fac:xt}),zo=xt({__NG_ELEMENT_ID__:xt}),ym=xt({__NG_ENV_ID__:xt});function Nh(t,e,n){let r=0;for(;r<n.length;){const i=n[r];if("number"==typeof i){if(0!==i)break;r++;const s=n[r++],o=n[r++],a=n[r++];t.setAttribute(e,o,a,s)}else{const s=i,o=n[++r];xm(s)?t.setProperty(e,s,o):t.setAttribute(e,s,o),r++}}return r}function xm(t){return 64===t.charCodeAt(0)}function Wo(t,e){if(null!==e&&0!==e.length)if(null===t||0===t.length)t=e.slice();else{let n=-1;for(let r=0;r<e.length;r++){const i=e[r];"number"==typeof i?n=i:0===n||wm(t,n,i,null,-1===n||2===n?e[++r]:null)}}return t}function wm(t,e,n,r,i){let s=0,o=t.length;if(-1===e)o=-1;else for(;s<t.length;){const a=t[s++];if("number"==typeof a){if(a===e){o=-1;break}if(a>e){o=s-1;break}}}for(;s<t.length;){const a=t[s];if("number"==typeof a)break;if(a===n){if(null===r)return void(null!==i&&(t[s+1]=i));if(r===t[s+1])return void(t[s+2]=i)}s++,null!==r&&s++,null!==i&&s++}-1!==o&&(t.splice(o,0,e),s=o+1),t.splice(s++,0,n),null!==r&&t.splice(s++,0,r),null!==i&&t.splice(s++,0,i)}const Em="ng-template";function bm(t){return 4===t.type&&t.value!==Em}function ir(t){return 0==(1&t)}function Sm(t,e){return t?":not("+e.trim()+")":e}function US(t){let e=t[0],n=1,r=2,i="",s=!1;for(;n<t.length;){let o=t[n];if("string"==typeof o)if(2&r){const a=t[++n];i+="["+o+(a.length>0?'="'+a+'"':"")+"]"}else 8&r?i+="."+o:4&r&&(i+=" "+o);else""!==i&&!ir(o)&&(e+=Sm(s,i),i=""),r=o,s=s||!ir(r);n++}return""!==i&&(e+=Sm(s,i)),e}function Tm(t){return function Qr(t){return{toString:t}.toString()}(()=>{const e=function Am(t){const e={};return{type:t.type,providersResolver:null,factory:null,hostBindings:t.hostBindings||null,hostVars:t.hostVars||0,hostAttrs:t.hostAttrs||null,contentQueries:t.contentQueries||null,declaredInputs:e,inputTransforms:null,inputConfig:t.inputs||Ir,exportAs:t.exportAs||null,standalone:!0===t.standalone,signals:!0===t.signals,selectors:t.selectors||pt,viewQuery:t.viewQuery||null,features:t.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:Im(t.inputs,e),outputs:Im(t.outputs)}}(t),n={...e,decls:t.decls,vars:t.vars,template:t.template,consts:t.consts||null,ngContentSelectors:t.ngContentSelectors,onPush:t.changeDetection===Rl.OnPush,directiveDefs:null,pipeDefs:null,dependencies:e.standalone&&t.dependencies||null,getStandaloneInjector:null,signals:t.signals??!1,data:t.data||{},encapsulation:t.encapsulation||rr.Emulated,styles:t.styles||pt,_:null,schemas:t.schemas||null,tView:null,id:""};!function Mm(t){t.features?.forEach(e=>e(t))}(n);const r=t.dependencies;return n.directiveDefs=Nl(r,!1),n.pipeDefs=Nl(r,!0),n.id=function XS(t){let e=0;const n=[t.selectors,t.ngContentSelectors,t.hostVars,t.hostAttrs,t.consts,t.vars,t.decls,t.encapsulation,t.standalone,t.signals,t.exportAs,JSON.stringify(t.inputs),JSON.stringify(t.outputs),Object.getOwnPropertyNames(t.type.prototype),!!t.contentQueries,!!t.viewQuery].join("|");for(const i of n)e=Math.imul(31,e)+i.charCodeAt(0)<<0;return e+=2147483648,"c"+e}(n),n})}function jS(t){return at(t)||rn(t)}function $S(t){return null!==t}function Im(t,e){if(null==t)return Ir;const n={};for(const r in t)if(t.hasOwnProperty(r)){let i=t[r],s=i;Array.isArray(i)&&(s=i[1],i=i[0]),n[i]=r,e&&(e[i]=s)}return n}function at(t){return t[Pl]||null}function rn(t){return t[Rh]||null}function yn(t){return t[Ph]||null}function Nl(t,e){if(!t)return null;const n=e?yn:jS;return()=>("function"==typeof t?t():t).map(r=>n(r)).filter($S)}const Ut=0,ce=1,ze=2,Rt=3,sr=4,Yo=5,hn=6,Cs=7,Ht=8,vi=9,Is=10,je=11,qo=12,As=14,Vt=15,Zo=16,Ms=17,Ar=18,Ko=19,Pm=20,xi=21,ei=22,Fl=23,Ol=24,it=25,Fh=1,Nm=2,Mr=7,Rs=9,sn=11;function Cn(t){return Array.isArray(t)&&"object"==typeof t[Fh]}function In(t){return Array.isArray(t)&&!0===t[Fh]}function ji(t){return t.componentOffset>-1}function or(t){return!!t.template}function Lh(t){return 0!=(512&t[ze])}function $i(t,e){return t.hasOwnProperty(Jr)?t[Jr]:null}let JS=bt.WeakRef??class QS{constructor(e){this.ref=e}deref(){return this.ref}},tT=0,Rr=null,kl=!1;function en(t){const e=Rr;return Rr=t,e}class km{constructor(){this.id=tT++,this.ref=function eT(t){return new JS(t)}(this),this.producers=new Map,this.consumers=new Map,this.trackingVersion=0,this.valueVersion=0}consumerPollProducersForChange(){for(const[e,n]of this.producers){const r=n.producerNode.deref();if(null!=r&&n.atTrackingVersion===this.trackingVersion){if(r.producerPollStatus(n.seenValueVersion))return!0}else this.producers.delete(e),r?.consumers.delete(this.id)}return!1}producerMayHaveChanged(){const e=kl;kl=!0;try{for(const[n,r]of this.consumers){const i=r.consumerNode.deref();null!=i&&i.trackingVersion===r.atTrackingVersion?i.onConsumerDependencyMayHaveChanged():(this.consumers.delete(n),i?.producers.delete(this.id))}}finally{kl=e}}producerAccessed(){if(kl)throw new Error("");if(null===Rr)return;let e=Rr.producers.get(this.id);void 0===e?(e={consumerNode:Rr.ref,producerNode:this.ref,seenValueVersion:this.valueVersion,atTrackingVersion:Rr.trackingVersion},Rr.producers.set(this.id,e),this.consumers.set(Rr.id,e)):(e.seenValueVersion=this.valueVersion,e.atTrackingVersion=Rr.trackingVersion)}get hasProducers(){return this.producers.size>0}get producerUpdatesAllowed(){return!1!==Rr?.consumerAllowSignalWrites}producerPollStatus(e){return this.valueVersion!==e||(this.onProducerUpdateValueVersion(),this.valueVersion!==e)}}let Um=null;const Vm=()=>{};class sT extends km{constructor(e,n,r){super(),this.watch=e,this.schedule=n,this.dirty=!1,this.cleanupFn=Vm,this.registerOnCleanup=i=>{this.cleanupFn=i},this.consumerAllowSignalWrites=r}notify(){this.dirty||this.schedule(this),this.dirty=!0}onConsumerDependencyMayHaveChanged(){this.notify()}onProducerUpdateValueVersion(){}run(){if(this.dirty=!1,0!==this.trackingVersion&&!this.consumerPollProducersForChange())return;const e=en(this);this.trackingVersion++;try{this.cleanupFn(),this.cleanupFn=Vm,this.watch(this.registerOnCleanup)}finally{en(e)}}cleanup(){this.cleanupFn()}}class oT{constructor(e,n,r){this.previousValue=e,this.currentValue=n,this.firstChange=r}isFirstChange(){return this.firstChange}}function Gm(t){return t.type.prototype.ngOnChanges&&(t.setInput=lT),aT}function aT(){const t=$m(this),e=t?.current;if(e){const n=t.previous;if(n===Ir)t.previous=e;else for(let r in e)n[r]=e[r];t.current=null,this.ngOnChanges(e)}}function lT(t,e,n,r){const i=this.declaredInputs[n],s=$m(t)||function cT(t,e){return t[jm]=e}(t,{previous:Ir,current:null}),o=s.current||(s.current={}),a=s.previous,l=a[i];o[i]=new oT(l&&l.currentValue,e,a===Ir),t[r]=e}const jm="__ngSimpleChanges__";function $m(t){return t[jm]||null}const Pr=function(t,e,n){};function It(t){for(;Array.isArray(t);)t=t[Ut];return t}function An(t,e){return It(e[t.index])}function kn(t,e){const n=e[t];return Cn(n)?n:n[Ut]}function Ym(t){t[Ms]=0}function mT(t){1024&t[ze]||(t[ze]|=1024,Zm(t,1))}function qm(t){1024&t[ze]&&(t[ze]&=-1025,Zm(t,-1))}function Zm(t,e){let n=t[Rt];if(null===n)return;n[Yo]+=e;let r=n;for(n=n[Rt];null!==n&&(1===e&&1===r[Yo]||-1===e&&0===r[Yo]);)n[Yo]+=e,r=n,n=n[Rt]}const Be={lFrame:ay(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function U(){return Be.lFrame.lView}function on(){let t=ey();for(;null!==t&&64===t.type;)t=t.parent;return t}function ey(){return Be.lFrame.currentTNode}function MT(t,e){const n=Be.lFrame;n.bindingIndex=n.bindingRootIndex=t,$h(e)}function $h(t){Be.lFrame.currentDirectiveIndex=t}function Wh(t){Be.lFrame.currentQueryIndex=t}function PT(t){const e=t[ce];return 2===e.type?e.declTNode:1===e.type?t[hn]:null}function sy(t,e,n){if(n&ot.SkipSelf){let i=e,s=t;for(;!(i=i.parent,null!==i||n&ot.Host||(i=PT(s),null===i||(s=s[As],10&i.type))););if(null===i)return!1;e=i,t=s}const r=Be.lFrame=oy();return r.currentTNode=e,r.lView=t,!0}function Xh(t){const e=oy(),n=t[ce];Be.lFrame=e,e.currentTNode=n.firstChild,e.lView=t,e.tView=n,e.contextLView=t,e.bindingIndex=n.bindingStartIndex,e.inI18n=!1}function oy(){const t=Be.lFrame,e=null===t?null:t.child;return null===e?ay(t):e}function ay(t){const e={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:t,child:null,inI18n:!1};return null!==t&&(t.child=e),e}function ly(){const t=Be.lFrame;return Be.lFrame=t.parent,t.currentTNode=null,t.lView=null,t}const cy=ly;function Yh(){const t=ly();t.isParent=!0,t.tView=null,t.selectedIndex=-1,t.contextLView=null,t.elementDepthCount=0,t.currentDirectiveIndex=-1,t.currentNamespace=null,t.bindingRootIndex=-1,t.bindingIndex=-1,t.currentQueryIndex=0}function zi(t){Be.lFrame.selectedIndex=t}function zl(t,e,n){dy(t,e,3,n)}function Wl(t,e,n,r){(3&t[ze])===n&&dy(t,e,n,r)}function qh(t,e){let n=t[ze];(3&n)===e&&(n&=8191,n+=1,t[ze]=n)}function dy(t,e,n,r){const s=r??-1,o=e.length-1;let a=0;for(let l=void 0!==r?65535&t[Ms]:0;l<o;l++)if("number"==typeof e[l+1]){if(a=e[l],null!=r&&a>=r)break}else e[l]<0&&(t[Ms]+=65536),(a<s||-1==s)&&(HT(t,n,e,l),t[Ms]=(4294901760&t[Ms])+l+2),l++}function fy(t,e){Pr(4,t,e);const n=en(null);try{e.call(t)}finally{en(n),Pr(5,t,e)}}function HT(t,e,n,r){const i=n[r]<0,s=n[r+1],a=t[i?-n[r]:n[r]];i?t[ze]>>13<t[Ms]>>16&&(3&t[ze])===e&&(t[ze]+=8192,fy(a,s)):fy(a,s)}const Os=-1;class ea{constructor(e,n,r){this.factory=e,this.resolving=!1,this.canSeeViewProviders=n,this.injectImpl=r}}function ta(t){return 32767&t}function na(t,e){let n=function $T(t){return t>>16}(t),r=e;for(;n>0;)r=r[As],n--;return r}let Qh=!0;function Xl(t){const e=Qh;return Qh=t,e}const py=255,gy=5;let zT=0;const Fr={};function Yl(t,e){const n=my(t,e);if(-1!==n)return n;const r=e[ce];r.firstCreatePass&&(t.injectorIndex=e.length,Jh(r.data,t),Jh(e,null),Jh(r.blueprint,null));const i=ql(t,e),s=t.injectorIndex;if(function Kh(t){return t!==Os}(i)){const o=ta(i),a=na(i,e),l=a[ce].data;for(let c=0;c<8;c++)e[s+c]=a[o+c]|l[o+c]}return e[s+8]=i,s}function Jh(t,e){t.push(0,0,0,0,0,0,0,0,e)}function my(t,e){return-1===t.injectorIndex||t.parent&&t.parent.injectorIndex===t.injectorIndex||null===e[t.injectorIndex+8]?-1:t.injectorIndex}function ql(t,e){if(t.parent&&-1!==t.parent.injectorIndex)return t.parent.injectorIndex;let n=0,r=null,i=e;for(;null!==i;){if(r=by(i),null===r)return Os;if(n++,i=i[As],-1!==r.injectorIndex)return r.injectorIndex|n<<16}return Os}function ed(t,e,n){!function WT(t,e,n){let r;"string"==typeof n?r=n.charCodeAt(0)||0:n.hasOwnProperty(zo)&&(r=n[zo]),null==r&&(r=n[zo]=zT++);const i=r&py;e.data[t+(i>>gy)]|=1<<i}(t,e,n)}function yy(t,e,n){if(n&ot.Optional||void 0!==t)return t;wh()}function _y(t,e,n,r){if(n&ot.Optional&&void 0===r&&(r=null),!(n&(ot.Self|ot.Host))){const i=t[vi],s=Sn(void 0);try{return i?i.get(e,r,n&ot.Optional):dm(e,r,n&ot.Optional)}finally{Sn(s)}}return yy(r,0,n)}function vy(t,e,n,r=ot.Default,i){if(null!==t){if(2048&e[ze]&&!(r&ot.Self)){const o=function JT(t,e,n,r,i){let s=t,o=e;for(;null!==s&&null!==o&&2048&o[ze]&&!(512&o[ze]);){const a=xy(s,o,n,r|ot.Self,Fr);if(a!==Fr)return a;let l=s.parent;if(!l){const c=o[Pm];if(c){const u=c.get(n,Fr,r);if(u!==Fr)return u}l=by(o),o=o[As]}s=l}return i}(t,e,n,r,Fr);if(o!==Fr)return o}const s=xy(t,e,n,r,Fr);if(s!==Fr)return s}return _y(e,n,r,i)}function xy(t,e,n,r,i){const s=function qT(t){if("string"==typeof t)return t.charCodeAt(0)||0;const e=t.hasOwnProperty(zo)?t[zo]:void 0;return"number"==typeof e?e>=0?e&py:KT:e}(n);if("function"==typeof s){if(!sy(e,t,r))return r&ot.Host?yy(i,0,r):_y(e,n,r,i);try{let o;if(o=s(r),null!=o||r&ot.Optional)return o;wh()}finally{cy()}}else if("number"==typeof s){let o=null,a=my(t,e),l=Os,c=r&ot.Host?e[Vt][hn]:null;for((-1===a||r&ot.SkipSelf)&&(l=-1===a?ql(t,e):e[a+8],l!==Os&&Ey(r,!1)?(o=e[ce],a=ta(l),e=na(l,e)):a=-1);-1!==a;){const u=e[ce];if(wy(s,a,u.data)){const h=YT(a,e,n,o,r,c);if(h!==Fr)return h}l=e[a+8],l!==Os&&Ey(r,e[ce].data[a+8]===c)&&wy(s,a,e)?(o=u,a=ta(l),e=na(l,e)):a=-1}}return i}function YT(t,e,n,r,i,s){const o=e[ce],a=o.data[t+8],u=function Zl(t,e,n,r,i){const s=t.providerIndexes,o=e.data,a=1048575&s,l=t.directiveStart,u=s>>20,d=i?a+u:t.directiveEnd;for(let f=r?a:a+u;f<d;f++){const p=o[f];if(f<l&&n===p||f>=l&&p.type===n)return f}if(i){const f=o[l];if(f&&or(f)&&f.type===n)return l}return null}(a,o,n,null==r?ji(a)&&Qh:r!=o&&0!=(3&a.type),i&ot.Host&&s===a);return null!==u?Wi(e,o,u,a):Fr}function Wi(t,e,n,r){let i=t[n];const s=e.data;if(function VT(t){return t instanceof ea}(i)){const o=i;o.resolving&&function gS(t,e){const n=e?`. Dependency path: ${e.join(" > ")} > ${t}`:"";throw new me(-200,`Circular dependency in DI detected for ${t}${n}`)}(yt(s[n]));const a=Xl(o.canSeeViewProviders);o.resolving=!0;const c=o.injectImpl?Sn(o.injectImpl):null;sy(t,r,ot.Default);try{i=t[n]=o.factory(void 0,s,t,r),e.firstCreatePass&&n>=r.directiveStart&&function UT(t,e,n){const{ngOnChanges:r,ngOnInit:i,ngDoCheck:s}=e.type.prototype;if(r){const o=Gm(e);(n.preOrderHooks??=[]).push(t,o),(n.preOrderCheckHooks??=[]).push(t,o)}i&&(n.preOrderHooks??=[]).push(0-t,i),s&&((n.preOrderHooks??=[]).push(t,s),(n.preOrderCheckHooks??=[]).push(t,s))}(n,s[n],e)}finally{null!==c&&Sn(c),Xl(a),o.resolving=!1,cy()}}return i}function wy(t,e,n){return!!(n[e+(t>>gy)]&1<<t)}function Ey(t,e){return!(t&ot.Self||t&ot.Host&&e)}class xn{constructor(e,n){this._tNode=e,this._lView=n}get(e,n,r){return vy(this._tNode,this._lView,e,Ml(r),n)}}function KT(){return new xn(on(),U())}function by(t){const e=t[ce],n=e.type;return 2===n?e.declTNode:1===n?t[hn]:null}function Vs(t,e){t.forEach(n=>Array.isArray(n)?Vs(n,e):e(n))}function Kl(t,e){return e>=t.length-1?t.pop():t.splice(e,1)[0]}var bi=function(t){return t[t.Important=1]="Important",t[t.DashCase=2]="DashCase",t}(bi||{});const hd=new Map;let MC=0;const fd="__ngContext__";function dn(t,e){Cn(e)?(t[fd]=e[Ko],function PC(t){hd.set(t[Ko],t)}(e)):t[fd]=e}let pd,Dd;function gd(t,e){return pd(t,e)}function la(t){const e=t[Rt];return In(e)?e[Rt]:e}function Wy(t){return Yy(t[qo])}function Xy(t){return Yy(t[sr])}function Yy(t){for(;null!==t&&!In(t);)t=t[sr];return t}function zs(t,e,n,r,i){if(null!=r){let s,o=!1;In(r)?s=r:Cn(r)&&(o=!0,r=r[Ut]);const a=It(r);0===t&&null!==n?null==i?function Qy(t,e,n){t.appendChild(e,n)}(e,n,a):Xi(e,n,a,i||null,!0):1===t&&null!==n?Xi(e,n,a,i||null,!0):2===t?function uc(t,e,n){const r=function lc(t,e){return t.parentNode(e)}(t,e);r&&function KC(t,e,n,r){t.removeChild(e,n,r)}(t,r,e,n)}(e,a,o):3===t&&e.destroyNode(a),null!=s&&function eI(t,e,n,r,i){const s=n[Mr];s!==It(n)&&zs(e,t,r,s,i);for(let a=sn;a<n.length;a++){const l=n[a];ua(l[ce],l,t,e,r,s)}}(e,t,s,n,i)}}function Zy(t,e){const n=t[Rs],r=n.indexOf(e);qm(e),n.splice(r,1)}function _d(t,e){if(!(256&e[ze])){e[ze]&=-129,e[ze]|=256,function ZC(t,e){let n;if(null!=t&&null!=(n=t.destroyHooks))for(let r=0;r<n.length;r+=2){const i=e[n[r]];if(!(i instanceof ea)){const s=n[r+1];if(Array.isArray(s))for(let o=0;o<s.length;o+=2){const a=i[s[o]],l=s[o+1];Pr(4,a,l);try{l.call(a)}finally{Pr(5,a,l)}}else{Pr(4,i,s);try{s.call(i)}finally{Pr(5,i,s)}}}}}(t,e),function qC(t,e){const n=t.cleanup,r=e[Cs];if(null!==n)for(let s=0;s<n.length-1;s+=2)if("string"==typeof n[s]){const o=n[s+3];o>=0?r[o]():r[-o].unsubscribe(),s+=2}else n[s].call(r[n[s+1]]);null!==r&&(e[Cs]=null);const i=e[xi];if(null!==i){e[xi]=null;for(let s=0;s<i.length;s++)(0,i[s])()}}(t,e),1===e[ce].type&&e[je].destroy();const n=e[Zo];if(null!==n&&In(e[Rt])){n!==e[Rt]&&Zy(n,e);const r=e[Ar];null!==r&&r.detachView(t)}!function NC(t){hd.delete(t[Ko])}(e)}}function Xi(t,e,n,r,i){t.insertBefore(e,n,r,i)}function i_(t,e){return null!==e?t[Vt][hn].projection[e.projection]:null}function Ed(t,e,n,r,i,s,o){for(;null!=n;){const a=r[n.index],l=n.type;if(o&&0===e&&(a&&dn(It(a),r),n.flags|=2),32!=(32&n.flags))if(8&l)Ed(t,e,n.child,r,i,s,!1),zs(e,t,i,a,s);else if(32&l){const c=gd(n,r);let u;for(;u=c();)zs(e,t,i,u,s);zs(e,t,i,a,s)}else 16&l?o_(t,e,r,n,i,s):zs(e,t,i,a,s);n=o?n.projectionNext:n.next}}function ua(t,e,n,r,i,s){Ed(n,r,t.firstChild,e,i,s,!1)}function o_(t,e,n,r,i,s){const o=n[Vt],l=o[hn].projection[r.projection];if(Array.isArray(l))for(let c=0;c<l.length;c++)zs(e,t,i,l[c],s);else{let c=l;const u=o[Rt];(function rc(t){return 128==(128&t.flags)})(r)&&(c.flags|=128),Ed(t,e,c,u,i,s,!0)}}function a_(t,e,n){""===n?t.removeAttribute(e,"class"):t.setAttribute(e,"class",n)}class We{constructor(e,n){this._desc=e,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof n?this.__NG_ELEMENT_ID__=n:void 0!==n&&(this.\u0275prov=Et({token:this,providedIn:n.providedIn||"root",factory:n.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}const pc=new We("ENVIRONMENT_INITIALIZER"),w_=new We("INJECTOR",-1),E_=new We("INJECTOR_DEF_TYPES");class Md{get(e,n=jo){if(n===jo){const r=new Error(`NullInjectorError: No provider for ${qt(e)}!`);throw r.name="NullInjectorError",r}return n}}function MI(...t){return{\u0275providers:D_(0,t),\u0275fromNgModule:!0}}function D_(t,...e){const n=[],r=new Set;let i;const s=o=>{n.push(o)};return Vs(e,o=>{const a=o;gc(a,s,[],r)&&(i||=[],i.push(a))}),void 0!==i&&S_(i,s),n}function S_(t,e){for(let n=0;n<t.length;n++){const{ngModule:r,providers:i}=t[n];Rd(i,s=>{e(s,r)})}}function gc(t,e,n,r){if(!(t=ke(t)))return!1;let i=null,s=Cl(t);const o=!s&&at(t);if(s||o){if(o&&!o.standalone)return!1;i=t}else{const l=t.ngModule;if(s=Cl(l),!s)return!1;i=l}const a=r.has(i);if(o){if(a)return!1;if(r.add(i),o.dependencies){const l="function"==typeof o.dependencies?o.dependencies():o.dependencies;for(const c of l)gc(c,e,n,r)}}else{if(!s)return!1;{if(null!=s.imports&&!a){let c;r.add(i);try{Vs(s.imports,u=>{gc(u,e,n,r)&&(c||=[],c.push(u))})}finally{}void 0!==c&&S_(c,e)}if(!a){const c=$i(i)||(()=>new i);e({provide:i,useFactory:c,deps:pt},i),e({provide:E_,useValue:i,multi:!0},i),e({provide:pc,useValue:()=>dt(i),multi:!0},i)}const l=s.providers;if(null!=l&&!a){const c=t;Rd(l,u=>{e(u,c)})}}}return i!==t&&void 0!==t.providers}function Rd(t,e){for(let n of t)xh(n)&&(n=n.\u0275providers),Array.isArray(n)?Rd(n,e):e(n)}const RI=xt({provide:String,useValue:xt});function Pd(t){return null!==t&&"object"==typeof t&&RI in t}function Yi(t){return"function"==typeof t}const Nd=new We("Set Injector scope."),mc={},NI={};let Fd;function yc(){return void 0===Fd&&(Fd=new Md),Fd}class ii{}class _c extends ii{get destroyed(){return this._destroyed}constructor(e,n,r,i){super(),this.parent=n,this.source=r,this.scopes=i,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,Ld(e,o=>this.processProvider(o)),this.records.set(w_,qs(void 0,this)),i.has("environment")&&this.records.set(ii,qs(void 0,this));const s=this.records.get(Nd);null!=s&&"string"==typeof s.value&&this.scopes.add(s.value),this.injectorDefTypes=new Set(this.get(E_.multi,pt,ot.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const n of this._ngOnDestroyHooks)n.ngOnDestroy();const e=this._onDestroyHooks;this._onDestroyHooks=[];for(const n of e)n()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear()}}onDestroy(e){return this.assertNotDestroyed(),this._onDestroyHooks.push(e),()=>this.removeOnDestroy(e)}runInContext(e){this.assertNotDestroyed();const n=_i(this),r=Sn(void 0);try{return e()}finally{_i(n),Sn(r)}}get(e,n=jo,r=ot.Default){if(this.assertNotDestroyed(),e.hasOwnProperty(ym))return e[ym](this);r=Ml(r);const s=_i(this),o=Sn(void 0);try{if(!(r&ot.SkipSelf)){let l=this.records.get(e);if(void 0===l){const c=function kI(t){return"function"==typeof t||"object"==typeof t&&t instanceof We}(e)&&Tl(e);l=c&&this.injectableDefInScope(c)?qs(Od(e),mc):null,this.records.set(e,l)}if(null!=l)return this.hydrate(e,l)}return(r&ot.Self?yc():this.parent).get(e,n=r&ot.Optional&&n===jo?null:n)}catch(a){if("NullInjectorError"===a.name){if((a[Al]=a[Al]||[]).unshift(qt(e)),s)throw a;return function AS(t,e,n,r){const i=t[Al];throw e[pm]&&i.unshift(e[pm]),t.message=function MS(t,e,n,r=null){t=t&&"\n"===t.charAt(0)&&"\u0275"==t.charAt(1)?t.slice(2):t;let i=qt(e);if(Array.isArray(e))i=e.map(qt).join(" -> ");else if("object"==typeof e){let s=[];for(let o in e)if(e.hasOwnProperty(o)){let a=e[o];s.push(o+":"+("string"==typeof a?JSON.stringify(a):qt(a)))}i=`{${s.join(", ")}}`}return`${n}${r?"("+r+")":""}[${i}]: ${t.replace(DS,"\n  ")}`}("\n"+t.message,i,n,r),t.ngTokenPath=i,t[Al]=null,t}(a,e,"R3InjectorError",this.source)}throw a}finally{Sn(o),_i(s)}}resolveInjectorInitializers(){const e=_i(this),n=Sn(void 0);try{const i=this.get(pc.multi,pt,ot.Self);for(const s of i)s()}finally{_i(e),Sn(n)}}toString(){const e=[],n=this.records;for(const r of n.keys())e.push(qt(r));return`R3Injector[${e.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new me(205,!1)}processProvider(e){let n=Yi(e=ke(e))?e:ke(e&&e.provide);const r=function OI(t){return Pd(t)?qs(void 0,t.useValue):qs(function I_(t,e,n){let r;if(Yi(t)){const i=ke(t);return $i(i)||Od(i)}if(Pd(t))r=()=>ke(t.useValue);else if(function C_(t){return!(!t||!t.useFactory)}(t))r=()=>t.useFactory(...Mh(t.deps||[]));else if(function T_(t){return!(!t||!t.useExisting)}(t))r=()=>dt(ke(t.useExisting));else{const i=ke(t&&(t.useClass||t.provide));if(!function LI(t){return!!t.deps}(t))return $i(i)||Od(i);r=()=>new i(...Mh(t.deps))}return r}(t),mc)}(e);if(Yi(e)||!0!==e.multi)this.records.get(n);else{let i=this.records.get(n);i||(i=qs(void 0,mc,!0),i.factory=()=>Mh(i.multi),this.records.set(n,i)),n=e,i.multi.push(e)}this.records.set(n,r)}hydrate(e,n){return n.value===mc&&(n.value=NI,n.value=n.factory()),"object"==typeof n.value&&n.value&&function BI(t){return null!==t&&"object"==typeof t&&"function"==typeof t.ngOnDestroy}(n.value)&&this._ngOnDestroyHooks.add(n.value),n.value}injectableDefInScope(e){if(!e.providedIn)return!1;const n=ke(e.providedIn);return"string"==typeof n?"any"===n||this.scopes.has(n):this.injectorDefTypes.has(n)}removeOnDestroy(e){const n=this._onDestroyHooks.indexOf(e);-1!==n&&this._onDestroyHooks.splice(n,1)}}function Od(t){const e=Tl(t),n=null!==e?e.factory:$i(t);if(null!==n)return n;if(t instanceof We)throw new me(204,!1);if(t instanceof Function)return function FI(t){const e=t.length;if(e>0)throw function sa(t,e){const n=[];for(let r=0;r<t;r++)n.push(e);return n}(e,"?"),new me(204,!1);const n=function xS(t){return t&&(t[Il]||t[um])||null}(t);return null!==n?()=>n.factory(t):()=>new t}(t);throw new me(204,!1)}function qs(t,e,n=!1){return{factory:t,value:e,multi:n?[]:void 0}}function Ld(t,e){for(const n of t)Array.isArray(n)?Ld(n,e):n&&xh(n)?Ld(n.\u0275providers,e):e(n)}const Bd=new We("AppId",{providedIn:"root",factory:()=>UI}),UI="ng",A_=new We("Platform Initializer"),Zs=new We("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),M_=new We("CSP nonce",{providedIn:"root",factory:()=>function Xs(){if(void 0!==Dd)return Dd;if(typeof document<"u")return document;throw new me(210,!1)}().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});let P_=(t,e,n)=>null;function $d(t,e,n=!1){return P_(t,e,n)}class qI{}class O_{}class KI{resolveComponentFactory(e){throw function ZI(t){const e=Error(`No component factory found for ${qt(t)}.`);return e.ngComponent=t,e}(e)}}let Dc=(()=>{class e{}return e.NULL=new KI,e})();function QI(){return Qs(on(),U())}function Qs(t,e){return new qi(An(t,e))}let qi=(()=>{class e{constructor(r){this.nativeElement=r}}return e.__NG_ELEMENT_ID__=QI,e})();class B_{}let t1=(()=>{var t;class e{}return(t=e).\u0275prov=Et({token:t,providedIn:"root",factory:()=>null}),e})();class Xd{constructor(e){this.full=e,this.major=e.split(".")[0],this.minor=e.split(".")[1],this.patch=e.split(".").slice(2).join(".")}}const n1=new Xd("16.2.1"),Yd={};function G_(t,e=null,n=null,r){const i=function j_(t,e=null,n=null,r,i=new Set){const s=[n||pt,MI(t)];return r=r||("object"==typeof t?void 0:qt(t)),new _c(s,e||yc(),r||null,i)}(t,e,n,r);return i.resolveInjectorInitializers(),i}let Or=(()=>{var t;class e{static create(r,i){if(Array.isArray(r))return G_({name:""},i,r,"");{const s=r.name??"";return G_({name:s},r.parent,r.providers,s)}}}return(t=e).THROW_IF_NOT_FOUND=jo,t.NULL=new Md,t.\u0275prov=Et({token:t,providedIn:"any",factory:()=>dt(w_)}),t.__NG_ELEMENT_ID__=-1,e})(),Kd=(()=>{var t;class e{constructor(){this.callbacks=new Set,this.deferredCallbacks=new Set,this.renderDepth=0,this.runningCallbacks=!1}begin(){if(this.runningCallbacks)throw new me(102,!1);this.renderDepth++}end(){if(this.renderDepth--,0===this.renderDepth)try{this.runningCallbacks=!0;for(const r of this.callbacks)r.invoke()}finally{this.runningCallbacks=!1;for(const r of this.deferredCallbacks)this.callbacks.add(r);this.deferredCallbacks.clear()}}register(r){(this.runningCallbacks?this.deferredCallbacks:this.callbacks).add(r)}unregister(r){this.callbacks.delete(r),this.deferredCallbacks.delete(r)}ngOnDestroy(){this.callbacks.clear(),this.deferredCallbacks.clear()}}return(t=e).\u0275prov=Et({token:t,providedIn:"root",factory:()=>new t}),e})();function ya(t){for(;t;){t[ze]|=64;const e=la(t);if(Lh(t)&&!e)return t;t=e}return null}function Qd(t){return t.ngOriginalError}class Zi{constructor(){this._console=console}handleError(e){const n=this._findOriginalError(e);this._console.error("ERROR",e),n&&this._console.error("ORIGINAL ERROR",n)}_findOriginalError(e){let n=e&&Qd(e);for(;n&&Qd(n);)n=Qd(n);return n||null}}const Y_=new We("",{providedIn:"root",factory:()=>!1});class Q_ extends km{constructor(){super(...arguments),this.consumerAllowSignalWrites=!1,this._lView=null}set lView(e){this._lView=e}onConsumerDependencyMayHaveChanged(){ya(this._lView)}onProducerUpdateValueVersion(){}get hasReadASignal(){return this.hasProducers}runInContext(e,n,r){const i=en(this);this.trackingVersion++;try{e(n,r)}finally{en(i)}}destroy(){this.trackingVersion++}}let Tc=null;function J_(){return Tc??=new Q_,Tc}function ev(t,e){return t[e]??J_()}function tv(t,e){const n=J_();n.hasReadASignal&&(t[e]=Tc,n.lView=t,Tc=new Q_)}const Xe={};function Ke(t,e=ot.Default){const n=U();return null===n?dt(t,e):vy(on(),n,ke(t),e)}function Cc(t,e,n,r,i,s,o,a,l,c,u){const h=e.blueprint.slice();return h[Ut]=i,h[ze]=140|r,(null!==c||t&&2048&t[ze])&&(h[ze]|=2048),Ym(h),h[Rt]=h[As]=t,h[Ht]=n,h[Is]=o||t&&t[Is],h[je]=a||t&&t[je],h[vi]=l||t&&t[vi]||null,h[hn]=s,h[Ko]=function RC(){return MC++}(),h[ei]=u,h[Pm]=c,h[Vt]=2==e.type?t[Vt]:h,h}function to(t,e,n,r,i){let s=t.data[e];if(null===s)s=function Jd(t,e,n,r,i){const s=ey(),o=function Gh(){return Be.lFrame.isParent}(),l=t.data[e]=function C1(t,e,n,r,i,s){let o=e?e.injectorIndex:-1,a=0;return function Ns(){return null!==Be.skipHydrationRootTNode}()&&(a|=128),{type:n,index:r,insertBeforeIndex:null,injectorIndex:o,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:a,providerIndexes:0,value:i,attrs:s,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:e,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,o?s:s&&s.parent,n,e,r,i);return null===t.firstChild&&(t.firstChild=l),null!==s&&(o?null==s.child&&null!==l.parent&&(s.child=l):null===s.next&&(s.next=l,l.prev=s)),l}(t,e,n,r,i),function AT(){return Be.lFrame.inI18n}()&&(s.flags|=32);else if(64&s.type){s.type=n,s.value=r,s.attrs=i;const o=function Jo(){const t=Be.lFrame,e=t.currentTNode;return t.isParent?e:e.parent}();s.injectorIndex=null===o?-1:o.injectorIndex}return function Nr(t,e){const n=Be.lFrame;n.currentTNode=t,n.isParent=e}(s,!0),s}function _a(t,e,n,r){if(0===n)return-1;const i=e.length;for(let s=0;s<n;s++)e.push(r),t.blueprint.push(r),t.data.push(null);return i}function rv(t,e,n,r,i){const s=ev(e,Fl),o=function vn(){return Be.lFrame.selectedIndex}(),a=2&r;try{if(zi(-1),a&&e.length>it&&function nv(t,e,n,r){if(!r)if(3==(3&e[ze])){const s=t.preOrderCheckHooks;null!==s&&zl(e,s,n)}else{const s=t.preOrderHooks;null!==s&&Wl(e,s,0,n)}zi(n)}(t,e,it,!1),Pr(a?2:0,i),a)s.runInContext(n,r,i);else{const c=en(null);try{n(r,i)}finally{en(c)}}}finally{a&&null===e[Fl]&&tv(e,Fl),zi(o),Pr(a?3:1,i)}}function rf(t,e,n,r,i,s,o,a,l,c,u){const h=it+r,d=h+i,f=function w1(t,e){const n=[];for(let r=0;r<e;r++)n.push(r<t?null:Xe);return n}(h,d),p="function"==typeof c?c():c;return f[ce]={type:t,blueprint:f,template:n,queries:null,viewQuery:a,declTNode:e,data:f.slice().fill(null,h),bindingStartIndex:h,expandoStartIndex:d,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof s?s():s,pipeRegistry:"function"==typeof o?o():o,firstChild:null,schemas:l,consts:p,incompleteFirstPass:!1,ssrId:u}}let sv=t=>null;function ov(t,e,n,r){for(let i in t)if(t.hasOwnProperty(i)){n=null===n?{}:n;const s=t[i];null===r?av(n,e,i,s):r.hasOwnProperty(i)&&av(n,e,r[i],s)}return n}function av(t,e,n,r){t.hasOwnProperty(n)?t[n].push(e,r):t[n]=[e,r]}function O1(t,e){null!==t.hostBindings&&t.hostBindings(1,e)}function k1(t,e,n){if(n){if(e.exportAs)for(let r=0;r<e.exportAs.length;r++)n[e.exportAs[r]]=t;or(e)&&(n[""]=t)}}function H1(t,e,n,r,i){t.data[r]=i;const s=i.factory||(i.factory=$i(i.type)),o=new ea(s,or(i),Ke);t.blueprint[r]=o,n[r]=o,function P1(t,e,n,r,i){const s=i.hostBindings;if(s){let o=t.hostBindingOpCodes;null===o&&(o=t.hostBindingOpCodes=[]);const a=~e.index;(function N1(t){let e=t.length;for(;e>0;){const n=t[--e];if("number"==typeof n&&n<0)return n}return 0})(o)!=a&&o.push(a),o.push(n,r,s)}}(t,e,r,_a(t,n,i.hostVars,Xe),i)}function uv(t,e,n,r,i){const s=en(null);try{const o=t.inputTransforms;null!==o&&o.hasOwnProperty(r)&&(i=o[r].call(e,i)),null!==t.setInput?t.setInput(e,i,n,r):e[r]=i}finally{en(s)}}function j1(t,e,n){let r=null,i=0;for(;i<n.length;){const s=n[i];if(0!==s)if(5!==s){if("number"==typeof s)break;if(t.hasOwnProperty(s)){null===r&&(r=[]);const o=t[s];for(let a=0;a<o.length;a+=2)if(o[a]===e){r.push(s,o[a+1],n[i+1]);break}}i+=2}else i+=2;else i+=4}return r}function dv(t,e){const n=t.contentQueries;if(null!==n)for(let r=0;r<n.length;r+=2){const s=n[r+1];if(-1!==s){const o=t.data[s];Wh(n[r]),o.contentQueries(2,e[s],s)}}}function lf(t,e,n){Wh(0);const r=en(null);try{e(t,n)}finally{en(r)}}function $1(t,e){const n=kn(e,t),r=n[ce];!function z1(t,e){for(let n=e.length;n<t.blueprint.length;n++)e.push(t.blueprint[n])}(r,n);const i=n[Ut];null!==i&&null===n[ei]&&(n[ei]=$d(i,n[vi])),uf(r,n,n[Ht])}function uf(t,e,n){Xh(e);try{const r=t.viewQuery;null!==r&&lf(1,r,n);const i=t.template;null!==i&&rv(t,e,i,1,n),t.firstCreatePass&&(t.firstCreatePass=!1),t.staticContentQueries&&dv(t,e),t.staticViewQueries&&lf(2,t.viewQuery,n);const s=t.components;null!==s&&function W1(t,e){for(let n=0;n<e.length;n++)$1(t,e[n])}(e,s)}catch(r){throw t.firstCreatePass&&(t.incompleteFirstPass=!0,t.firstCreatePass=!1),r}finally{e[ze]&=-5,Yh()}}let yv=(()=>{var t;class e{constructor(){this.all=new Set,this.queue=new Map}create(r,i,s){const o=typeof Zone>"u"?null:Zone.current,a=new sT(r,u=>{this.all.has(u)&&this.queue.set(u,o)},s);let l;this.all.add(a),a.notify();const c=()=>{a.cleanup(),l?.(),this.all.delete(a),this.queue.delete(a)};return l=i?.onDestroy(c),{destroy:c}}flush(){if(0!==this.queue.size)for(const[r,i]of this.queue)this.queue.delete(r),i?i.run(()=>r.run()):r.run()}get isQueueEmpty(){return 0===this.queue.size}}return(t=e).\u0275prov=Et({token:t,providedIn:"root",factory:()=>new t}),e})();function va(t,e,n,r,i=!1){for(;null!==n;){const s=e[n.index];if(null!==s&&r.push(It(s)),In(s)){for(let a=sn;a<s.length;a++){const l=s[a],c=l[ce].firstChild;null!==c&&va(l[ce],l,c,r)}s[Mr]!==s[Ut]&&r.push(s[Mr])}const o=n.type;if(8&o)va(t,e,n.child,r);else if(32&o){const a=gd(n,e);let l;for(;l=a();)r.push(l)}else if(16&o){const a=i_(e,n);if(Array.isArray(a))r.push(...a);else{const l=la(e[Vt]);va(l[ce],l,a,r,!0)}}n=i?n.projectionNext:n.next}return r}function Mc(t,e,n,r=!0){const i=e[Is],s=i.rendererFactory,o=i.afterRenderEventManager;s.begin?.(),o?.begin();try{_v(t,e,t.template,n)}catch(l){throw r&&function mv(t,e){const n=t[vi],r=n?n.get(Zi,null):null;r&&r.handleError(e)}(e,l),l}finally{s.end?.(),i.effectManager?.flush(),o?.end()}}function _v(t,e,n,r){const i=e[ze];if(256!=(256&i)){e[Is].effectManager?.flush(),Xh(e);try{Ym(e),function ny(t){return Be.lFrame.bindingIndex=t}(t.bindingStartIndex),null!==n&&rv(t,e,n,2,r);const o=3==(3&i);if(o){const c=t.preOrderCheckHooks;null!==c&&zl(e,c,null)}else{const c=t.preOrderHooks;null!==c&&Wl(e,c,0,null),qh(e,0)}if(function q1(t){for(let e=Wy(t);null!==e;e=Xy(e)){if(!e[Nm])continue;const n=e[Rs];for(let r=0;r<n.length;r++){mT(n[r])}}}(e),vv(e,2),null!==t.contentQueries&&dv(t,e),o){const c=t.contentCheckHooks;null!==c&&zl(e,c)}else{const c=t.contentHooks;null!==c&&Wl(e,c,1),qh(e,1)}!function x1(t,e){const n=t.hostBindingOpCodes;if(null===n)return;const r=ev(e,Ol);try{for(let i=0;i<n.length;i++){const s=n[i];if(s<0)zi(~s);else{const o=s,a=n[++i],l=n[++i];MT(a,o),r.runInContext(l,2,e[o])}}}finally{null===e[Ol]&&tv(e,Ol),zi(-1)}}(t,e);const a=t.components;null!==a&&wv(e,a,0);const l=t.viewQuery;if(null!==l&&lf(2,l,r),o){const c=t.viewCheckHooks;null!==c&&zl(e,c)}else{const c=t.viewHooks;null!==c&&Wl(e,c,2),qh(e,2)}!0===t.firstUpdatePass&&(t.firstUpdatePass=!1),e[ze]&=-73,qm(e)}finally{Yh()}}}function vv(t,e){for(let n=Wy(t);null!==n;n=Xy(n))for(let r=sn;r<n.length;r++)xv(n[r],e)}function Z1(t,e,n){xv(kn(e,t),n)}function xv(t,e){if(!function pT(t){return 128==(128&t[ze])}(t))return;const n=t[ce];if(80&t[ze]&&0===e||1024&t[ze]||2===e)_v(n,t,n.template,t[Ht]);else if(t[Yo]>0){vv(t,1);const i=t[ce].components;null!==i&&wv(t,i,1)}}function wv(t,e,n){for(let r=0;r<e.length;r++)Z1(t,e[r],n)}class xa{get rootNodes(){const e=this._lView,n=e[ce];return va(n,e,n.firstChild,[])}constructor(e,n){this._lView=e,this._cdRefInjectingView=n,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[Ht]}set context(e){this._lView[Ht]=e}get destroyed(){return 256==(256&this._lView[ze])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const e=this._lView[Rt];if(In(e)){const n=e[8],r=n?n.indexOf(this):-1;r>-1&&(function ac(t,e){if(t.length<=sn)return;const n=sn+e,r=t[n];if(r){const i=r[Zo];null!==i&&i!==t&&Zy(i,r),e>0&&(t[n-1][sr]=r[sr]);const s=Kl(t,sn+e);!function jC(t,e){ua(t,e,e[je],2,null,null),e[Ut]=null,e[hn]=null}(r[ce],r);const o=s[Ar];null!==o&&o.detachView(s[ce]),r[Rt]=null,r[sr]=null,r[ze]&=-129}return r}(e,r),Kl(n,r))}this._attachedToViewContainer=!1}!function yd(t,e){if(!(256&e[ze])){const n=e[je];e[Fl]?.destroy(),e[Ol]?.destroy(),n.destroyNode&&ua(t,e,n,3,null,null),function WC(t){let e=t[qo];if(!e)return _d(t[ce],t);for(;e;){let n=null;if(Cn(e))n=e[qo];else{const r=e[sn];r&&(n=r)}if(!n){for(;e&&!e[sr]&&e!==t;)Cn(e)&&_d(e[ce],e),e=e[Rt];null===e&&(e=t),Cn(e)&&_d(e[ce],e),n=e&&e[sr]}e=n}}(e)}}(this._lView[ce],this._lView)}onDestroy(e){!function Km(t,e){if(256==(256&t[ze]))throw new me(911,!1);null===t[xi]&&(t[xi]=[]),t[xi].push(e)}(this._lView,e)}markForCheck(){ya(this._cdRefInjectingView||this._lView)}detach(){this._lView[ze]&=-129}reattach(){this._lView[ze]|=128}detectChanges(){Mc(this._lView[ce],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new me(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function zC(t,e){ua(t,e,e[je],2,null,null)}(this._lView[ce],this._lView)}attachToAppRef(e){if(this._attachedToViewContainer)throw new me(902,!1);this._appRef=e}}class K1 extends xa{constructor(e){super(e),this._view=e}detectChanges(){const e=this._view;Mc(e[ce],e,e[Ht],!1)}checkNoChanges(){}get context(){return null}}class Ev extends Dc{constructor(e){super(),this.ngModule=e}resolveComponentFactory(e){const n=at(e);return new wa(n,this.ngModule)}}function bv(t){const e=[];for(let n in t)t.hasOwnProperty(n)&&e.push({propName:t[n],templateName:n});return e}class J1{constructor(e,n){this.injector=e,this.parentInjector=n}get(e,n,r){r=Ml(r);const i=this.injector.get(e,Yd,r);return i!==Yd||n===Yd?i:this.parentInjector.get(e,n,r)}}class wa extends O_{get inputs(){const e=this.componentDef,n=e.inputTransforms,r=bv(e.inputs);if(null!==n)for(const i of r)n.hasOwnProperty(i.propName)&&(i.transform=n[i.propName]);return r}get outputs(){return bv(this.componentDef.outputs)}constructor(e,n){super(),this.componentDef=e,this.ngModule=n,this.componentType=e.type,this.selector=function HS(t){return t.map(US).join(",")}(e.selectors),this.ngContentSelectors=e.ngContentSelectors?e.ngContentSelectors:[],this.isBoundToModule=!!n}create(e,n,r,i){let s=(i=i||this.ngModule)instanceof ii?i:i?.injector;s&&null!==this.componentDef.getStandaloneInjector&&(s=this.componentDef.getStandaloneInjector(s)||s);const o=s?new J1(e,s):e,a=o.get(B_,null);if(null===a)throw new me(407,!1);const h={rendererFactory:a,sanitizer:o.get(t1,null),effectManager:o.get(yv,null),afterRenderEventManager:o.get(Kd,null)},d=a.createRenderer(null,this.componentDef),f=this.componentDef.selectors[0][0]||"div",p=r?function E1(t,e,n,r){const s=r.get(Y_,!1)||n===rr.ShadowDom,o=t.selectRootElement(e,s);return function b1(t){sv(t)}(o),o}(d,r,this.componentDef.encapsulation,o):function oc(t,e,n){return t.createElement(e,n)}(d,f,function Q1(t){const e=t.toLowerCase();return"svg"===e?"svg":"math"===e?"math":null}(f)),_=this.componentDef.signals?4608:this.componentDef.onPush?576:528;let v=null;null!==p&&(v=$d(p,o,!0));const D=rf(0,null,null,1,0,null,null,null,null,null,null),A=Cc(null,D,null,_,null,null,h,d,o,null,v);let $,pe;Xh(A);try{const J=this.componentDef;let ee,Ve=null;J.findHostDirectiveDefs?(ee=[],Ve=new Map,J.findHostDirectiveDefs(J,ee,Ve),ee.push(J)):ee=[J];const te=function tA(t,e){const n=t[ce],r=it;return t[r]=e,to(n,r,2,"#host",null)}(A,p),he=function nA(t,e,n,r,i,s,o){const a=i[ce];!function rA(t,e,n,r){for(const i of t)e.mergedAttrs=Wo(e.mergedAttrs,i.hostAttrs);null!==e.mergedAttrs&&(function Ac(t,e,n){let r=n?t.styles:null,i=n?t.classes:null,s=0;if(null!==e)for(let o=0;o<e.length;o++){const a=e[o];"number"==typeof a?s=a:1==s?i=yh(i,a):2==s&&(r=yh(r,a+": "+e[++o]+";"))}n?t.styles=r:t.stylesWithoutHost=r,n?t.classes=i:t.classesWithoutHost=i}(e,e.mergedAttrs,!0),null!==n&&function l_(t,e,n){const{mergedAttrs:r,classes:i,styles:s}=n;null!==r&&Nh(t,e,r),null!==i&&a_(t,e,i),null!==s&&function nI(t,e,n){t.setAttribute(e,"style",n)}(t,e,s)}(r,n,e))}(r,t,e,o);let l=null;null!==e&&(l=$d(e,i[vi]));const c=s.rendererFactory.createRenderer(e,n);let u=16;n.signals?u=4096:n.onPush&&(u=64);const h=Cc(i,function iv(t){const e=t.tView;return null===e||e.incompleteFirstPass?t.tView=rf(1,null,t.template,t.decls,t.vars,t.directiveDefs,t.pipeDefs,t.viewQuery,t.schemas,t.consts,t.id):e}(n),null,u,i[t.index],t,s,c,null,null,l);return a.firstCreatePass&&function of(t,e,n){e.componentOffset=n,(t.components??=[]).push(e.index)}(a,t,r.length-1),function Ic(t,e){return t[qo]?t[13][sr]=e:t[qo]=e,t[13]=e,e}(i,h),i[t.index]=h}(te,p,J,ee,A,h,d);pe=function Xm(t,e){return t.data[e]}(D,it),p&&function sA(t,e,n,r){if(r)Nh(t,n,["ng-version",n1.full]);else{const{attrs:i,classes:s}=function VS(t){const e=[],n=[];let r=1,i=2;for(;r<t.length;){let s=t[r];if("string"==typeof s)2===i?""!==s&&e.push(s,t[++r]):8===i&&n.push(s);else{if(!ir(i))break;i=s}r++}return{attrs:e,classes:n}}(e.selectors[0]);i&&Nh(t,n,i),s&&s.length>0&&a_(t,n,s.join(" "))}}(d,J,p,r),void 0!==n&&function oA(t,e,n){const r=t.projection=[];for(let i=0;i<e.length;i++){const s=n[i];r.push(null!=s?Array.from(s):null)}}(pe,this.ngContentSelectors,n),$=function iA(t,e,n,r,i,s){const o=on(),a=i[ce],l=An(o,i);!function lv(t,e,n,r,i,s){for(let c=0;c<r.length;c++)ed(Yl(n,e),t,r[c].type);!function U1(t,e,n){t.flags|=1,t.directiveStart=e,t.directiveEnd=e+n,t.providerIndexes=e}(n,t.data.length,r.length);for(let c=0;c<r.length;c++){const u=r[c];u.providersResolver&&u.providersResolver(u)}let o=!1,a=!1,l=_a(t,e,r.length,null);for(let c=0;c<r.length;c++){const u=r[c];n.mergedAttrs=Wo(n.mergedAttrs,u.hostAttrs),H1(t,n,e,l,u),k1(l,u,i),null!==u.contentQueries&&(n.flags|=4),(null!==u.hostBindings||null!==u.hostAttrs||0!==u.hostVars)&&(n.flags|=64);const h=u.type.prototype;!o&&(h.ngOnChanges||h.ngOnInit||h.ngDoCheck)&&((t.preOrderHooks??=[]).push(n.index),o=!0),!a&&(h.ngOnChanges||h.ngDoCheck)&&((t.preOrderCheckHooks??=[]).push(n.index),a=!0),l++}!function I1(t,e,n){const i=e.directiveEnd,s=t.data,o=e.attrs,a=[];let l=null,c=null;for(let u=e.directiveStart;u<i;u++){const h=s[u],d=n?n.get(h):null,p=d?d.outputs:null;l=ov(h.inputs,u,l,d?d.inputs:null),c=ov(h.outputs,u,c,p);const g=null===l||null===o||bm(e)?null:j1(l,u,o);a.push(g)}null!==l&&(l.hasOwnProperty("class")&&(e.flags|=8),l.hasOwnProperty("style")&&(e.flags|=16)),e.initialInputs=a,e.inputs=l,e.outputs=c}(t,n,s)}(a,i,o,n,null,r);for(let u=0;u<n.length;u++)dn(Wi(i,a,o.directiveStart+u,o),i);(function cv(t,e,n){const r=n.directiveStart,i=n.directiveEnd,s=n.index,o=function RT(){return Be.lFrame.currentDirectiveIndex}();try{zi(s);for(let a=r;a<i;a++){const l=t.data[a],c=e[a];$h(a),(null!==l.hostBindings||0!==l.hostVars||null!==l.hostAttrs)&&O1(l,c)}}finally{zi(-1),$h(o)}})(a,i,o),l&&dn(l,i);const c=Wi(i,a,o.directiveStart+o.componentOffset,o);if(t[Ht]=i[Ht]=c,null!==s)for(const u of s)u(c,e);return function ef(t,e,n){if(function Oh(t){return 0!=(4&t.flags)}(e)){const r=en(null);try{const s=e.directiveEnd;for(let o=e.directiveStart;o<s;o++){const a=t.data[o];a.contentQueries&&a.contentQueries(1,n[o],o)}}finally{en(r)}}}(a,o,t),c}(he,J,ee,Ve,A,[aA]),uf(D,A,null)}finally{Yh()}return new eA(this.componentType,$,Qs(pe,A),A,pe)}}class eA extends qI{constructor(e,n,r,i,s){super(),this.location=r,this._rootLView=i,this._tNode=s,this.previousInputValues=null,this.instance=n,this.hostView=this.changeDetectorRef=new K1(i),this.componentType=e}setInput(e,n){const r=this._tNode.inputs;let i;if(null!==r&&(i=r[e])){if(this.previousInputValues??=new Map,this.previousInputValues.has(e)&&Object.is(this.previousInputValues.get(e),n))return;const s=this._rootLView;(function cf(t,e,n,r,i){for(let s=0;s<n.length;){const o=n[s++],a=n[s++];uv(t.data[o],e[o],r,a,i)}})(s[ce],s,i,e,n),this.previousInputValues.set(e,n),ya(kn(this._tNode.index,s))}}get injector(){return new xn(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(e){this.hostView.onDestroy(e)}}function aA(){const t=on();!function $l(t,e){for(let n=e.directiveStart,r=e.directiveEnd;n<r;n++){const s=t.data[n].type.prototype,{ngAfterContentInit:o,ngAfterContentChecked:a,ngAfterViewInit:l,ngAfterViewChecked:c,ngOnDestroy:u}=s;o&&(t.contentHooks??=[]).push(-n,o),a&&((t.contentHooks??=[]).push(n,a),(t.contentCheckHooks??=[]).push(n,a)),l&&(t.viewHooks??=[]).push(-n,l),c&&((t.viewHooks??=[]).push(n,c),(t.viewCheckHooks??=[]).push(n,c)),null!=u&&(t.destroyHooks??=[]).push(n,u)}}(U()[ce],t)}function Ef(t){return!!t&&"function"==typeof t.then}function qv(t){return!!t&&"function"==typeof t.subscribe}const po="en-US";let q0=po;class es{}class wx extends es{constructor(e){super(),this.componentFactoryResolver=new Ev(this),this.instance=null;const n=new _c([...e.providers,{provide:es,useValue:this},{provide:Dc,useValue:this.componentFactoryResolver}],e.parent||yc(),e.debugName,new Set(["environment"]));this.injector=n,e.runEnvironmentInitializers&&n.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(e){this.injector.onDestroy(e)}}let ZR=(()=>{var t;class e{constructor(r){this._injector=r,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(r){if(!r.standalone)return null;if(!this.cachedInjectors.has(r)){const i=D_(0,r.type),s=i.length>0?function qR(t,e,n=null){return new wx({providers:t,parent:e,debugName:n,runEnvironmentInitializers:!0}).injector}([i],this._injector,`Standalone[${r.type.name}]`):null;this.cachedInjectors.set(r,s)}return this.cachedInjectors.get(r)}ngOnDestroy(){try{for(const r of this.cachedInjectors.values())null!==r&&r.destroy()}finally{this.cachedInjectors.clear()}}}return(t=e).\u0275prov=Et({token:t,providedIn:"environment",factory:()=>new t(dt(ii))}),e})();function Ex(t){t.getStandaloneInjector=e=>e.get(ZR).getOrCreateStandaloneInjector(t)}function kf(t){return e=>{setTimeout(t,void 0,e)}}const $t=class EP extends O{constructor(e=!1){super(),this.__isAsync=e}emit(e){super.next(e)}subscribe(e,n,r){let i=e,s=n||(()=>null),o=r;if(e&&"object"==typeof e){const l=e;i=l.next?.bind(l),s=l.error?.bind(l),o=l.complete?.bind(l)}this.__isAsync&&(s=kf(s),i&&(i=kf(i)),o&&(o=kf(o)));const a=super.subscribe({next:i,error:s,complete:o});return e instanceof ie&&e.add(a),a}},mN=new We("Application Initializer");let Zf=(()=>{var t;class e{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((r,i)=>{this.resolve=r,this.reject=i}),this.appInits=Ct(mN,{optional:!0})??[]}runInitializers(){if(this.initialized)return;const r=[];for(const s of this.appInits){const o=s();if(Ef(o))r.push(o);else if(qv(o)){const a=new Promise((l,c)=>{o.subscribe({complete:l,error:c})});r.push(a)}}const i=()=>{this.done=!0,this.resolve()};Promise.all(r).then(()=>{i()}).catch(s=>{this.reject(s)}),0===r.length&&i(),this.initialized=!0}}return(t=e).\u0275fac=function(r){return new(r||t)},t.\u0275prov=Et({token:t,factory:t.\u0275fac,providedIn:"root"}),e})();const li=new We("LocaleId",{providedIn:"root",factory:()=>Ct(li,ot.Optional|ot.SkipSelf)||function _N(){return typeof $localize<"u"&&$localize.locale||po}()});let wN=(()=>{var t;class e{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new W(!1)}add(){this.hasPendingTasks.next(!0);const r=this.taskId++;return this.pendingTasks.add(r),r}remove(r){this.pendingTasks.delete(r),0===this.pendingTasks.size&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this.hasPendingTasks.next(!1)}}return(t=e).\u0275fac=function(r){return new(r||t)},t.\u0275prov=Et({token:t,factory:t.\u0275fac,providedIn:"root"}),e})();function pw(...t){}class zt{constructor({enableLongStackTrace:e=!1,shouldCoalesceEventChangeDetection:n=!1,shouldCoalesceRunChangeDetection:r=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new $t(!1),this.onMicrotaskEmpty=new $t(!1),this.onStable=new $t(!1),this.onError=new $t(!1),typeof Zone>"u")throw new me(908,!1);Zone.assertZonePatched();const i=this;i._nesting=0,i._outer=i._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(i._inner=i._inner.fork(new Zone.TaskTrackingZoneSpec)),e&&Zone.longStackTraceZoneSpec&&(i._inner=i._inner.fork(Zone.longStackTraceZoneSpec)),i.shouldCoalesceEventChangeDetection=!r&&n,i.shouldCoalesceRunChangeDetection=r,i.lastRequestAnimationFrameId=-1,i.nativeRequestAnimationFrame=function GN(){const t="function"==typeof bt.requestAnimationFrame;let e=bt[t?"requestAnimationFrame":"setTimeout"],n=bt[t?"cancelAnimationFrame":"clearTimeout"];if(typeof Zone<"u"&&e&&n){const r=e[Zone.__symbol__("OriginalDelegate")];r&&(e=r);const i=n[Zone.__symbol__("OriginalDelegate")];i&&(n=i)}return{nativeRequestAnimationFrame:e,nativeCancelAnimationFrame:n}}().nativeRequestAnimationFrame,function zN(t){const e=()=>{!function $N(t){t.isCheckStableRunning||-1!==t.lastRequestAnimationFrameId||(t.lastRequestAnimationFrameId=t.nativeRequestAnimationFrame.call(bt,()=>{t.fakeTopEventTask||(t.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{t.lastRequestAnimationFrameId=-1,ep(t),t.isCheckStableRunning=!0,Jf(t),t.isCheckStableRunning=!1},void 0,()=>{},()=>{})),t.fakeTopEventTask.invoke()}),ep(t))}(t)};t._inner=t._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(n,r,i,s,o,a)=>{try{return gw(t),n.invokeTask(i,s,o,a)}finally{(t.shouldCoalesceEventChangeDetection&&"eventTask"===s.type||t.shouldCoalesceRunChangeDetection)&&e(),mw(t)}},onInvoke:(n,r,i,s,o,a,l)=>{try{return gw(t),n.invoke(i,s,o,a,l)}finally{t.shouldCoalesceRunChangeDetection&&e(),mw(t)}},onHasTask:(n,r,i,s)=>{n.hasTask(i,s),r===i&&("microTask"==s.change?(t._hasPendingMicrotasks=s.microTask,ep(t),Jf(t)):"macroTask"==s.change&&(t.hasPendingMacrotasks=s.macroTask))},onHandleError:(n,r,i,s)=>(n.handleError(i,s),t.runOutsideAngular(()=>t.onError.emit(s)),!1)})}(i)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!zt.isInAngularZone())throw new me(909,!1)}static assertNotInAngularZone(){if(zt.isInAngularZone())throw new me(909,!1)}run(e,n,r){return this._inner.run(e,n,r)}runTask(e,n,r,i){const s=this._inner,o=s.scheduleEventTask("NgZoneEvent: "+i,e,jN,pw,pw);try{return s.runTask(o,n,r)}finally{s.cancelTask(o)}}runGuarded(e,n,r){return this._inner.runGuarded(e,n,r)}runOutsideAngular(e){return this._outer.run(e)}}const jN={};function Jf(t){if(0==t._nesting&&!t.hasPendingMicrotasks&&!t.isStable)try{t._nesting++,t.onMicrotaskEmpty.emit(null)}finally{if(t._nesting--,!t.hasPendingMicrotasks)try{t.runOutsideAngular(()=>t.onStable.emit(null))}finally{t.isStable=!0}}}function ep(t){t.hasPendingMicrotasks=!!(t._hasPendingMicrotasks||(t.shouldCoalesceEventChangeDetection||t.shouldCoalesceRunChangeDetection)&&-1!==t.lastRequestAnimationFrameId)}function gw(t){t._nesting++,t.isStable&&(t.isStable=!1,t.onUnstable.emit(null))}function mw(t){t._nesting--,Jf(t)}const yw=new We("",{providedIn:"root",factory:_w});function _w(){const t=Ct(zt);let e=!0;return cS(new x(i=>{e=t.isStable&&!t.hasPendingMacrotasks&&!t.hasPendingMicrotasks,t.runOutsideAngular(()=>{i.next(e),i.complete()})}),new x(i=>{let s;t.runOutsideAngular(()=>{s=t.onStable.subscribe(()=>{zt.assertNotInAngularZone(),queueMicrotask(()=>{!e&&!t.hasPendingMacrotasks&&!t.hasPendingMicrotasks&&(e=!0,i.next(!0))})})});const o=t.onUnstable.subscribe(()=>{zt.assertInAngularZone(),e&&(e=!1,t.runOutsideAngular(()=>{i.next(!1)}))});return()=>{s.unsubscribe(),o.unsubscribe()}}).pipe(am()))}const vw=new We("");let Ti=null;const ip=new We("PlatformDestroyListeners"),ww=new We("appBootstrapListener");function QN(t){try{const{rootComponent:e,appProviders:n,platformProviders:r}=t,i=function KN(t=[]){if(Ti)return Ti;const e=function Dw(t=[],e){return Or.create({name:e,providers:[{provide:Nd,useValue:"platform"},{provide:ip,useValue:new Set([()=>Ti=null])},...t]})}(t);return Ti=e,function Ew(){!function rT(t){Um=t}(()=>{throw new me(600,!1)})}(),function bw(t){t.get(A_,null)?.forEach(n=>n())}(e),e}(r),s=[rF(),...n||[]],a=new wx({providers:s,parent:i,debugName:"",runEnvironmentInitializers:!1}).injector,l=a.get(zt);return l.run(()=>{a.resolveInjectorInitializers();const c=a.get(Zi,null);let u;l.runOutsideAngular(()=>{u=l.onError.subscribe({next:f=>{c.handleError(f)}})});const h=()=>a.destroy(),d=i.get(ip);return d.add(h),a.onDestroy(()=>{u.unsubscribe(),d.delete(h)}),function Cw(t,e,n){try{const r=n();return Ef(r)?r.catch(i=>{throw e.runOutsideAngular(()=>t.handleError(i)),i}):r}catch(r){throw e.runOutsideAngular(()=>t.handleError(r)),r}}(c,l,()=>{const f=a.get(Zf);return f.runInitializers(),f.donePromise.then(()=>{!function Z0(t){Xn(t,"Expected localeId to be defined"),"string"==typeof t&&(q0=t.toLowerCase().replace(/_/g,"-"))}(a.get(li,po)||po);const g=a.get(La);return void 0!==e&&g.bootstrap(e),g})})})}catch(e){return Promise.reject(e)}}let La=(()=>{var t;class e{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=Ct(Mw),this.zoneIsStable=Ct(yw),this.componentTypes=[],this.components=[],this.isStable=Ct(wN).hasPendingTasks.pipe(function hS(t,e){return q((n,r)=>{let i=null,s=0,o=!1;const a=()=>o&&!i&&r.complete();n.subscribe(oe(r,l=>{i?.unsubscribe();let c=0;const u=s++;Wn(t(l,u)).subscribe(i=oe(r,h=>r.next(e?e(l,h,u,c++):h),()=>{i=null,a()}))},()=>{o=!0,a()}))})}(r=>r?function uS(...t){return om(t,nm(t))}(!1):this.zoneIsStable),function dS(t,e=j){return t=t??fS,q((n,r)=>{let i,s=!0;n.subscribe(oe(r,o=>{const a=e(o);(s||!t(i,a))&&(s=!1,i=a,r.next(o))}))})}(),am()),this._injector=Ct(ii)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(r,i){const s=r instanceof O_;if(!this._injector.get(Zf).done)throw!s&&function Xo(t){const e=at(t)||rn(t)||yn(t);return null!==e&&e.standalone}(r),new me(405,!1);let a;a=s?r:this._injector.get(Dc).resolveComponentFactory(r),this.componentTypes.push(a.componentType);const l=function qN(t){return t.isBoundToModule}(a)?void 0:this._injector.get(es),u=a.create(Or.NULL,[],i||a.selector,l),h=u.location.nativeElement,d=u.injector.get(vw,null);return d?.registerApplication(h),u.onDestroy(()=>{this.detachView(u.hostView),Yc(this.components,u),d?.unregisterApplication(h)}),this._loadComponent(u),u}tick(){if(this._runningTick)throw new me(101,!1);try{this._runningTick=!0;for(let r of this._views)r.detectChanges()}catch(r){this.internalErrorHandler(r)}finally{this._runningTick=!1}}attachView(r){const i=r;this._views.push(i),i.attachToAppRef(this)}detachView(r){const i=r;Yc(this._views,i),i.detachFromAppRef()}_loadComponent(r){this.attachView(r.hostView),this.tick(),this.components.push(r);const i=this._injector.get(ww,[]);i.push(...this._bootstrapListeners),i.forEach(s=>s(r))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(r=>r()),this._views.slice().forEach(r=>r.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(r){return this._destroyListeners.push(r),()=>Yc(this._destroyListeners,r)}destroy(){if(this._destroyed)throw new me(406,!1);const r=this._injector;r.destroy&&!r.destroyed&&r.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}}return(t=e).\u0275fac=function(r){return new(r||t)},t.\u0275prov=Et({token:t,factory:t.\u0275fac,providedIn:"root"}),e})();function Yc(t,e){const n=t.indexOf(e);n>-1&&t.splice(n,1)}const Mw=new We("",{providedIn:"root",factory:()=>Ct(Zi).handleError.bind(void 0)});function tF(){const t=Ct(zt),e=Ct(Zi);return n=>t.runOutsideAngular(()=>e.handleError(n))}let nF=(()=>{var t;class e{constructor(){this.zone=Ct(zt),this.applicationRef=Ct(La)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}}return(t=e).\u0275fac=function(r){return new(r||t)},t.\u0275prov=Et({token:t,factory:t.\u0275fac,providedIn:"root"}),e})();function Rw(t){return[{provide:zt,useFactory:t},{provide:pc,multi:!0,useFactory:()=>{const e=Ct(nF,{optional:!0});return()=>e.initialize()}},{provide:Mw,useFactory:tF},{provide:yw,useFactory:_w}]}function rF(t){return function b_(t){return{\u0275providers:t}}([[],Rw(()=>new zt(function Tw(t){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:t?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:t?.runCoalescing??!1}}(t)))])}let Nw=(()=>{class e{}return e.__NG_ELEMENT_ID__=iF,e})();function iF(t){return function sF(t,e,n){if(ji(t)&&!n){const r=kn(t.index,e);return new xa(r,r)}return 47&t.type?new xa(e[Vt],e):null}(on(),U(),16==(16&t))}let hp=null;function dp(){return hp}class MF{}const ns=new We("DocumentToken");function uE(t){return"server"===t}class xL extends MF{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class Ap extends xL{static makeCurrent(){!function AF(t){hp||(hp=t)}(new Ap)}onAndCancel(e,n,r){return e.addEventListener(n,r),()=>{e.removeEventListener(n,r)}}dispatchEvent(e,n){e.dispatchEvent(n)}remove(e){e.parentNode&&e.parentNode.removeChild(e)}createElement(e,n){return(n=n||this.getDefaultDocument()).createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,n){return"window"===n?window:"document"===n?e:"body"===n?e.body:null}getBaseHref(e){const n=function wL(){return Va=Va||document.querySelector("base"),Va?Va.getAttribute("href"):null}();return null==n?null:function EL(t){hu=hu||document.createElement("a"),hu.setAttribute("href",t);const e=hu.pathname;return"/"===e.charAt(0)?e:`/${e}`}(n)}resetBaseElement(){Va=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return function mO(t,e){e=encodeURIComponent(e);for(const n of t.split(";")){const r=n.indexOf("="),[i,s]=-1==r?[n,""]:[n.slice(0,r),n.slice(r+1)];if(i.trim()===e)return decodeURIComponent(s)}return null}(document.cookie,e)}}let hu,Va=null,DL=(()=>{var t;class e{build(){return new XMLHttpRequest}}return(t=e).\u0275fac=function(r){return new(r||t)},t.\u0275prov=Et({token:t,factory:t.\u0275fac}),e})();const Mp=new We("EventManagerPlugins");let gE=(()=>{var t;class e{constructor(r,i){this._zone=i,this._eventNameToPlugin=new Map,r.forEach(s=>{s.manager=this}),this._plugins=r.slice().reverse()}addEventListener(r,i,s){return this._findPluginFor(i).addEventListener(r,i,s)}getZone(){return this._zone}_findPluginFor(r){let i=this._eventNameToPlugin.get(r);if(i)return i;if(i=this._plugins.find(o=>o.supports(r)),!i)throw new me(5101,!1);return this._eventNameToPlugin.set(r,i),i}}return(t=e).\u0275fac=function(r){return new(r||t)(dt(Mp),dt(zt))},t.\u0275prov=Et({token:t,factory:t.\u0275fac}),e})();class mE{constructor(e){this._doc=e}}const Rp="ng-app-id";let yE=(()=>{var t;class e{constructor(r,i,s,o={}){this.doc=r,this.appId=i,this.nonce=s,this.platformId=o,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=uE(o),this.resetHostNodes()}addStyles(r){for(const i of r)1===this.changeUsageCount(i,1)&&this.onStyleAdded(i)}removeStyles(r){for(const i of r)this.changeUsageCount(i,-1)<=0&&this.onStyleRemoved(i)}ngOnDestroy(){const r=this.styleNodesInDOM;r&&(r.forEach(i=>i.remove()),r.clear());for(const i of this.getAllStyles())this.onStyleRemoved(i);this.resetHostNodes()}addHost(r){this.hostNodes.add(r);for(const i of this.getAllStyles())this.addStyleToHost(r,i)}removeHost(r){this.hostNodes.delete(r)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(r){for(const i of this.hostNodes)this.addStyleToHost(i,r)}onStyleRemoved(r){const i=this.styleRef;i.get(r)?.elements?.forEach(s=>s.remove()),i.delete(r)}collectServerRenderedStyles(){const r=this.doc.head?.querySelectorAll(`style[${Rp}="${this.appId}"]`);if(r?.length){const i=new Map;return r.forEach(s=>{null!=s.textContent&&i.set(s.textContent,s)}),i}return null}changeUsageCount(r,i){const s=this.styleRef;if(s.has(r)){const o=s.get(r);return o.usage+=i,o.usage}return s.set(r,{usage:i,elements:[]}),i}getStyleElement(r,i){const s=this.styleNodesInDOM,o=s?.get(i);if(o?.parentNode===r)return s.delete(i),o.removeAttribute(Rp),o;{const a=this.doc.createElement("style");return this.nonce&&a.setAttribute("nonce",this.nonce),a.textContent=i,this.platformIsServer&&a.setAttribute(Rp,this.appId),a}}addStyleToHost(r,i){const s=this.getStyleElement(r,i);r.appendChild(s);const o=this.styleRef,a=o.get(i)?.elements;a?a.push(s):o.set(i,{elements:[s],usage:1})}resetHostNodes(){const r=this.hostNodes;r.clear(),r.add(this.doc.head)}}return(t=e).\u0275fac=function(r){return new(r||t)(dt(ns),dt(Bd),dt(M_,8),dt(Zs))},t.\u0275prov=Et({token:t,factory:t.\u0275fac}),e})();const Pp={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},Np=/%COMP%/g,IL=new We("RemoveStylesOnCompDestroy",{providedIn:"root",factory:()=>!1});function vE(t,e){return e.map(n=>n.replace(Np,t))}let xE=(()=>{var t;class e{constructor(r,i,s,o,a,l,c,u=null){this.eventManager=r,this.sharedStylesHost=i,this.appId=s,this.removeStylesOnCompDestroy=o,this.doc=a,this.platformId=l,this.ngZone=c,this.nonce=u,this.rendererByCompId=new Map,this.platformIsServer=uE(l),this.defaultRenderer=new Fp(r,a,c,this.platformIsServer)}createRenderer(r,i){if(!r||!i)return this.defaultRenderer;this.platformIsServer&&i.encapsulation===rr.ShadowDom&&(i={...i,encapsulation:rr.Emulated});const s=this.getOrCreateRenderer(r,i);return s instanceof EE?s.applyToHost(r):s instanceof Op&&s.applyStyles(),s}getOrCreateRenderer(r,i){const s=this.rendererByCompId;let o=s.get(i.id);if(!o){const a=this.doc,l=this.ngZone,c=this.eventManager,u=this.sharedStylesHost,h=this.removeStylesOnCompDestroy,d=this.platformIsServer;switch(i.encapsulation){case rr.Emulated:o=new EE(c,u,i,this.appId,h,a,l,d);break;case rr.ShadowDom:return new PL(c,u,r,i,a,l,this.nonce,d);default:o=new Op(c,u,i,h,a,l,d)}s.set(i.id,o)}return o}ngOnDestroy(){this.rendererByCompId.clear()}}return(t=e).\u0275fac=function(r){return new(r||t)(dt(gE),dt(yE),dt(Bd),dt(IL),dt(ns),dt(Zs),dt(zt),dt(M_))},t.\u0275prov=Et({token:t,factory:t.\u0275fac}),e})();class Fp{constructor(e,n,r,i){this.eventManager=e,this.doc=n,this.ngZone=r,this.platformIsServer=i,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(e,n){return n?this.doc.createElementNS(Pp[n]||n,e):this.doc.createElement(e)}createComment(e){return this.doc.createComment(e)}createText(e){return this.doc.createTextNode(e)}appendChild(e,n){(wE(e)?e.content:e).appendChild(n)}insertBefore(e,n,r){e&&(wE(e)?e.content:e).insertBefore(n,r)}removeChild(e,n){e&&e.removeChild(n)}selectRootElement(e,n){let r="string"==typeof e?this.doc.querySelector(e):e;if(!r)throw new me(-5104,!1);return n||(r.textContent=""),r}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,n,r,i){if(i){n=i+":"+n;const s=Pp[i];s?e.setAttributeNS(s,n,r):e.setAttribute(n,r)}else e.setAttribute(n,r)}removeAttribute(e,n,r){if(r){const i=Pp[r];i?e.removeAttributeNS(i,n):e.removeAttribute(`${r}:${n}`)}else e.removeAttribute(n)}addClass(e,n){e.classList.add(n)}removeClass(e,n){e.classList.remove(n)}setStyle(e,n,r,i){i&(bi.DashCase|bi.Important)?e.style.setProperty(n,r,i&bi.Important?"important":""):e.style[n]=r}removeStyle(e,n,r){r&bi.DashCase?e.style.removeProperty(n):e.style[n]=""}setProperty(e,n,r){e[n]=r}setValue(e,n){e.nodeValue=n}listen(e,n,r){if("string"==typeof e&&!(e=dp().getGlobalEventTarget(this.doc,e)))throw new Error(`Unsupported event target ${e} for event ${n}`);return this.eventManager.addEventListener(e,n,this.decoratePreventDefault(r))}decoratePreventDefault(e){return n=>{if("__ngUnwrap__"===n)return e;!1===(this.platformIsServer?this.ngZone.runGuarded(()=>e(n)):e(n))&&n.preventDefault()}}}function wE(t){return"TEMPLATE"===t.tagName&&void 0!==t.content}class PL extends Fp{constructor(e,n,r,i,s,o,a,l){super(e,s,o,l),this.sharedStylesHost=n,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const c=vE(i.id,i.styles);for(const u of c){const h=document.createElement("style");a&&h.setAttribute("nonce",a),h.textContent=u,this.shadowRoot.appendChild(h)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}appendChild(e,n){return super.appendChild(this.nodeOrShadowRoot(e),n)}insertBefore(e,n,r){return super.insertBefore(this.nodeOrShadowRoot(e),n,r)}removeChild(e,n){return super.removeChild(this.nodeOrShadowRoot(e),n)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class Op extends Fp{constructor(e,n,r,i,s,o,a,l){super(e,s,o,a),this.sharedStylesHost=n,this.removeStylesOnCompDestroy=i,this.styles=l?vE(l,r.styles):r.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}}class EE extends Op{constructor(e,n,r,i,s,o,a,l){const c=i+"-"+r.id;super(e,n,r,s,o,a,l,c),this.contentAttr=function AL(t){return"_ngcontent-%COMP%".replace(Np,t)}(c),this.hostAttr=function ML(t){return"_nghost-%COMP%".replace(Np,t)}(c)}applyToHost(e){this.applyStyles(),this.setAttribute(e,this.hostAttr,"")}createElement(e,n){const r=super.createElement(e,n);return super.setAttribute(r,this.contentAttr,""),r}}let NL=(()=>{var t;class e extends mE{constructor(r){super(r)}supports(r){return!0}addEventListener(r,i,s){return r.addEventListener(i,s,!1),()=>this.removeEventListener(r,i,s)}removeEventListener(r,i,s){return r.removeEventListener(i,s)}}return(t=e).\u0275fac=function(r){return new(r||t)(dt(ns))},t.\u0275prov=Et({token:t,factory:t.\u0275fac}),e})();const bE=["alt","control","meta","shift"],FL={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},OL={alt:t=>t.altKey,control:t=>t.ctrlKey,meta:t=>t.metaKey,shift:t=>t.shiftKey};let LL=(()=>{var t;class e extends mE{constructor(r){super(r)}supports(r){return null!=e.parseEventName(r)}addEventListener(r,i,s){const o=e.parseEventName(i),a=e.eventCallback(o.fullKey,s,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>dp().onAndCancel(r,o.domEventName,a))}static parseEventName(r){const i=r.toLowerCase().split("."),s=i.shift();if(0===i.length||"keydown"!==s&&"keyup"!==s)return null;const o=e._normalizeKey(i.pop());let a="",l=i.indexOf("code");if(l>-1&&(i.splice(l,1),a="code."),bE.forEach(u=>{const h=i.indexOf(u);h>-1&&(i.splice(h,1),a+=u+".")}),a+=o,0!=i.length||0===o.length)return null;const c={};return c.domEventName=s,c.fullKey=a,c}static matchEventFullKeyCode(r,i){let s=FL[r.key]||r.key,o="";return i.indexOf("code.")>-1&&(s=r.code,o="code."),!(null==s||!s)&&(s=s.toLowerCase()," "===s?s="space":"."===s&&(s="dot"),bE.forEach(a=>{a!==s&&(0,OL[a])(r)&&(o+=a+".")}),o+=s,o===i)}static eventCallback(r,i,s){return o=>{e.matchEventFullKeyCode(o,r)&&s.runGuarded(()=>i(o))}}static _normalizeKey(r){return"esc"===r?"escape":r}}return(t=e).\u0275fac=function(r){return new(r||t)(dt(ns))},t.\u0275prov=Et({token:t,factory:t.\u0275fac}),e})();function DE(t){return{appProviders:[...jL,...t?.providers??[]],platformProviders:VL}}const VL=[{provide:Zs,useValue:"browser"},{provide:A_,useValue:function kL(){Ap.makeCurrent()},multi:!0},{provide:ns,useFactory:function HL(){return function oI(t){Dd=t}(document),document},deps:[]}],jL=[{provide:Nd,useValue:"root"},{provide:Zi,useFactory:function UL(){return new Zi},deps:[]},{provide:Mp,useClass:NL,multi:!0,deps:[ns,zt,Zs]},{provide:Mp,useClass:LL,multi:!0,deps:[ns]},xE,yE,gE,{provide:B_,useExisting:xE},{provide:class KO{},useClass:DL,deps:[]},[]];typeof window<"u"&&window;var rs=(t=>(t[t.WEBGL_LEGACY=0]="WEBGL_LEGACY",t[t.WEBGL=1]="WEBGL",t[t.WEBGL2=2]="WEBGL2",t))(rs||{}),IE=(t=>(t[t.UNKNOWN=0]="UNKNOWN",t[t.WEBGL=1]="WEBGL",t[t.CANVAS=2]="CANVAS",t))(IE||{}),Bp=(t=>(t[t.COLOR=16384]="COLOR",t[t.DEPTH=256]="DEPTH",t[t.STENCIL=1024]="STENCIL",t))(Bp||{}),Ne=(t=>(t[t.NORMAL=0]="NORMAL",t[t.ADD=1]="ADD",t[t.MULTIPLY=2]="MULTIPLY",t[t.SCREEN=3]="SCREEN",t[t.OVERLAY=4]="OVERLAY",t[t.DARKEN=5]="DARKEN",t[t.LIGHTEN=6]="LIGHTEN",t[t.COLOR_DODGE=7]="COLOR_DODGE",t[t.COLOR_BURN=8]="COLOR_BURN",t[t.HARD_LIGHT=9]="HARD_LIGHT",t[t.SOFT_LIGHT=10]="SOFT_LIGHT",t[t.DIFFERENCE=11]="DIFFERENCE",t[t.EXCLUSION=12]="EXCLUSION",t[t.HUE=13]="HUE",t[t.SATURATION=14]="SATURATION",t[t.COLOR=15]="COLOR",t[t.LUMINOSITY=16]="LUMINOSITY",t[t.NORMAL_NPM=17]="NORMAL_NPM",t[t.ADD_NPM=18]="ADD_NPM",t[t.SCREEN_NPM=19]="SCREEN_NPM",t[t.NONE=20]="NONE",t[t.SRC_OVER=0]="SRC_OVER",t[t.SRC_IN=21]="SRC_IN",t[t.SRC_OUT=22]="SRC_OUT",t[t.SRC_ATOP=23]="SRC_ATOP",t[t.DST_OVER=24]="DST_OVER",t[t.DST_IN=25]="DST_IN",t[t.DST_OUT=26]="DST_OUT",t[t.DST_ATOP=27]="DST_ATOP",t[t.ERASE=26]="ERASE",t[t.SUBTRACT=28]="SUBTRACT",t[t.XOR=29]="XOR",t))(Ne||{}),Vr=(t=>(t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t))(Vr||{}),Q=(t=>(t[t.RGBA=6408]="RGBA",t[t.RGB=6407]="RGB",t[t.RG=33319]="RG",t[t.RED=6403]="RED",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.ALPHA=6406]="ALPHA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t))(Q||{}),_o=(t=>(t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t))(_o||{}),Me=(t=>(t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.BYTE=5120]="BYTE",t[t.SHORT=5122]="SHORT",t[t.INT=5124]="INT",t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.HALF_FLOAT=36193]="HALF_FLOAT",t))(Me||{}),kp=(t=>(t[t.FLOAT=0]="FLOAT",t[t.INT=1]="INT",t[t.UINT=2]="UINT",t))(kp||{}),Gr=(t=>(t[t.NEAREST=0]="NEAREST",t[t.LINEAR=1]="LINEAR",t))(Gr||{}),Ii=(t=>(t[t.CLAMP=33071]="CLAMP",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t))(Ii||{}),jr=(t=>(t[t.OFF=0]="OFF",t[t.POW2=1]="POW2",t[t.ON=2]="ON",t[t.ON_MANUAL=3]="ON_MANUAL",t))(jr||{}),hr=(t=>(t[t.NPM=0]="NPM",t[t.UNPACK=1]="UNPACK",t[t.PMA=2]="PMA",t[t.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",t[t.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",t[t.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",t))(hr||{}),$r=(t=>(t[t.NO=0]="NO",t[t.YES=1]="YES",t[t.AUTO=2]="AUTO",t[t.BLEND=0]="BLEND",t[t.CLEAR=1]="CLEAR",t[t.BLIT=2]="BLIT",t))($r||{}),Up=(t=>(t[t.AUTO=0]="AUTO",t[t.MANUAL=1]="MANUAL",t))(Up||{}),Jn=(t=>(t.LOW="lowp",t.MEDIUM="mediump",t.HIGH="highp",t))(Jn||{}),Qt=(t=>(t[t.NONE=0]="NONE",t[t.SCISSOR=1]="SCISSOR",t[t.STENCIL=2]="STENCIL",t[t.SPRITE=3]="SPRITE",t[t.COLOR=4]="COLOR",t))(Qt||{}),Xt=(t=>(t[t.NONE=0]="NONE",t[t.LOW=2]="LOW",t[t.MEDIUM=4]="MEDIUM",t[t.HIGH=8]="HIGH",t))(Xt||{}),zr=(t=>(t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t))(zr||{});const ue={ADAPTER:{createCanvas:(t,e)=>{const n=document.createElement("canvas");return n.width=t,n.height=e,n},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(t,e)=>fetch(t,e),parseXML:t=>(new DOMParser).parseFromString(t,"text/xml")},RESOLUTION:1,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var Hp=/iPhone/i,AE=/iPod/i,ME=/iPad/i,RE=/\biOS-universal(?:.+)Mac\b/i,Vp=/\bAndroid(?:.+)Mobile\b/i,PE=/Android/i,vo=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,du=/Silk/i,hi=/Windows Phone/i,NE=/\bWindows(?:.+)ARM\b/i,FE=/BlackBerry/i,OE=/BB10/i,LE=/Opera Mini/i,BE=/\b(CriOS|Chrome)(?:.+)Mobile/i,kE=/Mobile(?:.+)Firefox\b/i,UE=function(t){return typeof t<"u"&&"MacIntel"===t.platform&&"number"==typeof t.maxTouchPoints&&t.maxTouchPoints>1&&typeof MSStream>"u"};function HE(t){var e={userAgent:"",platform:"",maxTouchPoints:0};!t&&typeof navigator<"u"?e={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:"string"==typeof t?e.userAgent=t:t&&t.userAgent&&(e={userAgent:t.userAgent,platform:t.platform,maxTouchPoints:t.maxTouchPoints||0});var n=e.userAgent,r=n.split("[FBAN");typeof r[1]<"u"&&(n=r[0]),typeof(r=n.split("Twitter"))[1]<"u"&&(n=r[0]);var i=function KL(t){return function(e){return e.test(t)}}(n),s={apple:{phone:i(Hp)&&!i(hi),ipod:i(AE),tablet:!i(Hp)&&(i(ME)||UE(e))&&!i(hi),universal:i(RE),device:(i(Hp)||i(AE)||i(ME)||i(RE)||UE(e))&&!i(hi)},amazon:{phone:i(vo),tablet:!i(vo)&&i(du),device:i(vo)||i(du)},android:{phone:!i(hi)&&i(vo)||!i(hi)&&i(Vp),tablet:!i(hi)&&!i(vo)&&!i(Vp)&&(i(du)||i(PE)),device:!i(hi)&&(i(vo)||i(du)||i(Vp)||i(PE))||i(/\bokhttp\b/i)},windows:{phone:i(hi),tablet:i(NE),device:i(hi)||i(NE)},other:{blackberry:i(FE),blackberry10:i(OE),opera:i(LE),firefox:i(kE),chrome:i(BE),device:i(FE)||i(OE)||i(LE)||i(kE)||i(BE)},any:!1,phone:!1,tablet:!1};return s.any=s.apple.device||s.android.device||s.windows.device||s.other.device,s.phone=s.apple.phone||s.android.phone||s.windows.phone,s.tablet=s.apple.tablet||s.android.tablet||s.windows.tablet,s}const di=(HE.default??HE)(globalThis.navigator);ue.RETINA_PREFIX=/@([0-9\.]+)x/,ue.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var Ga=re(472),QL=re(145),Gp=re(445);const JL={parse:Gp.Qc,format:Gp.WU,resolve:Gp.DB};function dr(t){if("string"!=typeof t)throw new TypeError(`Path must be a string. Received ${JSON.stringify(t)}`)}function ja(t){return t.split("?")[0].split("#")[0]}const pn={toPosix:t=>function tB(t,e,n){return t.replace(new RegExp(function eB(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}(e),"g"),n)}(t,"\\","/"),isUrl(t){return/^https?:/.test(this.toPosix(t))},isDataUrl:t=>/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(t),hasProtocol(t){return/^[^/:]+:\//.test(this.toPosix(t))},getProtocol(t){dr(t),t=this.toPosix(t);let e="";const n=/^file:\/\/\//.exec(t),r=/^[^/:]+:\/\//.exec(t),i=/^[^/:]+:\//.exec(t);if(n||r||i){const s=n?.[0]||r?.[0]||i?.[0];e=s,t=t.slice(s.length)}return e},toAbsolute(t,e,n){if(this.isDataUrl(t))return t;const r=ja(this.toPosix(e??ue.ADAPTER.getBaseUrl())),i=ja(this.toPosix(n??this.rootname(r)));return dr(t),(t=this.toPosix(t)).startsWith("/")?pn.join(i,t.slice(1)):this.isAbsolute(t)?t:this.join(r,t)},normalize(t){if(dr(t=this.toPosix(t)),0===t.length)return".";let e="";const n=t.startsWith("/");this.hasProtocol(t)&&(e=this.rootname(t),t=t.slice(e.length));const r=t.endsWith("/");return t=function nB(t,e){let n="",r=0,i=-1,s=0,o=-1;for(let a=0;a<=t.length;++a){if(a<t.length)o=t.charCodeAt(a);else{if(47===o)break;o=47}if(47===o){if(i!==a-1&&1!==s)if(i!==a-1&&2===s){if(n.length<2||2!==r||46!==n.charCodeAt(n.length-1)||46!==n.charCodeAt(n.length-2))if(n.length>2){const l=n.lastIndexOf("/");if(l!==n.length-1){-1===l?(n="",r=0):(n=n.slice(0,l),r=n.length-1-n.lastIndexOf("/")),i=a,s=0;continue}}else if(2===n.length||1===n.length){n="",r=0,i=a,s=0;continue}e&&(n.length>0?n+="/..":n="..",r=2)}else n.length>0?n+=`/${t.slice(i+1,a)}`:n=t.slice(i+1,a),r=a-i-1;i=a,s=0}else 46===o&&-1!==s?++s:s=-1}return n}(t,!1),t.length>0&&r&&(t+="/"),n?`/${t}`:e+t},isAbsolute(t){return dr(t),t=this.toPosix(t),!!this.hasProtocol(t)||t.startsWith("/")},join(...t){if(0===t.length)return".";let e;for(let n=0;n<t.length;++n){const r=t[n];dr(r),r.length>0&&(void 0===e?e=r:this.extname(t[n-1]??"")?e+=`/../${r}`:e+=`/${r}`)}return void 0===e?".":this.normalize(e)},dirname(t){if(dr(t),0===t.length)return".";let e=(t=this.toPosix(t)).charCodeAt(0);const n=47===e;let r=-1,i=!0;const s=this.getProtocol(t),o=t;for(let a=(t=t.slice(s.length)).length-1;a>=1;--a)if(e=t.charCodeAt(a),47===e){if(!i){r=a;break}}else i=!1;return-1===r?n?"/":this.isUrl(o)?s+t:s:n&&1===r?"//":s+t.slice(0,r)},rootname(t){dr(t);let e="";if(e=(t=this.toPosix(t)).startsWith("/")?"/":this.getProtocol(t),this.isUrl(t)){const n=t.indexOf("/",e.length);e=-1!==n?t.slice(0,n):t,e.endsWith("/")||(e+="/")}return e},basename(t,e){dr(t),e&&dr(e),t=ja(this.toPosix(t));let s,n=0,r=-1,i=!0;if(void 0!==e&&e.length>0&&e.length<=t.length){if(e.length===t.length&&e===t)return"";let o=e.length-1,a=-1;for(s=t.length-1;s>=0;--s){const l=t.charCodeAt(s);if(47===l){if(!i){n=s+1;break}}else-1===a&&(i=!1,a=s+1),o>=0&&(l===e.charCodeAt(o)?-1==--o&&(r=s):(o=-1,r=a))}return n===r?r=a:-1===r&&(r=t.length),t.slice(n,r)}for(s=t.length-1;s>=0;--s)if(47===t.charCodeAt(s)){if(!i){n=s+1;break}}else-1===r&&(i=!1,r=s+1);return-1===r?"":t.slice(n,r)},extname(t){dr(t);let e=-1,n=0,r=-1,i=!0,s=0;for(let o=(t=ja(this.toPosix(t))).length-1;o>=0;--o){const a=t.charCodeAt(o);if(47!==a)-1===r&&(i=!1,r=o+1),46===a?-1===e?e=o:1!==s&&(s=1):-1!==e&&(s=-1);else if(!i){n=o+1;break}}return-1===e||-1===r||0===s||1===s&&e===r-1&&e===n+1?"":t.slice(e,r)},parse(t){dr(t);const e={root:"",dir:"",base:"",ext:"",name:""};if(0===t.length)return e;let n=(t=ja(this.toPosix(t))).charCodeAt(0);const r=this.isAbsolute(t);let i;e.root=this.rootname(t),i=r||this.hasProtocol(t)?1:0;let o=-1,a=0,l=-1,c=!0,u=t.length-1,h=0;for(;u>=i;--u)if(n=t.charCodeAt(u),47!==n)-1===l&&(c=!1,l=u+1),46===n?-1===o?o=u:1!==h&&(h=1):-1!==o&&(h=-1);else if(!c){a=u+1;break}return-1===o||-1===l||0===h||1===h&&o===l-1&&o===a+1?-1!==l&&(e.base=e.name=t.slice(0===a&&r?1:a,l)):(0===a&&r?(e.name=t.slice(1,o),e.base=t.slice(1,l)):(e.name=t.slice(a,o),e.base=t.slice(a,l)),e.ext=t.slice(o,l)),e.dir=this.dirname(t),e},sep:"/",delimiter:":"},VE={};function Ye(t,e,n=3){if(VE[e])return;let r=(new Error).stack;typeof r>"u"?console.warn("PixiJS Deprecation Warning: ",`${e}\nDeprecated since v${t}`):(r=r.split("\n").splice(n).join("\n"),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${e}\nDeprecated since v${t}`),console.warn(r),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${e}\nDeprecated since v${t}`),console.warn(r))),VE[e]=!0}let jp;var iB={grad:.9,turn:360,rad:360/(2*Math.PI)},fi=function(t){return"string"==typeof t?t.length>0:"number"==typeof t},tn=function(t,e,n){return void 0===e&&(e=0),void 0===n&&(n=Math.pow(10,e)),Math.round(n*t)/n+0},er=function(t,e,n){return void 0===e&&(e=0),void 0===n&&(n=1),t>n?n:t>e?t:e},GE=function(t){return(t=isFinite(t)?t%360:0)>0?t:t+360},jE=function(t){return{r:er(t.r,0,255),g:er(t.g,0,255),b:er(t.b,0,255),a:er(t.a)}},$p=function(t){return{r:tn(t.r),g:tn(t.g),b:tn(t.b),a:tn(t.a,3)}},sB=/^#([0-9a-f]{3,8})$/i,fu=function(t){var e=t.toString(16);return e.length<2?"0"+e:e},$E=function(t){var e=t.r,n=t.g,r=t.b,i=t.a,s=Math.max(e,n,r),o=s-Math.min(e,n,r),a=o?s===e?(n-r)/o:s===n?2+(r-e)/o:4+(e-n)/o:0;return{h:60*(a<0?a+6:a),s:s?o/s*100:0,v:s/255*100,a:i}},zE=function(t){var e=t.h,n=t.s,r=t.v,i=t.a;e=e/360*6,n/=100,r/=100;var s=Math.floor(e),o=r*(1-n),a=r*(1-(e-s)*n),l=r*(1-(1-e+s)*n),c=s%6;return{r:255*[r,a,o,o,l,r][c],g:255*[l,r,r,a,o,o][c],b:255*[o,o,l,r,r,a][c],a:i}},WE=function(t){return{h:GE(t.h),s:er(t.s,0,100),l:er(t.l,0,100),a:er(t.a)}},XE=function(t){return{h:tn(t.h),s:tn(t.s),l:tn(t.l),a:tn(t.a,3)}},YE=function(t){return zE((n=(e=t).s,{h:e.h,s:(n*=((r=e.l)<50?r:100-r)/100)>0?2*n/(r+n)*100:0,v:r+n,a:e.a}));var e,n,r},$a=function(t){return{h:(e=$E(t)).h,s:(i=(200-(n=e.s))*(r=e.v)/100)>0&&i<200?n*r/100/(i<=100?i:200-i)*100:0,l:i/2,a:e.a};var e,n,r,i},oB=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,aB=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,lB=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,cB=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,zp={string:[[function(t){var e=sB.exec(t);return e?(t=e[1]).length<=4?{r:parseInt(t[0]+t[0],16),g:parseInt(t[1]+t[1],16),b:parseInt(t[2]+t[2],16),a:4===t.length?tn(parseInt(t[3]+t[3],16)/255,2):1}:6===t.length||8===t.length?{r:parseInt(t.substr(0,2),16),g:parseInt(t.substr(2,2),16),b:parseInt(t.substr(4,2),16),a:8===t.length?tn(parseInt(t.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(t){var e=lB.exec(t)||cB.exec(t);return e?e[2]!==e[4]||e[4]!==e[6]?null:jE({r:Number(e[1])/(e[2]?100/255:1),g:Number(e[3])/(e[4]?100/255:1),b:Number(e[5])/(e[6]?100/255:1),a:void 0===e[7]?1:Number(e[7])/(e[8]?100:1)}):null},"rgb"],[function(t){var e=oB.exec(t)||aB.exec(t);if(!e)return null;var n,r,i=WE({h:(n=e[1],r=e[2],void 0===r&&(r="deg"),Number(n)*(iB[r]||1)),s:Number(e[3]),l:Number(e[4]),a:void 0===e[5]?1:Number(e[5])/(e[6]?100:1)});return YE(i)},"hsl"]],object:[[function(t){var e=t.r,n=t.g,r=t.b,i=t.a,s=void 0===i?1:i;return fi(e)&&fi(n)&&fi(r)?jE({r:Number(e),g:Number(n),b:Number(r),a:Number(s)}):null},"rgb"],[function(t){var e=t.h,n=t.s,r=t.l,i=t.a,s=void 0===i?1:i;if(!fi(e)||!fi(n)||!fi(r))return null;var o=WE({h:Number(e),s:Number(n),l:Number(r),a:Number(s)});return YE(o)},"hsl"],[function(t){var e=t.h,n=t.s,r=t.v,i=t.a,s=void 0===i?1:i;if(!fi(e)||!fi(n)||!fi(r))return null;var a,o=(a={h:Number(e),s:Number(n),v:Number(r),a:Number(s)},{h:GE(a.h),s:er(a.s,0,100),v:er(a.v,0,100),a:er(a.a)});return zE(o)},"hsv"]]},qE=function(t,e){for(var n=0;n<e.length;n++){var r=e[n][0](t);if(r)return[r,e[n][1]]}return[null,void 0]},Wp=function(t,e){var n=$a(t);return{h:n.h,s:er(n.s+100*e,0,100),l:n.l,a:n.a}},Xp=function(t){return(299*t.r+587*t.g+114*t.b)/1e3/255},KE=function(t,e){var n=$a(t);return{h:n.h,s:n.s,l:er(n.l+100*e,0,100),a:n.a}},pu=function(){function t(e){this.parsed=function(t){return"string"==typeof t?qE(t.trim(),zp.string):"object"==typeof t&&null!==t?qE(t,zp.object):[null,void 0]}(e)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return t.prototype.isValid=function(){return null!==this.parsed},t.prototype.brightness=function(){return tn(Xp(this.rgba),2)},t.prototype.isDark=function(){return Xp(this.rgba)<.5},t.prototype.isLight=function(){return Xp(this.rgba)>=.5},t.prototype.toHex=function(){return n=(e=$p(this.rgba)).r,r=e.g,i=e.b,o=(s=e.a)<1?fu(tn(255*s)):"","#"+fu(n)+fu(r)+fu(i)+o;var e,n,r,i,s,o},t.prototype.toRgb=function(){return $p(this.rgba)},t.prototype.toRgbString=function(){return n=(e=$p(this.rgba)).r,r=e.g,i=e.b,(s=e.a)<1?"rgba("+n+", "+r+", "+i+", "+s+")":"rgb("+n+", "+r+", "+i+")";var e,n,r,i,s},t.prototype.toHsl=function(){return XE($a(this.rgba))},t.prototype.toHslString=function(){return n=(e=XE($a(this.rgba))).h,r=e.s,i=e.l,(s=e.a)<1?"hsla("+n+", "+r+"%, "+i+"%, "+s+")":"hsl("+n+", "+r+"%, "+i+"%)";var e,n,r,i,s},t.prototype.toHsv=function(){return e=$E(this.rgba),{h:tn(e.h),s:tn(e.s),v:tn(e.v),a:tn(e.a,3)};var e},t.prototype.invert=function(){return Wr({r:255-(e=this.rgba).r,g:255-e.g,b:255-e.b,a:e.a});var e},t.prototype.saturate=function(e){return void 0===e&&(e=.1),Wr(Wp(this.rgba,e))},t.prototype.desaturate=function(e){return void 0===e&&(e=.1),Wr(Wp(this.rgba,-e))},t.prototype.grayscale=function(){return Wr(Wp(this.rgba,-1))},t.prototype.lighten=function(e){return void 0===e&&(e=.1),Wr(KE(this.rgba,e))},t.prototype.darken=function(e){return void 0===e&&(e=.1),Wr(KE(this.rgba,-e))},t.prototype.rotate=function(e){return void 0===e&&(e=15),this.hue(this.hue()+e)},t.prototype.alpha=function(e){return"number"==typeof e?Wr({r:(n=this.rgba).r,g:n.g,b:n.b,a:e}):tn(this.rgba.a,3);var n},t.prototype.hue=function(e){var n=$a(this.rgba);return"number"==typeof e?Wr({h:e,s:n.s,l:n.l,a:n.a}):tn(n.h)},t.prototype.isEqual=function(e){return this.toHex()===Wr(e).toHex()},t}(),Wr=function(t){return t instanceof pu?t:new pu(t)},QE=[];[function hB(t,e){var n={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},r={};for(var i in n)r[n[i]]=i;var s={};t.prototype.toName=function(o){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var a,l,c=r[this.toHex()];if(c)return c;if(o?.closest){var u=this.toRgb(),h=1/0,d="black";if(!s.length)for(var f in n)s[f]=new t(n[f]).toRgb();for(var p in n){var g=(a=u,l=s[p],Math.pow(a.r-l.r,2)+Math.pow(a.g-l.g,2)+Math.pow(a.b-l.b,2));g<h&&(h=g,d=p)}return d}},e.string.push([function(o){var a=o.toLowerCase(),l="transparent"===a?"#0000":n[a];return l?new t(l).toRgb():null},"name"])}].forEach(function(e){QE.indexOf(e)<0&&(e(pu,zp),QE.push(e))});const xo=class{constructor(t=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=t}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(t){return this.value=t,this}set value(t){if(t instanceof xo)this._value=this.cloneSource(t._value),this._int=t._int,this._components.set(t._components);else{if(null===t)throw new Error("Cannot set PIXI.Color#value to null");(null===this._value||!this.isSourceEqual(this._value,t))&&(this.normalize(t),this._value=this.cloneSource(t))}}get value(){return this._value}cloneSource(t){return"string"==typeof t||"number"==typeof t||t instanceof Number||null===t?t:Array.isArray(t)||ArrayBuffer.isView(t)?t.slice(0):"object"==typeof t&&null!==t?{...t}:t}isSourceEqual(t,e){const n=typeof t;if(n!==typeof e)return!1;if("number"===n||"string"===n||t instanceof Number)return t===e;if(Array.isArray(t)&&Array.isArray(e)||ArrayBuffer.isView(t)&&ArrayBuffer.isView(e))return t.length===e.length&&t.every((i,s)=>i===e[s]);if(null!==t&&null!==e){const i=Object.keys(t),s=Object.keys(e);return i.length===s.length&&i.every(o=>t[o]===e[o])}return t===e}toRgba(){const[t,e,n,r]=this._components;return{r:t,g:e,b:n,a:r}}toRgb(){const[t,e,n]=this._components;return{r:t,g:e,b:n}}toRgbaString(){const[t,e,n]=this.toUint8RgbArray();return`rgba(${t},${e},${n},${this.alpha})`}toUint8RgbArray(t){const[e,n,r]=this._components;return(t=t??[])[0]=Math.round(255*e),t[1]=Math.round(255*n),t[2]=Math.round(255*r),t}toRgbArray(t){t=t??[];const[e,n,r]=this._components;return t[0]=e,t[1]=n,t[2]=r,t}toNumber(){return this._int}toLittleEndianNumber(){const t=this._int;return(t>>16)+(65280&t)+((255&t)<<16)}multiply(t){const[e,n,r,i]=xo.temp.setValue(t)._components;return this._components[0]*=e,this._components[1]*=n,this._components[2]*=r,this._components[3]*=i,this.refreshInt(),this._value=null,this}premultiply(t,e=!0){return e&&(this._components[0]*=t,this._components[1]*=t,this._components[2]*=t),this._components[3]=t,this.refreshInt(),this._value=null,this}toPremultiplied(t,e=!0){if(1===t)return(255<<24)+this._int;if(0===t)return e?0:this._int;let n=this._int>>16&255,r=this._int>>8&255,i=255&this._int;return e&&(n=n*t+.5|0,r=r*t+.5|0,i=i*t+.5|0),(255*t<<24)+(n<<16)+(r<<8)+i}toHex(){const t=this._int.toString(16);return`#${"000000".substring(0,6-t.length)+t}`}toHexa(){const e=Math.round(255*this._components[3]).toString(16);return this.toHex()+"00".substring(0,2-e.length)+e}setAlpha(t){return this._components[3]=this._clamp(t),this}round(t){const[e,n,r]=this._components;return this._components[0]=Math.round(e*t)/t,this._components[1]=Math.round(n*t)/t,this._components[2]=Math.round(r*t)/t,this.refreshInt(),this._value=null,this}toArray(t){t=t??[];const[e,n,r,i]=this._components;return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t}normalize(t){let e,n,r,i;if(("number"==typeof t||t instanceof Number)&&t>=0&&t<=16777215)e=(t>>16&255)/255,n=(t>>8&255)/255,r=(255&t)/255,i=1;else if((Array.isArray(t)||t instanceof Float32Array)&&t.length>=3&&t.length<=4)t=this._clamp(t),[e,n,r,i=1]=t;else if((t instanceof Uint8Array||t instanceof Uint8ClampedArray)&&t.length>=3&&t.length<=4)t=this._clamp(t,0,255),[e,n,r,i=255]=t,e/=255,n/=255,r/=255,i/=255;else if("string"==typeof t||"object"==typeof t){if("string"==typeof t){const o=xo.HEX_PATTERN.exec(t);o&&(t=`#${o[2]}`)}const s=Wr(t);s.isValid()&&(({r:e,g:n,b:r,a:i}=s.rgba),e/=255,n/=255,r/=255)}if(void 0===e)throw new Error(`Unable to convert color ${t}`);this._components[0]=e,this._components[1]=n,this._components[2]=r,this._components[3]=i,this.refreshInt()}refreshInt(){this._clamp(this._components);const[t,e,n]=this._components;this._int=(255*t<<16)+(255*e<<8)+(255*n|0)}_clamp(t,e=0,n=1){return"number"==typeof t?Math.min(Math.max(t,e),n):(t.forEach((r,i)=>{t[i]=Math.min(Math.max(r,e),n)}),t)}};let ft=xo;ft.shared=new xo,ft.temp=new xo,ft.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;const JE=function pB(){const t=[],e=[];for(let r=0;r<32;r++)t[r]=r,e[r]=r;t[Ne.NORMAL_NPM]=Ne.NORMAL,t[Ne.ADD_NPM]=Ne.ADD,t[Ne.SCREEN_NPM]=Ne.SCREEN,e[Ne.NORMAL]=Ne.NORMAL_NPM,e[Ne.ADD]=Ne.ADD_NPM,e[Ne.SCREEN]=Ne.SCREEN_NPM;const n=[];return n.push(e),n.push(t),n}();function eb(t,e){return JE[e?1:0][t]}function Yp(t){if(4===t.BYTES_PER_ELEMENT)return t instanceof Float32Array?"Float32Array":t instanceof Uint32Array?"Uint32Array":"Int32Array";if(2===t.BYTES_PER_ELEMENT){if(t instanceof Uint16Array)return"Uint16Array"}else if(1===t.BYTES_PER_ELEMENT&&t instanceof Uint8Array)return"Uint8Array";return null}function gu(t){return t+=0===t?1:0,--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,1+(t|=t>>>16)}function tb(t){return!(t&t-1||!t)}function nb(t){let e=(t>65535?1:0)<<4,n=((t>>>=e)>255?1:0)<<3;return e|=n,n=((t>>>=n)>15?1:0)<<2,e|=n,n=((t>>>=n)>3?1:0)<<1,e|=n,e|(t>>>=n)>>1}function wo(t,e,n){const r=t.length;let i;if(e>=r||0===n)return;const s=r-(n=e+n>r?r-e:n);for(i=e;i<s;++i)t[i]=t[i+n];t.length=s}function Ai(t){return 0===t?0:t<0?-1:1}Float32Array,Uint32Array,Int32Array,Uint8Array;let _B=0;function is(){return++_B}const rb=class{constructor(t,e,n,r){this.left=t,this.top=e,this.right=n,this.bottom=r}get width(){return this.right-this.left}get height(){return this.bottom-this.top}isEmpty(){return this.left===this.right||this.top===this.bottom}};let qp=rb;qp.EMPTY=new rb(0,0,0,0);const ib={},Nn=Object.create(null),tr=Object.create(null);class vB{constructor(e,n,r){this._canvas=ue.ADAPTER.createCanvas(),this._context=this._canvas.getContext("2d"),this.resolution=r||ue.RESOLUTION,this.resize(e,n)}clear(){this._checkDestroyed(),this._context.setTransform(1,0,0,1,0,0),this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}resize(e,n){this._checkDestroyed(),this._canvas.width=Math.round(e*this.resolution),this._canvas.height=Math.round(n*this.resolution)}destroy(){this._context=null,this._canvas=null}get width(){return this._checkDestroyed(),this._canvas.width}set width(e){this._checkDestroyed(),this._canvas.width=Math.round(e)}get height(){return this._checkDestroyed(),this._canvas.height}set height(e){this._checkDestroyed(),this._canvas.height=Math.round(e)}get canvas(){return this._checkDestroyed(),this._canvas}get context(){return this._checkDestroyed(),this._context}_checkDestroyed(){if(null===this._canvas)throw new TypeError("The CanvasRenderTarget has already been destroyed")}}function sb(t,e,n){for(let r=0,i=4*n*e;r<e;++r,i+=4)if(0!==t[i+3])return!1;return!0}function ob(t,e,n,r,i){const s=4*e;for(let o=r,a=r*s+4*n;o<=i;++o,a+=s)if(0!==t[a+3])return!1;return!0}let mu;function Mi(t,e=1){const n=ue.RETINA_PREFIX?.exec(t);return n?parseFloat(n[1]):e}var de=(t=>(t.Renderer="renderer",t.Application="application",t.RendererSystem="renderer-webgl-system",t.RendererPlugin="renderer-webgl-plugin",t.CanvasRendererSystem="renderer-canvas-system",t.CanvasRendererPlugin="renderer-canvas-plugin",t.Asset="asset",t.LoadParser="load-parser",t.ResolveParser="resolve-parser",t.CacheParser="cache-parser",t.DetectionParser="detection-parser",t))(de||{});const Zp=t=>{if("function"==typeof t||"object"==typeof t&&t.extension){if(!t.extension)throw new Error("Extension class must have an extension object");t={..."object"!=typeof t.extension?{type:t.extension}:t.extension,ref:t}}if("object"!=typeof t)throw new Error("Invalid extension type");return"string"==typeof(t={...t}).type&&(t.type=[t.type]),t},ab=(t,e)=>Zp(t).priority??e,Se={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...t){return t.map(Zp).forEach(e=>{e.type.forEach(n=>this._removeHandlers[n]?.(e))}),this},add(...t){return t.map(Zp).forEach(e=>{e.type.forEach(n=>{const r=this._addHandlers,i=this._queue;r[n]?r[n](e):(i[n]=i[n]||[],i[n].push(e))})}),this},handle(t,e,n){const r=this._addHandlers,i=this._removeHandlers;if(r[t]||i[t])throw new Error(`Extension type ${t} already has a handler`);r[t]=e,i[t]=n;const s=this._queue;return s[t]&&(s[t].forEach(o=>e(o)),delete s[t]),this},handleByMap(t,e){return this.handle(t,n=>{e[n.name]=n.ref},n=>{delete e[n.name]})},handleByList(t,e,n=-1){return this.handle(t,r=>{e.includes(r.ref)||(e.push(r.ref),e.sort((i,s)=>ab(s,n)-ab(i,n)))},r=>{const i=e.indexOf(r.ref);-1!==i&&e.splice(i,1)})}};class Kp{constructor(e){this.rawBinaryData="number"==typeof e?new ArrayBuffer(e):e instanceof Uint8Array?e.buffer:e,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(e){return this[`${e}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(e){switch(e){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${e} isn't a valid view type`)}}}const bB=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");function DB(t){let e="";for(let n=0;n<t;++n)n>0&&(e+="\nelse "),n<t-1&&(e+=`if(test == ${n}.0){}`);return e}class pi{constructor(){this.data=0,this.blendMode=Ne.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(1&this.data)}set blend(e){!!(1&this.data)!==e&&(this.data^=1)}get offsets(){return!!(2&this.data)}set offsets(e){!!(2&this.data)!==e&&(this.data^=2)}get culling(){return!!(4&this.data)}set culling(e){!!(4&this.data)!==e&&(this.data^=4)}get depthTest(){return!!(8&this.data)}set depthTest(e){!!(8&this.data)!==e&&(this.data^=8)}get depthMask(){return!!(32&this.data)}set depthMask(e){!!(32&this.data)!==e&&(this.data^=32)}get clockwiseFrontFace(){return!!(16&this.data)}set clockwiseFrontFace(e){!!(16&this.data)!==e&&(this.data^=16)}get blendMode(){return this._blendMode}set blendMode(e){this.blend=e!==Ne.NONE,this._blendMode=e}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){this.offsets=!!e,this._polygonOffset=e}toString(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`}static for2d(){const e=new pi;return e.depthTest=!1,e.blend=!0,e}}const ig=[];function lb(t,e){if(!t)return null;let n="";if("string"==typeof t){const r=/\.(\w{3,4})(?:$|\?|#)/i.exec(t);r&&(n=r[1].toLowerCase())}for(let r=ig.length-1;r>=0;--r){const i=ig[r];if(i.test&&i.test(t,n))return new i(t,e)}throw new Error("Unrecognized source type to auto-detect Resource")}class fr{constructor(e){this.items=[],this._name=e,this._aliasCount=0}emit(e,n,r,i,s,o,a,l){if(arguments.length>8)throw new Error("max arguments reached");const{name:c,items:u}=this;this._aliasCount++;for(let h=0,d=u.length;h<d;h++)u[h][c](e,n,r,i,s,o,a,l);return u===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(e){return e[this._name]&&(this.ensureNonAliasedItems(),this.remove(e),this.items.push(e)),this}remove(e){const n=this.items.indexOf(e);return-1!==n&&(this.ensureNonAliasedItems(),this.items.splice(n,1)),this}contains(e){return this.items.includes(e)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return 0===this.items.length}get name(){return this._name}}Object.defineProperties(fr.prototype,{dispatch:{value:fr.prototype.emit},run:{value:fr.prototype.emit}});class za{constructor(e=0,n=0){this._width=e,this._height=n,this.destroyed=!1,this.internal=!1,this.onResize=new fr("setRealSize"),this.onUpdate=new fr("update"),this.onError=new fr("onError")}bind(e){this.onResize.add(e),this.onUpdate.add(e),this.onError.add(e),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(e){this.onResize.remove(e),this.onUpdate.remove(e),this.onError.remove(e)}resize(e,n){(e!==this._width||n!==this._height)&&(this._width=e,this._height=n,this.onResize.emit(e,n))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(e,n,r){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(e,n){return!1}}class Wa extends za{constructor(e,n){const{width:r,height:i}=n||{};if(!r||!i)throw new Error("BufferResource width or height invalid");super(r,i),this.data=e}upload(e,n,r){const i=e.gl;i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.alphaMode===hr.UNPACK);const s=n.realWidth,o=n.realHeight;return r.width===s&&r.height===o?i.texSubImage2D(n.target,0,0,0,s,o,n.format,r.type,this.data):(r.width=s,r.height=o,i.texImage2D(n.target,0,r.internalFormat,s,o,0,n.format,r.type,this.data)),!0}dispose(){this.data=null}static test(e){return e instanceof Float32Array||e instanceof Uint8Array||e instanceof Uint32Array}}const TB={scaleMode:Gr.NEAREST,format:Q.RGBA,alphaMode:hr.NPM},Eo=class extends Ga{constructor(t=null,e=null){super(),e=Object.assign({},Eo.defaultOptions,e);const{alphaMode:n,mipmap:r,anisotropicLevel:i,scaleMode:s,width:o,height:a,wrapMode:l,format:c,type:u,target:h,resolution:d,resourceOptions:f}=e;t&&!(t instanceof za)&&((t=lb(t,f)).internal=!0),this.resolution=d||ue.RESOLUTION,this.width=Math.round((o||0)*this.resolution)/this.resolution,this.height=Math.round((a||0)*this.resolution)/this.resolution,this._mipmap=r,this.anisotropicLevel=i,this._wrapMode=l,this._scaleMode=s,this.format=c,this.type=u,this.target=h,this.alphaMode=n,this.uid=is(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=o>0&&a>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(t)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(t){this._mipmap!==t&&(this._mipmap=t,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(t){this._scaleMode!==t&&(this._scaleMode=t,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(t){this._wrapMode!==t&&(this._wrapMode=t,this.dirtyStyleId++)}setStyle(t,e){let n;return void 0!==t&&t!==this.scaleMode&&(this.scaleMode=t,n=!0),void 0!==e&&e!==this.mipmap&&(this.mipmap=e,n=!0),n&&this.dirtyStyleId++,this}setSize(t,e,n){return this.setRealSize(t*(n=n||this.resolution),e*n,n)}setRealSize(t,e,n){return this.resolution=n||this.resolution,this.width=Math.round(t)/this.resolution,this.height=Math.round(e)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=tb(this.realWidth)&&tb(this.realHeight)}setResolution(t){const e=this.resolution;return e===t||(this.resolution=t,this.valid&&(this.width=Math.round(this.width*e)/t,this.height=Math.round(this.height*e)/t,this.emit("update",this)),this._refreshPOT()),this}setResource(t){if(this.resource===t)return this;if(this.resource)throw new Error("Resource can be set only once");return t.bind(this),this.resource=t,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(t){this.emit("error",this,t)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete tr[this.cacheId],delete Nn[this.cacheId],this.cacheId=null),this.dispose(),Eo.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(t,e,n=ue.STRICT_TEXTURE_CACHE){const r="string"==typeof t;let i=null;r?i=t:(t._pixiId||(t._pixiId=`${e?.pixiIdPrefix||"pixiid"}_${is()}`),i=t._pixiId);let s=tr[i];if(r&&n&&!s)throw new Error(`The cacheId "${i}" does not exist in BaseTextureCache.`);return s||(s=new Eo(t,e),s.cacheId=i,Eo.addToCache(s,i)),s}static fromBuffer(t,e,n,r){t=t||new Float32Array(e*n*4);const i=new Wa(t,{width:e,height:n}),s=t instanceof Float32Array?Me.FLOAT:Me.UNSIGNED_BYTE;return new Eo(i,Object.assign({},TB,{type:s},r))}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),tr[e]&&tr[e]!==t&&console.warn(`BaseTexture added to the cache with an id [${e}] that already had an entry`),tr[e]=t)}static removeFromCache(t){if("string"==typeof t){const e=tr[t];if(e){const n=e.textureCacheIds.indexOf(t);return n>-1&&e.textureCacheIds.splice(n,1),delete tr[t],e}}else if(t?.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)delete tr[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}};let $e=Eo;$e.defaultOptions={mipmap:jr.POW2,anisotropicLevel:0,scaleMode:Gr.LINEAR,wrapMode:Ii.CLAMP,alphaMode:hr.UNPACK,target:_o.TEXTURE_2D,format:Q.RGBA,type:Me.UNSIGNED_BYTE},$e._globalBatch=0;class sg{constructor(){this.texArray=null,this.blend=0,this.type=Vr.TRIANGLES,this.start=0,this.size=0,this.data=null}}let CB=0;class jt{constructor(e,n=!0,r=!1){this.data=e||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=r,this.static=n,this.id=CB++,this.disposeRunner=new fr("disposeBuffer")}update(e){e instanceof Array&&(e=new Float32Array(e)),this.data=e||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(e){this.type=e?zr.ELEMENT_ARRAY_BUFFER:zr.ARRAY_BUFFER}get index(){return this.type===zr.ELEMENT_ARRAY_BUFFER}static from(e){return e instanceof Array&&(e=new Float32Array(e)),new jt(e)}}class yu{constructor(e,n=0,r=!1,i=Me.FLOAT,s,o,a,l=1){this.buffer=e,this.size=n,this.normalized=r,this.type=i,this.stride=s,this.start=o,this.instance=a,this.divisor=l}destroy(){this.buffer=null}static from(e,n,r,i,s){return new yu(e,n,r,i,s)}}const IB={Float32Array,Uint32Array,Int32Array,Uint8Array},cb={5126:4,5123:2,5121:1};let MB=0;const RB={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array};class Ri{constructor(e=[],n={}){this.buffers=e,this.indexBuffer=null,this.attributes=n,this.glVertexArrayObjects={},this.id=MB++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new fr("disposeGeometry"),this.refCount=0}addAttribute(e,n,r=0,i=!1,s,o,a,l=!1){if(!n)throw new Error("You must pass a buffer when creating an attribute");n instanceof jt||(n instanceof Array&&(n=new Float32Array(n)),n=new jt(n));const c=e.split("|");if(c.length>1){for(let h=0;h<c.length;h++)this.addAttribute(c[h],n,r,i,s);return this}let u=this.buffers.indexOf(n);return-1===u&&(this.buffers.push(n),u=this.buffers.length-1),this.attributes[e]=new yu(u,r,i,s,o,a,l),this.instanced=this.instanced||l,this}getAttribute(e){return this.attributes[e]}getBuffer(e){return this.buffers[this.getAttribute(e).buffer]}addIndex(e){return e instanceof jt||(e instanceof Array&&(e=new Uint16Array(e)),e=new jt(e)),e.type=zr.ELEMENT_ARRAY_BUFFER,this.indexBuffer=e,this.buffers.includes(e)||this.buffers.push(e),this}getIndex(){return this.indexBuffer}interleave(){if(1===this.buffers.length||2===this.buffers.length&&this.indexBuffer)return this;const e=[],n=[],r=new jt;let i;for(i in this.attributes){const s=this.attributes[i];e.push(this.buffers[s.buffer].data),n.push(s.size*cb[s.type]/4),s.buffer=0}for(r.data=function AB(t,e){let n=0,r=0;const i={};for(let l=0;l<t.length;l++)r+=e[l],n+=t[l].length;const s=new ArrayBuffer(4*n);let o=null,a=0;for(let l=0;l<t.length;l++){const c=e[l],u=t[l],h=Yp(u);i[h]||(i[h]=new IB[h](s)),o=i[h];for(let d=0;d<u.length;d++)o[(d/c|0)*r+a+d%c]=u[d];a+=c}return new Float32Array(s)}(e,n),i=0;i<this.buffers.length;i++)this.buffers[i]!==this.indexBuffer&&this.buffers[i].destroy();return this.buffers=[r],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const e in this.attributes){const n=this.attributes[e];return this.buffers[n.buffer].data.length/(n.stride/4||n.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const e=new Ri;for(let n=0;n<this.buffers.length;n++)e.buffers[n]=new jt(this.buffers[n].data.slice(0));for(const n in this.attributes){const r=this.attributes[n];e.attributes[n]=new yu(r.buffer,r.size,r.normalized,r.type,r.stride,r.start,r.instance)}return this.indexBuffer&&(e.indexBuffer=e.buffers[this.buffers.indexOf(this.indexBuffer)],e.indexBuffer.type=zr.ELEMENT_ARRAY_BUFFER),e}static merge(e){const n=new Ri,r=[],i=[],s=[];let o;for(let a=0;a<e.length;a++){o=e[a];for(let l=0;l<o.buffers.length;l++)i[l]=i[l]||0,i[l]+=o.buffers[l].data.length,s[l]=0}for(let a=0;a<o.buffers.length;a++)r[a]=new(RB[Yp(o.buffers[a].data)])(i[a]),n.buffers[a]=new jt(r[a]);for(let a=0;a<e.length;a++){o=e[a];for(let l=0;l<o.buffers.length;l++)r[l].set(o.buffers[l].data,s[l]),s[l]+=o.buffers[l].data.length}if(n.attributes=o.attributes,o.indexBuffer){n.indexBuffer=n.buffers[o.buffers.indexOf(o.indexBuffer)],n.indexBuffer.type=zr.ELEMENT_ARRAY_BUFFER;let a=0,l=0,c=0,u=0;for(let h=0;h<o.buffers.length;h++)if(o.buffers[h]!==o.indexBuffer){u=h;break}for(const h in o.attributes){const d=o.attributes[h];(0|d.buffer)===u&&(l+=d.size*cb[d.type]/4)}for(let h=0;h<e.length;h++){const d=e[h].indexBuffer.data;for(let f=0;f<d.length;f++)n.indexBuffer.data[f+c]+=a;a+=e[h].buffers[u].data.length/l,c+=d.length}}return n}}class ub extends Ri{constructor(e=!1){super(),this._buffer=new jt(null,e,!1),this._indexBuffer=new jt(null,e,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,Me.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,Me.FLOAT).addAttribute("aColor",this._buffer,4,!0,Me.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,Me.FLOAT).addIndex(this._indexBuffer)}}const Xa=2*Math.PI,PB=180/Math.PI,NB=Math.PI/180;var an=(t=>(t[t.POLY=0]="POLY",t[t.RECT=1]="RECT",t[t.CIRC=2]="CIRC",t[t.ELIP=3]="ELIP",t[t.RREC=4]="RREC",t))(an||{});class ct{constructor(e=0,n=0){this.x=0,this.y=0,this.x=e,this.y=n}clone(){return new ct(this.x,this.y)}copyFrom(e){return this.set(e.x,e.y),this}copyTo(e){return e.set(this.x,this.y),e}equals(e){return e.x===this.x&&e.y===this.y}set(e=0,n=e){return this.x=e,this.y=n,this}toString(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`}}const _u=[new ct,new ct,new ct,new ct];class nt{constructor(e=0,n=0,r=0,i=0){this.x=Number(e),this.y=Number(n),this.width=Number(r),this.height=Number(i),this.type=an.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new nt(0,0,0,0)}clone(){return new nt(this.x,this.y,this.width,this.height)}copyFrom(e){return this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,this}copyTo(e){return e.x=this.x,e.y=this.y,e.width=this.width,e.height=this.height,e}contains(e,n){return!(this.width<=0||this.height<=0)&&e>=this.x&&e<this.x+this.width&&n>=this.y&&n<this.y+this.height}intersects(e,n){if(!n)return!((this.right>e.right?e.right:this.right)<=(this.x<e.x?e.x:this.x))&&(this.bottom>e.bottom?e.bottom:this.bottom)>(this.y<e.y?e.y:this.y);const r=this.left,i=this.right,s=this.top,o=this.bottom;if(i<=r||o<=s)return!1;const a=_u[0].set(e.left,e.top),l=_u[1].set(e.left,e.bottom),c=_u[2].set(e.right,e.top),u=_u[3].set(e.right,e.bottom);if(c.x<=a.x||l.y<=a.y)return!1;const h=Math.sign(n.a*n.d-n.b*n.c);if(0===h||(n.apply(a,a),n.apply(l,l),n.apply(c,c),n.apply(u,u),Math.max(a.x,l.x,c.x,u.x)<=r||Math.min(a.x,l.x,c.x,u.x)>=i||Math.max(a.y,l.y,c.y,u.y)<=s||Math.min(a.y,l.y,c.y,u.y)>=o))return!1;const d=h*(l.y-a.y),f=h*(a.x-l.x),p=d*r+f*s,g=d*i+f*s,m=d*r+f*o,_=d*i+f*o;if(Math.max(p,g,m,_)<=d*a.x+f*a.y||Math.min(p,g,m,_)>=d*u.x+f*u.y)return!1;const v=h*(a.y-c.y),D=h*(c.x-a.x),A=v*r+D*s,$=v*i+D*s,pe=v*r+D*o,J=v*i+D*o;return!(Math.max(A,$,pe,J)<=v*a.x+D*a.y||Math.min(A,$,pe,J)>=v*u.x+D*u.y)}pad(e=0,n=e){return this.x-=e,this.y-=n,this.width+=2*e,this.height+=2*n,this}fit(e){const n=Math.max(this.x,e.x),r=Math.min(this.x+this.width,e.x+e.width),i=Math.max(this.y,e.y),s=Math.min(this.y+this.height,e.y+e.height);return this.x=n,this.width=Math.max(r-n,0),this.y=i,this.height=Math.max(s-i,0),this}ceil(e=1,n=.001){const r=Math.ceil((this.x+this.width-n)*e)/e,i=Math.ceil((this.y+this.height-n)*e)/e;return this.x=Math.floor((this.x+n)*e)/e,this.y=Math.floor((this.y+n)*e)/e,this.width=r-this.x,this.height=i-this.y,this}enlarge(e){const n=Math.min(this.x,e.x),r=Math.max(this.x+this.width,e.x+e.width),i=Math.min(this.y,e.y),s=Math.max(this.y+this.height,e.y+e.height);return this.x=n,this.width=r-n,this.y=i,this.height=s-i,this}toString(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}class og{constructor(e=0,n=0,r=0){this.x=e,this.y=n,this.radius=r,this.type=an.CIRC}clone(){return new og(this.x,this.y,this.radius)}contains(e,n){if(this.radius<=0)return!1;let i=this.x-e,s=this.y-n;return i*=i,s*=s,i+s<=this.radius*this.radius}getBounds(){return new nt(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)}toString(){return`[@pixi/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`}}class ag{constructor(e=0,n=0,r=0,i=0){this.x=e,this.y=n,this.width=r,this.height=i,this.type=an.ELIP}clone(){return new ag(this.x,this.y,this.width,this.height)}contains(e,n){if(this.width<=0||this.height<=0)return!1;let r=(e-this.x)/this.width,i=(n-this.y)/this.height;return r*=r,i*=i,r+i<=1}getBounds(){return new nt(this.x-this.width,this.y-this.height,this.width,this.height)}toString(){return`[@pixi/math:Ellipse x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}class ss{constructor(...e){let n=Array.isArray(e[0])?e[0]:e;if("number"!=typeof n[0]){const r=[];for(let i=0,s=n.length;i<s;i++)r.push(n[i].x,n[i].y);n=r}this.points=n,this.type=an.POLY,this.closeStroke=!0}clone(){const e=this.points.slice(),n=new ss(e);return n.closeStroke=this.closeStroke,n}contains(e,n){let r=!1;const i=this.points.length/2;for(let s=0,o=i-1;s<i;o=s++){const a=this.points[2*s],l=this.points[2*s+1],u=this.points[2*o+1];l>n!=u>n&&e<(n-l)/(u-l)*(this.points[2*o]-a)+a&&(r=!r)}return r}toString(){return`[@pixi/math:PolygoncloseStroke=${this.closeStroke}points=${this.points.reduce((e,n)=>`${e}, ${n}`,"")}]`}}class lg{constructor(e=0,n=0,r=0,i=0,s=20){this.x=e,this.y=n,this.width=r,this.height=i,this.radius=s,this.type=an.RREC}clone(){return new lg(this.x,this.y,this.width,this.height,this.radius)}contains(e,n){if(this.width<=0||this.height<=0)return!1;if(e>=this.x&&e<=this.x+this.width&&n>=this.y&&n<=this.y+this.height){const r=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(n>=this.y+r&&n<=this.y+this.height-r||e>=this.x+r&&e<=this.x+this.width-r)return!0;let i=e-(this.x+r),s=n-(this.y+r);const o=r*r;if(i*i+s*s<=o||(i=e-(this.x+this.width-r),i*i+s*s<=o)||(s=n-(this.y+this.height-r),i*i+s*s<=o)||(i=e-(this.x+r),i*i+s*s<=o))return!0}return!1}toString(){return`[@pixi/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`}}class Pt{constructor(e=1,n=0,r=0,i=1,s=0,o=0){this.array=null,this.a=e,this.b=n,this.c=r,this.d=i,this.tx=s,this.ty=o}fromArray(e){this.a=e[0],this.b=e[1],this.c=e[3],this.d=e[4],this.tx=e[2],this.ty=e[5]}set(e,n,r,i,s,o){return this.a=e,this.b=n,this.c=r,this.d=i,this.tx=s,this.ty=o,this}toArray(e,n){this.array||(this.array=new Float32Array(9));const r=n||this.array;return e?(r[0]=this.a,r[1]=this.b,r[2]=0,r[3]=this.c,r[4]=this.d,r[5]=0,r[6]=this.tx,r[7]=this.ty,r[8]=1):(r[0]=this.a,r[1]=this.c,r[2]=this.tx,r[3]=this.b,r[4]=this.d,r[5]=this.ty,r[6]=0,r[7]=0,r[8]=1),r}apply(e,n){n=n||new ct;const r=e.x,i=e.y;return n.x=this.a*r+this.c*i+this.tx,n.y=this.b*r+this.d*i+this.ty,n}applyInverse(e,n){n=n||new ct;const r=1/(this.a*this.d+this.c*-this.b),i=e.x,s=e.y;return n.x=this.d*r*i+-this.c*r*s+(this.ty*this.c-this.tx*this.d)*r,n.y=this.a*r*s+-this.b*r*i+(-this.ty*this.a+this.tx*this.b)*r,n}translate(e,n){return this.tx+=e,this.ty+=n,this}scale(e,n){return this.a*=e,this.d*=n,this.c*=e,this.b*=n,this.tx*=e,this.ty*=n,this}rotate(e){const n=Math.cos(e),r=Math.sin(e),i=this.a,s=this.c,o=this.tx;return this.a=i*n-this.b*r,this.b=i*r+this.b*n,this.c=s*n-this.d*r,this.d=s*r+this.d*n,this.tx=o*n-this.ty*r,this.ty=o*r+this.ty*n,this}append(e){const n=this.a,r=this.b,i=this.c,s=this.d;return this.a=e.a*n+e.b*i,this.b=e.a*r+e.b*s,this.c=e.c*n+e.d*i,this.d=e.c*r+e.d*s,this.tx=e.tx*n+e.ty*i+this.tx,this.ty=e.tx*r+e.ty*s+this.ty,this}setTransform(e,n,r,i,s,o,a,l,c){return this.a=Math.cos(a+c)*s,this.b=Math.sin(a+c)*s,this.c=-Math.sin(a-l)*o,this.d=Math.cos(a-l)*o,this.tx=e-(r*this.a+i*this.c),this.ty=n-(r*this.b+i*this.d),this}prepend(e){const n=this.tx;if(1!==e.a||0!==e.b||0!==e.c||1!==e.d){const r=this.a,i=this.c;this.a=r*e.a+this.b*e.c,this.b=r*e.b+this.b*e.d,this.c=i*e.a+this.d*e.c,this.d=i*e.b+this.d*e.d}return this.tx=n*e.a+this.ty*e.c+e.tx,this.ty=n*e.b+this.ty*e.d+e.ty,this}decompose(e){const n=this.a,r=this.b,i=this.c,s=this.d,o=e.pivot,a=-Math.atan2(-i,s),l=Math.atan2(r,n),c=Math.abs(a+l);return c<1e-5||Math.abs(Xa-c)<1e-5?(e.rotation=l,e.skew.x=e.skew.y=0):(e.rotation=0,e.skew.x=a,e.skew.y=l),e.scale.x=Math.sqrt(n*n+r*r),e.scale.y=Math.sqrt(i*i+s*s),e.position.x=this.tx+(o.x*n+o.y*i),e.position.y=this.ty+(o.x*r+o.y*s),e}invert(){const e=this.a,n=this.b,r=this.c,i=this.d,s=this.tx,o=e*i-n*r;return this.a=i/o,this.b=-n/o,this.c=-r/o,this.d=e/o,this.tx=(r*this.ty-i*s)/o,this.ty=-(e*this.ty-n*s)/o,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const e=new Pt;return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e}copyTo(e){return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e}copyFrom(e){return this.a=e.a,this.b=e.b,this.c=e.c,this.d=e.d,this.tx=e.tx,this.ty=e.ty,this}toString(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`}static get IDENTITY(){return new Pt}static get TEMP_MATRIX(){return new Pt}}const os=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],as=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],ls=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],cs=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],cg=[],hb=[],vu=Math.sign;!function FB(){for(let t=0;t<16;t++){const e=[];cg.push(e);for(let n=0;n<16;n++){const r=vu(os[t]*os[n]+ls[t]*as[n]),i=vu(as[t]*os[n]+cs[t]*as[n]),s=vu(os[t]*ls[n]+ls[t]*cs[n]),o=vu(as[t]*ls[n]+cs[t]*cs[n]);for(let a=0;a<16;a++)if(os[a]===r&&as[a]===i&&ls[a]===s&&cs[a]===o){e.push(a);break}}}for(let t=0;t<16;t++){const e=new Pt;e.set(os[t],as[t],ls[t],cs[t],0,0),hb.push(e)}}();const Lt={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:t=>os[t],uY:t=>as[t],vX:t=>ls[t],vY:t=>cs[t],inv:t=>8&t?15&t:7&-t,add:(t,e)=>cg[t][e],sub:(t,e)=>cg[t][Lt.inv(e)],rotate180:t=>4^t,isVertical:t=>2==(3&t),byDirection:(t,e)=>2*Math.abs(t)<=Math.abs(e)?e>=0?Lt.S:Lt.N:2*Math.abs(e)<=Math.abs(t)?t>0?Lt.E:Lt.W:e>0?t>0?Lt.SE:Lt.SW:t>0?Lt.NE:Lt.NW,matrixAppendRotationInv:(t,e,n=0,r=0)=>{const i=hb[Lt.inv(e)];i.tx=n,i.ty=r,t.append(i)}};class Pi{constructor(e,n,r=0,i=0){this._x=r,this._y=i,this.cb=e,this.scope=n}clone(e=this.cb,n=this.scope){return new Pi(e,n,this._x,this._y)}set(e=0,n=e){return(this._x!==e||this._y!==n)&&(this._x=e,this._y=n,this.cb.call(this.scope)),this}copyFrom(e){return(this._x!==e.x||this._y!==e.y)&&(this._x=e.x,this._y=e.y,this.cb.call(this.scope)),this}copyTo(e){return e.set(this._x,this._y),e}equals(e){return e.x===this._x&&e.y===this._y}toString(){return`[@pixi/math:ObservablePoint x=0 y=0 scope=${this.scope}]`}get x(){return this._x}set x(e){this._x!==e&&(this._x=e,this.cb.call(this.scope))}get y(){return this._y}set y(e){this._y!==e&&(this._y=e,this.cb.call(this.scope))}}const db=class{constructor(){this.worldTransform=new Pt,this.localTransform=new Pt,this.position=new Pi(this.onChange,this,0,0),this.scale=new Pi(this.onChange,this,1,1),this.pivot=new Pi(this.onChange,this,0,0),this.skew=new Pi(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}toString(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`}updateLocalTransform(){const t=this.localTransform;this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(t){const e=this.localTransform;if(this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==t._worldID){const n=t.worldTransform,r=this.worldTransform;r.a=e.a*n.a+e.b*n.c,r.b=e.a*n.b+e.b*n.d,r.c=e.c*n.a+e.d*n.c,r.d=e.c*n.b+e.d*n.d,r.tx=e.tx*n.a+e.ty*n.c+n.tx,r.ty=e.tx*n.b+e.ty*n.d+n.ty,this._parentID=t._worldID,this._worldID++}}setFromMatrix(t){t.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(t){this._rotation!==t&&(this._rotation=t,this.updateSkew())}};let ug=db;ug.IDENTITY=new db;const bo=[{test:t=>"float"===t.type&&1===t.size&&!t.isArray,code:t=>`\n            if(uv["${t}"] !== ud["${t}"].value)\n            {\n                ud["${t}"].value = uv["${t}"]\n                gl.uniform1f(ud["${t}"].location, uv["${t}"])\n            }\n            `},{test:(t,e)=>!("sampler2D"!==t.type&&"samplerCube"!==t.type&&"sampler2DArray"!==t.type||1!==t.size||t.isArray||null!=e&&void 0===e.castToBaseTexture),code:t=>`t = syncData.textureCount++;\n\n            renderer.texture.bind(uv["${t}"], t);\n\n            if(ud["${t}"].value !== t)\n            {\n                ud["${t}"].value = t;\n                gl.uniform1i(ud["${t}"].location, t);\n; // eslint-disable-line max-len\n            }`},{test:(t,e)=>"mat3"===t.type&&1===t.size&&!t.isArray&&void 0!==e.a,code:t=>`\n            gl.uniformMatrix3fv(ud["${t}"].location, false, uv["${t}"].toArray(true));\n            `,codeUbo:t=>`\n                var ${t}_matrix = uv.${t}.toArray(true);\n\n                data[offset] = ${t}_matrix[0];\n                data[offset+1] = ${t}_matrix[1];\n                data[offset+2] = ${t}_matrix[2];\n        \n                data[offset + 4] = ${t}_matrix[3];\n                data[offset + 5] = ${t}_matrix[4];\n                data[offset + 6] = ${t}_matrix[5];\n        \n                data[offset + 8] = ${t}_matrix[6];\n                data[offset + 9] = ${t}_matrix[7];\n                data[offset + 10] = ${t}_matrix[8];\n            `},{test:(t,e)=>"vec2"===t.type&&1===t.size&&!t.isArray&&void 0!==e.x,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    gl.uniform2f(ud["${t}"].location, v.x, v.y);\n                }`,codeUbo:t=>`\n                v = uv.${t};\n\n                data[offset] = v.x;\n                data[offset+1] = v.y;\n            `},{test:t=>"vec2"===t.type&&1===t.size&&!t.isArray,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    gl.uniform2f(ud["${t}"].location, v[0], v[1]);\n                }\n            `},{test:(t,e)=>"vec4"===t.type&&1===t.size&&!t.isArray&&void 0!==e.width,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    cv[2] = v.width;\n                    cv[3] = v.height;\n                    gl.uniform4f(ud["${t}"].location, v.x, v.y, v.width, v.height)\n                }`,codeUbo:t=>`\n                    v = uv.${t};\n\n                    data[offset] = v.x;\n                    data[offset+1] = v.y;\n                    data[offset+2] = v.width;\n                    data[offset+3] = v.height;\n                `},{test:(t,e)=>"vec4"===t.type&&1===t.size&&!t.isArray&&void 0!==e.red,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)\n                {\n                    cv[0] = v.red;\n                    cv[1] = v.green;\n                    cv[2] = v.blue;\n                    cv[3] = v.alpha;\n                    gl.uniform4f(ud["${t}"].location, v.red, v.green, v.blue, v.alpha)\n                }`,codeUbo:t=>`\n                    v = uv.${t};\n\n                    data[offset] = v.red;\n                    data[offset+1] = v.green;\n                    data[offset+2] = v.blue;\n                    data[offset+3] = v.alpha;\n                `},{test:(t,e)=>"vec3"===t.type&&1===t.size&&!t.isArray&&void 0!==e.red,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)\n                {\n                    cv[0] = v.red;\n                    cv[1] = v.green;\n                    cv[2] = v.blue;\n    \n                    gl.uniform3f(ud["${t}"].location, v.red, v.green, v.blue)\n                }`,codeUbo:t=>`\n                    v = uv.${t};\n\n                    data[offset] = v.red;\n                    data[offset+1] = v.green;\n                    data[offset+2] = v.blue;\n                `},{test:t=>"vec4"===t.type&&1===t.size&&!t.isArray,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    cv[2] = v[2];\n                    cv[3] = v[3];\n\n                    gl.uniform4f(ud["${t}"].location, v[0], v[1], v[2], v[3])\n                }`}],BB={float:"\n    if (cv !== v)\n    {\n        cu.value = v;\n        gl.uniform1f(location, v);\n    }",vec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2f(location, v[0], v[1])\n    }",vec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3f(location, v[0], v[1], v[2])\n    }",vec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4f(location, v[0], v[1], v[2], v[3]);\n    }",int:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",ivec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2i(location, v[0], v[1]);\n    }",ivec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3i(location, v[0], v[1], v[2]);\n    }",ivec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n    }",uint:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1ui(location, v);\n    }",uvec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2ui(location, v[0], v[1]);\n    }",uvec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3ui(location, v[0], v[1], v[2]);\n    }",uvec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);\n    }",bool:"\n    if (cv !== v)\n    {\n        cu.value = v;\n        gl.uniform1i(location, v);\n    }",bvec2:"\n    if (cv[0] != v[0] || cv[1] != v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2i(location, v[0], v[1]);\n    }",bvec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3i(location, v[0], v[1], v[2]);\n    }",bvec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n    }",mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",samplerCube:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",sampler2DArray:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }"},kB={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"},fb={};let wu,xu=fb;const GB={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function pb(t){return GB[t]}let Eu=null;const gb={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function mb(t,e){if(!Eu){const n=Object.keys(gb);Eu={};for(let r=0;r<n.length;++r){const i=n[r];Eu[t[i]]=gb[i]}}return Eu[e]}function yb(t,e,n){if("precision"!==t.substring(0,9)){let r=e;return e===Jn.HIGH&&n!==Jn.HIGH&&(r=Jn.MEDIUM),`precision ${r} float;\n${t}`}return n!==Jn.HIGH&&"precision highp"===t.substring(0,15)?t.replace("precision highp","precision mediump"):t}let jB=0;const bu={},Do=class{constructor(t,e,n="pixi-shader",r={}){this.extra={},this.id=jB++,this.vertexSrc=t||Do.defaultVertexSrc,this.fragmentSrc=e||Do.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=r,"#version"!==this.vertexSrc.substring(0,8)&&(n=n.replace(/\s+/g,"-"),bu[n]?(bu[n]++,n+=`-${bu[n]}`):bu[n]=1,this.vertexSrc=`#define SHADER_NAME ${n}\n${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${n}\n${this.fragmentSrc}`,this.vertexSrc=yb(this.vertexSrc,Do.defaultVertexPrecision,Jn.HIGH),this.fragmentSrc=yb(this.fragmentSrc,Do.defaultFragmentPrecision,function VB(){if(!wu){wu=Jn.MEDIUM;const t=function HB(){if(xu===fb||xu?.isContextLost()){const t=ue.ADAPTER.createCanvas();let e;ue.PREFER_ENV>=rs.WEBGL2&&(e=t.getContext("webgl2",{})),e||(e=t.getContext("webgl",{})||t.getContext("experimental-webgl",{}),e?e.getExtension("WEBGL_draw_buffers"):e=null),xu=e}return xu}();t&&t.getShaderPrecisionFormat&&(wu=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision?Jn.HIGH:Jn.MEDIUM)}return wu}())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n}\n"}static get defaultFragmentSrc(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor *= texture2D(uSampler, vTextureCoord);\n}"}static from(t,e,n){const r=t+e;let i=ib[r];return i||(ib[r]=i=new Do(t,e,n)),i}};let pr=Do;pr.defaultVertexPrecision=Jn.HIGH,pr.defaultFragmentPrecision=di.apple.device?Jn.HIGH:Jn.MEDIUM;let $B=0;class gr{constructor(e,n,r){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=$B++,this.static=!!n,this.ubo=!!r,e instanceof jt?(this.buffer=e,this.buffer.type=zr.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=e,this.ubo&&(this.buffer=new jt(new Float32Array(1)),this.buffer.type=zr.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(e,n,r){if(this.ubo)throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them");this.uniforms[e]=new gr(n,r)}static from(e,n,r){return new gr(e,n,r)}static uboFrom(e,n){return new gr(e,n??!0,!0)}}class Xr{constructor(e,n){this.uniformBindCount=0,this.program=e,this.uniformGroup=n?n instanceof gr?n:new gr(n):new gr({}),this.disposeRunner=new fr("disposeShader")}checkUniformExists(e,n){if(n.uniforms[e])return!0;for(const r in n.uniforms){const i=n.uniforms[r];if(i.group&&this.checkUniformExists(e,i))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(e,n,r){const i=pr.from(e,n);return new Xr(i,r)}}class zB{constructor(e,n){if(this.vertexSrc=e,this.fragTemplate=n,this.programCache={},this.defaultGroupCache={},!n.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!n.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(e){if(!this.programCache[e]){const r=new Int32Array(e);for(let s=0;s<e;s++)r[s]=s;this.defaultGroupCache[e]=gr.from({uSamplers:r},!0);let i=this.fragTemplate;i=i.replace(/%count%/gi,`${e}`),i=i.replace(/%forloop%/gi,this.generateSampleSrc(e)),this.programCache[e]=new pr(this.vertexSrc,i)}const n={tint:new Float32Array([1,1,1,1]),translationMatrix:new Pt,default:this.defaultGroupCache[e]};return new Xr(this.programCache[e],n)}generateSampleSrc(e){let n="";n+="\n",n+="\n";for(let r=0;r<e;r++)r>0&&(n+="\nelse "),r<e-1&&(n+=`if(vTextureId < ${r}.5)`),n+="\n{",n+=`\n\tcolor = texture2D(uSamplers[${r}], vTextureCoord);`,n+="\n}";return n+="\n",n+="\n",n}}class hg{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let e=0;e<this.count;e++)this.elements[e]=null;this.count=0}}class Du{constructor(e){this.renderer=e}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(e){}}const mr=class extends Du{constructor(t){super(t),this.setShaderGenerator(),this.geometryClass=ub,this.vertexSize=6,this.state=pi.for2d(),this.size=4*mr.defaultBatchSize,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),t.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){return this._defaultMaxTextures=this._defaultMaxTextures??function XB(t){let e=!0;const n=ue.ADAPTER.getNavigator();if(di.tablet||di.phone){if(di.apple.device){const r=n.userAgent.match(/OS (\d+)_(\d+)?/);r&&parseInt(r[1],10)<11&&(e=!1)}if(di.android.device){const r=n.userAgent.match(/Android\s([0-9.]*)/);r&&parseInt(r[1],10)<7&&(e=!1)}}return e?t:4}(32),this._defaultMaxTextures}static set defaultMaxTextures(t){this._defaultMaxTextures=t}static get canUploadSameBuffer(){return this._canUploadSameBuffer=this._canUploadSameBuffer??function WB(){return!di.apple.device}(),this._canUploadSameBuffer}static set canUploadSameBuffer(t){this._canUploadSameBuffer=t}get MAX_TEXTURES(){return Ye("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return"precision highp float;\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform vec4 tint;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vColor = aColor * tint;\n}\n"}static get defaultFragmentTemplate(){return"varying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\nuniform sampler2D uSamplers[%count%];\n\nvoid main(void){\n    vec4 color;\n    %forloop%\n    gl_FragColor = color * vColor;\n}\n"}setShaderGenerator({vertex:t=mr.defaultVertexSrc,fragment:e=mr.defaultFragmentTemplate}={}){this.shaderGenerator=new zB(t,e)}contextChange(){const t=this.renderer.gl;ue.PREFER_ENV===rs.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),mr.defaultMaxTextures),this.maxTextures=function SB(t,e){if(0===t)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const n=e.createShader(e.FRAGMENT_SHADER);for(;;){const r=bB.replace(/%forloop%/gi,DB(t));if(e.shaderSource(n,r),e.compileShader(n),e.getShaderParameter(n,e.COMPILE_STATUS))break;t=t/2|0}return t}(this.maxTextures,t)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:t,_textureArrayPool:e}=mr,n=this.size/4,r=Math.floor(n/this.maxTextures)+1;for(;t.length<n;)t.push(new sg);for(;e.length<r;)e.push(new hg);for(let i=0;i<this.maxTextures;i++)this._tempBoundTextures[i]=null}onPrerender(){this._flushId=0}render(t){t._texture.valid&&(this._vertexCount+t.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=t.vertexData.length/2,this._indexCount+=t.indices.length,this._bufferedTextures[this._bufferSize]=t._texture.baseTexture,this._bufferedElements[this._bufferSize++]=t)}buildTexturesAndDrawCalls(){const{_bufferedTextures:t,maxTextures:e}=this,n=mr._textureArrayPool,r=this.renderer.batch,i=this._tempBoundTextures,s=this.renderer.textureGC.count;let o=++$e._globalBatch,a=0,l=n[0],c=0;r.copyBoundTextures(i,e);for(let u=0;u<this._bufferSize;++u){const h=t[u];t[u]=null,h._batchEnabled!==o&&(l.count>=e&&(r.boundArray(l,i,o,e),this.buildDrawCalls(l,c,u),c=u,l=n[++a],++o),h._batchEnabled=o,h.touched=s,l.elements[l.count++]=h)}l.count>0&&(r.boundArray(l,i,o,e),this.buildDrawCalls(l,c,this._bufferSize),++a,++o);for(let u=0;u<i.length;u++)i[u]=null;$e._globalBatch=o}buildDrawCalls(t,e,n){const{_bufferedElements:r,_attributeBuffer:i,_indexBuffer:s,vertexSize:o}=this,a=mr._drawCallPool;let l=this._dcIndex,c=this._aIndex,u=this._iIndex,h=a[l];h.start=this._iIndex,h.texArray=t;for(let d=e;d<n;++d){const f=r[d],g=JE[f._texture.baseTexture.alphaMode?1:0][f.blendMode];r[d]=null,e<d&&h.blend!==g&&(h.size=u-h.start,e=d,h=a[++l],h.texArray=t,h.start=u),this.packInterleavedGeometry(f,i,s,c,u),c+=f.vertexData.length/2*o,u+=f.indices.length,h.blend=g}e<n&&(h.size=u-h.start,++l),this._dcIndex=l,this._aIndex=c,this._iIndex=u}bindAndClearTexArray(t){const e=this.renderer.texture;for(let n=0;n<t.count;n++)e.bind(t.elements[n],t.ids[n]),t.elements[n]=null;t.count=0}updateGeometry(){const{_packedGeometries:t,_attributeBuffer:e,_indexBuffer:n}=this;mr.canUploadSameBuffer?(t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(n),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,t[this._flushId]=new this.geometryClass),t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(n),this.renderer.geometry.bind(t[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const t=this._dcIndex,{gl:e,state:n}=this.renderer,r=mr._drawCallPool;let i=null;for(let s=0;s<t;s++){const{texArray:o,type:a,size:l,start:c,blend:u}=r[s];i!==o&&(i=o,this.bindAndClearTexArray(o)),this.state.blendMode=u,n.set(this.state),e.drawElements(a,l,e.UNSIGNED_SHORT,2*c)}}flush(){0!==this._vertexCount&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),mr.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]&&this._packedGeometries[t].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(t){const e=gu(Math.ceil(t/8)),n=nb(e),r=8*e;this._aBuffers.length<=n&&(this._iBuffers.length=n+1);let i=this._aBuffers[r];return i||(this._aBuffers[r]=i=new Kp(r*this.vertexSize*4)),i}getIndexBuffer(t){const e=gu(Math.ceil(t/12)),n=nb(e),r=12*e;this._iBuffers.length<=n&&(this._iBuffers.length=n+1);let i=this._iBuffers[n];return i||(this._iBuffers[n]=i=new Uint16Array(r)),i}packInterleavedGeometry(t,e,n,r,i){const{uint32View:s,float32View:o}=e,a=r/this.vertexSize,l=t.uvs,c=t.indices,u=t.vertexData,h=t._texture.baseTexture._batchLocation,d=Math.min(t.worldAlpha,1),f=ft.shared.setValue(t._tintRGB).toPremultiplied(d,t._texture.baseTexture.alphaMode>0);for(let p=0;p<u.length;p+=2)o[r++]=u[p],o[r++]=u[p+1],o[r++]=l[p],o[r++]=l[p+1],s[r++]=f,o[r++]=h;for(let p=0;p<c.length;p++)n[i++]=a+c[p]}};let yr=mr;yr.defaultBatchSize=4096,yr.extension={name:"batch",type:de.RendererPlugin},yr._drawCallPool=[],yr._textureArrayPool=[],Se.add(yr);const Ya=class extends Xr{constructor(t,e,n){super(pr.from(t||Ya.defaultVertexSrc,e||Ya.defaultFragmentSrc),n),this.padding=0,this.resolution=Ya.defaultResolution,this.multisample=Ya.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new pi}apply(t,e,n,r,i){t.applyFilter(this,e,n,r)}get blendMode(){return this.state.blendMode}set blendMode(t){this.state.blendMode=t}get resolution(){return this._resolution}set resolution(t){this._resolution=t}static get defaultVertexSrc(){return"attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n"}static get defaultFragmentSrc(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor = texture2D(uSampler, vTextureCoord);\n}\n"}};let ln=Ya;ln.defaultResolution=1,ln.defaultMultisample=Xt.NONE;class Su{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new ft(0),this.alpha=1}init(e){this.clearBeforeRender=e.clearBeforeRender;const{backgroundColor:n,background:r,backgroundAlpha:i}=e,s=r??n;void 0!==s&&(this.color=s),this.alpha=i}get color(){return this._backgroundColor.value}set color(e){this._backgroundColor.setValue(e)}get alpha(){return this._backgroundColor.alpha}set alpha(e){this._backgroundColor.setAlpha(e)}get backgroundColor(){return this._backgroundColor}destroy(){}}Su.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0},Su.extension={type:[de.RendererSystem,de.CanvasRendererSystem],name:"background"},Se.add(Su);class _b{constructor(e){this.renderer=e,this.emptyRenderer=new Du(e),this.currentRenderer=this.emptyRenderer}setObjectRenderer(e){this.currentRenderer!==e&&(this.currentRenderer.stop(),this.currentRenderer=e,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(e,n){const{boundTextures:r}=this.renderer.texture;for(let i=n-1;i>=0;--i)e[i]=r[i]||null,e[i]&&(e[i]._batchLocation=i)}boundArray(e,n,r,i){const{elements:s,ids:o,count:a}=e;let l=0;for(let c=0;c<a;c++){const u=s[c],h=u._batchLocation;if(h>=0&&h<i&&n[h]===u)o[c]=h;else for(;l<i;){const d=n[l];if(!d||d._batchEnabled!==r||d._batchLocation!==l){o[c]=l,u._batchLocation=l,n[l]=u;break}l++}}}destroy(){this.renderer=null}}_b.extension={type:de.RendererSystem,name:"batch"},Se.add(_b);let vb=0;class Tu{constructor(e){this.renderer=e,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(e){this.gl=e,this.renderer.gl=e,this.renderer.CONTEXT_UID=vb++}init(e){if(e.context)this.initFromContext(e.context);else{const n=this.renderer.background.alpha<1,r=e.premultipliedAlpha;this.preserveDrawingBuffer=e.preserveDrawingBuffer,this.useContextAlpha=e.useContextAlpha,this.powerPreference=e.powerPreference,this.initFromOptions({alpha:n,premultipliedAlpha:r,antialias:e.antialias,stencil:!0,preserveDrawingBuffer:e.preserveDrawingBuffer,powerPreference:e.powerPreference})}}initFromContext(e){this.gl=e,this.validateContext(e),this.renderer.gl=e,this.renderer.CONTEXT_UID=vb++,this.renderer.runners.contextChange.emit(e);const n=this.renderer.view;void 0!==n.addEventListener&&(n.addEventListener("webglcontextlost",this.handleContextLost,!1),n.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(e){const n=this.createContext(this.renderer.view,e);this.initFromContext(n)}createContext(e,n){let r;if(ue.PREFER_ENV>=rs.WEBGL2&&(r=e.getContext("webgl2",n)),r)this.webGLVersion=2;else if(this.webGLVersion=1,r=e.getContext("webgl",n)||e.getContext("experimental-webgl",n),!r)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=r,this.getExtensions(),this.gl}getExtensions(){const{gl:e}=this,n={loseContext:e.getExtension("WEBGL_lose_context"),anisotropicFiltering:e.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),s3tc:e.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:e.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:e.getExtension("WEBGL_compressed_texture_etc"),etc1:e.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:e.getExtension("WEBGL_compressed_texture_atc"),astc:e.getExtension("WEBGL_compressed_texture_astc")};1===this.webGLVersion?Object.assign(this.extensions,n,{drawBuffers:e.getExtension("WEBGL_draw_buffers"),depthTexture:e.getExtension("WEBGL_depth_texture"),vertexArrayObject:e.getExtension("OES_vertex_array_object")||e.getExtension("MOZ_OES_vertex_array_object")||e.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:e.getExtension("OES_element_index_uint"),floatTexture:e.getExtension("OES_texture_float"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),textureHalfFloat:e.getExtension("OES_texture_half_float"),textureHalfFloatLinear:e.getExtension("OES_texture_half_float_linear")}):2===this.webGLVersion&&Object.assign(this.extensions,n,{colorBufferFloat:e.getExtension("EXT_color_buffer_float")})}handleContextLost(e){e.preventDefault(),setTimeout(()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()},0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const e=this.renderer.view;this.renderer=null,void 0!==e.removeEventListener&&(e.removeEventListener("webglcontextlost",this.handleContextLost),e.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(e){const n=e.getContextAttributes(),r="WebGL2RenderingContext"in globalThis&&e instanceof globalThis.WebGL2RenderingContext;r&&(this.webGLVersion=2),n&&!n.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const i=r||!!e.getExtension("OES_element_index_uint");this.supports.uint32Indices=i,i||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}}Tu.defaultOptions={context:null,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default"},Tu.extension={type:de.RendererSystem,name:"context"},Se.add(Tu);class QB extends Wa{upload(e,n,r){const i=e.gl;i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.alphaMode===hr.UNPACK);const s=n.realWidth,o=n.realHeight;return r.width===s&&r.height===o?i.texSubImage2D(n.target,0,0,0,s,o,n.format,r.type,this.data):(r.width=s,r.height=o,i.texImage2D(n.target,0,r.internalFormat,s,o,0,n.format,r.type,this.data)),!0}}class dg{constructor(e,n){this.width=Math.round(e||100),this.height=Math.round(n||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new fr("disposeFramebuffer"),this.multisample=Xt.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(e=0,n){return this.colorTextures[e]=n||new $e(null,{scaleMode:Gr.NEAREST,resolution:1,mipmap:jr.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(e){return this.depthTexture=e||new $e(new QB(null,{width:this.width,height:this.height}),{scaleMode:Gr.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:jr.OFF,format:Q.DEPTH_COMPONENT,type:Me.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(e,n){if(e=Math.round(e),n=Math.round(n),e!==this.width||n!==this.height){this.width=e,this.height=n,this.dirtyId++,this.dirtySize++;for(let r=0;r<this.colorTextures.length;r++){const i=this.colorTextures[r],s=i.resolution;i.setSize(e/s,n/s)}if(this.depthTexture){const r=this.depthTexture.resolution;this.depthTexture.setSize(e/r,n/r)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class xb extends $e{constructor(e={}){"number"==typeof e&&(e={width:arguments[0],height:arguments[1],scaleMode:arguments[2],resolution:arguments[3]}),e.width=e.width||100,e.height=e.height||100,e.multisample??(e.multisample=Xt.NONE),super(null,e),this.mipmap=jr.OFF,this.valid=!0,this._clear=new ft([0,0,0,0]),this.framebuffer=new dg(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=e.multisample,this.maskStack=[],this.filterStack=[{}]}set clearColor(e){this._clear.setValue(e)}get clearColor(){return this._clear.value}get clear(){return this._clear}resize(e,n){this.framebuffer.resize(e*this.resolution,n*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class Ni extends za{constructor(e){super(e.naturalWidth||e.videoWidth||e.width,e.naturalHeight||e.videoHeight||e.height),this.source=e,this.noSubImage=!1}static crossOrigin(e,n,r){void 0!==r||n.startsWith("data:")?!1!==r&&(e.crossOrigin="string"==typeof r?r:"anonymous"):e.crossOrigin=function EB(t,e=globalThis.location){if(t.startsWith("data:"))return"";e=e||globalThis.location,mu||(mu=document.createElement("a")),mu.href=t;const n=JL.parse(mu.href);return n.hostname!==e.hostname||(n.port||""!==e.port)&&n.port!==e.port||n.protocol!==e.protocol?"anonymous":""}(n)}upload(e,n,r,i){const s=e.gl,o=n.realWidth,a=n.realHeight;if(i=i||this.source,typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement){if(!i.complete||0===i.naturalWidth)return!1}else if(typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement&&i.readyState<=1&&0===i.buffered.length)return!1;return s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.alphaMode===hr.UNPACK),this.noSubImage||n.target!==s.TEXTURE_2D||r.width!==o||r.height!==a?(r.width=o,r.height=a,s.texImage2D(n.target,0,r.internalFormat,n.format,r.type,i)):s.texSubImage2D(s.TEXTURE_2D,0,0,0,n.format,r.type,i),!0}update(){if(this.destroyed)return;const e=this.source;this.resize(e.naturalWidth||e.videoWidth||e.width,e.naturalHeight||e.videoHeight||e.height),super.update()}dispose(){this.source=null}}class wb extends Ni{constructor(e,n){if(n=n||{},"string"==typeof e){const r=new Image;Ni.crossOrigin(r,e,n.crossorigin),r.src=e,e=r}super(e),!e.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=e.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(n.createBitmap??ue.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode="number"==typeof n.alphaMode?n.alphaMode:null,this.bitmap=null,this._load=null,!1!==n.autoLoad&&this.load()}load(e){return this._load||(void 0!==e&&(this.createBitmap=e),this._load=new Promise((n,r)=>{const i=this.source;this.url=i.src;const s=()=>{this.destroyed||(i.onload=null,i.onerror=null,this.resize(i.width,i.height),this._load=null,n(this.createBitmap?this.process():this))};i.complete&&i.src?s():(i.onload=s,i.onerror=o=>{r(o),this.onError.emit(o)})})),this._load}process(){const e=this.source;if(null!==this._process)return this._process;if(null!==this.bitmap||!globalThis.createImageBitmap)return Promise.resolve(this);const n=globalThis.createImageBitmap;return this._process=fetch(e.src,{mode:e.crossOrigin&&"anonymous"!==e.crossOrigin?"no-cors":"cors"}).then(i=>i.blob()).then(i=>n(i,0,0,e.width,e.height,{premultiplyAlpha:null===this.alphaMode||this.alphaMode===hr.UNPACK?"premultiply":"none"})).then(i=>this.destroyed?Promise.reject():(this.bitmap=i,this.update(),this._process=null,Promise.resolve(this))),this._process}upload(e,n,r){if("number"==typeof this.alphaMode&&(n.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(e,n,r);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(e,n,r,this.bitmap),!this.preserveBitmap){let i=!0;const s=n._glTextures;for(const o in s){const a=s[o];if(a!==r&&a.dirtyId!==n.dirtyId){i=!1;break}}i&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(e){return typeof HTMLImageElement<"u"&&("string"==typeof e||e instanceof HTMLImageElement)}}class Eb{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(e,n,r){const i=n.width,s=n.height;if(r){const o=e.width/2/i,a=e.height/2/s,l=e.x/i+o,c=e.y/s+a;r=Lt.add(r,Lt.NW),this.x0=l+o*Lt.uX(r),this.y0=c+a*Lt.uY(r),r=Lt.add(r,2),this.x1=l+o*Lt.uX(r),this.y1=c+a*Lt.uY(r),r=Lt.add(r,2),this.x2=l+o*Lt.uX(r),this.y2=c+a*Lt.uY(r),r=Lt.add(r,2),this.x3=l+o*Lt.uX(r),this.y3=c+a*Lt.uY(r)}else this.x0=e.x/i,this.y0=e.y/s,this.x1=(e.x+e.width)/i,this.y1=e.y/s,this.x2=(e.x+e.width)/i,this.y2=(e.y+e.height)/s,this.x3=e.x/i,this.y3=(e.y+e.height)/s;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}toString(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`}}const bb=new Eb;function Cu(t){t.destroy=function(){},t.on=function(){},t.once=function(){},t.emit=function(){}}class ye extends Ga{constructor(e,n,r,i,s,o,a){if(super(),this.noFrame=!1,n||(this.noFrame=!0,n=new nt(0,0,1,1)),e instanceof ye&&(e=e.baseTexture),this.baseTexture=e,this._frame=n,this.trim=i,this.valid=!1,this._uvs=bb,this.uvMatrix=null,this.orig=r||n,this._rotate=Number(s||0),!0===s)this._rotate=2;else if(this._rotate%2!=0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=o?new ct(o.x,o.y):new ct(0,0),this.defaultBorders=a,this._updateID=0,this.textureCacheIds=[],e.valid?this.noFrame?e.valid&&this.onBaseTextureUpdated(e):this.frame=n:e.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&e.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(e){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=e.width,this._frame.height=e.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(e){if(this.baseTexture){if(e){const{resource:n}=this.baseTexture;n?.url&&Nn[n.url]&&ye.removeFromCache(n.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,ye.removeFromCache(this),this.textureCacheIds=null}clone(){const e=this._frame.clone(),n=this._frame===this.orig?e:this.orig.clone(),r=new ye(this.baseTexture,!this.noFrame&&e,n,this.trim?.clone(),this.rotate,this.defaultAnchor,this.defaultBorders);return this.noFrame&&(r._frame=e),r}updateUvs(){this._uvs===bb&&(this._uvs=new Eb),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(e,n={},r=ue.STRICT_TEXTURE_CACHE){const i="string"==typeof e;let s=null;i?s=e:e instanceof $e?(e.cacheId||(e.cacheId=`${n?.pixiIdPrefix||"pixiid"}-${is()}`,$e.addToCache(e,e.cacheId)),s=e.cacheId):(e._pixiId||(e._pixiId=`${n?.pixiIdPrefix||"pixiid"}_${is()}`),s=e._pixiId);let o=Nn[s];if(i&&r&&!o)throw new Error(`The cacheId "${s}" does not exist in TextureCache.`);return o||e instanceof $e?!o&&e instanceof $e&&(o=new ye(e),ye.addToCache(o,s)):(n.resolution||(n.resolution=Mi(e)),o=new ye(new $e(e,n)),o.baseTexture.cacheId=s,$e.addToCache(o.baseTexture,s),ye.addToCache(o,s)),o}static fromURL(e,n){const r=Object.assign({autoLoad:!1},n?.resourceOptions),i=ye.from(e,Object.assign({resourceOptions:r},n),!1),s=i.baseTexture.resource;return i.baseTexture.valid?Promise.resolve(i):s.load().then(()=>Promise.resolve(i))}static fromBuffer(e,n,r,i){return new ye($e.fromBuffer(e,n,r,i))}static fromLoader(e,n,r,i){const s=new $e(e,Object.assign({scaleMode:$e.defaultOptions.scaleMode,resolution:Mi(n)},i)),{resource:o}=s;o instanceof wb&&(o.url=n);const a=new ye(s);return r||(r=n),$e.addToCache(a.baseTexture,r),ye.addToCache(a,r),r!==n&&($e.addToCache(a.baseTexture,n),ye.addToCache(a,n)),a.baseTexture.valid?Promise.resolve(a):new Promise(l=>{a.baseTexture.once("loaded",()=>l(a))})}static addToCache(e,n){n&&(e.textureCacheIds.includes(n)||e.textureCacheIds.push(n),Nn[n]&&Nn[n]!==e&&console.warn(`Texture added to the cache with an id [${n}] that already had an entry`),Nn[n]=e)}static removeFromCache(e){if("string"==typeof e){const n=Nn[e];if(n){const r=n.textureCacheIds.indexOf(e);return r>-1&&n.textureCacheIds.splice(r,1),delete Nn[e],n}}else if(e?.textureCacheIds){for(let n=0;n<e.textureCacheIds.length;++n)Nn[e.textureCacheIds[n]]===e&&delete Nn[e.textureCacheIds[n]];return e.textureCacheIds.length=0,e}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(e){this._frame=e,this.noFrame=!1;const{x:n,y:r,width:i,height:s}=e,o=n+i>this.baseTexture.width,a=r+s>this.baseTexture.height;if(o||a)throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: X: ${n} + ${i} = ${n+i} > ${this.baseTexture.width} ${o&&a?"and":"or"} Y: ${r} + ${s} = ${r+s} > ${this.baseTexture.height}`);this.valid=i&&s&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=e),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(e){this._rotate=e,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return ye._EMPTY||(ye._EMPTY=new ye(new $e),Cu(ye._EMPTY),Cu(ye._EMPTY.baseTexture)),ye._EMPTY}static get WHITE(){if(!ye._WHITE){const e=ue.ADAPTER.createCanvas(16,16),n=e.getContext("2d");e.width=16,e.height=16,n.fillStyle="white",n.fillRect(0,0,16,16),ye._WHITE=new ye($e.from(e)),Cu(ye._WHITE),Cu(ye._WHITE.baseTexture)}return ye._WHITE}}class us extends ye{constructor(e,n){super(e,n),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(e){this.framebuffer.multisample=e}resize(e,n,r=!0){const i=this.baseTexture.resolution,s=Math.round(e*i)/i,o=Math.round(n*i)/i;this.valid=s>0&&o>0,this._frame.width=this.orig.width=s,this._frame.height=this.orig.height=o,r&&this.baseTexture.resize(s,o),this.updateUvs()}setResolution(e){const{baseTexture:n}=this;n.resolution!==e&&(n.setResolution(e),this.resize(n.width,n.height,!1))}static create(e){return new us(new xb(e))}}let JB=(()=>{class t{constructor(n){this.texturePool={},this.textureOptions=n||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(n,r,i=Xt.NONE){const s=new xb(Object.assign({width:n,height:r,resolution:1,multisample:i},this.textureOptions));return new us(s)}getOptimalTexture(n,r,i=1,s=Xt.NONE){let o;n=Math.ceil(n*i-1e-6),r=Math.ceil(r*i-1e-6),this.enableFullScreen&&n===this._pixelsWidth&&r===this._pixelsHeight?o=s>1?-s:-1:(o=((65535&(n=gu(n)))<<16|65535&(r=gu(r)))>>>0,s>1&&(o+=4294967296*s)),this.texturePool[o]||(this.texturePool[o]=[]);let a=this.texturePool[o].pop();return a||(a=this.createTexture(n,r,s)),a.filterPoolKey=o,a.setResolution(i),a}getFilterTexture(n,r,i){const s=this.getOptimalTexture(n.width,n.height,r||n.resolution,i||Xt.NONE);return s.filterFrame=n.filterFrame,s}returnTexture(n){const r=n.filterPoolKey;n.filterFrame=null,this.texturePool[r].push(n)}returnFilterTexture(n){this.returnTexture(n)}clear(n){if(n=!1!==n)for(const r in this.texturePool){const i=this.texturePool[r];if(i)for(let s=0;s<i.length;s++)i[s].destroy(!0)}this.texturePool={}}setScreenSize(n){if(n.width!==this._pixelsWidth||n.height!==this._pixelsHeight){this.enableFullScreen=n.width>0&&n.height>0;for(const r in this.texturePool){if(!(Number(r)<0))continue;const i=this.texturePool[r];if(i)for(let s=0;s<i.length;s++)i[s].destroy(!0);this.texturePool[r]=[]}this._pixelsWidth=n.width,this._pixelsHeight=n.height}}}return t.SCREEN_KEY=-1,t})();class ek extends Ri{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}}class Db extends Ri{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new jt(this.vertices),this.uvBuffer=new jt(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(e,n){let r=0,i=0;return this.uvs[0]=r,this.uvs[1]=i,this.uvs[2]=r+n.width/e.width,this.uvs[3]=i,this.uvs[4]=r+n.width/e.width,this.uvs[5]=i+n.height/e.height,this.uvs[6]=r,this.uvs[7]=i+n.height/e.height,r=n.x,i=n.y,this.vertices[0]=r,this.vertices[1]=i,this.vertices[2]=r+n.width,this.vertices[3]=i,this.vertices[4]=r+n.width,this.vertices[5]=i+n.height,this.vertices[6]=r,this.vertices[7]=i+n.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}class tk{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=Xt.NONE,this.sourceFrame=new nt,this.destinationFrame=new nt,this.bindingSourceFrame=new nt,this.bindingDestinationFrame=new nt,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const Iu=[new ct,new ct,new ct,new ct],fg=new Pt;class Sb{constructor(e){this.renderer=e,this.defaultFilterStack=[{}],this.texturePool=new JB,this.statePool=[],this.quad=new ek,this.quadUv=new Db,this.tempRect=new nt,this.activeState={},this.globalUniforms=new gr({outputFrame:new nt,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(e,n){const r=this.renderer,i=this.defaultFilterStack,s=this.statePool.pop()||new tk,o=this.renderer.renderTexture;let a=n[0].resolution,l=n[0].multisample,c=n[0].padding,u=n[0].autoFit,h=n[0].legacy??!0;for(let p=1;p<n.length;p++){const g=n[p];a=Math.min(a,g.resolution),l=Math.min(l,g.multisample),c=this.useMaxPadding?Math.max(c,g.padding):c+g.padding,u=u&&g.autoFit,h=h||(g.legacy??!0)}1===i.length&&(this.defaultFilterStack[0].renderTexture=o.current),i.push(s),s.resolution=a,s.multisample=l,s.legacy=h,s.target=e,s.sourceFrame.copyFrom(e.filterArea||e.getBounds(!0)),s.sourceFrame.pad(c);const d=this.tempRect.copyFrom(o.sourceFrame);r.projection.transform&&this.transformAABB(fg.copyFrom(r.projection.transform).invert(),d),u?(s.sourceFrame.fit(d),(s.sourceFrame.width<=0||s.sourceFrame.height<=0)&&(s.sourceFrame.width=0,s.sourceFrame.height=0)):s.sourceFrame.intersects(d)||(s.sourceFrame.width=0,s.sourceFrame.height=0),this.roundFrame(s.sourceFrame,o.current?o.current.resolution:r.resolution,o.sourceFrame,o.destinationFrame,r.projection.transform),s.renderTexture=this.getOptimalFilterTexture(s.sourceFrame.width,s.sourceFrame.height,a,l),s.filters=n,s.destinationFrame.width=s.renderTexture.width,s.destinationFrame.height=s.renderTexture.height;const f=this.tempRect;f.x=0,f.y=0,f.width=s.sourceFrame.width,f.height=s.sourceFrame.height,s.renderTexture.filterFrame=s.sourceFrame,s.bindingSourceFrame.copyFrom(o.sourceFrame),s.bindingDestinationFrame.copyFrom(o.destinationFrame),s.transform=r.projection.transform,r.projection.transform=null,o.bind(s.renderTexture,s.sourceFrame,f),r.framebuffer.clear(0,0,0,0)}pop(){const e=this.defaultFilterStack,n=e.pop(),r=n.filters;this.activeState=n;const i=this.globalUniforms.uniforms;i.outputFrame=n.sourceFrame,i.resolution=n.resolution;const s=i.inputSize,o=i.inputPixel,a=i.inputClamp;if(s[0]=n.destinationFrame.width,s[1]=n.destinationFrame.height,s[2]=1/s[0],s[3]=1/s[1],o[0]=Math.round(s[0]*n.resolution),o[1]=Math.round(s[1]*n.resolution),o[2]=1/o[0],o[3]=1/o[1],a[0]=.5*o[2],a[1]=.5*o[3],a[2]=n.sourceFrame.width*s[2]-.5*o[2],a[3]=n.sourceFrame.height*s[3]-.5*o[3],n.legacy){const c=i.filterArea;c[0]=n.destinationFrame.width,c[1]=n.destinationFrame.height,c[2]=n.sourceFrame.x,c[3]=n.sourceFrame.y,i.filterClamp=i.inputClamp}this.globalUniforms.update();const l=e[e.length-1];if(this.renderer.framebuffer.blit(),1===r.length)r[0].apply(this,n.renderTexture,l.renderTexture,$r.BLEND,n),this.returnFilterTexture(n.renderTexture);else{let c=n.renderTexture,u=this.getOptimalFilterTexture(c.width,c.height,n.resolution);u.filterFrame=c.filterFrame;let h=0;for(h=0;h<r.length-1;++h){1===h&&n.multisample>1&&(u=this.getOptimalFilterTexture(c.width,c.height,n.resolution),u.filterFrame=c.filterFrame),r[h].apply(this,c,u,$r.CLEAR,n);const d=c;c=u,u=d}r[h].apply(this,c,l.renderTexture,$r.BLEND,n),h>1&&n.multisample>1&&this.returnFilterTexture(n.renderTexture),this.returnFilterTexture(c),this.returnFilterTexture(u)}n.clear(),this.statePool.push(n)}bindAndClear(e,n=$r.CLEAR){const{renderTexture:r,state:i}=this.renderer;if(this.renderer.projection.transform=e===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.activeState.transform:null,e?.filterFrame){const o=this.tempRect;o.x=0,o.y=0,o.width=e.filterFrame.width,o.height=e.filterFrame.height,r.bind(e,e.filterFrame,o)}else e!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?r.bind(e):this.renderer.renderTexture.bind(e,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);(n===$r.CLEAR||n===$r.BLIT&&(1&i.stateId||this.forceClear))&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(e,n,r,i){const s=this.renderer;s.state.set(e.state),this.bindAndClear(r,i),e.uniforms.uSampler=n,e.uniforms.filterGlobals=this.globalUniforms,s.shader.bind(e),e.legacy=!!e.program.attributeData.aTextureCoord,e.legacy?(this.quadUv.map(n._frame,n.filterFrame),s.geometry.bind(this.quadUv),s.geometry.draw(Vr.TRIANGLES)):(s.geometry.bind(this.quad),s.geometry.draw(Vr.TRIANGLE_STRIP))}calculateSpriteMatrix(e,n){const{sourceFrame:r,destinationFrame:i}=this.activeState,{orig:s}=n._texture,o=e.set(i.width,0,0,i.height,r.x,r.y),a=n.worldTransform.copyTo(Pt.TEMP_MATRIX);return a.invert(),o.prepend(a),o.scale(1/s.width,1/s.height),o.translate(n.anchor.x,n.anchor.y),o}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(e,n,r=1,i=Xt.NONE){return this.texturePool.getOptimalTexture(e,n,r,i)}getFilterTexture(e,n,r){if("number"==typeof e){const s=e;e=n,n=s}const i=this.texturePool.getOptimalTexture((e=e||this.activeState.renderTexture).width,e.height,n||e.resolution,r||Xt.NONE);return i.filterFrame=e.filterFrame,i}returnFilterTexture(e){this.texturePool.returnTexture(e)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(e,n){const r=Iu[0],i=Iu[1],s=Iu[2],o=Iu[3];r.set(n.left,n.top),i.set(n.left,n.bottom),s.set(n.right,n.top),o.set(n.right,n.bottom),e.apply(r,r),e.apply(i,i),e.apply(s,s),e.apply(o,o);const a=Math.min(r.x,i.x,s.x,o.x),l=Math.min(r.y,i.y,s.y,o.y),c=Math.max(r.x,i.x,s.x,o.x),u=Math.max(r.y,i.y,s.y,o.y);n.x=a,n.y=l,n.width=c-a,n.height=u-l}roundFrame(e,n,r,i,s){if(!(e.width<=0||e.height<=0||r.width<=0||r.height<=0)){if(s){const{a:o,b:a,c:l,d:c}=s;if((Math.abs(a)>1e-4||Math.abs(l)>1e-4)&&(Math.abs(o)>1e-4||Math.abs(c)>1e-4))return}(s=s?fg.copyFrom(s):fg.identity()).translate(-r.x,-r.y).scale(i.width/r.width,i.height/r.height).translate(i.x,i.y),this.transformAABB(s,e),e.ceil(n),this.transformAABB(s.invert(),e)}}}Sb.extension={type:de.RendererSystem,name:"filter"},Se.add(Sb);class nk{constructor(e){this.framebuffer=e,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=Xt.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const rk=new nt;class Tb{constructor(e){this.renderer=e,this.managedFramebuffers=[],this.unknownFramebuffer=new dg(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);const e=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new nt,this.hasMRT=!0,this.writeDepthTexture=!0,1===this.renderer.context.webGLVersion){let n=this.renderer.context.extensions.drawBuffers,r=this.renderer.context.extensions.depthTexture;ue.PREFER_ENV===rs.WEBGL_LEGACY&&(n=null,r=null),n?e.drawBuffers=i=>n.drawBuffersWEBGL(i):(this.hasMRT=!1,e.drawBuffers=()=>{}),r||(this.writeDepthTexture=!1)}else this.msaaSamples=e.getInternalformatParameter(e.RENDERBUFFER,e.RGBA8,e.SAMPLES)}bind(e,n,r=0){const{gl:i}=this;if(e){const s=e.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(e);this.current!==e&&(this.current=e,i.bindFramebuffer(i.FRAMEBUFFER,s.framebuffer)),s.mipLevel!==r&&(e.dirtyId++,e.dirtyFormat++,s.mipLevel=r),s.dirtyId!==e.dirtyId&&(s.dirtyId=e.dirtyId,s.dirtyFormat!==e.dirtyFormat?(s.dirtyFormat=e.dirtyFormat,s.dirtySize=e.dirtySize,this.updateFramebuffer(e,r)):s.dirtySize!==e.dirtySize&&(s.dirtySize=e.dirtySize,this.resizeFramebuffer(e)));for(let o=0;o<e.colorTextures.length;o++){const a=e.colorTextures[o];this.renderer.texture.unbind(a.parentTextureArray||a)}if(e.depthTexture&&this.renderer.texture.unbind(e.depthTexture),n){const o=n.width>>r,l=o/n.width;this.setViewport(n.x*l,n.y*l,o,n.height>>r)}else this.setViewport(0,0,e.width>>r,e.height>>r)}else this.current&&(this.current=null,i.bindFramebuffer(i.FRAMEBUFFER,null)),n?this.setViewport(n.x,n.y,n.width,n.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(e,n,r,i){const s=this.viewport;e=Math.round(e),n=Math.round(n),r=Math.round(r),i=Math.round(i),(s.width!==r||s.height!==i||s.x!==e||s.y!==n)&&(s.x=e,s.y=n,s.width=r,s.height=i,this.gl.viewport(e,n,r,i))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(e,n,r,i,s=Bp.COLOR|Bp.DEPTH){const{gl:o}=this;o.clearColor(e,n,r,i),o.clear(s)}initFramebuffer(e){const{gl:n}=this,r=new nk(n.createFramebuffer());return r.multisample=this.detectSamples(e.multisample),e.glFramebuffers[this.CONTEXT_UID]=r,this.managedFramebuffers.push(e),e.disposeRunner.add(this),r}resizeFramebuffer(e){const{gl:n}=this,r=e.glFramebuffers[this.CONTEXT_UID];r.stencil&&(n.bindRenderbuffer(n.RENDERBUFFER,r.stencil),r.msaaBuffer?n.renderbufferStorageMultisample(n.RENDERBUFFER,r.multisample,n.DEPTH24_STENCIL8,e.width,e.height):n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_STENCIL,e.width,e.height));const i=e.colorTextures;let s=i.length;n.drawBuffers||(s=Math.min(s,1));for(let o=0;o<s;o++){const a=i[o],l=a.parentTextureArray||a;this.renderer.texture.bind(l,0),0===o&&r.msaaBuffer&&(n.bindRenderbuffer(n.RENDERBUFFER,r.msaaBuffer),n.renderbufferStorageMultisample(n.RENDERBUFFER,r.multisample,l._glTextures[this.CONTEXT_UID].internalFormat,e.width,e.height))}e.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(e.depthTexture,0)}updateFramebuffer(e,n){const{gl:r}=this,i=e.glFramebuffers[this.CONTEXT_UID],s=e.colorTextures;let o=s.length;r.drawBuffers||(o=Math.min(o,1)),i.multisample>1&&this.canMultisampleFramebuffer(e)?i.msaaBuffer=i.msaaBuffer||r.createRenderbuffer():i.msaaBuffer&&(r.deleteRenderbuffer(i.msaaBuffer),i.msaaBuffer=null,i.blitFramebuffer&&(i.blitFramebuffer.dispose(),i.blitFramebuffer=null));const a=[];for(let l=0;l<o;l++){const c=s[l],u=c.parentTextureArray||c;this.renderer.texture.bind(u,0),0===l&&i.msaaBuffer?(r.bindRenderbuffer(r.RENDERBUFFER,i.msaaBuffer),r.renderbufferStorageMultisample(r.RENDERBUFFER,i.multisample,u._glTextures[this.CONTEXT_UID].internalFormat,e.width,e.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,i.msaaBuffer)):(r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+l,c.target,u._glTextures[this.CONTEXT_UID].texture,n),a.push(r.COLOR_ATTACHMENT0+l))}if(a.length>1&&r.drawBuffers(a),e.depthTexture&&this.writeDepthTexture){const c=e.depthTexture;this.renderer.texture.bind(c,0),r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,c._glTextures[this.CONTEXT_UID].texture,n)}!e.stencil&&!e.depth||e.depthTexture&&this.writeDepthTexture?i.stencil&&(r.deleteRenderbuffer(i.stencil),i.stencil=null):(i.stencil=i.stencil||r.createRenderbuffer(),r.bindRenderbuffer(r.RENDERBUFFER,i.stencil),i.msaaBuffer?r.renderbufferStorageMultisample(r.RENDERBUFFER,i.multisample,r.DEPTH24_STENCIL8,e.width,e.height):r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_STENCIL,e.width,e.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,i.stencil))}canMultisampleFramebuffer(e){return 1!==this.renderer.context.webGLVersion&&e.colorTextures.length<=1&&!e.depthTexture}detectSamples(e){const{msaaSamples:n}=this;let r=Xt.NONE;if(e<=1||null===n)return r;for(let i=0;i<n.length;i++)if(n[i]<=e){r=n[i];break}return 1===r&&(r=Xt.NONE),r}blit(e,n,r){const{current:i,renderer:s,gl:o,CONTEXT_UID:a}=this;if(2!==s.context.webGLVersion||!i)return;const l=i.glFramebuffers[a];if(!l)return;if(!e){if(!l.msaaBuffer)return;const u=i.colorTextures[0];if(!u)return;l.blitFramebuffer||(l.blitFramebuffer=new dg(i.width,i.height),l.blitFramebuffer.addColorTexture(0,u)),(e=l.blitFramebuffer).colorTextures[0]!==u&&(e.colorTextures[0]=u,e.dirtyId++,e.dirtyFormat++),(e.width!==i.width||e.height!==i.height)&&(e.width=i.width,e.height=i.height,e.dirtyId++,e.dirtySize++)}n||((n=rk).width=i.width,n.height=i.height),r||(r=n);const c=n.width===r.width&&n.height===r.height;this.bind(e),o.bindFramebuffer(o.READ_FRAMEBUFFER,l.framebuffer),o.blitFramebuffer(n.left,n.top,n.right,n.bottom,r.left,r.top,r.right,r.bottom,o.COLOR_BUFFER_BIT,c?o.NEAREST:o.LINEAR),o.bindFramebuffer(o.READ_FRAMEBUFFER,e.glFramebuffers[this.CONTEXT_UID].framebuffer)}disposeFramebuffer(e,n){const r=e.glFramebuffers[this.CONTEXT_UID],i=this.gl;if(!r)return;delete e.glFramebuffers[this.CONTEXT_UID];const s=this.managedFramebuffers.indexOf(e);s>=0&&this.managedFramebuffers.splice(s,1),e.disposeRunner.remove(this),n||(i.deleteFramebuffer(r.framebuffer),r.msaaBuffer&&i.deleteRenderbuffer(r.msaaBuffer),r.stencil&&i.deleteRenderbuffer(r.stencil)),r.blitFramebuffer&&this.disposeFramebuffer(r.blitFramebuffer,n)}disposeAll(e){const n=this.managedFramebuffers;this.managedFramebuffers=[];for(let r=0;r<n.length;r++)this.disposeFramebuffer(n[r],e)}forceStencil(){const e=this.current;if(!e)return;const n=e.glFramebuffers[this.CONTEXT_UID];if(!n||n.stencil)return;e.stencil=!0;const r=e.width,i=e.height,s=this.gl,o=s.createRenderbuffer();s.bindRenderbuffer(s.RENDERBUFFER,o),n.msaaBuffer?s.renderbufferStorageMultisample(s.RENDERBUFFER,n.multisample,s.DEPTH24_STENCIL8,r,i):s.renderbufferStorage(s.RENDERBUFFER,s.DEPTH_STENCIL,r,i),n.stencil=o,s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,o)}reset(){this.current=this.unknownFramebuffer,this.viewport=new nt}destroy(){this.renderer=null}}Tb.extension={type:de.RendererSystem,name:"framebuffer"},Se.add(Tb);const pg={5126:4,5123:2,5121:1};class Cb{constructor(e){this.renderer=e,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const e=this.gl=this.renderer.gl,n=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,2!==n.webGLVersion){let r=this.renderer.context.extensions.vertexArrayObject;ue.PREFER_ENV===rs.WEBGL_LEGACY&&(r=null),r?(e.createVertexArray=()=>r.createVertexArrayOES(),e.bindVertexArray=i=>r.bindVertexArrayOES(i),e.deleteVertexArray=i=>r.deleteVertexArrayOES(i)):(this.hasVao=!1,e.createVertexArray=()=>null,e.bindVertexArray=()=>null,e.deleteVertexArray=()=>null)}if(2!==n.webGLVersion){const r=e.getExtension("ANGLE_instanced_arrays");r?(e.vertexAttribDivisor=(i,s)=>r.vertexAttribDivisorANGLE(i,s),e.drawElementsInstanced=(i,s,o,a,l)=>r.drawElementsInstancedANGLE(i,s,o,a,l),e.drawArraysInstanced=(i,s,o,a)=>r.drawArraysInstancedANGLE(i,s,o,a)):this.hasInstance=!1}this.canUseUInt32ElementIndex=2===n.webGLVersion||!!n.extensions.uint32ElementIndex}bind(e,n){n=n||this.renderer.shader.shader;const{gl:r}=this;let i=e.glVertexArrayObjects[this.CONTEXT_UID],s=!1;i||(this.managedGeometries[e.id]=e,e.disposeRunner.add(this),e.glVertexArrayObjects[this.CONTEXT_UID]=i={},s=!0);const o=i[n.program.id]||this.initGeometryVao(e,n,s);this._activeGeometry=e,this._activeVao!==o&&(this._activeVao=o,this.hasVao?r.bindVertexArray(o):this.activateVao(e,n.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const e=this._activeGeometry,n=this.renderer.buffer;for(let r=0;r<e.buffers.length;r++)n.update(e.buffers[r])}checkCompatibility(e,n){const r=e.attributes,i=n.attributeData;for(const s in i)if(!r[s])throw new Error(`shader and geometry incompatible, geometry missing the "${s}" attribute`)}getSignature(e,n){const r=e.attributes,i=n.attributeData,s=["g",e.id];for(const o in r)i[o]&&s.push(o,i[o].location);return s.join("-")}initGeometryVao(e,n,r=!0){const i=this.gl,s=this.CONTEXT_UID,o=this.renderer.buffer,a=n.program;a.glPrograms[s]||this.renderer.shader.generateProgram(n),this.checkCompatibility(e,a);const l=this.getSignature(e,a),c=e.glVertexArrayObjects[this.CONTEXT_UID];let u=c[l];if(u)return c[a.id]=u,u;const h=e.buffers,d=e.attributes,f={},p={};for(const g in h)f[g]=0,p[g]=0;for(const g in d)!d[g].size&&a.attributeData[g]?d[g].size=a.attributeData[g].size:d[g].size||console.warn(`PIXI Geometry attribute '${g}' size cannot be determined (likely the bound shader does not have the attribute)`),f[d[g].buffer]+=d[g].size*pg[d[g].type];for(const g in d){const m=d[g],_=m.size;void 0===m.stride&&(m.stride=f[m.buffer]===_*pg[m.type]?0:f[m.buffer]),void 0===m.start&&(m.start=p[m.buffer],p[m.buffer]+=_*pg[m.type])}u=i.createVertexArray(),i.bindVertexArray(u);for(let g=0;g<h.length;g++){const m=h[g];o.bind(m),r&&m._glBuffers[s].refCount++}return this.activateVao(e,a),c[a.id]=u,c[l]=u,i.bindVertexArray(null),o.unbind(zr.ARRAY_BUFFER),u}disposeGeometry(e,n){if(!this.managedGeometries[e.id])return;delete this.managedGeometries[e.id];const r=e.glVertexArrayObjects[this.CONTEXT_UID],i=this.gl,s=e.buffers,o=this.renderer?.buffer;if(e.disposeRunner.remove(this),r){if(o)for(let a=0;a<s.length;a++){const l=s[a]._glBuffers[this.CONTEXT_UID];l&&(l.refCount--,0===l.refCount&&!n&&o.dispose(s[a],n))}if(!n)for(const a in r)if("g"===a[0]){const l=r[a];this._activeVao===l&&this.unbind(),i.deleteVertexArray(l)}delete e.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(e){const n=Object.keys(this.managedGeometries);for(let r=0;r<n.length;r++)this.disposeGeometry(this.managedGeometries[n[r]],e)}activateVao(e,n){const r=this.gl,i=this.CONTEXT_UID,s=this.renderer.buffer,o=e.buffers,a=e.attributes;e.indexBuffer&&s.bind(e.indexBuffer);let l=null;for(const c in a){const u=a[c],h=o[u.buffer],d=h._glBuffers[i];if(n.attributeData[c]){l!==d&&(s.bind(h),l=d);const f=n.attributeData[c].location;if(r.enableVertexAttribArray(f),r.vertexAttribPointer(f,u.size,u.type||r.FLOAT,u.normalized,u.stride,u.start),u.instance){if(!this.hasInstance)throw new Error("geometry error, GPU Instancing is not supported on this device");r.vertexAttribDivisor(f,u.divisor)}}}}draw(e,n,r,i){const{gl:s}=this,o=this._activeGeometry;if(o.indexBuffer){const a=o.indexBuffer.data.BYTES_PER_ELEMENT,l=2===a?s.UNSIGNED_SHORT:s.UNSIGNED_INT;2===a||4===a&&this.canUseUInt32ElementIndex?o.instanced?s.drawElementsInstanced(e,n||o.indexBuffer.data.length,l,(r||0)*a,i||1):s.drawElements(e,n||o.indexBuffer.data.length,l,(r||0)*a):console.warn("unsupported index buffer type: uint32")}else o.instanced?s.drawArraysInstanced(e,r,n||o.getSize(),i||1):s.drawArrays(e,r,n||o.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}Cb.extension={type:de.RendererSystem,name:"geometry"},Se.add(Cb);const Ib=new Pt;class Ab{constructor(e,n){this._texture=e,this.mapCoord=new Pt,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof n>"u"?.5:n,this.isSimple=!1}get texture(){return this._texture}set texture(e){this._texture=e,this._textureID=-1}multiplyUvs(e,n){void 0===n&&(n=e);const r=this.mapCoord;for(let i=0;i<e.length;i+=2){const s=e[i],o=e[i+1];n[i]=s*r.a+o*r.c+r.tx,n[i+1]=s*r.b+o*r.d+r.ty}return n}update(e){const n=this._texture;if(!n||!n.valid||!e&&this._textureID===n._updateID)return!1;this._textureID=n._updateID,this._updateID++;const r=n._uvs;this.mapCoord.set(r.x1-r.x0,r.y1-r.y0,r.x3-r.x0,r.y3-r.y0,r.x0,r.y0);const i=n.orig,s=n.trim;s&&(Ib.set(i.width/s.width,0,0,i.height/s.height,-s.x/s.width,-s.y/s.height),this.mapCoord.append(Ib));const o=n.baseTexture,a=this.uClampFrame,l=this.clampMargin/o.resolution,c=this.clampOffset;return a[0]=(n._frame.x+l+c)/o.width,a[1]=(n._frame.y+l+c)/o.height,a[2]=(n._frame.x+n._frame.width-l+c)/o.width,a[3]=(n._frame.y+n._frame.height-l+c)/o.height,this.uClampOffset[0]=c/o.realWidth,this.uClampOffset[1]=c/o.realHeight,this.isSimple=n._frame.width===o.width&&n._frame.height===o.height&&0===n.rotate,!0}}class ok extends ln{constructor(e,n,r){let i=null;"string"!=typeof e&&void 0===n&&void 0===r&&(i=e,e=void 0,n=void 0,r=void 0),super(e||"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n}\n",n||"varying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D mask;\nuniform float alpha;\nuniform float npmAlpha;\nuniform vec4 maskClamp;\n\nvoid main(void)\n{\n    float clip = step(3.5,\n        step(maskClamp.x, vMaskCoord.x) +\n        step(maskClamp.y, vMaskCoord.y) +\n        step(vMaskCoord.x, maskClamp.z) +\n        step(vMaskCoord.y, maskClamp.w));\n\n    vec4 original = texture2D(uSampler, vTextureCoord);\n    vec4 masky = texture2D(mask, vMaskCoord);\n    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);\n\n    original *= (alphaMul * masky.r * alpha * clip);\n\n    gl_FragColor = original;\n}\n",r),this.maskSprite=i,this.maskMatrix=new Pt}get maskSprite(){return this._maskSprite}set maskSprite(e){this._maskSprite=e,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(e,n,r,i){const s=this._maskSprite,o=s._texture;o.valid&&(o.uvMatrix||(o.uvMatrix=new Ab(o,0)),o.uvMatrix.update(),this.uniforms.npmAlpha=o.baseTexture.alphaMode?0:1,this.uniforms.mask=o,this.uniforms.otherMatrix=e.calculateSpriteMatrix(this.maskMatrix,s).prepend(o.uvMatrix.mapCoord),this.uniforms.alpha=s.worldAlpha,this.uniforms.maskClamp=o.uvMatrix.uClampFrame,e.applyFilter(this,n,r,i))}}class ak{constructor(e=null){this.type=Qt.NONE,this.autoDetect=!0,this.maskObject=e||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=ln.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(e){e?this._filters?this._filters[0]=e:this._filters=[e]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=Qt.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(e){e?(this._stencilCounter=e._stencilCounter,this._scissorCounter=e._scissorCounter,this._scissorRect=e._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}class Mb{constructor(e){this.renderer=e,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(e){this.maskStack=e,this.renderer.scissor.setMaskStack(e),this.renderer.stencil.setMaskStack(e)}push(e,n){let r=n;if(!r.isMaskData){const s=this.maskDataPool.pop()||new ak;s.pooled=!0,s.maskObject=n,r=s}const i=0!==this.maskStack.length?this.maskStack[this.maskStack.length-1]:null;if(r.copyCountersOrReset(i),r._colorMask=i?i._colorMask:15,r.autoDetect&&this.detect(r),r._target=e,r.type!==Qt.SPRITE&&this.maskStack.push(r),r.enabled)switch(r.type){case Qt.SCISSOR:this.renderer.scissor.push(r);break;case Qt.STENCIL:this.renderer.stencil.push(r);break;case Qt.SPRITE:r.copyCountersOrReset(null),this.pushSpriteMask(r);break;case Qt.COLOR:this.pushColorMask(r)}r.type===Qt.SPRITE&&this.maskStack.push(r)}pop(e){const n=this.maskStack.pop();if(n&&n._target===e){if(n.enabled)switch(n.type){case Qt.SCISSOR:this.renderer.scissor.pop(n);break;case Qt.STENCIL:this.renderer.stencil.pop(n.maskObject);break;case Qt.SPRITE:this.popSpriteMask(n);break;case Qt.COLOR:this.popColorMask(n)}if(n.reset(),n.pooled&&this.maskDataPool.push(n),0!==this.maskStack.length){const r=this.maskStack[this.maskStack.length-1];r.type===Qt.SPRITE&&r._filters&&(r._filters[0].maskSprite=r.maskObject)}}}detect(e){const n=e.maskObject;e.type=n?n.isSprite?Qt.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(e)?Qt.SCISSOR:Qt.STENCIL:Qt.COLOR}pushSpriteMask(e){const{maskObject:n}=e,r=e._target;let i=e._filters;i||(i=this.alphaMaskPool[this.alphaMaskIndex],i||(i=this.alphaMaskPool[this.alphaMaskIndex]=[new ok]));const s=this.renderer,o=s.renderTexture;let a,l;if(o.current){const u=o.current;a=e.resolution||u.resolution,l=e.multisample??u.multisample}else a=e.resolution||s.resolution,l=e.multisample??s.multisample;i[0].resolution=a,i[0].multisample=l,i[0].maskSprite=n;const c=r.filterArea;r.filterArea=n.getBounds(!0),s.filter.push(r,i),r.filterArea=c,e._filters||this.alphaMaskIndex++}popSpriteMask(e){this.renderer.filter.pop(),e._filters?e._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(e){const n=e._colorMask,r=e._colorMask=n&e.colorMask;r!==n&&this.renderer.gl.colorMask(0!=(1&r),0!=(2&r),0!=(4&r),0!=(8&r))}popColorMask(e){const r=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;r!==e._colorMask&&this.renderer.gl.colorMask(0!=(1&r),0!=(2&r),0!=(4&r),0!=(8&r))}destroy(){this.renderer=null}}Mb.extension={type:de.RendererSystem,name:"mask"},Se.add(Mb);class Rb{constructor(e){this.renderer=e,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(e){const{gl:n}=this.renderer,r=this.getStackLength();this.maskStack=e;const i=this.getStackLength();i!==r&&(0===i?n.disable(this.glConst):(n.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const Pb=new Pt,Nb=[],Au=class extends Rb{constructor(t){super(t),this.glConst=ue.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._scissorCounter:0}calcScissorRect(t){if(t._scissorRectLocal)return;const e=t._scissorRect,{maskObject:n}=t,{renderer:r}=this,i=r.renderTexture,s=n.getBounds(!0,Nb.pop()??new nt);this.roundFrameToPixels(s,i.current?i.current.resolution:r.resolution,i.sourceFrame,i.destinationFrame,r.projection.transform),e&&s.fit(e),t._scissorRectLocal=s}static isMatrixRotated(t){if(!t)return!1;const{a:e,b:n,c:r,d:i}=t;return(Math.abs(n)>1e-4||Math.abs(r)>1e-4)&&(Math.abs(e)>1e-4||Math.abs(i)>1e-4)}testScissor(t){const{maskObject:e}=t;if(!e.isFastRect||!e.isFastRect()||Au.isMatrixRotated(e.worldTransform)||Au.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(t);const n=t._scissorRectLocal;return n.width>0&&n.height>0}roundFrameToPixels(t,e,n,r,i){Au.isMatrixRotated(i)||((i=i?Pb.copyFrom(i):Pb.identity()).translate(-n.x,-n.y).scale(r.width/n.width,r.height/n.height).translate(r.x,r.y),this.renderer.filter.transformAABB(i,t),t.fit(r),t.x=Math.round(t.x*e),t.y=Math.round(t.y*e),t.width=Math.round(t.width*e),t.height=Math.round(t.height*e))}push(t){t._scissorRectLocal||this.calcScissorRect(t);const{gl:e}=this.renderer;t._scissorRect||e.enable(e.SCISSOR_TEST),t._scissorCounter++,t._scissorRect=t._scissorRectLocal,this._useCurrent()}pop(t){const{gl:e}=this.renderer;t&&Nb.push(t._scissorRectLocal),this.getStackLength()>0?this._useCurrent():e.disable(e.SCISSOR_TEST)}_useCurrent(){const t=this.maskStack[this.maskStack.length-1]._scissorRect;let e;e=this.renderer.renderTexture.current?t.y:this.renderer.height-t.height-t.y,this.renderer.gl.scissor(t.x,e,t.width,t.height)}};let Fb=Au;Fb.extension={type:de.RendererSystem,name:"scissor"},Se.add(Fb);class Ob extends Rb{constructor(e){super(e),this.glConst=ue.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const e=this.maskStack[this.maskStack.length-1];return e?e._stencilCounter:0}push(e){const n=e.maskObject,{gl:r}=this.renderer,i=e._stencilCounter;0===i&&(this.renderer.framebuffer.forceStencil(),r.clearStencil(0),r.clear(r.STENCIL_BUFFER_BIT),r.enable(r.STENCIL_TEST)),e._stencilCounter++;const s=e._colorMask;0!==s&&(e._colorMask=0,r.colorMask(!1,!1,!1,!1)),r.stencilFunc(r.EQUAL,i,4294967295),r.stencilOp(r.KEEP,r.KEEP,r.INCR),n.renderable=!0,n.render(this.renderer),this.renderer.batch.flush(),n.renderable=!1,0!==s&&(e._colorMask=s,r.colorMask(0!=(1&s),0!=(2&s),0!=(4&s),0!=(8&s))),this._useCurrent()}pop(e){const n=this.renderer.gl;if(0===this.getStackLength())n.disable(n.STENCIL_TEST);else{const r=0!==this.maskStack.length?this.maskStack[this.maskStack.length-1]:null,i=r?r._colorMask:15;0!==i&&(r._colorMask=0,n.colorMask(!1,!1,!1,!1)),n.stencilOp(n.KEEP,n.KEEP,n.DECR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,0!==i&&(r._colorMask=i,n.colorMask(0!=(1&i),0!=(2&i),0!=(4&i),0!=(8&i))),this._useCurrent()}}_useCurrent(){const e=this.renderer.gl;e.stencilFunc(e.EQUAL,this.getStackLength(),4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP)}}Ob.extension={type:de.RendererSystem,name:"stencil"},Se.add(Ob);class Lb{constructor(e){this.renderer=e,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get:()=>(Ye("7.0.0","renderer.plugins.extract has moved to renderer.extract"),e.extract)},prepare:{enumerable:!1,get:()=>(Ye("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),e.prepare)},interaction:{enumerable:!1,get:()=>(Ye("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),e.events)}})}init(){const e=this.rendererPlugins;for(const n in e)this.plugins[n]=new e[n](this.renderer)}destroy(){for(const e in this.plugins)this.plugins[e].destroy(),this.plugins[e]=null}}Lb.extension={type:[de.RendererSystem,de.CanvasRendererSystem],name:"_plugin"},Se.add(Lb);class Bb{constructor(e){this.renderer=e,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new Pt,this.transform=null}update(e,n,r,i){this.destinationFrame=e||this.destinationFrame||this.defaultFrame,this.sourceFrame=n||this.sourceFrame||e,this.calculateProjection(this.destinationFrame,this.sourceFrame,r,i),this.transform&&this.projectionMatrix.append(this.transform);const s=this.renderer;s.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,s.globalUniforms.update(),s.shader.shader&&s.shader.syncUniformGroup(s.shader.shader.uniforms.globals)}calculateProjection(e,n,r,i){const s=this.projectionMatrix,o=i?-1:1;s.identity(),s.a=1/n.width*2,s.d=o*(1/n.height*2),s.tx=-1-n.x*s.a,s.ty=-o-n.y*s.d}setTransform(e){}destroy(){this.renderer=null}}Bb.extension={type:de.RendererSystem,name:"projection"},Se.add(Bb);const lk=new ug;class kb{constructor(e){this.renderer=e,this._tempMatrix=new Pt}generateTexture(e,n){const{region:r,...i}=n||{},s=r||e.getLocalBounds(null,!0);0===s.width&&(s.width=1),0===s.height&&(s.height=1);const o=us.create({width:s.width,height:s.height,...i});this._tempMatrix.tx=-s.x,this._tempMatrix.ty=-s.y;const a=e.transform;return e.transform=lk,this.renderer.render(e,{renderTexture:o,transform:this._tempMatrix,skipUpdateTransform:!!e.parent,blit:!0}),e.transform=a,o}destroy(){}}kb.extension={type:[de.RendererSystem,de.CanvasRendererSystem],name:"textureGenerator"},Se.add(kb);const hs=new nt,qa=new nt;class Ub{constructor(e){this.renderer=e,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new nt,this.destinationFrame=new nt,this.viewportFrame=new nt}contextChange(){const e=this.renderer?.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(e&&e.alpha&&e.premultipliedAlpha)}bind(e=null,n,r){const i=this.renderer;let s,o,a;this.current=e,e?(s=e.baseTexture,a=s.resolution,n||(hs.width=e.frame.width,hs.height=e.frame.height,n=hs),r||(qa.x=e.frame.x,qa.y=e.frame.y,qa.width=n.width,qa.height=n.height,r=qa),o=s.framebuffer):(a=i.resolution,n||(hs.width=i._view.screen.width,hs.height=i._view.screen.height,n=hs),r||((r=hs).width=n.width,r.height=n.height));const l=this.viewportFrame;l.x=r.x*a,l.y=r.y*a,l.width=r.width*a,l.height=r.height*a,e||(l.y=i.view.height-(l.y+l.height)),l.ceil(),this.renderer.framebuffer.bind(o,l),this.renderer.projection.update(r,n,a,!o),this.renderer.mask.setMaskStack(e?s.maskStack:this.defaultMaskStack),this.sourceFrame.copyFrom(n),this.destinationFrame.copyFrom(r)}clear(e,n){const i=ft.shared.setValue(e||(this.current?this.current.baseTexture.clear:this.renderer.background.backgroundColor));(this.current&&this.current.baseTexture.alphaMode>0||!this.current&&this._rendererPremultipliedAlpha)&&i.premultiply(i.alpha);const s=this.destinationFrame,o=this.current?this.current.baseTexture:this.renderer._view.screen,a=s.width!==o.width||s.height!==o.height;if(a){let{x:l,y:c,width:u,height:h}=this.viewportFrame;l=Math.round(l),c=Math.round(c),u=Math.round(u),h=Math.round(h),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(l,c,u,h)}this.renderer.framebuffer.clear(i.red,i.green,i.blue,i.alpha,n),a&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}Ub.extension={type:de.RendererSystem,name:"renderTexture"},Se.add(Ub);class ck{constructor(e,n){this.program=e,this.uniformData=n,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function Hb(t,e,n){const r=t.createShader(e);return t.shaderSource(r,n),t.compileShader(r),r}function gg(t){const e=new Array(t);for(let n=0;n<e.length;n++)e[n]=!1;return e}function Vb(t,e){switch(t){case"float":case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"vec2":return new Float32Array(2*e);case"vec3":return new Float32Array(3*e);case"vec4":return new Float32Array(4*e);case"ivec2":return new Int32Array(2*e);case"ivec3":return new Int32Array(3*e);case"ivec4":return new Int32Array(4*e);case"uvec2":return new Uint32Array(2*e);case"uvec3":return new Uint32Array(3*e);case"uvec4":return new Uint32Array(4*e);case"bool":return!1;case"bvec2":return gg(2*e);case"bvec3":return gg(3*e);case"bvec4":return gg(4*e);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}function Gb(t,e){const n=t.getShaderSource(e).split("\n").map((c,u)=>`${u}: ${c}`),r=t.getShaderInfoLog(e),i=r.split("\n"),s={},o=i.map(c=>parseFloat(c.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(c=>!(!c||s[c]||(s[c]=!0,0))),a=[""];o.forEach(c=>{n[c-1]=`%c${n[c-1]}%c`,a.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});const l=n.join("\n");a[0]=l,console.error(r),console.groupCollapsed("click to view full shader code"),console.warn(...a),console.groupEnd()}function pk(t,e,n,r,i){n.buffer.update(i)}const gk={float:"\n        data[offset] = v;\n    ",vec2:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n    ",vec3:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n    ",vec4:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n        data[offset+3] = v[3];\n    ",mat2:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n\n        data[offset+4] = v[2];\n        data[offset+5] = v[3];\n    ",mat3:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n        data[offset + 4] = v[3];\n        data[offset + 5] = v[4];\n        data[offset + 6] = v[5];\n\n        data[offset + 8] = v[6];\n        data[offset + 9] = v[7];\n        data[offset + 10] = v[8];\n    ",mat4:"\n        for(var i = 0; i < 16; i++)\n        {\n            data[offset + i] = v[i];\n        }\n    "},jb={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:32,mat3:48,mat4:64};let Za,xk=0;const Mu={textureCount:0,uboCount:0};class $b{constructor(e){this.destroyed=!1,this.renderer=e,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=xk++}systemCheck(){if(!function vk(){if("boolean"==typeof Za)return Za;try{Za=!0===new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")}catch{Za=!1}return Za}())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(e){this.gl=e,this.reset()}bind(e,n){e.disposeRunner.add(this),e.uniforms.globals=this.renderer.globalUniforms;const r=e.program,i=r.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(e);return this.shader=e,this.program!==r&&(this.program=r,this.gl.useProgram(i.program)),n||(Mu.textureCount=0,Mu.uboCount=0,this.syncUniformGroup(e.uniformGroup,Mu)),i}setUniforms(e){const n=this.shader.program;n.syncUniforms(n.glPrograms[this.renderer.CONTEXT_UID].uniformData,e,this.renderer)}syncUniformGroup(e,n){const r=this.getGlProgram();(!e.static||e.dirtyId!==r.uniformDirtyGroups[e.id])&&(r.uniformDirtyGroups[e.id]=e.dirtyId,this.syncUniforms(e,r,n))}syncUniforms(e,n,r){(e.syncUniforms[this.shader.program.id]||this.createSyncGroups(e))(n.uniformData,e.uniforms,this.renderer,r)}createSyncGroups(e){const n=this.getSignature(e,this.shader.program.uniformData,"u");return this.cache[n]||(this.cache[n]=function UB(t,e){const n=["\n        var v = null;\n        var cv = null;\n        var cu = null;\n        var t = 0;\n        var gl = renderer.gl;\n    "];for(const r in t.uniforms){const i=e[r];if(!i){t.uniforms[r]?.group&&n.push(t.uniforms[r].ubo?`\n                        renderer.shader.syncUniformBufferGroup(uv.${r}, '${r}');\n                    `:`\n                        renderer.shader.syncUniformGroup(uv.${r}, syncData);\n                    `);continue}const s=t.uniforms[r];let o=!1;for(let a=0;a<bo.length;a++)if(bo[a].test(i,s)){n.push(bo[a].code(r,s)),o=!0;break}if(!o){const l=(1!==i.size||i.isArray?kB:BB)[i.type].replace("location",`ud["${r}"].location`);n.push(`\n            cu = ud["${r}"];\n            cv = cu.value;\n            v = uv["${r}"];\n            ${l};`)}}return new Function("ud","uv","renderer","syncData",n.join("\n"))}(e,this.shader.program.uniformData)),e.syncUniforms[this.shader.program.id]=this.cache[n],e.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(e,n){const r=this.getGlProgram();if(!e.static||0!==e.dirtyId||!r.uniformGroups[e.id]){e.dirtyId=0;const i=r.uniformGroups[e.id]||this.createSyncBufferGroup(e,r,n);e.buffer.update(),i(r.uniformData,e.uniforms,this.renderer,Mu,e.buffer)}this.renderer.buffer.bindBufferBase(e.buffer,r.uniformBufferBindings[n])}createSyncBufferGroup(e,n,r){const{gl:i}=this.renderer;this.renderer.buffer.bind(e.buffer);const s=this.gl.getUniformBlockIndex(n.program,r);n.uniformBufferBindings[r]=this.shader.uniformBindCount,i.uniformBlockBinding(n.program,s,this.shader.uniformBindCount),this.shader.uniformBindCount++;const o=this.getSignature(e,this.shader.program.uniformData,"ubo");let a=this._uboCache[o];if(a||(a=this._uboCache[o]=function _k(t,e){if(!t.autoManage)return{size:0,syncFunc:pk};const n=function yk(t,e){const n=[];for(const r in t)e[r]&&n.push(e[r]);return n.sort((r,i)=>r.index-i.index),n}(t.uniforms,e),{uboElements:r,size:i}=function mk(t){const e=t.map(s=>({data:s,offset:0,dataLen:0,dirty:0}));let n=0,r=0,i=0;for(let s=0;s<e.length;s++){const o=e[s];if(n=jb[o.data.type],o.data.size>1&&(n=Math.max(n,16)*o.data.size),o.dataLen=n,r%n!=0&&r<16){const a=r%n%16;r+=a,i+=a}r+n>16?(i=16*Math.ceil(i/16),o.offset=i,i+=n,r=n):(o.offset=i,r+=n,i+=n)}return i=16*Math.ceil(i/16),{uboElements:e,size:i}}(n),s=["\n    var v = null;\n    var v2 = null;\n    var cv = null;\n    var t = 0;\n    var gl = renderer.gl\n    var index = 0;\n    var data = buffer.data;\n    "];for(let o=0;o<r.length;o++){const a=r[o],l=t.uniforms[a.data.name],c=a.data.name;let u=!1;for(let h=0;h<bo.length;h++){const d=bo[h];if(d.codeUbo&&d.test(a.data,l)){s.push(`offset = ${a.offset/4};`,bo[h].codeUbo(a.data.name,l)),u=!0;break}}if(!u)if(a.data.size>1){const h=pb(a.data.type),d=Math.max(jb[a.data.type]/16,1),f=h/d;s.push(`\n                cv = ud.${c}.value;\n                v = uv.${c};\n                offset = ${a.offset/4};\n\n                t = 0;\n\n                for(var i=0; i < ${a.data.size*d}; i++)\n                {\n                    for(var j = 0; j < ${f}; j++)\n                    {\n                        data[offset++] = v[t++];\n                    }\n                    offset += ${(4-f%4)%4};\n                }\n\n                `)}else s.push(`\n                cv = ud.${c}.value;\n                v = uv.${c};\n                offset = ${a.offset/4};\n                ${gk[a.data.type]};\n                `)}return s.push("\n       renderer.buffer.update(buffer);\n    "),{size:i,syncFunc:new Function("ud","uv","renderer","syncData","buffer",s.join("\n"))}}(e,this.shader.program.uniformData)),e.autoManage){const l=new Float32Array(a.size/4);e.buffer.update(l)}return n.uniformGroups[e.id]=a.syncFunc,n.uniformGroups[e.id]}getSignature(e,n,r){const i=e.uniforms,s=[`${r}-`];for(const o in i)s.push(o),n[o]&&s.push(n[o].type);return s.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(e){const r=e.program,i=function fk(t,e){const n=Hb(t,t.VERTEX_SHADER,e.vertexSrc),r=Hb(t,t.FRAGMENT_SHADER,e.fragmentSrc),i=t.createProgram();t.attachShader(i,n),t.attachShader(i,r);const s=e.extra?.transformFeedbackVaryings;if(s&&("function"!=typeof t.transformFeedbackVaryings?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):t.transformFeedbackVaryings(i,s.names,"separate"===s.bufferMode?t.SEPARATE_ATTRIBS:t.INTERLEAVED_ATTRIBS)),t.linkProgram(i),t.getProgramParameter(i,t.LINK_STATUS)||function dk(t,e,n,r){t.getProgramParameter(e,t.LINK_STATUS)||(t.getShaderParameter(n,t.COMPILE_STATUS)||Gb(t,n),t.getShaderParameter(r,t.COMPILE_STATUS)||Gb(t,r),console.error("PixiJS Error: Could not initialize shader."),""!==t.getProgramInfoLog(e)&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",t.getProgramInfoLog(e)))}(t,i,n,r),e.attributeData=function uk(t,e){const n={},r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let i=0;i<r;i++){const s=e.getActiveAttrib(t,i);if(s.name.startsWith("gl_"))continue;const o=mb(e,s.type),a={type:o,name:s.name,size:pb(o),location:e.getAttribLocation(t,s.name)};n[s.name]=a}return n}(i,t),e.uniformData=function hk(t,e){const n={},r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let i=0;i<r;i++){const s=e.getActiveUniform(t,i),o=s.name.replace(/\[.*?\]$/,""),a=!!s.name.match(/\[.*?\]$/),l=mb(e,s.type);n[o]={name:o,index:i,type:l,size:s.size,isArray:a,value:Vb(l,s.size)}}return n}(i,t),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(e.vertexSrc)){const l=Object.keys(e.attributeData);l.sort((c,u)=>c>u?1:-1);for(let c=0;c<l.length;c++)e.attributeData[l[c]].location=c,t.bindAttribLocation(i,c,l[c]);t.linkProgram(i)}t.deleteShader(n),t.deleteShader(r);const o={};for(const l in e.uniformData){const c=e.uniformData[l];o[l]={location:t.getUniformLocation(i,l),value:Vb(c.type,c.size)}}return new ck(i,o)}(this.gl,r);return r.glPrograms[this.renderer.CONTEXT_UID]=i,i}reset(){this.program=null,this.shader=null}disposeShader(e){this.shader===e&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}$b.extension={type:de.RendererSystem,name:"shader"},Se.add($b);class Ru{constructor(e){this.renderer=e}run(e){const{renderer:n}=this;n.runners.init.emit(n.options),e.hello&&console.log(`PixiJS 7.2.4 - ${n.rendererLogId} - https://pixijs.com`),n.resize(n.screen.width,n.screen.height)}destroy(){}}Ru.defaultOptions={hello:!1},Ru.extension={type:[de.RendererSystem,de.CanvasRendererSystem],name:"startup"},Se.add(Ru);const mg=class{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=Ne.NONE,this._blendEq=!1,this.map=[],this.map[0]=this.setBlend,this.map[1]=this.setOffset,this.map[2]=this.setCullFace,this.map[3]=this.setDepthTest,this.map[4]=this.setFrontFace,this.map[5]=this.setDepthMask,this.checks=[],this.defaultState=new pi,this.defaultState.blend=!0}contextChange(t){this.gl=t,this.blendModes=function wk(t,e=[]){return e[Ne.NORMAL]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Ne.ADD]=[t.ONE,t.ONE],e[Ne.MULTIPLY]=[t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Ne.SCREEN]=[t.ONE,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Ne.OVERLAY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Ne.DARKEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Ne.LIGHTEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Ne.COLOR_DODGE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Ne.COLOR_BURN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Ne.HARD_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Ne.SOFT_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Ne.DIFFERENCE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Ne.EXCLUSION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Ne.HUE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Ne.SATURATION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Ne.COLOR]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Ne.LUMINOSITY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Ne.NONE]=[0,0],e[Ne.NORMAL_NPM]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Ne.ADD_NPM]=[t.SRC_ALPHA,t.ONE,t.ONE,t.ONE],e[Ne.SCREEN_NPM]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Ne.SRC_IN]=[t.DST_ALPHA,t.ZERO],e[Ne.SRC_OUT]=[t.ONE_MINUS_DST_ALPHA,t.ZERO],e[Ne.SRC_ATOP]=[t.DST_ALPHA,t.ONE_MINUS_SRC_ALPHA],e[Ne.DST_OVER]=[t.ONE_MINUS_DST_ALPHA,t.ONE],e[Ne.DST_IN]=[t.ZERO,t.SRC_ALPHA],e[Ne.DST_OUT]=[t.ZERO,t.ONE_MINUS_SRC_ALPHA],e[Ne.DST_ATOP]=[t.ONE_MINUS_DST_ALPHA,t.SRC_ALPHA],e[Ne.XOR]=[t.ONE_MINUS_DST_ALPHA,t.ONE_MINUS_SRC_ALPHA],e[Ne.SUBTRACT]=[t.ONE,t.ONE,t.ONE,t.ONE,t.FUNC_REVERSE_SUBTRACT,t.FUNC_ADD],e}(t),this.set(this.defaultState),this.reset()}set(t){if(this.stateId!==(t=t||this.defaultState).data){let e=this.stateId^t.data,n=0;for(;e;)1&e&&this.map[n].call(this,!!(t.data&1<<n)),e>>=1,n++;this.stateId=t.data}for(let e=0;e<this.checks.length;e++)this.checks[e](this,t)}forceState(t){t=t||this.defaultState;for(let e=0;e<this.map.length;e++)this.map[e].call(this,!!(t.data&1<<e));for(let e=0;e<this.checks.length;e++)this.checks[e](this,t);this.stateId=t.data}setBlend(t){this.updateCheck(mg.checkBlendMode,t),this.gl[t?"enable":"disable"](this.gl.BLEND)}setOffset(t){this.updateCheck(mg.checkPolygonOffset,t),this.gl[t?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(t){this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(t){this.gl.depthMask(t)}setCullFace(t){this.gl[t?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(t){this.gl.frontFace(this.gl[t?"CW":"CCW"])}setBlendMode(t){if(t===this.blendMode)return;this.blendMode=t;const e=this.blendModes[t],n=this.gl;2===e.length?n.blendFunc(e[0],e[1]):n.blendFuncSeparate(e[0],e[1],e[2],e[3]),6===e.length?(this._blendEq=!0,n.blendEquationSeparate(e[4],e[5])):this._blendEq&&(this._blendEq=!1,n.blendEquationSeparate(n.FUNC_ADD,n.FUNC_ADD))}setPolygonOffset(t,e){this.gl.polygonOffset(t,e)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(t,e){const n=this.checks.indexOf(t);e&&-1===n?this.checks.push(t):!e&&-1!==n&&this.checks.splice(n,1)}static checkBlendMode(t,e){t.setBlendMode(e.blendMode)}static checkPolygonOffset(t,e){t.setPolygonOffset(1,e.polygonOffset)}destroy(){this.gl=null}};let zb=mg;zb.extension={type:de.RendererSystem,name:"state"},Se.add(zb);class Ik extends Ga{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(e){this.addRunners(...e.runners);const n=(e.priority??[]).filter(i=>e.systems[i]),r=[...n,...Object.keys(e.systems).filter(i=>!n.includes(i))];for(const i of r)this.addSystem(e.systems[i],i)}addRunners(...e){e.forEach(n=>{this.runners[n]=new fr(n)})}addSystem(e,n){const r=new e(this);if(this[n])throw new Error(`Whoops! The name "${n}" is already in use`);this[n]=r,this._systemsHash[n]=r;for(const i in this.runners)this.runners[i].add(r);return this}emitWithCustomOptions(e,n){const r=Object.keys(this._systemsHash);e.items.forEach(i=>{const s=r.find(o=>this._systemsHash[o]===i);i[e.name](n[s])})}destroy(){Object.values(this.runners).forEach(e=>{e.destroy()}),this._systemsHash={}}}const Pu=class{constructor(t){this.renderer=t,this.count=0,this.checkCount=0,this.maxIdle=Pu.defaultMaxIdle,this.checkCountMax=Pu.defaultCheckCountMax,this.mode=Pu.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==Up.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const t=this.renderer.texture,e=t.managedTextures;let n=!1;for(let r=0;r<e.length;r++){const i=e[r];!i.framebuffer&&this.count-i.touched>this.maxIdle&&(t.destroyTexture(i,!0),e[r]=null,n=!0)}if(n){let r=0;for(let i=0;i<e.length;i++)null!==e[i]&&(e[r++]=e[i]);e.length=r}}unload(t){const n=t._texture;n&&!n.framebuffer&&this.renderer.texture.destroyTexture(n);for(let r=t.children.length-1;r>=0;r--)this.unload(t.children[r])}destroy(){this.renderer=null}};let _r=Pu;_r.defaultMode=Up.AUTO,_r.defaultMaxIdle=3600,_r.defaultCheckCountMax=600,_r.extension={type:de.RendererSystem,name:"textureGC"},Se.add(_r);class yg{constructor(e){this.texture=e,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=Me.UNSIGNED_BYTE,this.internalFormat=Q.RGBA,this.samplerType=0}}class Wb{constructor(e){this.renderer=e,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new $e,this.hasIntegerTextures=!1}contextChange(){const e=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=function Ak(t){let e;return e="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext?{[Me.UNSIGNED_BYTE]:{[Q.RGBA]:t.RGBA8,[Q.RGB]:t.RGB8,[Q.RG]:t.RG8,[Q.RED]:t.R8,[Q.RGBA_INTEGER]:t.RGBA8UI,[Q.RGB_INTEGER]:t.RGB8UI,[Q.RG_INTEGER]:t.RG8UI,[Q.RED_INTEGER]:t.R8UI,[Q.ALPHA]:t.ALPHA,[Q.LUMINANCE]:t.LUMINANCE,[Q.LUMINANCE_ALPHA]:t.LUMINANCE_ALPHA},[Me.BYTE]:{[Q.RGBA]:t.RGBA8_SNORM,[Q.RGB]:t.RGB8_SNORM,[Q.RG]:t.RG8_SNORM,[Q.RED]:t.R8_SNORM,[Q.RGBA_INTEGER]:t.RGBA8I,[Q.RGB_INTEGER]:t.RGB8I,[Q.RG_INTEGER]:t.RG8I,[Q.RED_INTEGER]:t.R8I},[Me.UNSIGNED_SHORT]:{[Q.RGBA_INTEGER]:t.RGBA16UI,[Q.RGB_INTEGER]:t.RGB16UI,[Q.RG_INTEGER]:t.RG16UI,[Q.RED_INTEGER]:t.R16UI,[Q.DEPTH_COMPONENT]:t.DEPTH_COMPONENT16},[Me.SHORT]:{[Q.RGBA_INTEGER]:t.RGBA16I,[Q.RGB_INTEGER]:t.RGB16I,[Q.RG_INTEGER]:t.RG16I,[Q.RED_INTEGER]:t.R16I},[Me.UNSIGNED_INT]:{[Q.RGBA_INTEGER]:t.RGBA32UI,[Q.RGB_INTEGER]:t.RGB32UI,[Q.RG_INTEGER]:t.RG32UI,[Q.RED_INTEGER]:t.R32UI,[Q.DEPTH_COMPONENT]:t.DEPTH_COMPONENT24},[Me.INT]:{[Q.RGBA_INTEGER]:t.RGBA32I,[Q.RGB_INTEGER]:t.RGB32I,[Q.RG_INTEGER]:t.RG32I,[Q.RED_INTEGER]:t.R32I},[Me.FLOAT]:{[Q.RGBA]:t.RGBA32F,[Q.RGB]:t.RGB32F,[Q.RG]:t.RG32F,[Q.RED]:t.R32F,[Q.DEPTH_COMPONENT]:t.DEPTH_COMPONENT32F},[Me.HALF_FLOAT]:{[Q.RGBA]:t.RGBA16F,[Q.RGB]:t.RGB16F,[Q.RG]:t.RG16F,[Q.RED]:t.R16F},[Me.UNSIGNED_SHORT_5_6_5]:{[Q.RGB]:t.RGB565},[Me.UNSIGNED_SHORT_4_4_4_4]:{[Q.RGBA]:t.RGBA4},[Me.UNSIGNED_SHORT_5_5_5_1]:{[Q.RGBA]:t.RGB5_A1},[Me.UNSIGNED_INT_2_10_10_10_REV]:{[Q.RGBA]:t.RGB10_A2,[Q.RGBA_INTEGER]:t.RGB10_A2UI},[Me.UNSIGNED_INT_10F_11F_11F_REV]:{[Q.RGB]:t.R11F_G11F_B10F},[Me.UNSIGNED_INT_5_9_9_9_REV]:{[Q.RGB]:t.RGB9_E5},[Me.UNSIGNED_INT_24_8]:{[Q.DEPTH_STENCIL]:t.DEPTH24_STENCIL8},[Me.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[Q.DEPTH_STENCIL]:t.DEPTH32F_STENCIL8}}:{[Me.UNSIGNED_BYTE]:{[Q.RGBA]:t.RGBA,[Q.RGB]:t.RGB,[Q.ALPHA]:t.ALPHA,[Q.LUMINANCE]:t.LUMINANCE,[Q.LUMINANCE_ALPHA]:t.LUMINANCE_ALPHA},[Me.UNSIGNED_SHORT_5_6_5]:{[Q.RGB]:t.RGB},[Me.UNSIGNED_SHORT_4_4_4_4]:{[Q.RGBA]:t.RGBA},[Me.UNSIGNED_SHORT_5_5_5_1]:{[Q.RGBA]:t.RGBA}},e}(e);const n=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=n;for(let i=0;i<n;i++)this.boundTextures[i]=null;this.emptyTextures={};const r=new yg(e.createTexture());e.bindTexture(e.TEXTURE_2D,r.texture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[e.TEXTURE_2D]=r,this.emptyTextures[e.TEXTURE_CUBE_MAP]=new yg(e.createTexture()),e.bindTexture(e.TEXTURE_CUBE_MAP,this.emptyTextures[e.TEXTURE_CUBE_MAP].texture);for(let i=0;i<6;i++)e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,null);e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR);for(let i=0;i<this.boundTextures.length;i++)this.bind(null,i)}bind(e,n=0){const{gl:r}=this;if(e=e?.castToBaseTexture(),e?.valid&&!e.parentTextureArray){e.touched=this.renderer.textureGC.count;const i=e._glTextures[this.CONTEXT_UID]||this.initTexture(e);this.boundTextures[n]!==e&&(this.currentLocation!==n&&(this.currentLocation=n,r.activeTexture(r.TEXTURE0+n)),r.bindTexture(e.target,i.texture)),i.dirtyId!==e.dirtyId?(this.currentLocation!==n&&(this.currentLocation=n,r.activeTexture(r.TEXTURE0+n)),this.updateTexture(e)):i.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(e),this.boundTextures[n]=e}else this.currentLocation!==n&&(this.currentLocation=n,r.activeTexture(r.TEXTURE0+n)),r.bindTexture(r.TEXTURE_2D,this.emptyTextures[r.TEXTURE_2D].texture),this.boundTextures[n]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let e=0;e<this.boundTextures.length;e++)this.boundTextures[e]=this.unknownTexture}unbind(e){const{gl:n,boundTextures:r}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let i=0;i<r.length;i++)r[i]===this.unknownTexture&&this.bind(null,i)}for(let i=0;i<r.length;i++)r[i]===e&&(this.currentLocation!==i&&(n.activeTexture(n.TEXTURE0+i),this.currentLocation=i),n.bindTexture(e.target,this.emptyTextures[e.target].texture),r[i]=null)}ensureSamplerType(e){const{boundTextures:n,hasIntegerTextures:r,CONTEXT_UID:i}=this;if(r)for(let s=e-1;s>=0;--s){const o=n[s];o&&o._glTextures[i].samplerType!==kp.FLOAT&&this.renderer.texture.unbind(o)}}initTexture(e){const n=new yg(this.gl.createTexture());return n.dirtyId=-1,e._glTextures[this.CONTEXT_UID]=n,this.managedTextures.push(e),e.on("dispose",this.destroyTexture,this),n}initTextureType(e,n){n.internalFormat=this.internalFormats[e.type]?.[e.format]??e.format,n.type=2===this.webGLVersion&&e.type===Me.HALF_FLOAT?this.gl.HALF_FLOAT:e.type}updateTexture(e){const n=e._glTextures[this.CONTEXT_UID];if(!n)return;const r=this.renderer;if(this.initTextureType(e,n),e.resource?.upload(r,e,n))n.samplerType!==kp.FLOAT&&(this.hasIntegerTextures=!0);else{const i=e.realWidth,s=e.realHeight,o=r.gl;(n.width!==i||n.height!==s||n.dirtyId<0)&&(n.width=i,n.height=s,o.texImage2D(e.target,0,n.internalFormat,i,s,0,e.format,n.type,null))}e.dirtyStyleId!==n.dirtyStyleId&&this.updateTextureStyle(e),n.dirtyId=e.dirtyId}destroyTexture(e,n){const{gl:r}=this;if((e=e.castToBaseTexture())._glTextures[this.CONTEXT_UID]&&(this.unbind(e),r.deleteTexture(e._glTextures[this.CONTEXT_UID].texture),e.off("dispose",this.destroyTexture,this),delete e._glTextures[this.CONTEXT_UID],!n)){const i=this.managedTextures.indexOf(e);-1!==i&&wo(this.managedTextures,i,1)}}updateTextureStyle(e){const n=e._glTextures[this.CONTEXT_UID];n&&(n.mipmap=!!(e.mipmap!==jr.POW2&&2===this.webGLVersion||e.isPowerOfTwo)&&e.mipmap>=1,n.wrapMode=2===this.webGLVersion||e.isPowerOfTwo?e.wrapMode:Ii.CLAMP,e.resource?.style(this.renderer,e,n)||this.setStyle(e,n),n.dirtyStyleId=e.dirtyStyleId)}setStyle(e,n){const r=this.gl;if(n.mipmap&&e.mipmap!==jr.ON_MANUAL&&r.generateMipmap(e.target),r.texParameteri(e.target,r.TEXTURE_WRAP_S,n.wrapMode),r.texParameteri(e.target,r.TEXTURE_WRAP_T,n.wrapMode),n.mipmap){r.texParameteri(e.target,r.TEXTURE_MIN_FILTER,e.scaleMode===Gr.LINEAR?r.LINEAR_MIPMAP_LINEAR:r.NEAREST_MIPMAP_NEAREST);const i=this.renderer.context.extensions.anisotropicFiltering;if(i&&e.anisotropicLevel>0&&e.scaleMode===Gr.LINEAR){const s=Math.min(e.anisotropicLevel,r.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT));r.texParameterf(e.target,i.TEXTURE_MAX_ANISOTROPY_EXT,s)}}else r.texParameteri(e.target,r.TEXTURE_MIN_FILTER,e.scaleMode===Gr.LINEAR?r.LINEAR:r.NEAREST);r.texParameteri(e.target,r.TEXTURE_MAG_FILTER,e.scaleMode===Gr.LINEAR?r.LINEAR:r.NEAREST)}destroy(){this.renderer=null}}Wb.extension={type:de.RendererSystem,name:"texture"},Se.add(Wb);class Xb{constructor(e){this.renderer=e}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(e){const{gl:n,CONTEXT_UID:r}=this,i=e._glTransformFeedbacks[r]||this.createGLTransformFeedback(e);n.bindTransformFeedback(n.TRANSFORM_FEEDBACK,i)}unbind(){const{gl:e}=this;e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(e,n){const{gl:r,renderer:i}=this;n&&i.shader.bind(n),r.beginTransformFeedback(e)}endTransformFeedback(){const{gl:e}=this;e.endTransformFeedback()}createGLTransformFeedback(e){const{gl:n,renderer:r,CONTEXT_UID:i}=this,s=n.createTransformFeedback();e._glTransformFeedbacks[i]=s,n.bindTransformFeedback(n.TRANSFORM_FEEDBACK,s);for(let o=0;o<e.buffers.length;o++){const a=e.buffers[o];a&&(r.buffer.update(a),a._glBuffers[i].refCount++,n.bindBufferBase(n.TRANSFORM_FEEDBACK_BUFFER,o,a._glBuffers[i].buffer||null))}return n.bindTransformFeedback(n.TRANSFORM_FEEDBACK,null),e.disposeRunner.add(this),s}disposeTransformFeedback(e,n){const r=e._glTransformFeedbacks[this.CONTEXT_UID],i=this.gl;e.disposeRunner.remove(this);const s=this.renderer.buffer;if(s)for(let o=0;o<e.buffers.length;o++){const a=e.buffers[o];if(!a)continue;const l=a._glBuffers[this.CONTEXT_UID];l&&(l.refCount--,0===l.refCount&&!n&&s.dispose(a,n))}r&&(n||i.deleteTransformFeedback(r),delete e._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}Xb.extension={type:de.RendererSystem,name:"transformFeedback"},Se.add(Xb);class Nu{constructor(e){this.renderer=e}init(e){this.screen=new nt(0,0,e.width,e.height),this.element=e.view||ue.ADAPTER.createCanvas(),this.resolution=e.resolution||ue.RESOLUTION,this.autoDensity=!!e.autoDensity}resizeView(e,n){this.element.width=Math.round(e*this.resolution),this.element.height=Math.round(n*this.resolution);const r=this.element.width/this.resolution,i=this.element.height/this.resolution;this.screen.width=r,this.screen.height=i,this.autoDensity&&(this.element.style.width=`${r}px`,this.element.style.height=`${i}px`),this.renderer.emit("resize",r,i),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(e){e&&this.element.parentNode?.removeChild(this.element),this.renderer=null,this.element=null,this.screen=null}}Nu.defaultOptions={width:800,height:600,resolution:ue.RESOLUTION,autoDensity:!1},Nu.extension={type:[de.RendererSystem,de.CanvasRendererSystem],name:"_view"},Se.add(Nu),ue.PREFER_ENV=rs.WEBGL2,ue.STRICT_TEXTURE_CACHE=!1,ue.RENDER_OPTIONS={...Tu.defaultOptions,...Su.defaultOptions,...Nu.defaultOptions,...Ru.defaultOptions},Object.defineProperties(ue,{WRAP_MODE:{get:()=>$e.defaultOptions.wrapMode,set(t){Ye("7.1.0","settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode"),$e.defaultOptions.wrapMode=t}},SCALE_MODE:{get:()=>$e.defaultOptions.scaleMode,set(t){Ye("7.1.0","settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode"),$e.defaultOptions.scaleMode=t}},MIPMAP_TEXTURES:{get:()=>$e.defaultOptions.mipmap,set(t){Ye("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap"),$e.defaultOptions.mipmap=t}},ANISOTROPIC_LEVEL:{get:()=>$e.defaultOptions.anisotropicLevel,set(t){Ye("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel"),$e.defaultOptions.anisotropicLevel=t}},FILTER_RESOLUTION:{get:()=>(Ye("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),ln.defaultResolution),set(t){ln.defaultResolution=t}},FILTER_MULTISAMPLE:{get:()=>(Ye("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),ln.defaultMultisample),set(t){ln.defaultMultisample=t}},SPRITE_MAX_TEXTURES:{get:()=>yr.defaultMaxTextures,set(t){Ye("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),yr.defaultMaxTextures=t}},SPRITE_BATCH_SIZE:{get:()=>yr.defaultBatchSize,set(t){Ye("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),yr.defaultBatchSize=t}},CAN_UPLOAD_SAME_BUFFER:{get:()=>yr.canUploadSameBuffer,set(t){Ye("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),yr.canUploadSameBuffer=t}},GC_MODE:{get:()=>_r.defaultMode,set(t){Ye("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),_r.defaultMode=t}},GC_MAX_IDLE:{get:()=>_r.defaultMaxIdle,set(t){Ye("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),_r.defaultMaxIdle=t}},GC_MAX_CHECK_COUNT:{get:()=>_r.defaultCheckCountMax,set(t){Ye("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),_r.defaultCheckCountMax=t}},PRECISION_VERTEX:{get:()=>pr.defaultVertexPrecision,set(t){Ye("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),pr.defaultVertexPrecision=t}},PRECISION_FRAGMENT:{get:()=>pr.defaultFragmentPrecision,set(t){Ye("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),pr.defaultFragmentPrecision=t}}});var Fi=(t=>(t[t.INTERACTION=50]="INTERACTION",t[t.HIGH=25]="HIGH",t[t.NORMAL=0]="NORMAL",t[t.LOW=-25]="LOW",t[t.UTILITY=-50]="UTILITY",t))(Fi||{});class _g{constructor(e,n=null,r=0,i=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=e,this.context=n,this.priority=r,this.once=i}match(e,n=null){return this.fn===e&&this.context===n}emit(e){this.fn&&(this.context?this.fn.call(this.context,e):this.fn(e));const n=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),n}connect(e){this.previous=e,e.next&&(e.next.previous=this),this.next=e.next,e.next=this}destroy(e=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const n=this.next;return this.next=e?null:n,this.previous=null,n}}const Gn=class{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new _g(null,null,1/0),this.deltaMS=1/Gn.targetFPMS,this.elapsedMS=1/Gn.targetFPMS,this._tick=t=>{this._requestId=null,this.started&&(this.update(t),this.started&&null===this._requestId&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){null===this._requestId&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){null!==this._requestId&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(t,e,n=Fi.NORMAL){return this._addListener(new _g(t,e,n))}addOnce(t,e,n=Fi.NORMAL){return this._addListener(new _g(t,e,n,!0))}_addListener(t){let e=this._head.next,n=this._head;if(e){for(;e;){if(t.priority>e.priority){t.connect(n);break}n=e,e=e.next}t.previous||t.connect(n)}else t.connect(n);return this._startIfPossible(),this}remove(t,e){let n=this._head.next;for(;n;)n=n.match(t,e)?n.destroy():n.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let t=0,e=this._head;for(;e=e.next;)t++;return t}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let t=this._head.next;for(;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}}update(t=performance.now()){let e;if(t>this.lastTime){if(e=this.elapsedMS=t-this.lastTime,e>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){const i=t-this._lastFrame|0;if(i<this._minElapsedMS)return;this._lastFrame=t-i%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*Gn.targetFPMS;const n=this._head;let r=n.next;for(;r;)r=r.emit(this.deltaTime);n.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(t){const e=Math.min(this.maxFPS,t),n=Math.min(Math.max(0,e)/1e3,Gn.targetFPMS);this._maxElapsedMS=1/n}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(t){if(0===t)this._minElapsedMS=0;else{const e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}}static get shared(){if(!Gn._shared){const t=Gn._shared=new Gn;t.autoStart=!0,t._protected=!0}return Gn._shared}static get system(){if(!Gn._system){const t=Gn._system=new Gn;t.autoStart=!0,t._protected=!0}return Gn._system}};let Yt=Gn;Yt.targetFPMS=.06,Object.defineProperties(ue,{TARGET_FPMS:{get:()=>Yt.targetFPMS,set(t){Ye("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),Yt.targetFPMS=t}}});class Yb{static init(e){e=Object.assign({autoStart:!0,sharedTicker:!1},e),Object.defineProperty(this,"ticker",{set(n){this._ticker&&this._ticker.remove(this.render,this),this._ticker=n,n&&n.add(this.render,this,Fi.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=e.sharedTicker?Yt.shared:new Yt,e.autoStart&&this.start()}static destroy(){if(this._ticker){const e=this._ticker;this.ticker=null,e.destroy()}}}Yb.extension=de.Application,Se.add(Yb);const qb=[];Se.handleByList(de.Renderer,qb);const Zb="attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n";class Kb{constructor(e){this.renderer=e}contextChange(e){let n;if(1===this.renderer.context.webGLVersion){const r=e.getParameter(e.FRAMEBUFFER_BINDING);e.bindFramebuffer(e.FRAMEBUFFER,null),n=e.getParameter(e.SAMPLES),e.bindFramebuffer(e.FRAMEBUFFER,r)}else{const r=e.getParameter(e.DRAW_FRAMEBUFFER_BINDING);e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),n=e.getParameter(e.SAMPLES),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,r)}this.multisample=n>=Xt.HIGH?Xt.HIGH:n>=Xt.MEDIUM?Xt.MEDIUM:n>=Xt.LOW?Xt.LOW:Xt.NONE}destroy(){}}Kb.extension={type:de.RendererSystem,name:"_multisample"},Se.add(Kb);class Fk{constructor(e){this.buffer=e||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class Qb{constructor(e){this.renderer=e,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(e){const{gl:n,CONTEXT_UID:r}=this,i=e._glBuffers[r]||this.createGLBuffer(e);n.bindBuffer(e.type,i.buffer)}unbind(e){const{gl:n}=this;n.bindBuffer(e,null)}bindBufferBase(e,n){const{gl:r,CONTEXT_UID:i}=this;if(this.boundBufferBases[n]!==e){const s=e._glBuffers[i]||this.createGLBuffer(e);this.boundBufferBases[n]=e,r.bindBufferBase(r.UNIFORM_BUFFER,n,s.buffer)}}bindBufferRange(e,n,r){const{gl:i,CONTEXT_UID:s}=this;r=r||0;const o=e._glBuffers[s]||this.createGLBuffer(e);i.bindBufferRange(i.UNIFORM_BUFFER,n||0,o.buffer,256*r,256)}update(e){const{gl:n,CONTEXT_UID:r}=this,i=e._glBuffers[r]||this.createGLBuffer(e);if(e._updateID!==i.updateID)if(i.updateID=e._updateID,n.bindBuffer(e.type,i.buffer),i.byteLength>=e.data.byteLength)n.bufferSubData(e.type,0,e.data);else{const s=e.static?n.STATIC_DRAW:n.DYNAMIC_DRAW;i.byteLength=e.data.byteLength,n.bufferData(e.type,e.data,s)}}dispose(e,n){if(!this.managedBuffers[e.id])return;delete this.managedBuffers[e.id];const r=e._glBuffers[this.CONTEXT_UID],i=this.gl;e.disposeRunner.remove(this),r&&(n||i.deleteBuffer(r.buffer),delete e._glBuffers[this.CONTEXT_UID])}disposeAll(e){const n=Object.keys(this.managedBuffers);for(let r=0;r<n.length;r++)this.dispose(this.managedBuffers[n[r]],e)}createGLBuffer(e){const{CONTEXT_UID:n,gl:r}=this;return e._glBuffers[n]=new Fk(r.createBuffer()),this.managedBuffers[e.id]=e,e.disposeRunner.add(this),e._glBuffers[n]}}Qb.extension={type:de.RendererSystem,name:"buffer"},Se.add(Qb);class Jb{constructor(e){this.renderer=e}render(e,n){const r=this.renderer;let i,s,o,a;if(n&&(i=n.renderTexture,s=n.clear,o=n.transform,a=n.skipUpdateTransform),this.renderingToScreen=!i,r.runners.prerender.emit(),r.emit("prerender"),r.projection.transform=o,!r.context.isLost){if(i||(this.lastObjectRendered=e),!a){const l=e.enableTempParent();e.updateTransform(),e.disableTempParent(l)}r.renderTexture.bind(i),r.batch.currentRenderer.start(),(s??r.background.clearBeforeRender)&&r.renderTexture.clear(),e.render(r),r.batch.currentRenderer.flush(),i&&(n.blit&&r.framebuffer.blit(),i.baseTexture.update()),r.runners.postrender.emit(),r.projection.transform=null,r.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}Jb.extension={type:de.RendererSystem,name:"objectRenderer"},Se.add(Jb);const vg=class extends Ik{constructor(t){super(),this.type=IE.WEBGL,t=Object.assign({},ue.RENDER_OPTIONS,t),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new gr({projectionMatrix:new Pt},!0),this.setup({runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:vg.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]}),"useContextAlpha"in t&&(Ye("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),t.premultipliedAlpha=t.useContextAlpha&&"notMultiplied"!==t.useContextAlpha,t.backgroundAlpha=!1===t.useContextAlpha?1:t.backgroundAlpha),this._plugin.rendererPlugins=vg.__plugins,this.options=t,this.startup.run(this.options)}static test(t){return!t?.forceCanvas&&function rB(){return typeof jp>"u"&&(jp=function(){const e={stencil:!0,failIfMajorPerformanceCaveat:ue.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!ue.ADAPTER.getWebGLRenderingContext())return!1;const n=ue.ADAPTER.createCanvas();let r=n.getContext("webgl",e)||n.getContext("experimental-webgl",e);const i=!!r?.getContextAttributes()?.stencil;if(r){const s=r.getExtension("WEBGL_lose_context");s&&s.loseContext()}return r=null,i}catch{return!1}}()),jp}()}render(t,e){this.objectRenderer.render(t,e)}resize(t,e){this._view.resizeView(t,e)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(t=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:t}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(t){this._view.resolution=t,this.runners.resolutionChange.emit(t)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return Ye("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return Ye("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return Ye("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return Ye("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(t){Ye("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=t}get backgroundAlpha(){return Ye("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha}set backgroundAlpha(t){Ye("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=t}get powerPreference(){return Ye("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(t,e){return this.textureGenerator.generateTexture(t,e)}};let So=vg;So.extension={type:de.Renderer,priority:1},So.__plugins={},So.__systems={},Se.handleByMap(de.RendererPlugin,So.__plugins),Se.handleByMap(de.RendererSystem,So.__systems),Se.add(So);class eD extends za{constructor(e,n){const{width:r,height:i}=n||{};super(r,i),this.items=[],this.itemDirtyIds=[];for(let s=0;s<e;s++){const o=new $e;this.items.push(o),this.itemDirtyIds.push(-2)}this.length=e,this._load=null,this.baseTexture=null}initFromArray(e,n){for(let r=0;r<this.length;r++)e[r]&&(e[r].castToBaseTexture?this.addBaseTextureAt(e[r].castToBaseTexture(),r):this.addResourceAt(e[r]instanceof za?e[r]:lb(e[r],n),r))}dispose(){for(let e=0,n=this.length;e<n;e++)this.items[e].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(e,n){if(!this.items[n])throw new Error(`Index ${n} is out of bounds`);return e.valid&&!this.valid&&this.resize(e.width,e.height),this.items[n].setResource(e),this}bind(e){if(null!==this.baseTexture)throw new Error("Only one base texture per TextureArray is allowed");super.bind(e);for(let n=0;n<this.length;n++)this.items[n].parentTextureArray=e,this.items[n].on("update",e.update,e)}unbind(e){super.unbind(e);for(let n=0;n<this.length;n++)this.items[n].parentTextureArray=null,this.items[n].off("update",e.update,e)}load(){if(this._load)return this._load;const n=this.items.map(r=>r.resource).filter(r=>r).map(r=>r.load());return this._load=Promise.all(n).then(()=>{const{realWidth:r,realHeight:i}=this.items[0];return this.resize(r,i),Promise.resolve(this)}),this._load}}const Ka=class extends eD{constructor(t,e){const{width:n,height:r,autoLoad:i,linkBaseTexture:s}=e||{};if(t&&t.length!==Ka.SIDES)throw new Error(`Invalid length. Got ${t.length}, expected 6`);super(6,{width:n,height:r});for(let o=0;o<Ka.SIDES;o++)this.items[o].target=_o.TEXTURE_CUBE_MAP_POSITIVE_X+o;this.linkBaseTexture=!1!==s,t&&this.initFromArray(t,e),!1!==i&&this.load()}bind(t){super.bind(t),t.target=_o.TEXTURE_CUBE_MAP}addBaseTextureAt(t,e,n){if(void 0===n&&(n=this.linkBaseTexture),!this.items[e])throw new Error(`Index ${e} is out of bounds`);if(!this.linkBaseTexture||t.parentTextureArray||Object.keys(t._glTextures).length>0){if(!t.resource)throw new Error("CubeResource does not support copying of renderTexture.");this.addResourceAt(t.resource,e)}else t.target=_o.TEXTURE_CUBE_MAP_POSITIVE_X+e,t.parentTextureArray=this.baseTexture,this.items[e]=t;return t.valid&&!this.valid&&this.resize(t.realWidth,t.realHeight),this.items[e]=t,this}upload(t,e,n){const r=this.itemDirtyIds;for(let i=0;i<Ka.SIDES;i++){const s=this.items[i];(r[i]<s.dirtyId||n.dirtyId<e.dirtyId)&&(s.valid&&s.resource?(s.resource.upload(t,s,n),r[i]=s.dirtyId):r[i]<-1&&(t.gl.texImage2D(s.target,0,n.internalFormat,e.realWidth,e.realHeight,0,e.format,n.type,null),r[i]=-1))}return!0}static test(t){return Array.isArray(t)&&t.length===Ka.SIDES}};let tD=Ka;function nD(t,e,n,r,i,s,o){try{var a=t[s](o),l=a.value}catch(c){return void n(c)}a.done?e(l):Promise.resolve(l).then(r,i)}function Z(t){return function(){var e=this,n=arguments;return new Promise(function(r,i){var s=t.apply(e,n);function o(l){nD(s,r,i,o,a,"next",l)}function a(l){nD(s,r,i,o,a,"throw",l)}o(void 0)})}}tD.SIDES=6;class To extends Ni{constructor(e,n){let r,i;n=n||{},"string"==typeof e?(r=To.EMPTY,i=e):(r=e,i=null),super(r),this.url=i,this.crossOrigin=n.crossOrigin??!0,this.alphaMode="number"==typeof n.alphaMode?n.alphaMode:null,this._load=null,!1!==n.autoLoad&&this.load()}load(){var e=this;return this._load||(this._load=new Promise(function(){var n=Z(function*(r,i){if(null!==e.url)try{const s=yield ue.ADAPTER.fetch(e.url,{mode:e.crossOrigin?"cors":"no-cors"});if(e.destroyed)return;const o=yield s.blob();if(e.destroyed)return;const a=yield createImageBitmap(o,{premultiplyAlpha:null===e.alphaMode||e.alphaMode===hr.UNPACK?"premultiply":"none"});if(e.destroyed)return;e.source=a,e.update(),r(e)}catch(s){if(e.destroyed)return;i(s),e.onError.emit(s)}else r(e)});return function(r,i){return n.apply(this,arguments)}}())),this._load}upload(e,n,r){return this.source instanceof ImageBitmap?("number"==typeof this.alphaMode&&(n.alphaMode=this.alphaMode),super.upload(e,n,r)):(this.load(),!1)}dispose(){this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(e){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&("string"==typeof e||e instanceof ImageBitmap)}static get EMPTY(){return To._EMPTY=To._EMPTY??ue.ADAPTER.createCanvas(0,0),To._EMPTY}}const Fu=class extends Ni{constructor(t,e){e=e||{},super(ue.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=t,this.scale=e.scale||1,this._overrideWidth=e.width,this._overrideHeight=e.height,this._resolve=null,this._crossorigin=e.crossorigin,this._load=null,!1!==e.autoLoad&&this.load()}load(){return this._load||(this._load=new Promise(t=>{if(this._resolve=()=>{this.resize(this.source.width,this.source.height),t(this)},Fu.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()})),this._load}_loadSvg(){const t=new Image;Ni.crossOrigin(t,this.svg,this._crossorigin),t.src=this.svg,t.onerror=e=>{this._resolve&&(t.onerror=null,this.onError.emit(e))},t.onload=()=>{if(!this._resolve)return;const e=t.width,n=t.height;if(!e||!n)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let r=e*this.scale,i=n*this.scale;(this._overrideWidth||this._overrideHeight)&&(r=this._overrideWidth||this._overrideHeight/n*e,i=this._overrideHeight||this._overrideWidth/e*n),r=Math.round(r),i=Math.round(i);const s=this.source;s.width=r,s.height=i,s._pixiId=`canvas_${is()}`,s.getContext("2d").drawImage(t,0,0,e,n,0,0,r,i),this._resolve(),this._resolve=null}}static getSize(t){const e=Fu.SVG_SIZE.exec(t),n={};return e&&(n[e[1]]=Math.round(parseFloat(e[3])),n[e[5]]=Math.round(parseFloat(e[7]))),n}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(t,e){return"svg"===e||"string"==typeof t&&t.startsWith("data:image/svg+xml")||"string"==typeof t&&Fu.SVG_XML.test(t)}};let Qa=Fu;Qa.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,Qa.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;const xg=class extends Ni{constructor(t,e){if(e=e||{},!(t instanceof HTMLVideoElement)){const n=document.createElement("video");n.setAttribute("preload","auto"),n.setAttribute("webkit-playsinline",""),n.setAttribute("playsinline",""),"string"==typeof t&&(t=[t]),Ni.crossOrigin(n,t[0].src||t[0],e.crossorigin);for(let i=0;i<t.length;++i){const s=document.createElement("source");let{src:o,mime:a}=t[i];o=o||t[i];const l=o.split("?").shift().toLowerCase(),c=l.slice(l.lastIndexOf(".")+1);a=a||xg.MIME_TYPES[c]||`video/${c}`,s.src=o,s.type=a,n.appendChild(s)}t=n}super(t),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=e.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=!1!==e.autoPlay,this._load=null,this._resolve=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),!1!==e.autoLoad&&this.load()}update(t=0){this.destroyed||(this._msToNextUpdate=Math.floor(this._msToNextUpdate-Yt.shared.elapsedMS*this.source.playbackRate),(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0))}load(){if(this._load)return this._load;const t=this.source;return(t.readyState===t.HAVE_ENOUGH_DATA||t.readyState===t.HAVE_FUTURE_DATA)&&t.width&&t.height&&(t.complete=!0),t.addEventListener("play",this._onPlayStart.bind(this)),t.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(t.addEventListener("canplay",this._onCanPlay),t.addEventListener("canplaythrough",this._onCanPlay),t.addEventListener("error",this._onError,!0)),this._load=new Promise(e=>{this.valid?e(this):(this._resolve=e,t.load())}),this._load}_onError(t){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(t)}_isSourcePlaying(){const t=this.source;return!t.paused&&!t.ended&&this._isSourceReady()}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this.autoUpdate&&!this._isConnectedToTicker&&(Yt.shared.add(this.update,this),this._isConnectedToTicker=!0)}_onPlayStop(){this._isConnectedToTicker&&(Yt.shared.remove(this.update,this),this._isConnectedToTicker=!1)}_onCanPlay(){const t=this.source;t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay);const e=this.valid;this.resize(t.videoWidth,t.videoHeight),!e&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&t.play()}dispose(){this._isConnectedToTicker&&(Yt.shared.remove(this.update,this),this._isConnectedToTicker=!1);const t=this.source;t&&(t.removeEventListener("error",this._onError,!0),t.pause(),t.src="",t.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(Yt.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying()&&(Yt.shared.add(this.update,this),this._isConnectedToTicker=!0))}get updateFPS(){return this._updateFPS}set updateFPS(t){t!==this._updateFPS&&(this._updateFPS=t)}static test(t,e){return globalThis.HTMLVideoElement&&t instanceof HTMLVideoElement||xg.TYPES.includes(e)}};let wg=xg;wg.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],wg.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"},ig.push(To,wb,class Lk extends Ni{constructor(e){super(e)}static test(e){const{OffscreenCanvas:n}=globalThis;return!!(n&&e instanceof n)||globalThis.HTMLCanvasElement&&e instanceof HTMLCanvasElement}},wg,Qa,Wa,tD,class Ok extends eD{constructor(e,n){const{width:r,height:i}=n||{};let s,o;Array.isArray(e)?(s=e,o=e.length):o=e,super(o,{width:r,height:i}),s&&this.initFromArray(s,n)}addBaseTextureAt(e,n){if(!e.resource)throw new Error("ArrayResource does not support RenderTexture");return this.addResourceAt(e.resource,n),this}bind(e){super.bind(e),e.target=_o.TEXTURE_2D_ARRAY}upload(e,n,r){const{length:i,itemDirtyIds:s,items:o}=this,{gl:a}=e;r.dirtyId<0&&a.texImage3D(a.TEXTURE_2D_ARRAY,0,r.internalFormat,this._width,this._height,i,0,n.format,r.type,null);for(let l=0;l<i;l++){const c=o[l];s[l]<c.dirtyId&&(s[l]=c.dirtyId,c.valid&&a.texSubImage3D(a.TEXTURE_2D_ARRAY,0,0,0,l,c.resource.width,c.resource.height,1,n.format,r.type,c.resource.source))}return!0}});const Ja={build(t){const e=t.points;let n,r,i,s,o,a;if(t.type===an.CIRC){const p=t.shape;n=p.x,r=p.y,o=a=p.radius,i=s=0}else if(t.type===an.ELIP){const p=t.shape;n=p.x,r=p.y,o=p.width,a=p.height,i=s=0}else{const p=t.shape,g=p.width/2,m=p.height/2;n=p.x+g,r=p.y+m,o=a=Math.max(0,Math.min(p.radius,Math.min(g,m))),i=g-o,s=m-a}if(!(o>=0&&a>=0&&i>=0&&s>=0))return void(e.length=0);const l=Math.ceil(2.3*Math.sqrt(o+a)),c=8*l+(i?4:0)+(s?4:0);if(e.length=c,0===c)return;if(0===l)return e.length=8,e[0]=e[6]=n+i,e[1]=e[3]=r+s,e[2]=e[4]=n-i,void(e[5]=e[7]=r-s);let u=0,h=4*l+(i?2:0)+2,d=h,f=c;{const p=i+o,g=s,m=n+p,_=n-p,v=r+g;if(e[u++]=m,e[u++]=v,e[--h]=v,e[--h]=_,s){const D=r-g;e[d++]=_,e[d++]=D,e[--f]=D,e[--f]=m}}for(let p=1;p<l;p++){const g=Math.PI/2*(p/l),m=i+Math.cos(g)*o,_=s+Math.sin(g)*a,v=n+m,D=n-m,A=r+_,$=r-_;e[u++]=v,e[u++]=A,e[--h]=A,e[--h]=D,e[d++]=D,e[d++]=$,e[--f]=$,e[--f]=v}{const g=s+a,m=n+i,_=n-i,v=r+g,D=r-g;e[u++]=m,e[u++]=v,e[--f]=D,e[--f]=m,i&&(e[u++]=_,e[u++]=v,e[--f]=D,e[--f]=_)}},triangulate(t,e){const n=t.points,r=e.points,i=e.indices;if(0===n.length)return;let s=r.length/2;const o=s;let a,l;if(t.type!==an.RREC){const u=t.shape;a=u.x,l=u.y}else{const u=t.shape;a=u.x+u.width/2,l=u.y+u.height/2}const c=t.matrix;r.push(t.matrix?c.a*a+c.c*l+c.tx:a,t.matrix?c.b*a+c.d*l+c.ty:l),s++,r.push(n[0],n[1]);for(let u=2;u<n.length;u+=2)r.push(n[u],n[u+1]),i.push(s++,o,s);i.push(o+1,o,s)}};function rD(t,e=!1){const n=t.length;if(n<6)return;let r=0;for(let i=0,s=t[n-2],o=t[n-1];i<n;i+=2){const a=t[i],l=t[i+1];r+=(a-s)*(l+o),s=a,o=l}if(!e&&r>0||e&&r<=0){const i=n/2;for(let s=i+i%2;s<n;s+=2){const o=n-s-2,a=n-s-1,l=s,c=s+1;[t[o],t[l]]=[t[l],t[o]],[t[a],t[c]]=[t[c],t[a]]}}}const Eg={build(t){t.points=t.shape.points.slice()},triangulate(t,e){let n=t.points;const r=t.holes,i=e.points,s=e.indices;if(n.length>=6){rD(n,!1);const o=[];for(let c=0;c<r.length;c++){const u=r[c];rD(u.points,!0),o.push(n.length/2),n=n.concat(u.points)}const a=QL(n,o,2);if(!a)return;const l=i.length/2;for(let c=0;c<a.length;c+=3)s.push(a[c]+l),s.push(a[c+1]+l),s.push(a[c+2]+l);for(let c=0;c<n.length;c++)i.push(n[c])}}},iD={build(t){const e=t.shape,n=e.x,r=e.y,i=e.width,s=e.height,o=t.points;o.length=0,i>=0&&s>=0&&o.push(n,r,n+i,r,n+i,r+s,n,r+s)},triangulate(t,e){const n=t.points,r=e.points;if(0===n.length)return;const i=r.length/2;r.push(n[0],n[1],n[2],n[3],n[6],n[7],n[4],n[5]),e.indices.push(i,i+1,i+2,i+1,i+2,i+3)}},sD={build(t){Ja.build(t)},triangulate(t,e){Ja.triangulate(t,e)}};var vr=(t=>(t.MITER="miter",t.BEVEL="bevel",t.ROUND="round",t))(vr||{}),ds=(t=>(t.BUTT="butt",t.ROUND="round",t.SQUARE="square",t))(ds||{});const Co={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(t,e=20){if(!this.adaptive||!t||isNaN(t))return e;let n=Math.ceil(t/this.maxLength);return n<this.minSegments?n=this.minSegments:n>this.maxSegments&&(n=this.maxSegments),n}};class bg{static curveTo(e,n,r,i,s,o){const c=o[o.length-1]-n,u=o[o.length-2]-e,h=i-n,d=r-e,f=Math.abs(c*d-u*h);if(f<1e-8||0===s)return(o[o.length-2]!==e||o[o.length-1]!==n)&&o.push(e,n),null;const p=c*c+u*u,g=h*h+d*d,m=c*h+u*d,_=s*Math.sqrt(p)/f,v=s*Math.sqrt(g)/f,D=_*m/p,A=v*m/g,$=_*d+v*u,pe=_*h+v*c,Ve=d*(_+A),te=h*(_+A);return{cx:$+e,cy:pe+n,radius:s,startAngle:Math.atan2(c*(v+D)-pe,u*(v+D)-$),endAngle:Math.atan2(te-pe,Ve-$),anticlockwise:u*h>d*c}}static arc(e,n,r,i,s,o,a,l,c){const u=a-o,h=Co._segmentsCount(Math.abs(u)*s,40*Math.ceil(Math.abs(u)/Xa)),d=u/(2*h),f=2*d,p=Math.cos(d),g=Math.sin(d),m=h-1,_=m%1/m;for(let v=0;v<=m;++v){const A=d+o+f*(v+_*v),$=Math.cos(A),pe=-Math.sin(A);c.push((p*$+g*pe)*s+r,(p*-pe+g*$)*s+i)}}}class Ou{static curveLength(e,n,r,i,s,o,a,l){let u=0,h=0,d=0,f=0,p=0,g=0,m=0,_=0,v=0,D=0,A=0,$=e,pe=n;for(let J=1;J<=10;++J)h=J/10,d=h*h,f=d*h,p=1-h,g=p*p,m=g*p,_=m*e+3*g*h*r+3*p*d*s+f*a,v=m*n+3*g*h*i+3*p*d*o+f*l,D=$-_,A=pe-v,$=_,pe=v,u+=Math.sqrt(D*D+A*A);return u}static curveTo(e,n,r,i,s,o,a){const l=a[a.length-2],c=a[a.length-1];a.length-=2;const u=Co._segmentsCount(Ou.curveLength(l,c,e,n,r,i,s,o));let h=0,d=0,f=0,p=0,g=0;a.push(l,c);for(let m=1,_=0;m<=u;++m)_=m/u,h=1-_,d=h*h,f=d*h,p=_*_,g=p*_,a.push(f*l+3*d*_*e+3*h*p*r+g*s,f*c+3*d*_*n+3*h*p*i+g*o)}}function oD(t,e,n,r,i,s,o,a){let d,f;return o?(d=r,f=-n):(d=-r,f=n),a.push(t-n*i+d,e-r*i+f,t+n*s+d,e+r*s+f),2}function fs(t,e,n,r,i,s,o,a){const l=n-t,c=r-e;let u=Math.atan2(l,c),h=Math.atan2(i-t,s-e);a&&u<h?u+=2*Math.PI:!a&&u>h&&(h+=2*Math.PI);let d=u;const f=h-u,p=Math.abs(f),g=Math.sqrt(l*l+c*c),m=1+(15*p*Math.sqrt(g)/Math.PI>>0),_=f/m;if(d+=_,a){o.push(t,e,n,r);for(let v=1,D=d;v<m;v++,D+=_)o.push(t,e,t+Math.sin(D)*g,e+Math.cos(D)*g);o.push(t,e,i,s)}else{o.push(n,r,t,e);for(let v=1,D=d;v<m;v++,D+=_)o.push(t+Math.sin(D)*g,e+Math.cos(D)*g,t,e);o.push(i,s,t,e)}return 2*m}function Dg(t,e){t.lineStyle.native?function kk(t,e){let n=0;const r=t.shape,i=t.points||r.points,s=r.type!==an.POLY||r.closeStroke;if(0===i.length)return;const o=e.points,a=e.indices,l=i.length/2,c=o.length/2;let u=c;for(o.push(i[0],i[1]),n=1;n<l;n++)o.push(i[2*n],i[2*n+1]),a.push(u,u+1),u++;s&&a.push(u,c)}(t,e):function Bk(t,e){const n=t.shape;let r=t.points||n.points.slice();const i=e.closePointEps;if(0===r.length)return;const s=t.lineStyle,o=new ct(r[0],r[1]),a=new ct(r[r.length-2],r[r.length-1]),l=n.type!==an.POLY||n.closeStroke,c=Math.abs(o.x-a.x)<i&&Math.abs(o.y-a.y)<i;if(l){r=r.slice(),c&&(r.pop(),r.pop(),a.set(r[r.length-2],r[r.length-1]));const qe=.5*(o.x+a.x),Tt=.5*(a.y+o.y);r.unshift(qe,Tt),r.push(qe,Tt)}const u=e.points,h=r.length/2;let d=r.length;const f=u.length/2,p=s.width/2,g=p*p,m=s.miterLimit*s.miterLimit;let _=r[0],v=r[1],D=r[2],A=r[3],$=0,pe=0,J=-(v-A),ee=_-D,Ve=0,te=0,he=Math.sqrt(J*J+ee*ee);J/=he,ee/=he,J*=p,ee*=p;const st=s.alignment,X=2*(1-st),Y=2*st;l||(s.cap===ds.ROUND?d+=fs(_-J*(X-Y)*.5,v-ee*(X-Y)*.5,_-J*X,v-ee*X,_+J*Y,v+ee*Y,u,!0)+2:s.cap===ds.SQUARE&&(d+=oD(_,v,J,ee,X,Y,!0,u))),u.push(_-J*X,v-ee*X,_+J*Y,v+ee*Y);for(let qe=1;qe<h-1;++qe){_=r[2*(qe-1)],v=r[2*(qe-1)+1],D=r[2*qe],A=r[2*qe+1],$=r[2*(qe+1)],pe=r[2*(qe+1)+1],J=-(v-A),ee=_-D,he=Math.sqrt(J*J+ee*ee),J/=he,ee/=he,J*=p,ee*=p,Ve=-(A-pe),te=D-$,he=Math.sqrt(Ve*Ve+te*te),Ve/=he,te/=he,Ve*=p,te*=p;const Tt=D-_,ut=v-A,dl=D-$,fl=pe-A,qD=Tt*dl+ut*fl,lh=ut*dl-fl*Tt,pl=lh<0;if(Math.abs(lh)<.001*Math.abs(qD)){u.push(D-J*X,A-ee*X,D+J*Y,A+ee*Y),qD>=0&&(d+=s.join===vr.ROUND?fs(D,A,D-J*X,A-ee*X,D-Ve*X,A-te*X,u,!1)+4:2,u.push(D-Ve*Y,A-te*Y,D+Ve*X,A+te*X));continue}const ZD=(-J+_)*(-ee+A)-(-J+D)*(-ee+v),KD=(-Ve+$)*(-te+A)-(-Ve+D)*(-te+pe),ch=(Tt*KD-dl*ZD)/lh,uh=(fl*ZD-ut*KD)/lh,QD=(ch-D)*(ch-D)+(uh-A)*(uh-A),ms=D+(ch-D)*X,ys=A+(uh-A)*X,_s=D-(ch-D)*Y,vs=A-(uh-A)*Y,QU=Math.min(Tt*Tt+ut*ut,dl*dl+fl*fl),JD=pl?X:Y;let hh=s.join;if(hh===vr.MITER&&QD/g>m&&(hh=vr.BEVEL),QD<=QU+JD*JD*g)switch(hh){case vr.MITER:u.push(ms,ys,_s,vs);break;case vr.BEVEL:pl?u.push(ms,ys,D+J*Y,A+ee*Y,ms,ys,D+Ve*Y,A+te*Y):u.push(D-J*X,A-ee*X,_s,vs,D-Ve*X,A-te*X,_s,vs),d+=2;break;case vr.ROUND:pl?(u.push(ms,ys,D+J*Y,A+ee*Y),d+=fs(D,A,D+J*Y,A+ee*Y,D+Ve*Y,A+te*Y,u,!0)+4,u.push(ms,ys,D+Ve*Y,A+te*Y)):(u.push(D-J*X,A-ee*X,_s,vs),d+=fs(D,A,D-J*X,A-ee*X,D-Ve*X,A-te*X,u,!1)+4,u.push(D-Ve*X,A-te*X,_s,vs))}else{switch(u.push(D-J*X,A-ee*X,D+J*Y,A+ee*Y),hh){case vr.MITER:pl?u.push(_s,vs,_s,vs):u.push(ms,ys,ms,ys),d+=2;break;case vr.ROUND:d+=pl?fs(D,A,D+J*Y,A+ee*Y,D+Ve*Y,A+te*Y,u,!0)+2:fs(D,A,D-J*X,A-ee*X,D-Ve*X,A-te*X,u,!1)+2}u.push(D-Ve*X,A-te*X,D+Ve*Y,A+te*Y),d+=2}}_=r[2*(h-2)],v=r[2*(h-2)+1],D=r[2*(h-1)],A=r[2*(h-1)+1],J=-(v-A),ee=_-D,he=Math.sqrt(J*J+ee*ee),J/=he,ee/=he,J*=p,ee*=p,u.push(D-J*X,A-ee*X,D+J*Y,A+ee*Y),l||(s.cap===ds.ROUND?d+=fs(D-J*(X-Y)*.5,A-ee*(X-Y)*.5,D-J*X,A-ee*X,D+J*Y,A+ee*Y,u,!1)+2:s.cap===ds.SQUARE&&(d+=oD(D,A,J,ee,X,Y,!1,u)));const St=e.indices,Qe=Co.epsilon*Co.epsilon;for(let qe=f;qe<d+f-2;++qe)_=u[2*qe],v=u[2*qe+1],D=u[2*(qe+1)],A=u[2*(qe+1)+1],$=u[2*(qe+2)],pe=u[2*(qe+2)+1],!(Math.abs(_*(A-pe)+D*(pe-v)+$*(v-A))<Qe)&&St.push(qe,qe+1,qe+2)}(t,e)}class Lu{static curveLength(e,n,r,i,s,o){const a=e-2*r+s,l=n-2*i+o,c=2*r-2*e,u=2*i-2*n,h=4*(a*a+l*l),d=4*(a*c+l*u),f=c*c+u*u,p=2*Math.sqrt(h+d+f),g=Math.sqrt(h),m=2*h*g,_=2*Math.sqrt(f),v=d/g;return(m*p+g*d*(p-_)+(4*f*h-d*d)*Math.log((2*g+v+p)/(v+_)))/(4*m)}static curveTo(e,n,r,i,s){const o=s[s.length-2],a=s[s.length-1],l=Co._segmentsCount(Lu.curveLength(o,a,e,n,r,i));let c=0,u=0;for(let h=1;h<=l;++h){const d=h/l;c=o+(e-o)*d,u=a+(n-a)*d,s.push(c+(e+(r-e)*d-c)*d,u+(n+(i-n)*d-u)*d)}}}const Bu={[an.POLY]:Eg,[an.CIRC]:Ja,[an.ELIP]:Ja,[an.RECT]:iD,[an.RREC]:sD},Sg=[],el=[];class ku{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(e){return this.minX>this.maxX||this.minY>this.maxY?nt.EMPTY:((e=e||new nt(0,0,1,1)).x=this.minX,e.y=this.minY,e.width=this.maxX-this.minX,e.height=this.maxY-this.minY,e)}addPoint(e){this.minX=Math.min(this.minX,e.x),this.maxX=Math.max(this.maxX,e.x),this.minY=Math.min(this.minY,e.y),this.maxY=Math.max(this.maxY,e.y)}addPointMatrix(e,n){const{a:r,b:i,c:s,d:o,tx:a,ty:l}=e,c=r*n.x+s*n.y+a,u=i*n.x+o*n.y+l;this.minX=Math.min(this.minX,c),this.maxX=Math.max(this.maxX,c),this.minY=Math.min(this.minY,u),this.maxY=Math.max(this.maxY,u)}addQuad(e){let n=this.minX,r=this.minY,i=this.maxX,s=this.maxY,o=e[0],a=e[1];n=o<n?o:n,r=a<r?a:r,i=o>i?o:i,s=a>s?a:s,o=e[2],a=e[3],n=o<n?o:n,r=a<r?a:r,i=o>i?o:i,s=a>s?a:s,o=e[4],a=e[5],n=o<n?o:n,r=a<r?a:r,i=o>i?o:i,s=a>s?a:s,o=e[6],a=e[7],n=o<n?o:n,r=a<r?a:r,i=o>i?o:i,s=a>s?a:s,this.minX=n,this.minY=r,this.maxX=i,this.maxY=s}addFrame(e,n,r,i,s){this.addFrameMatrix(e.worldTransform,n,r,i,s)}addFrameMatrix(e,n,r,i,s){const o=e.a,a=e.b,l=e.c,c=e.d,u=e.tx,h=e.ty;let d=this.minX,f=this.minY,p=this.maxX,g=this.maxY,m=o*n+l*r+u,_=a*n+c*r+h;d=m<d?m:d,f=_<f?_:f,p=m>p?m:p,g=_>g?_:g,m=o*i+l*r+u,_=a*i+c*r+h,d=m<d?m:d,f=_<f?_:f,p=m>p?m:p,g=_>g?_:g,m=o*n+l*s+u,_=a*n+c*s+h,d=m<d?m:d,f=_<f?_:f,p=m>p?m:p,g=_>g?_:g,m=o*i+l*s+u,_=a*i+c*s+h,d=m<d?m:d,f=_<f?_:f,p=m>p?m:p,g=_>g?_:g,this.minX=d,this.minY=f,this.maxX=p,this.maxY=g}addVertexData(e,n,r){let i=this.minX,s=this.minY,o=this.maxX,a=this.maxY;for(let l=n;l<r;l+=2){const c=e[l],u=e[l+1];i=c<i?c:i,s=u<s?u:s,o=c>o?c:o,a=u>a?u:a}this.minX=i,this.minY=s,this.maxX=o,this.maxY=a}addVertices(e,n,r,i){this.addVerticesMatrix(e.worldTransform,n,r,i)}addVerticesMatrix(e,n,r,i,s=0,o=s){const a=e.a,l=e.b,c=e.c,u=e.d,h=e.tx,d=e.ty;let f=this.minX,p=this.minY,g=this.maxX,m=this.maxY;for(let _=r;_<i;_+=2){const v=n[_],D=n[_+1],A=a*v+c*D+h,$=u*D+l*v+d;f=Math.min(f,A-s),g=Math.max(g,A+s),p=Math.min(p,$-o),m=Math.max(m,$+o)}this.minX=f,this.minY=p,this.maxX=g,this.maxY=m}addBounds(e){const n=this.minX,r=this.minY,i=this.maxX,s=this.maxY;this.minX=e.minX<n?e.minX:n,this.minY=e.minY<r?e.minY:r,this.maxX=e.maxX>i?e.maxX:i,this.maxY=e.maxY>s?e.maxY:s}addBoundsMask(e,n){const r=e.minX>n.minX?e.minX:n.minX,i=e.minY>n.minY?e.minY:n.minY,s=e.maxX<n.maxX?e.maxX:n.maxX,o=e.maxY<n.maxY?e.maxY:n.maxY;if(r<=s&&i<=o){const a=this.minX,l=this.minY,c=this.maxX,u=this.maxY;this.minX=r<a?r:a,this.minY=i<l?i:l,this.maxX=s>c?s:c,this.maxY=o>u?o:u}}addBoundsMatrix(e,n){this.addFrameMatrix(n,e.minX,e.minY,e.maxX,e.maxY)}addBoundsArea(e,n){const r=e.minX>n.x?e.minX:n.x,i=e.minY>n.y?e.minY:n.y,s=e.maxX<n.x+n.width?e.maxX:n.x+n.width,o=e.maxY<n.y+n.height?e.maxY:n.y+n.height;if(r<=s&&i<=o){const a=this.minX,l=this.minY,c=this.maxX,u=this.maxY;this.minX=r<a?r:a,this.minY=i<l?i:l,this.maxX=s>c?s:c,this.maxY=o>u?o:u}}pad(e=0,n=e){this.isEmpty()||(this.minX-=e,this.maxX+=e,this.minY-=n,this.maxY+=n)}addFramePad(e,n,r,i,s,o){n-=o,r+=s,i+=o,this.minX=this.minX<(e-=s)?this.minX:e,this.maxX=this.maxX>r?this.maxX:r,this.minY=this.minY<n?this.minY:n,this.maxY=this.maxY>i?this.maxY:i}}class Bt extends Ga{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new ug,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new ku,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(e){const n=Object.keys(e);for(let r=0;r<n.length;++r){const i=n[r];Object.defineProperty(Bt.prototype,i,Object.getOwnPropertyDescriptor(e,i))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(e,n){return e||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),n||(this._boundsRect||(this._boundsRect=new nt),n=this._boundsRect),this._bounds.getRectangle(n)}getLocalBounds(e){e||(this._localBoundsRect||(this._localBoundsRect=new nt),e=this._localBoundsRect),this._localBounds||(this._localBounds=new ku);const n=this.transform,r=this.parent;this.parent=null,this.transform=this._tempDisplayObjectParent.transform;const i=this._bounds,s=this._boundsID;this._bounds=this._localBounds;const o=this.getBounds(!1,e);return this.parent=r,this.transform=n,this._bounds=i,this._bounds.updateID+=this._boundsID-s,o}toGlobal(e,n,r=!1){return r||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(e,n)}toLocal(e,n,r,i){return n&&(e=n.toGlobal(e,r,i)),i||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(e,r)}setParent(e){if(!e||!e.addChild)throw new Error("setParent: Argument must be a Container");return e.addChild(this),e}removeFromParent(){this.parent?.removeChild(this)}setTransform(e=0,n=0,r=1,i=1,s=0,o=0,a=0,l=0,c=0){return this.position.x=e,this.position.y=n,this.scale.x=r||1,this.scale.y=i||1,this.rotation=s,this.skew.x=o,this.skew.y=a,this.pivot.x=l,this.pivot.y=c,this}destroy(e){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.eventMode="auto",this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return null===this.tempDisplayObjectParent&&(this.tempDisplayObjectParent=new Uk),this.tempDisplayObjectParent}enableTempParent(){const e=this.parent;return this.parent=this._tempDisplayObjectParent,e}disableTempParent(e){this.parent=e}get x(){return this.position.x}set x(e){this.transform.position.x=e}get y(){return this.position.y}set y(e){this.transform.position.y=e}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(e){this.transform.position.copyFrom(e)}get scale(){return this.transform.scale}set scale(e){this.transform.scale.copyFrom(e)}get pivot(){return this.transform.pivot}set pivot(e){this.transform.pivot.copyFrom(e)}get skew(){return this.transform.skew}set skew(e){this.transform.skew.copyFrom(e)}get rotation(){return this.transform.rotation}set rotation(e){this.transform.rotation=e}get angle(){return this.transform.rotation*PB}set angle(e){this.transform.rotation=e*NB}get zIndex(){return this._zIndex}set zIndex(e){this._zIndex=e,this.parent&&(this.parent.sortDirty=!0)}get worldVisible(){let e=this;do{if(!e.visible)return!1;e=e.parent}while(e);return!0}get mask(){return this._mask}set mask(e){if(this._mask!==e){if(this._mask){const n=this._mask.isMaskData?this._mask.maskObject:this._mask;n&&(n._maskRefCount--,0===n._maskRefCount&&(n.renderable=!0,n.isMask=!1))}if(this._mask=e,this._mask){const n=this._mask.isMaskData?this._mask.maskObject:this._mask;n&&(0===n._maskRefCount&&(n.renderable=!1,n.isMask=!0),n._maskRefCount++)}}}}class Uk extends Bt{constructor(){super(...arguments),this.sortDirty=null}}Bt.prototype.displayObjectUpdateTransform=Bt.prototype.updateTransform;const Hk=new Pt;function Vk(t,e){return t.zIndex===e.zIndex?t._lastSortedIndex-e._lastSortedIndex:t.zIndex-e.zIndex}const Tg=class extends Bt{constructor(){super(),this.children=[],this.sortableChildren=Tg.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(t){}addChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.addChild(t[e]);else{const e=t[0];e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.push(e),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",e,this,this.children.length-1),e.emit("added",this)}return t[0]}addChildAt(t,e){if(e<0||e>this.children.length)throw new Error(`${t}addChildAt: The index ${e} supplied is out of bounds ${this.children.length}`);return t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.splice(e,0,t),this._boundsID++,this.onChildrenChange(e),t.emit("added",this),this.emit("childAdded",t,this,e),t}swapChildren(t,e){if(t===e)return;const n=this.getChildIndex(t),r=this.getChildIndex(e);this.children[n]=e,this.children[r]=t,this.onChildrenChange(n<r?n:r)}getChildIndex(t){const e=this.children.indexOf(t);if(-1===e)throw new Error("The supplied DisplayObject must be a child of the caller");return e}setChildIndex(t,e){if(e<0||e>=this.children.length)throw new Error(`The index ${e} supplied is out of bounds ${this.children.length}`);const n=this.getChildIndex(t);wo(this.children,n,1),this.children.splice(e,0,t),this.onChildrenChange(e)}getChildAt(t){if(t<0||t>=this.children.length)throw new Error(`getChildAt: Index (${t}) does not exist.`);return this.children[t]}removeChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.removeChild(t[e]);else{const e=t[0],n=this.children.indexOf(e);if(-1===n)return null;e.parent=null,e.transform._parentID=-1,wo(this.children,n,1),this._boundsID++,this.onChildrenChange(n),e.emit("removed",this),this.emit("childRemoved",e,this,n)}return t[0]}removeChildAt(t){const e=this.getChildAt(t);return e.parent=null,e.transform._parentID=-1,wo(this.children,t,1),this._boundsID++,this.onChildrenChange(t),e.emit("removed",this),this.emit("childRemoved",e,this,t),e}removeChildren(t=0,e=this.children.length){const i=e-t;let s;if(i>0&&i<=e){s=this.children.splice(t,i);for(let o=0;o<s.length;++o)s[o].parent=null,s[o].transform&&(s[o].transform._parentID=-1);this._boundsID++,this.onChildrenChange(t);for(let o=0;o<s.length;++o)s[o].emit("removed",this),this.emit("childRemoved",s[o],this,o);return s}if(0===i&&0===this.children.length)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let t=!1;for(let e=0,n=this.children.length;e<n;++e){const r=this.children[e];r._lastSortedIndex=e,!t&&0!==r.zIndex&&(t=!0)}t&&this.children.length>1&&this.children.sort(Vk),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let t=0,e=this.children.length;t<e;++t){const n=this.children[t];n.visible&&n.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let t=0;t<this.children.length;t++){const e=this.children[t];if(e.visible&&e.renderable)if(e.calculateBounds(),e._mask){const n=e._mask.isMaskData?e._mask.maskObject:e._mask;n?(n.calculateBounds(),this._bounds.addBoundsMask(e._bounds,n._bounds)):this._bounds.addBounds(e._bounds)}else e.filterArea?this._bounds.addBoundsArea(e._bounds,e.filterArea):this._bounds.addBounds(e._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(t,e=!1){const n=super.getLocalBounds(t);if(!e)for(let r=0,i=this.children.length;r<i;++r){const s=this.children[r];s.visible&&s.updateTransform()}return n}_calculateBounds(){}_renderWithCulling(t){const e=t.renderTexture.sourceFrame;if(!(e.width>0&&e.height>0))return;let n,r;this.cullArea?(n=this.cullArea,r=this.worldTransform):this._render!==Tg.prototype._render&&(n=this.getBounds(!0));const i=t.projection.transform;if(i&&(r?(r=Hk.copyFrom(r),r.prepend(i)):r=i),n&&e.intersects(n,r))this._render(t);else if(this.cullArea)return;for(let s=0,o=this.children.length;s<o;++s){const a=this.children[s],l=a.cullable;a.cullable=l||!this.cullArea,a.render(t),a.cullable=l}}render(t){if(this.visible&&!(this.worldAlpha<=0)&&this.renderable)if(this._mask||this.filters?.length)this.renderAdvanced(t);else if(this.cullable)this._renderWithCulling(t);else{this._render(t);for(let e=0,n=this.children.length;e<n;++e)this.children[e].render(t)}}renderAdvanced(t){const e=this.filters,n=this._mask;if(e){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let i=0;i<e.length;i++)e[i].enabled&&this._enabledFilters.push(e[i])}const r=e&&this._enabledFilters?.length||n&&(!n.isMaskData||n.enabled&&(n.autoDetect||n.type!==Qt.NONE));if(r&&t.batch.flush(),e&&this._enabledFilters?.length&&t.filter.push(this,this._enabledFilters),n&&t.mask.push(this,this._mask),this.cullable)this._renderWithCulling(t);else{this._render(t);for(let i=0,s=this.children.length;i<s;++i)this.children[i].render(t)}r&&t.batch.flush(),n&&t.mask.pop(this),e&&this._enabledFilters?.length&&t.filter.pop()}_render(t){}destroy(t){super.destroy(),this.sortDirty=!1;const e="boolean"==typeof t?t:t?.children,n=this.removeChildren(0,this.children.length);if(e)for(let r=0;r<n.length;++r)n[r].destroy(t)}get width(){return this.scale.x*this.getLocalBounds().width}set width(t){const e=this.getLocalBounds().width;this.scale.x=0!==e?t/e:1,this._width=t}get height(){return this.scale.y*this.getLocalBounds().height}set height(t){const e=this.getLocalBounds().height;this.scale.y=0!==e?t/e:1,this._height=t}};let nn=Tg;nn.defaultSortableChildren=!1,nn.prototype.containerUpdateTransform=nn.prototype.updateTransform,Object.defineProperties(ue,{SORTABLE_CHILDREN:{get:()=>nn.defaultSortableChildren,set(t){Ye("7.1.0","settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),nn.defaultSortableChildren=t}}});class Uu{constructor(e,n=null,r=null,i=null){this.points=[],this.holes=[],this.shape=e,this.lineStyle=r,this.fillStyle=n,this.matrix=i,this.type=e.type}clone(){return new Uu(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}}class aD{constructor(){this.reset()}begin(e,n,r){this.reset(),this.style=e,this.start=n,this.attribStart=r}end(e,n){this.attribSize=n-this.attribStart,this.size=e-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}}const Io=new ct,lD=class extends ub{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new ku,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let t=0;t<this.drawCalls.length;t++)this.drawCalls[t].texArray.clear(),el.push(this.drawCalls[t]);this.drawCalls.length=0;for(let t=0;t<this.batches.length;t++){const e=this.batches[t];e.reset(),Sg.push(e)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(t,e=null,n=null,r=null){const i=new Uu(t,e,n,r);return this.graphicsData.push(i),this.dirty++,this}drawHole(t,e=null){if(!this.graphicsData.length)return null;const n=new Uu(t,null,null,e),r=this.graphicsData[this.graphicsData.length-1];return n.lineStyle=r.lineStyle,r.holes.push(n),this.dirty++,this}destroy(){super.destroy();for(let t=0;t<this.graphicsData.length;++t)this.graphicsData[t].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(t){const e=this.graphicsData;for(let n=0;n<e.length;++n){const r=e[n];if(r.fillStyle.visible&&r.shape&&(r.matrix?r.matrix.applyInverse(t,Io):Io.copyFrom(t),r.shape.contains(Io.x,Io.y))){let i=!1;if(r.holes)for(let s=0;s<r.holes.length;s++)if(r.holes[s].shape.contains(Io.x,Io.y)){i=!0;break}if(!i)return!0}}return!1}updateBatches(){if(!this.graphicsData.length)return void(this.batchable=!0);if(!this.validateBatching())return;this.cacheDirty=this.dirty;const t=this.uvs,e=this.graphicsData;let n=null,r=null;this.batches.length>0&&(n=this.batches[this.batches.length-1],r=n.style);for(let a=this.shapeIndex;a<e.length;a++){this.shapeIndex++;const l=e[a],c=l.fillStyle,u=l.lineStyle;Bu[l.type].build(l),l.matrix&&this.transformPoints(l.points,l.matrix),(c.visible||u.visible)&&this.processHoles(l.holes);for(let d=0;d<2;d++){const f=0===d?c:u;if(!f.visible)continue;const g=this.indices.length,m=this.points.length/2;f.texture.baseTexture.wrapMode=Ii.REPEAT,0===d?this.processFill(l):this.processLine(l);const _=this.points.length/2-m;0!==_&&(n&&!this._compareStyles(r,f)&&(n.end(g,m),n=null),n||(n=Sg.pop()||new aD,n.begin(f,g,m),this.batches.push(n),r=f),this.addUvs(this.points,t,f.texture,m,_,f.matrix))}}const s=this.points.length/2;if(n&&n.end(this.indices.length,s),0===this.batches.length)return void(this.batchable=!0);const o=s>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&o===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=o?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(t,e){return!(!t||!e||t.texture.baseTexture!==e.texture.baseTexture||t.color+t.alpha!==e.color+e.alpha||!!t.native!=!!e.native)}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let t=0,e=this.graphicsData.length;t<e;t++){const n=this.graphicsData[t],r=n.fillStyle,i=n.lineStyle;if(r&&!r.texture.baseTexture.valid||i&&!i.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);const t=this.batches;for(let e=0,n=t.length;e<n;e++){const r=t[e];for(let i=0;i<r.size;i++){const s=r.start+i;this.indicesUint16[s]=this.indicesUint16[s]-r.attribStart}}}isBatchable(){if(this.points.length>131070)return!1;const t=this.batches;for(let e=0;e<t.length;e++)if(t[e].style.native)return!1;return this.points.length<2*lD.BATCHABLE_SIZE}buildDrawCalls(){let t=++$e._globalBatch;for(let u=0;u<this.drawCalls.length;u++)this.drawCalls[u].texArray.clear(),el.push(this.drawCalls[u]);this.drawCalls.length=0;const e=this.colors,n=this.textureIds;let r=el.pop();r||(r=new sg,r.texArray=new hg),r.texArray.count=0,r.start=0,r.size=0,r.type=Vr.TRIANGLES;let i=0,s=null,o=0,a=!1,l=Vr.TRIANGLES,c=0;this.drawCalls.push(r);for(let u=0;u<this.batches.length;u++){const h=this.batches[u],d=8,f=h.style,p=f.texture.baseTexture;a!==!!f.native&&(a=!!f.native,l=a?Vr.LINES:Vr.TRIANGLES,s=null,i=d,t++),s!==p&&(s=p,p._batchEnabled!==t&&(i===d&&(t++,i=0,r.size>0&&(r=el.pop(),r||(r=new sg,r.texArray=new hg),this.drawCalls.push(r)),r.start=c,r.size=0,r.texArray.count=0,r.type=l),p.touched=1,p._batchEnabled=t,p._batchLocation=i,p.wrapMode=Ii.REPEAT,r.texArray.elements[r.texArray.count++]=p,i++)),r.size+=h.size,c+=h.size,o=p._batchLocation,this.addColors(e,f.color,f.alpha,h.attribSize,h.attribStart),this.addTextureIds(n,o,h.attribSize,h.attribStart)}$e._globalBatch=t,this.packAttributes()}packAttributes(){const t=this.points,e=this.uvs,n=this.colors,r=this.textureIds,i=new ArrayBuffer(3*t.length*4),s=new Float32Array(i),o=new Uint32Array(i);let a=0;for(let l=0;l<t.length/2;l++)s[a++]=t[2*l],s[a++]=t[2*l+1],s[a++]=e[2*l],s[a++]=e[2*l+1],o[a++]=n[l],s[a++]=r[l];this._buffer.update(i),this._indexBuffer.update(this.indicesUint16)}processFill(t){t.holes.length?Eg.triangulate(t,this):Bu[t.type].triangulate(t,this)}processLine(t){Dg(t,this);for(let e=0;e<t.holes.length;e++)Dg(t.holes[e],this)}processHoles(t){for(let e=0;e<t.length;e++){const n=t[e];Bu[n.type].build(n),n.matrix&&this.transformPoints(n.points,n.matrix)}}calculateBounds(){const t=this._bounds;t.clear(),t.addVertexData(this.points,0,this.points.length),t.pad(this.boundsPadding,this.boundsPadding)}transformPoints(t,e){for(let n=0;n<t.length/2;n++){const r=t[2*n],i=t[2*n+1];t[2*n]=e.a*r+e.c*i+e.tx,t[2*n+1]=e.b*r+e.d*i+e.ty}}addColors(t,e,n,r,i=0){const s=ft.shared.setValue(e).toLittleEndianNumber(),o=ft.shared.setValue(s).toPremultiplied(n);t.length=Math.max(t.length,i+r);for(let a=0;a<r;a++)t[i+a]=o}addTextureIds(t,e,n,r=0){t.length=Math.max(t.length,r+n);for(let i=0;i<n;i++)t[r+i]=e}addUvs(t,e,n,r,i,s=null){let o=0;const a=e.length,l=n.frame;for(;o<i;){let u=t[2*(r+o)],h=t[2*(r+o)+1];if(s){const d=s.a*u+s.c*h+s.tx;h=s.b*u+s.d*h+s.ty,u=d}o++,e.push(u/l.width,h/l.height)}const c=n.baseTexture;(l.width<c.width||l.height<c.height)&&this.adjustUvs(e,n,a,i)}adjustUvs(t,e,n,r){const i=e.baseTexture,s=1e-6,o=n+2*r,a=e.frame,l=a.width/i.width,c=a.height/i.height;let u=a.x/a.width,h=a.y/a.height,d=Math.floor(t[n]+s),f=Math.floor(t[n+1]+s);for(let p=n+2;p<o;p+=2)d=Math.min(d,Math.floor(t[p]+s)),f=Math.min(f,Math.floor(t[p+1]+s));u-=d,h-=f;for(let p=n;p<o;p+=2)t[p]=(t[p]+u)*l,t[p+1]=(t[p+1]+h)*c}};let cD=lD;cD.BATCHABLE_SIZE=100;class Hu{constructor(){this.color=16777215,this.alpha=1,this.texture=ye.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){const e=new Hu;return e.color=this.color,e.alpha=this.alpha,e.texture=this.texture,e.matrix=this.matrix,e.visible=this.visible,e}reset(){this.color=16777215,this.alpha=1,this.texture=ye.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}}class Cg extends Hu{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=ds.BUTT,this.join=vr.MITER,this.miterLimit=10}clone(){const e=new Cg;return e.color=this.color,e.alpha=this.alpha,e.texture=this.texture,e.matrix=this.matrix,e.visible=this.visible,e.width=this.width,e.alignment=this.alignment,e.native=this.native,e.cap=this.cap,e.join=this.join,e.miterLimit=this.miterLimit,e}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1}}const Ig={},Vu=class extends nn{constructor(t=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new Hu,this._lineStyle=new Cg,this._matrix=null,this._holeMode=!1,this.state=pi.for2d(),this._geometry=t||new cD,this._geometry.refCount++,this._transformID=-1,this._tintColor=new ft(16777215),this.blendMode=Ne.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new Vu(this._geometry)}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t)}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(t=null,e=0,n,r=.5,i=!1){return"number"==typeof t&&(t={width:t,color:e,alpha:n,alignment:r,native:i}),this.lineTextureStyle(t)}lineTextureStyle(t){t=Object.assign({width:0,texture:ye.WHITE,color:t?.texture?16777215:0,matrix:null,alignment:.5,native:!1,cap:ds.BUTT,join:vr.MITER,miterLimit:10},t),this.normalizeColor(t),this.currentPath&&this.startPoly();const n=t.width>0&&t.alpha>0;return n?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._lineStyle,{visible:n},t)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){const t=this.currentPath.points,e=this.currentPath.points.length;e>2&&(this.drawShape(this.currentPath),this.currentPath=new ss,this.currentPath.closeStroke=!1,this.currentPath.points.push(t[e-2],t[e-1]))}else this.currentPath=new ss,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(t,e){return this.startPoly(),this.currentPath.points[0]=t,this.currentPath.points[1]=e,this}lineTo(t,e){this.currentPath||this.moveTo(0,0);const n=this.currentPath.points;return(n[n.length-2]!==t||n[n.length-1]!==e)&&n.push(t,e),this}_initCurve(t=0,e=0){this.currentPath?0===this.currentPath.points.length&&(this.currentPath.points=[t,e]):this.moveTo(t,e)}quadraticCurveTo(t,e,n,r){this._initCurve();const i=this.currentPath.points;return 0===i.length&&this.moveTo(0,0),Lu.curveTo(t,e,n,r,i),this}bezierCurveTo(t,e,n,r,i,s){return this._initCurve(),Ou.curveTo(t,e,n,r,i,s,this.currentPath.points),this}arcTo(t,e,n,r,i){this._initCurve(t,e);const o=bg.curveTo(t,e,n,r,i,this.currentPath.points);if(o){const{cx:a,cy:l,radius:c,startAngle:u,endAngle:h,anticlockwise:d}=o;this.arc(a,l,c,u,h,d)}return this}arc(t,e,n,r,i,s=!1){if(r===i)return this;if(!s&&i<=r?i+=Xa:s&&r<=i&&(r+=Xa),i-r==0)return this;const a=t+Math.cos(r)*n,l=e+Math.sin(r)*n,c=this._geometry.closePointEps;let u=this.currentPath?this.currentPath.points:null;if(u){const h=Math.abs(u[u.length-2]-a),d=Math.abs(u[u.length-1]-l);h<c&&d<c||u.push(a,l)}else this.moveTo(a,l),u=this.currentPath.points;return bg.arc(a,l,t,e,n,r,i,s,u),this}beginFill(t=0,e){return this.beginTextureFill({texture:ye.WHITE,color:t,alpha:e})}normalizeColor(t){const e=ft.shared.setValue(t.color??0);t.color=e.toNumber(),t.alpha??(t.alpha=e.alpha)}beginTextureFill(t){t=Object.assign({texture:ye.WHITE,color:16777215,matrix:null},t),this.normalizeColor(t),this.currentPath&&this.startPoly();const n=t.alpha>0;return n?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._fillStyle,{visible:n},t)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(t,e,n,r){return this.drawShape(new nt(t,e,n,r))}drawRoundedRect(t,e,n,r,i){return this.drawShape(new lg(t,e,n,r,i))}drawCircle(t,e,n){return this.drawShape(new og(t,e,n))}drawEllipse(t,e,n,r){return this.drawShape(new ag(t,e,n,r))}drawPolygon(...t){let e,n=!0;const r=t[0];r.points?(n=r.closeStroke,e=r.points):e=Array.isArray(t[0])?t[0]:t;const i=new ss(e);return i.closeStroke=n,this.drawShape(i),this}drawShape(t){return this._holeMode?this._geometry.drawHole(t,this._matrix):this._geometry.drawShape(t,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){const t=this._geometry.graphicsData;return!(1!==t.length||t[0].shape.type!==an.RECT||t[0].matrix||t[0].holes.length||t[0].lineStyle.visible&&t[0].lineStyle.width)}_render(t){this.finishPoly();const e=this._geometry;e.updateBatches(),e.batchable?(this.batchDirty!==e.batchDirty&&this._populateBatches(),this._renderBatched(t)):(t.batch.flush(),this._renderDirect(t))}_populateBatches(){const t=this._geometry,e=this.blendMode,n=t.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=t.batchDirty,this.batches.length=n,this.vertexData=new Float32Array(t.points);for(let r=0;r<n;r++){const i=t.batches[r],s=i.style.color,o=new Float32Array(this.vertexData.buffer,4*i.attribStart*2,2*i.attribSize),a=new Float32Array(t.uvsFloat32.buffer,4*i.attribStart*2,2*i.attribSize),c={vertexData:o,blendMode:e,indices:new Uint16Array(t.indicesUint16.buffer,2*i.start,i.size),uvs:a,_batchRGB:ft.shared.setValue(s).toRgbArray(),_tintRGB:s,_texture:i.style.texture,alpha:i.style.alpha,worldAlpha:1};this.batches[r]=c}}_renderBatched(t){if(this.batches.length){t.batch.setObjectRenderer(t.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let e=0,n=this.batches.length;e<n;e++){const r=this.batches[e];r.worldAlpha=this.worldAlpha*r.alpha,t.plugins[this.pluginName].render(r)}}}_renderDirect(t){const e=this._resolveDirectShader(t),n=this._geometry,r=this.worldAlpha,i=e.uniforms,s=n.drawCalls;i.translationMatrix=this.transform.worldTransform,ft.shared.setValue(this._tintColor).premultiply(r).toArray(i.tint),t.shader.bind(e),t.geometry.bind(n,e),t.state.set(this.state);for(let o=0,a=s.length;o<a;o++)this._renderDrawCallDirect(t,n.drawCalls[o])}_renderDrawCallDirect(t,e){const{texArray:n,type:r,size:i,start:s}=e,o=n.count;for(let a=0;a<o;a++)t.texture.bind(n.elements[a],a);t.geometry.draw(r,i,s)}_resolveDirectShader(t){let e=this.shader;const n=this.pluginName;if(!e){if(!Ig[n]){const{maxTextures:r}=t.plugins[n],i=new Int32Array(r);for(let a=0;a<r;a++)i[a]=a;const s={tint:new Float32Array([1,1,1,1]),translationMatrix:new Pt,default:gr.from({uSamplers:i},!0)};Ig[n]=new Xr(t.plugins[n]._shader.program,s)}e=Ig[n]}return e}_calculateBounds(){this.finishPoly();const t=this._geometry;if(!t.graphicsData.length)return;const{minX:e,minY:n,maxX:r,maxY:i}=t.bounds;this._bounds.addFrame(this.transform,e,n,r,i)}containsPoint(t){return this.worldTransform.applyInverse(t,Vu._TEMP_POINT),this._geometry.containsPoint(Vu._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this._tintColor.toNumber();for(let t=0;t<this.batches.length;t++){const e=this.batches[t];e._tintRGB=ft.shared.setValue(this._tintColor).multiply(e._batchRGB).toLittleEndianNumber()}}}calculateVertices(){const t=this.transform._worldID;if(this._transformID===t)return;this._transformID=t;const e=this.transform.worldTransform,n=e.a,r=e.b,i=e.c,s=e.d,o=e.tx,a=e.ty,l=this._geometry.points,c=this.vertexData;let u=0;for(let h=0;h<l.length;h+=2){const d=l[h],f=l[h+1];c[u++]=n*d+i*f+o,c[u++]=s*f+r*d+a}}closePath(){const t=this.currentPath;return t&&(t.closeStroke=!0,this.finishPoly()),this}setMatrix(t){return this._matrix=t,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(t){this._geometry.refCount--,0===this._geometry.refCount&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(t)}};let xr=Vu;xr.curves=Co,xr._TEMP_POINT=new ct;class Wk extends ss{constructor(e,n,r,i,s,o=0){s=s||i/2;const a=-1*Math.PI/2+o,l=2*r,c=Xa/l,u=[];for(let h=0;h<l;h++){const d=h%2?s:i,f=h*c+a;u.push(e+d*Math.cos(f),n+d*Math.sin(f))}super(u)}}Object.defineProperties(xr.prototype,{drawTorus:{value:function Yk(t,e,n,r,i=0,s=2*Math.PI){return Math.abs(s-i)>=2*Math.PI?this.drawCircle(t,e,r).beginHole().drawCircle(t,e,n).endHole():(this.finishPoly(),this.arc(t,e,n,s,i,!0).arc(t,e,r,i,s,!1).finishPoly(),this)}},drawChamferRect:{value:function Gk(t,e,n,r,i){if(i<=0)return this.drawRect(t,e,n,r);const s=Math.min(i,Math.min(n,r)/2),o=t+n,a=e+r,l=[t+s,e,o-s,e,o,e+s,o,a-s,o-s,a,t+s,a,t,a-s,t,e+s];for(let c=l.length-1;c>=2;c-=2)l[c]===l[c-2]&&l[c-1]===l[c-3]&&l.splice(c-1,2);return this.drawPolygon(l)}},drawFilletRect:{value:function jk(t,e,n,r,i){if(0===i)return this.drawRect(t,e,n,r);const s=Math.min(n,r)/2,o=Math.min(s,Math.max(-s,i)),a=t+n,l=e+r,c=o<0?-o:0,u=Math.abs(o);return this.moveTo(t,e+u).arcTo(t+c,e+c,t+u,e,u).lineTo(a-u,e).arcTo(a-c,e+c,a,e+u,u).lineTo(a,l-u).arcTo(a-c,l-c,t+n-u,l,u).lineTo(t+u,l).arcTo(t+c,l-c,t,l-u,u).closePath()}},drawRegularPolygon:{value:function $k(t,e,n,r,i=0){r=Math.max(0|r,3);const s=-1*Math.PI/2+i,o=2*Math.PI/r,a=[];for(let l=0;l<r;l++){const c=l*o+s;a.push(t+n*Math.cos(c),e+n*Math.sin(c))}return this.drawPolygon(a)}},drawRoundedPolygon:{value:function zk(t,e,n,r,i,s=0){if(r=Math.max(0|r,3),i<=0)return this.drawRegularPolygon(t,e,n,r,s);const o=n*Math.sin(Math.PI/r)-.001;i=Math.min(i,o);const a=-1*Math.PI/2+s,l=2*Math.PI/r,c=(r-2)*Math.PI/r/2;for(let u=0;u<r;u++){const h=u*l+a,d=t+n*Math.cos(h),f=e+n*Math.sin(h),p=h+Math.PI+c,g=h-Math.PI-c,m=d+i*Math.cos(p),_=f+i*Math.sin(p),v=d+i*Math.cos(g),D=f+i*Math.sin(g);0===u?this.moveTo(m,_):this.lineTo(m,_),this.quadraticCurveTo(d,f,v,D)}return this.closePath()}},drawStar:{value:function Xk(t,e,n,r,i,s=0){return this.drawPolygon(new Wk(t,e,n,r,i,s))}}});const tl=new ct,qk=new Uint16Array([0,1,2,0,2,3]);class jn extends nn{constructor(e){super(),this._anchor=new Pi(this._onAnchorUpdate,this,e?e.defaultAnchor.x:0,e?e.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tintColor=new ft(16777215),this._tintRGB=null,this.tint=16777215,this.blendMode=Ne.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=e||ye.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=qk,this.pluginName="batch",this.isSprite=!0,this._roundPixels=ue.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=Ai(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=Ai(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){const e=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===e._updateID)return;this._textureID!==e._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=e._updateID;const n=this.transform.worldTransform,r=n.a,i=n.b,s=n.c,o=n.d,a=n.tx,l=n.ty,c=this.vertexData,u=e.trim,h=e.orig,d=this._anchor;let f=0,p=0,g=0,m=0;if(u?(p=u.x-d._x*h.width,f=p+u.width,m=u.y-d._y*h.height,g=m+u.height):(p=-d._x*h.width,f=p+h.width,m=-d._y*h.height,g=m+h.height),c[0]=r*p+s*m+a,c[1]=o*m+i*p+l,c[2]=r*f+s*m+a,c[3]=o*m+i*f+l,c[4]=r*f+s*g+a,c[5]=o*g+i*f+l,c[6]=r*p+s*g+a,c[7]=o*g+i*p+l,this._roundPixels){const _=ue.RESOLUTION;for(let v=0;v<c.length;++v)c[v]=Math.round(c[v]*_)/_}}calculateTrimmedVertices(){if(this.vertexTrimmedData){if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return}else this.vertexTrimmedData=new Float32Array(8);this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;const n=this.vertexTrimmedData,r=this._texture.orig,i=this._anchor,s=this.transform.worldTransform,o=s.a,a=s.b,l=s.c,c=s.d,u=s.tx,h=s.ty,d=-i._x*r.width,f=d+r.width,p=-i._y*r.height,g=p+r.height;n[0]=o*d+l*p+u,n[1]=c*p+a*d+h,n[2]=o*f+l*p+u,n[3]=c*p+a*f+h,n[4]=o*f+l*g+u,n[5]=c*g+a*f+h,n[6]=o*d+l*g+u,n[7]=c*g+a*d+h}_render(e){this.calculateVertices(),e.batch.setObjectRenderer(e.plugins[this.pluginName]),e.plugins[this.pluginName].render(this)}_calculateBounds(){const e=this._texture.trim,n=this._texture.orig;!e||e.width===n.width&&e.height===n.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(e){return 0===this.children.length?(this._localBounds||(this._localBounds=new ku),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),e||(this._localBoundsRect||(this._localBoundsRect=new nt),e=this._localBoundsRect),this._localBounds.getRectangle(e)):super.getLocalBounds.call(this,e)}containsPoint(e){this.worldTransform.applyInverse(e,tl);const n=this._texture.orig.width,r=this._texture.orig.height,i=-n*this.anchor.x;let s=0;return tl.x>=i&&tl.x<i+n&&(s=-r*this.anchor.y,tl.y>=s&&tl.y<s+r)}destroy(e){super.destroy(e),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,("boolean"==typeof e?e:e?.texture)&&this._texture.destroy(!!("boolean"==typeof e?e:e?.baseTexture)),this._texture=null}static from(e,n){const r=e instanceof ye?e:ye.from(e,n);return new jn(r)}set roundPixels(e){this._roundPixels!==e&&(this._transformID=-1),this._roundPixels=e}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(e){const n=Ai(this.scale.x)||1;this.scale.x=n*e/this._texture.orig.width,this._width=e}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(e){const n=Ai(this.scale.y)||1;this.scale.y=n*e/this._texture.orig.height,this._height=e}get anchor(){return this._anchor}set anchor(e){this._anchor.copyFrom(e)}get tint(){return this._tintColor.value}set tint(e){this._tintColor.setValue(e),this._tintRGB=this._tintColor.toLittleEndianNumber()}get tintValue(){return this._tintColor.toNumber()}get texture(){return this._texture}set texture(e){this._texture!==e&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=e||ye.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,e&&(e.baseTexture.valid?this._onTextureUpdate():e.once("update",this._onTextureUpdate,this)))}}const uD=new Pt;Bt.prototype._cacheAsBitmap=!1,Bt.prototype._cacheData=null,Bt.prototype._cacheAsBitmapResolution=null,Bt.prototype._cacheAsBitmapMultisample=null;class Zk{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}}Object.defineProperties(Bt.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(t){t!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=t,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(t){t!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=t,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(t){if(this._cacheAsBitmap===t)return;let e;this._cacheAsBitmap=t,t?(this._cacheData||(this._cacheData=new Zk),e=this._cacheData,e.originalRender=this.render,e.originalRenderCanvas=this.renderCanvas,e.originalUpdateTransform=this.updateTransform,e.originalCalculateBounds=this.calculateBounds,e.originalGetLocalBounds=this.getLocalBounds,e.originalDestroy=this.destroy,e.originalContainsPoint=this.containsPoint,e.originalMask=this._mask,e.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(e=this._cacheData,e.sprite&&this._destroyCachedDisplayObject(),this.render=e.originalRender,this.renderCanvas=e.originalRenderCanvas,this.calculateBounds=e.originalCalculateBounds,this.getLocalBounds=e.originalGetLocalBounds,this.destroy=e.originalDestroy,this.updateTransform=e.originalUpdateTransform,this.containsPoint=e.originalContainsPoint,this._mask=e.originalMask,this.filterArea=e.originalFilterArea)}}}),Bt.prototype._renderCached=function(e){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(e),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(e))},Bt.prototype._initCachedDisplayObject=function(e){if(this._cacheData?.sprite)return;const n=this.alpha;this.alpha=1,e.batch.flush();const r=this.getLocalBounds(null,!0).clone();this.filters?.length&&r.pad(this.filters[0].padding),r.ceil(ue.RESOLUTION);const i=e.renderTexture.current,s=e.renderTexture.sourceFrame.clone(),o=e.renderTexture.destinationFrame.clone(),a=e.projection.transform,l=us.create({width:r.width,height:r.height,resolution:this.cacheAsBitmapResolution||e.resolution,multisample:this.cacheAsBitmapMultisample??e.multisample}),c=`cacheAsBitmap_${is()}`;this._cacheData.textureCacheId=c,$e.addToCache(l.baseTexture,c),ye.addToCache(l,c);const u=this.transform.localTransform.copyTo(uD).invert().translate(-r.x,-r.y);this.render=this._cacheData.originalRender,e.render(this,{renderTexture:l,clear:!0,transform:u,skipUpdateTransform:!1}),e.framebuffer.blit(),e.projection.transform=a,e.renderTexture.bind(i,s,o),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=n;const h=new jn(l);h.transform.worldTransform=this.transform.worldTransform,h.anchor.x=-r.x/r.width,h.anchor.y=-r.y/r.height,h.alpha=n,h._bounds=this._bounds,this._cacheData.sprite=h,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=h.containsPoint.bind(h)},Bt.prototype._renderCachedCanvas=function(e){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(e),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(e))},Bt.prototype._initCachedDisplayObjectCanvas=function(e){if(this._cacheData?.sprite)return;const n=this.getLocalBounds(null,!0),r=this.alpha;this.alpha=1;const i=e.canvasContext.activeContext,s=e._projTransform;n.ceil(ue.RESOLUTION);const o=us.create({width:n.width,height:n.height}),a=`cacheAsBitmap_${is()}`;this._cacheData.textureCacheId=a,$e.addToCache(o.baseTexture,a),ye.addToCache(o,a);const l=uD;this.transform.localTransform.copyTo(l),l.invert(),l.tx-=n.x,l.ty-=n.y,this.renderCanvas=this._cacheData.originalRenderCanvas,e.render(this,{renderTexture:o,clear:!0,transform:l,skipUpdateTransform:!1}),e.canvasContext.activeContext=i,e._projTransform=s,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=r;const c=new jn(o);c.transform.worldTransform=this.transform.worldTransform,c.anchor.x=-n.x/n.width,c.anchor.y=-n.y/n.height,c.alpha=r,c._bounds=this._bounds,this._cacheData.sprite=c,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=e._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=c.containsPoint.bind(c)},Bt.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID},Bt.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)},Bt.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,$e.removeFromCache(this._cacheData.textureCacheId),ye.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null},Bt.prototype._cacheAsBitmapDestroy=function(e){this.cacheAsBitmap=!1,this.destroy(e)},Bt.prototype.name=null,nn.prototype.getChildByName=function(e,n){for(let r=0,i=this.children.length;r<i;r++)if(this.children[r].name===e)return this.children[r];if(n)for(let r=0,i=this.children.length;r<i;r++){const s=this.children[r];if(!s.getChildByName)continue;const o=s.getChildByName(e,!0);if(o)return o}return null},Bt.prototype.getGlobalPosition=function(e=new ct,n=!1){return this.parent?this.parent.toGlobal(this.position,e,n):(e.x=this.position.x,e.y=this.position.y),e};const Jk={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},e2=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join("\n");class Ag extends ln{constructor(e,n=8,r=4,i=ln.defaultResolution,s=5){const o=function r2(t,e){const n=Math.ceil(t/2);let s,r="\n    attribute vec2 aVertexPosition;\n\n    uniform mat3 projectionMatrix;\n\n    uniform float strength;\n\n    varying vec2 vBlurTexCoords[%size%];\n\n    uniform vec4 inputSize;\n    uniform vec4 outputFrame;\n\n    vec4 filterVertexPosition( void )\n    {\n        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n    }\n\n    vec2 filterTextureCoord( void )\n    {\n        return aVertexPosition * (outputFrame.zw * inputSize.zw);\n    }\n\n    void main(void)\n    {\n        gl_Position = filterVertexPosition();\n\n        vec2 textureCoord = filterTextureCoord();\n        %blur%\n    }",i="";s=e?"vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":"vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(let o=0;o<t;o++){let a=s.replace("%index%",o.toString());a=a.replace("%sampleIndex%",o-(n-1)+".0"),i+=a,i+="\n"}return r=r.replace("%blur%",i),r=r.replace("%size%",t.toString()),r}(s,e),a=function t2(t){const e=Jk[t],n=e.length;let o,r=e2,i="";for(let a=0;a<t;a++){let l="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;".replace("%index%",a.toString());o=a,a>=n&&(o=t-a-1),l=l.replace("%value%",e[o].toString()),i+=l,i+="\n"}return r=r.replace("%blur%",i),r=r.replace("%size%",t.toString()),r}(s);super(o,a),this.horizontal=e,this.resolution=i,this._quality=0,this.quality=r,this.blur=n}apply(e,n,r,i){if(this.uniforms.strength=r?this.horizontal?1/r.width*(r.width/n.width):1/r.height*(r.height/n.height):this.horizontal?1/e.renderer.width*(e.renderer.width/n.width):1/e.renderer.height*(e.renderer.height/n.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,1===this.passes)e.applyFilter(this,n,r,i);else{const s=e.getFilterTexture(),o=e.renderer;let a=n,l=s;this.state.blend=!1,e.applyFilter(this,a,l,$r.CLEAR);for(let c=1;c<this.passes-1;c++){e.bindAndClear(a,$r.BLIT),this.uniforms.uSampler=l;const u=l;l=a,a=u,o.shader.bind(this),o.geometry.draw(5)}this.state.blend=!0,e.applyFilter(this,l,r,i),e.returnFilterTexture(s)}}get blur(){return this.strength}set blur(e){this.padding=1+2*Math.abs(e),this.strength=e}get quality(){return this._quality}set quality(e){this._quality=e,this.passes=e}}class Mg extends ln{constructor(){const e={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(Zb,"varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float m[20];\nuniform float uAlpha;\n\nvoid main(void)\n{\n    vec4 c = texture2D(uSampler, vTextureCoord);\n\n    if (uAlpha == 0.0) {\n        gl_FragColor = c;\n        return;\n    }\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (c.a > 0.0) {\n      c.rgb /= c.a;\n    }\n\n    vec4 result;\n\n    result.r = (m[0] * c.r);\n        result.r += (m[1] * c.g);\n        result.r += (m[2] * c.b);\n        result.r += (m[3] * c.a);\n        result.r += m[4];\n\n    result.g = (m[5] * c.r);\n        result.g += (m[6] * c.g);\n        result.g += (m[7] * c.b);\n        result.g += (m[8] * c.a);\n        result.g += m[9];\n\n    result.b = (m[10] * c.r);\n       result.b += (m[11] * c.g);\n       result.b += (m[12] * c.b);\n       result.b += (m[13] * c.a);\n       result.b += m[14];\n\n    result.a = (m[15] * c.r);\n       result.a += (m[16] * c.g);\n       result.a += (m[17] * c.b);\n       result.a += (m[18] * c.a);\n       result.a += m[19];\n\n    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);\n\n    // Premultiply alpha again.\n    rgb *= result.a;\n\n    gl_FragColor = vec4(rgb, result.a);\n}\n",e),this.alpha=1}_loadMatrix(e,n=!1){let r=e;n&&(this._multiply(r,this.uniforms.m,e),r=this._colorMatrix(r)),this.uniforms.m=r}_multiply(e,n,r){return e[0]=n[0]*r[0]+n[1]*r[5]+n[2]*r[10]+n[3]*r[15],e[1]=n[0]*r[1]+n[1]*r[6]+n[2]*r[11]+n[3]*r[16],e[2]=n[0]*r[2]+n[1]*r[7]+n[2]*r[12]+n[3]*r[17],e[3]=n[0]*r[3]+n[1]*r[8]+n[2]*r[13]+n[3]*r[18],e[4]=n[0]*r[4]+n[1]*r[9]+n[2]*r[14]+n[3]*r[19]+n[4],e[5]=n[5]*r[0]+n[6]*r[5]+n[7]*r[10]+n[8]*r[15],e[6]=n[5]*r[1]+n[6]*r[6]+n[7]*r[11]+n[8]*r[16],e[7]=n[5]*r[2]+n[6]*r[7]+n[7]*r[12]+n[8]*r[17],e[8]=n[5]*r[3]+n[6]*r[8]+n[7]*r[13]+n[8]*r[18],e[9]=n[5]*r[4]+n[6]*r[9]+n[7]*r[14]+n[8]*r[19]+n[9],e[10]=n[10]*r[0]+n[11]*r[5]+n[12]*r[10]+n[13]*r[15],e[11]=n[10]*r[1]+n[11]*r[6]+n[12]*r[11]+n[13]*r[16],e[12]=n[10]*r[2]+n[11]*r[7]+n[12]*r[12]+n[13]*r[17],e[13]=n[10]*r[3]+n[11]*r[8]+n[12]*r[13]+n[13]*r[18],e[14]=n[10]*r[4]+n[11]*r[9]+n[12]*r[14]+n[13]*r[19]+n[14],e[15]=n[15]*r[0]+n[16]*r[5]+n[17]*r[10]+n[18]*r[15],e[16]=n[15]*r[1]+n[16]*r[6]+n[17]*r[11]+n[18]*r[16],e[17]=n[15]*r[2]+n[16]*r[7]+n[17]*r[12]+n[18]*r[17],e[18]=n[15]*r[3]+n[16]*r[8]+n[17]*r[13]+n[18]*r[18],e[19]=n[15]*r[4]+n[16]*r[9]+n[17]*r[14]+n[18]*r[19]+n[19],e}_colorMatrix(e){const n=new Float32Array(e);return n[4]/=255,n[9]/=255,n[14]/=255,n[19]/=255,n}brightness(e,n){this._loadMatrix([e,0,0,0,0,0,e,0,0,0,0,0,e,0,0,0,0,0,1,0],n)}tint(e,n){const[r,i,s]=ft.shared.setValue(e).toArray();this._loadMatrix([r,0,0,0,0,0,i,0,0,0,0,0,s,0,0,0,0,0,1,0],n)}greyscale(e,n){this._loadMatrix([e,e,e,0,0,e,e,e,0,0,e,e,e,0,0,0,0,0,1,0],n)}blackAndWhite(e){this._loadMatrix([.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0],e)}hue(e,n){e=(e||0)/180*Math.PI;const r=Math.cos(e),i=Math.sin(e),o=1/3,a=(0,Math.sqrt)(o);this._loadMatrix([r+(1-r)*o,o*(1-r)-a*i,o*(1-r)+a*i,0,0,o*(1-r)+a*i,r+o*(1-r),o*(1-r)-a*i,0,0,o*(1-r)-a*i,o*(1-r)+a*i,r+o*(1-r),0,0,0,0,0,1,0],n)}contrast(e,n){const r=(e||0)+1,i=-.5*(r-1);this._loadMatrix([r,0,0,0,i,0,r,0,0,i,0,0,r,0,i,0,0,0,1,0],n)}saturate(e=0,n){const r=2*e/3+1,i=-.5*(r-1);this._loadMatrix([r,i,i,0,0,i,r,i,0,0,i,i,r,0,0,0,0,0,1,0],n)}desaturate(){this.saturate(-1)}negative(e){this._loadMatrix([-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0],e)}sepia(e){this._loadMatrix([.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0],e)}technicolor(e){this._loadMatrix([1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0],e)}polaroid(e){this._loadMatrix([1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],e)}toBGR(e){this._loadMatrix([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0],e)}kodachrome(e){this._loadMatrix([1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0],e)}browni(e){this._loadMatrix([.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0],e)}vintage(e){this._loadMatrix([.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0],e)}colorTone(e,n,r,i,s){e=e||.2,n=n||.15,r=r||16770432,i=i||3375104;const o=ft.shared,[a,l,c]=o.setValue(r).toArray(),[u,h,d]=o.setValue(i).toArray();this._loadMatrix([.3,.59,.11,0,0,a,l,c,e,0,u,h,d,n,0,a-u,l-h,c-d,0,0],s)}night(e,n){this._loadMatrix([-2*(e=e||.1),-e,0,0,0,-e,0,e,0,0,0,e,2*e,0,0,0,0,0,1,0],n)}predator(e,n){this._loadMatrix([11.224130630493164*e,-4.794486999511719*e,-2.8746118545532227*e,0*e,.40342438220977783*e,-3.6330697536468506*e,9.193157196044922*e,-2.951810836791992*e,0*e,-1.316135048866272*e,-3.2184197902679443*e,-4.2375030517578125*e,7.476448059082031*e,0*e,.8044459223747253*e,0,0,0,1,0],n)}lsd(e){this._loadMatrix([2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0],e)}reset(){this._loadMatrix([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],!1)}get matrix(){return this.uniforms.m}set matrix(e){this.uniforms.m=e}get alpha(){return this.uniforms.uAlpha}set alpha(e){this.uniforms.uAlpha=e}}Mg.prototype.grayscale=Mg.prototype.greyscale;const hD={AlphaFilter:class Qk extends ln{constructor(e=1){super("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float uAlpha;\n\nvoid main(void)\n{\n   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;\n}\n",{uAlpha:1}),this.alpha=e}get alpha(){return this.uniforms.uAlpha}set alpha(e){this.uniforms.uAlpha=e}},BlurFilter:class i2 extends ln{constructor(e=8,n=4,r=ln.defaultResolution,i=5){super(),this._repeatEdgePixels=!1,this.blurXFilter=new Ag(!0,e,n,r,i),this.blurYFilter=new Ag(!1,e,n,r,i),this.resolution=r,this.quality=n,this.blur=e,this.repeatEdgePixels=!1}apply(e,n,r,i){const s=Math.abs(this.blurXFilter.strength),o=Math.abs(this.blurYFilter.strength);if(s&&o){const a=e.getFilterTexture();this.blurXFilter.apply(e,n,a,$r.CLEAR),this.blurYFilter.apply(e,a,r,i),e.returnFilterTexture(a)}else o?this.blurYFilter.apply(e,n,r,i):this.blurXFilter.apply(e,n,r,i)}updatePadding(){this.padding=this._repeatEdgePixels?0:2*Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))}get blur(){return this.blurXFilter.blur}set blur(e){this.blurXFilter.blur=this.blurYFilter.blur=e,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(e){this.blurXFilter.quality=this.blurYFilter.quality=e}get blurX(){return this.blurXFilter.blur}set blurX(e){this.blurXFilter.blur=e,this.updatePadding()}get blurY(){return this.blurYFilter.blur}set blurY(e){this.blurYFilter.blur=e,this.updatePadding()}get blendMode(){return this.blurYFilter.blendMode}set blendMode(e){this.blurYFilter.blendMode=e}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(e){this._repeatEdgePixels=e,this.updatePadding()}},BlurFilterPass:Ag,ColorMatrixFilter:Mg,DisplacementFilter:class l2 extends ln{constructor(e,n){const r=new Pt;e.renderable=!1,super("attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\nuniform mat3 filterMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vFilterCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n\tgl_Position = filterVertexPosition();\n\tvTextureCoord = filterTextureCoord();\n\tvFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;\n}\n","varying vec2 vFilterCoord;\nvarying vec2 vTextureCoord;\n\nuniform vec2 scale;\nuniform mat2 rotation;\nuniform sampler2D uSampler;\nuniform sampler2D mapSampler;\n\nuniform highp vec4 inputSize;\nuniform vec4 inputClamp;\n\nvoid main(void)\n{\n  vec4 map =  texture2D(mapSampler, vFilterCoord);\n\n  map -= 0.5;\n  map.xy = scale * inputSize.zw * (rotation * map.xy);\n\n  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));\n}\n",{mapSampler:e._texture,filterMatrix:r,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])}),this.maskSprite=e,this.maskMatrix=r,null==n&&(n=20),this.scale=new ct(n,n)}apply(e,n,r,i){this.uniforms.filterMatrix=e.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;const s=this.maskSprite.worldTransform,o=Math.sqrt(s.a*s.a+s.b*s.b),a=Math.sqrt(s.c*s.c+s.d*s.d);0!==o&&0!==a&&(this.uniforms.rotation[0]=s.a/o,this.uniforms.rotation[1]=s.b/o,this.uniforms.rotation[2]=s.c/a,this.uniforms.rotation[3]=s.d/a),e.applyFilter(this,n,r,i)}get map(){return this.uniforms.mapSampler}set map(e){this.uniforms.mapSampler=e}},FXAAFilter:class h2 extends ln{constructor(){super("\nattribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvoid texcoords(vec2 fragCoord, vec2 inverseVP,\n               out vec2 v_rgbNW, out vec2 v_rgbNE,\n               out vec2 v_rgbSW, out vec2 v_rgbSE,\n               out vec2 v_rgbM) {\n    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\n    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\n    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\n    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\n    v_rgbM = vec2(fragCoord * inverseVP);\n}\n\nvoid main(void) {\n\n   gl_Position = filterVertexPosition();\n\n   vFragCoord = aVertexPosition * outputFrame.zw;\n\n   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}\n",'varying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\nuniform sampler2D uSampler;\nuniform highp vec4 inputSize;\n\n\n/**\n Basic FXAA implementation based on the code on geeks3d.com with the\n modification that the texture2DLod stuff was removed since it\'s\n unsupported by WebGL.\n\n --\n\n From:\n https://github.com/mitsuhiko/webgl-meincraft\n\n Copyright (c) 2011 by Armin Ronacher.\n\n Some rights reserved.\n\n Redistribution and use in source and binary forms, with or without\n modification, are permitted provided that the following conditions are\n met:\n\n * Redistributions of source code must retain the above copyright\n notice, this list of conditions and the following disclaimer.\n\n * Redistributions in binary form must reproduce the above\n copyright notice, this list of conditions and the following\n disclaimer in the documentation and/or other materials provided\n with the distribution.\n\n * The names of the contributors may not be used to endorse or\n promote products derived from this software without specific\n prior written permission.\n\n THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n#ifndef FXAA_REDUCE_MIN\n#define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#endif\n#ifndef FXAA_REDUCE_MUL\n#define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#endif\n#ifndef FXAA_SPAN_MAX\n#define FXAA_SPAN_MAX     8.0\n#endif\n\n//optimized version for mobile, where dependent\n//texture reads can be a bottleneck\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,\n          vec2 v_rgbNW, vec2 v_rgbNE,\n          vec2 v_rgbSW, vec2 v_rgbSE,\n          vec2 v_rgbM) {\n    vec4 color;\n    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\n    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\n    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\n    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\n    vec4 texColor = texture2D(tex, v_rgbM);\n    vec3 rgbM  = texColor.xyz;\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\n    mediump vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n\n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n\n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n                  dir * rcpDirMin)) * inverseVP;\n\n    vec3 rgbA = 0.5 * (\n                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\n                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (\n                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\n                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\n\n    float lumaB = dot(rgbB, luma);\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        color = vec4(rgbA, texColor.a);\n    else\n        color = vec4(rgbB, texColor.a);\n    return color;\n}\n\nvoid main() {\n\n      vec4 color;\n\n      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n\n      gl_FragColor = color;\n}\n')}},NoiseFilter:class f2 extends ln{constructor(e=.5,n=Math.random()){super(Zb,"precision highp float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform float uNoise;\nuniform float uSeed;\nuniform sampler2D uSampler;\n\nfloat rand(vec2 co)\n{\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main()\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n    float randomValue = rand(gl_FragCoord.xy * uSeed);\n    float diff = (randomValue - 0.5) * uNoise;\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (color.a > 0.0) {\n        color.rgb /= color.a;\n    }\n\n    color.r += diff;\n    color.g += diff;\n    color.b += diff;\n\n    // Premultiply alpha again.\n    color.rgb *= color.a;\n\n    gl_FragColor = color;\n}\n",{uNoise:0,uSeed:0}),this.noise=e,this.seed=n}get noise(){return this.uniforms.uNoise}set noise(e){this.uniforms.uNoise=e}get seed(){return this.uniforms.uSeed}set seed(e){this.uniforms.uSeed=e}}};Object.entries(hD).forEach(([t,e])=>{Object.defineProperty(hD,t,{get:()=>(Ye("7.1.0",`filters.${t} has moved to ${t}`),e)})});const Oi=new class p2{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}init(e){this.removeTickerListener(),this.events=e,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate(e){this._pauseUpdate=e}addTickerListener(){this.tickerAdded||!this.domElement||(Yt.system.add(this.tickerUpdate,this,Fi.INTERACTION),this.tickerAdded=!0)}removeTickerListener(){this.tickerAdded&&(Yt.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)}pointerMoved(){this._didMove=!0}update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove)return void(this._didMove=!1);const e=this.events.rootPointerEvent;this.events.supportsTouchEvents&&"touch"===e.pointerType||globalThis.document.dispatchEvent(new PointerEvent("pointermove",{clientX:e.clientX,clientY:e.clientY}))}tickerUpdate(e){this._deltaTime+=e,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.update())}};class nl{constructor(e){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=nl.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new ct,this.page=new ct,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=e}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(e,n,r){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(e,n,r,i,s){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}class Gu extends nl{constructor(){super(...arguments),this.client=new ct,this.movement=new ct,this.offset=new ct,this.global=new ct,this.screen=new ct}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition(e,n,r){return e.worldTransform.applyInverse(r||this.global,n)}getModifierState(e){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(e)}initMouseEvent(e,n,r,i,s,o,a,l,c,u,h,d,f,p,g){throw new Error("Method not implemented.")}}class wr extends Gu{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return"pointermove"===this.type||"mousemove"===this.type||"touchmove"===this.type?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}let Rg=(()=>{class t extends Gu{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}}return t.DOM_DELTA_PIXEL=0,t.DOM_DELTA_LINE=1,t.DOM_DELTA_PAGE=2,t})();const m2=new ct,Pg=new ct;class y2{constructor(e){this.dispatch=new Ga,this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map,this._allInteractiveElements=[],this._hitElements=[],this._isPointerMoveEvent=!1,this.rootTarget=e,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(e,n){this.mappingTable[e]||(this.mappingTable[e]=[]),this.mappingTable[e].push({fn:n,priority:0}),this.mappingTable[e].sort((r,i)=>r.priority-i.priority)}dispatchEvent(e,n){e.propagationStopped=!1,e.propagationImmediatelyStopped=!1,this.propagate(e,n),this.dispatch.emit(n||e.type,e)}mapEvent(e){if(!this.rootTarget)return;const n=this.mappingTable[e.type];if(n)for(let r=0,i=n.length;r<i;r++)n[r].fn(e);else console.warn(`[EventBoundary]: Event mapping not defined for ${e.type}`)}hitTest(e,n){Oi.pauseUpdate=!0;const s=this[this._isPointerMoveEvent&&this.enableGlobalMoveEvents?"hitTestMoveRecursive":"hitTestRecursive"](this.rootTarget,this.rootTarget.eventMode,m2.set(e,n),this.hitTestFn,this.hitPruneFn);return s&&s[0]}propagate(e,n){if(!e.target)return;const r=e.composedPath();e.eventPhase=e.CAPTURING_PHASE;for(let i=0,s=r.length-1;i<s;i++)if(e.currentTarget=r[i],this.notifyTarget(e,n),e.propagationStopped||e.propagationImmediatelyStopped)return;if(e.eventPhase=e.AT_TARGET,e.currentTarget=e.target,this.notifyTarget(e,n),!e.propagationStopped&&!e.propagationImmediatelyStopped){e.eventPhase=e.BUBBLING_PHASE;for(let i=r.length-2;i>=0;i--)if(e.currentTarget=r[i],this.notifyTarget(e,n),e.propagationStopped||e.propagationImmediatelyStopped)return}}all(e,n,r=this._allInteractiveElements){if(0===r.length)return;e.eventPhase=e.BUBBLING_PHASE;const i=Array.isArray(n)?n:[n];for(let s=r.length-1;s>=0;s--)i.forEach(o=>{e.currentTarget=r[s],this.notifyTarget(e,o)})}propagationPath(e){const n=[e];for(let r=0;r<2048&&e!==this.rootTarget;r++){if(!e.parent)throw new Error("Cannot find propagation path to disconnected target");n.push(e.parent),e=e.parent}return n.reverse(),n}hitTestMoveRecursive(e,n,r,i,s,o=!1){let a=!1;if(this._interactivePrune(e))return null;if(("dynamic"===e.eventMode||"dynamic"===n)&&(Oi.pauseUpdate=!1),e.interactiveChildren&&e.children){const u=e.children;for(let h=u.length-1;h>=0;h--){const d=u[h],f=this.hitTestMoveRecursive(d,this._isInteractive(n)?n:d.eventMode,r,i,s,o||s(e,r));if(f){if(f.length>0&&!f[f.length-1].parent)continue;const p=e.isInteractive();(f.length>0||p)&&(p&&this._allInteractiveElements.push(e),f.push(e)),0===this._hitElements.length&&(this._hitElements=f),a=!0}}}const l=this._isInteractive(n),c=e.isInteractive();return c&&c&&this._allInteractiveElements.push(e),o||this._hitElements.length>0?null:a?this._hitElements:l&&!s(e,r)&&i(e,r)?c?[e]:[]:null}hitTestRecursive(e,n,r,i,s){if(this._interactivePrune(e)||s(e,r))return null;if(("dynamic"===e.eventMode||"dynamic"===n)&&(Oi.pauseUpdate=!1),e.interactiveChildren&&e.children){const l=e.children;for(let c=l.length-1;c>=0;c--){const u=l[c],h=this.hitTestRecursive(u,this._isInteractive(n)?n:u.eventMode,r,i,s);if(h){if(h.length>0&&!h[h.length-1].parent)continue;const d=e.isInteractive();return(h.length>0||d)&&h.push(e),h}}}const o=this._isInteractive(n),a=e.isInteractive();return o&&i(e,r)?a?[e]:[]:null}_isInteractive(e){return"static"===e||"dynamic"===e}_interactivePrune(e){return!(e&&!e.isMask&&e.visible&&e.renderable&&"none"!==e.eventMode&&("passive"!==e.eventMode||e.interactiveChildren)&&!e.isMask)}hitPruneFn(e,n){if(e.hitArea&&(e.worldTransform.applyInverse(n,Pg),!e.hitArea.contains(Pg.x,Pg.y)))return!0;if(e._mask){const r=e._mask.isMaskData?e._mask.maskObject:e._mask;if(r&&!r.containsPoint?.(n))return!0}return!1}hitTestFn(e,n){return"passive"!==e.eventMode&&(!!e.hitArea||!!e.containsPoint&&e.containsPoint(n))}notifyTarget(e,n){const r=`on${n=n??e.type}`;e.currentTarget[r]?.(e),this.notifyListeners(e,e.eventPhase===e.CAPTURING_PHASE||e.eventPhase===e.AT_TARGET?`${n}capture`:n),e.eventPhase===e.AT_TARGET&&this.notifyListeners(e,n)}mapPointerDown(e){if(!(e instanceof wr))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const n=this.createPointerEvent(e);this.dispatchEvent(n,"pointerdown"),"touch"===n.pointerType?this.dispatchEvent(n,"touchstart"):"mouse"!==n.pointerType&&"pen"!==n.pointerType||this.dispatchEvent(n,2===n.button?"rightdown":"mousedown"),this.trackingData(e.pointerId).pressTargetsByButton[e.button]=n.composedPath(),this.freeEvent(n)}mapPointerMove(e){if(!(e instanceof wr))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");this._allInteractiveElements.length=0,this._hitElements.length=0,this._isPointerMoveEvent=!0;const n=this.createPointerEvent(e);this._isPointerMoveEvent=!1;const r="mouse"===n.pointerType||"pen"===n.pointerType,i=this.trackingData(e.pointerId),s=this.findMountedTarget(i.overTargets);if(i.overTargets?.length>0&&s!==n.target){const c=this.createPointerEvent(e,"mousemove"===e.type?"mouseout":"pointerout",s);if(this.dispatchEvent(c,"pointerout"),r&&this.dispatchEvent(c,"mouseout"),!n.composedPath().includes(s)){const u=this.createPointerEvent(e,"pointerleave",s);for(u.eventPhase=u.AT_TARGET;u.target&&!n.composedPath().includes(u.target);)u.currentTarget=u.target,this.notifyTarget(u),r&&this.notifyTarget(u,"mouseleave"),u.target=u.target.parent;this.freeEvent(u)}this.freeEvent(c)}if(s!==n.target){const c=this.clonePointerEvent(n,"mousemove"===e.type?"mouseover":"pointerover");this.dispatchEvent(c,"pointerover"),r&&this.dispatchEvent(c,"mouseover");let u=s?.parent;for(;u&&u!==this.rootTarget.parent&&u!==n.target;)u=u.parent;if(!u||u===this.rootTarget.parent){const d=this.clonePointerEvent(n,"pointerenter");for(d.eventPhase=d.AT_TARGET;d.target&&d.target!==s&&d.target!==this.rootTarget.parent;)d.currentTarget=d.target,this.notifyTarget(d),r&&this.notifyTarget(d,"mouseenter"),d.target=d.target.parent;this.freeEvent(d)}this.freeEvent(c)}const o=[],a=this.enableGlobalMoveEvents??!0;this.moveOnAll?o.push("pointermove"):this.dispatchEvent(n,"pointermove"),a&&o.push("globalpointermove"),"touch"===n.pointerType&&(this.moveOnAll?o.splice(1,0,"touchmove"):this.dispatchEvent(n,"touchmove"),a&&o.push("globaltouchmove")),r&&(this.moveOnAll?o.splice(1,0,"mousemove"):this.dispatchEvent(n,"mousemove"),a&&o.push("globalmousemove"),this.cursor=n.target?.cursor),o.length>0&&this.all(n,o),this._allInteractiveElements.length=0,this._hitElements.length=0,i.overTargets=n.composedPath(),this.freeEvent(n)}mapPointerOver(e){if(!(e instanceof wr))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const n=this.trackingData(e.pointerId),r=this.createPointerEvent(e),i="mouse"===r.pointerType||"pen"===r.pointerType;this.dispatchEvent(r,"pointerover"),i&&this.dispatchEvent(r,"mouseover"),"mouse"===r.pointerType&&(this.cursor=r.target?.cursor);const s=this.clonePointerEvent(r,"pointerenter");for(s.eventPhase=s.AT_TARGET;s.target&&s.target!==this.rootTarget.parent;)s.currentTarget=s.target,this.notifyTarget(s),i&&this.notifyTarget(s,"mouseenter"),s.target=s.target.parent;n.overTargets=r.composedPath(),this.freeEvent(r),this.freeEvent(s)}mapPointerOut(e){if(!(e instanceof wr))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const n=this.trackingData(e.pointerId);if(n.overTargets){const r="mouse"===e.pointerType||"pen"===e.pointerType,i=this.findMountedTarget(n.overTargets),s=this.createPointerEvent(e,"pointerout",i);this.dispatchEvent(s),r&&this.dispatchEvent(s,"mouseout");const o=this.createPointerEvent(e,"pointerleave",i);for(o.eventPhase=o.AT_TARGET;o.target&&o.target!==this.rootTarget.parent;)o.currentTarget=o.target,this.notifyTarget(o),r&&this.notifyTarget(o,"mouseleave"),o.target=o.target.parent;n.overTargets=null,this.freeEvent(s),this.freeEvent(o)}this.cursor=null}mapPointerUp(e){if(!(e instanceof wr))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const n=performance.now(),r=this.createPointerEvent(e);this.dispatchEvent(r,"pointerup"),"touch"===r.pointerType?this.dispatchEvent(r,"touchend"):"mouse"!==r.pointerType&&"pen"!==r.pointerType||this.dispatchEvent(r,2===r.button?"rightup":"mouseup");const i=this.trackingData(e.pointerId),s=this.findMountedTarget(i.pressTargetsByButton[e.button]);let o=s;if(s&&!r.composedPath().includes(s)){let a=s;for(;a&&!r.composedPath().includes(a);)r.currentTarget=a,this.notifyTarget(r,"pointerupoutside"),"touch"===r.pointerType?this.notifyTarget(r,"touchendoutside"):"mouse"!==r.pointerType&&"pen"!==r.pointerType||this.notifyTarget(r,2===r.button?"rightupoutside":"mouseupoutside"),a=a.parent;delete i.pressTargetsByButton[e.button],o=a}if(o){const a=this.clonePointerEvent(r,"click");a.target=o,a.path=null,i.clicksByButton[e.button]||(i.clicksByButton[e.button]={clickCount:0,target:a.target,timeStamp:n});const l=i.clicksByButton[e.button];l.target===a.target&&n-l.timeStamp<200?++l.clickCount:l.clickCount=1,l.target=a.target,l.timeStamp=n,a.detail=l.clickCount,"mouse"===a.pointerType?this.dispatchEvent(a,2===a.button?"rightclick":"click"):"touch"===a.pointerType&&this.dispatchEvent(a,"tap"),this.dispatchEvent(a,"pointertap"),this.freeEvent(a)}this.freeEvent(r)}mapPointerUpOutside(e){if(!(e instanceof wr))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const n=this.trackingData(e.pointerId),r=this.findMountedTarget(n.pressTargetsByButton[e.button]),i=this.createPointerEvent(e);if(r){let s=r;for(;s;)i.currentTarget=s,this.notifyTarget(i,"pointerupoutside"),"touch"===i.pointerType?this.notifyTarget(i,"touchendoutside"):("mouse"===i.pointerType||"pen"===i.pointerType)&&this.notifyTarget(i,2===i.button?"rightupoutside":"mouseupoutside"),s=s.parent;delete n.pressTargetsByButton[e.button]}this.freeEvent(i)}mapWheel(e){if(!(e instanceof Rg))return void console.warn("EventBoundary cannot map a non-wheel event as a wheel event");const n=this.createWheelEvent(e);this.dispatchEvent(n),this.freeEvent(n)}findMountedTarget(e){if(!e)return null;let n=e[0];for(let r=1;r<e.length&&e[r].parent===n;r++)n=e[r];return n}createPointerEvent(e,n,r){const i=this.allocateEvent(wr);return this.copyPointerData(e,i),this.copyMouseData(e,i),this.copyData(e,i),i.nativeEvent=e.nativeEvent,i.originalEvent=e,i.target=r??this.hitTest(i.global.x,i.global.y)??this._hitElements[0],"string"==typeof n&&(i.type=n),i}createWheelEvent(e){const n=this.allocateEvent(Rg);return this.copyWheelData(e,n),this.copyMouseData(e,n),this.copyData(e,n),n.nativeEvent=e.nativeEvent,n.originalEvent=e,n.target=this.hitTest(n.global.x,n.global.y),n}clonePointerEvent(e,n){const r=this.allocateEvent(wr);return r.nativeEvent=e.nativeEvent,r.originalEvent=e.originalEvent,this.copyPointerData(e,r),this.copyMouseData(e,r),this.copyData(e,r),r.target=e.target,r.path=e.composedPath().slice(),r.type=n??r.type,r}copyWheelData(e,n){n.deltaMode=e.deltaMode,n.deltaX=e.deltaX,n.deltaY=e.deltaY,n.deltaZ=e.deltaZ}copyPointerData(e,n){e instanceof wr&&n instanceof wr&&(n.pointerId=e.pointerId,n.width=e.width,n.height=e.height,n.isPrimary=e.isPrimary,n.pointerType=e.pointerType,n.pressure=e.pressure,n.tangentialPressure=e.tangentialPressure,n.tiltX=e.tiltX,n.tiltY=e.tiltY,n.twist=e.twist)}copyMouseData(e,n){e instanceof Gu&&n instanceof Gu&&(n.altKey=e.altKey,n.button=e.button,n.buttons=e.buttons,n.client.copyFrom(e.client),n.ctrlKey=e.ctrlKey,n.metaKey=e.metaKey,n.movement.copyFrom(e.movement),n.screen.copyFrom(e.screen),n.shiftKey=e.shiftKey,n.global.copyFrom(e.global))}copyData(e,n){n.isTrusted=e.isTrusted,n.srcElement=e.srcElement,n.timeStamp=performance.now(),n.type=e.type,n.detail=e.detail,n.view=e.view,n.which=e.which,n.layer.copyFrom(e.layer),n.page.copyFrom(e.page)}trackingData(e){return this.mappingState.trackingData[e]||(this.mappingState.trackingData[e]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[e]}allocateEvent(e){this.eventPool.has(e)||this.eventPool.set(e,[]);const n=this.eventPool.get(e).pop()||new e(this);return n.eventPhase=n.NONE,n.currentTarget=null,n.path=null,n.target=null,n}freeEvent(e){if(e.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const n=e.constructor;this.eventPool.has(n)||this.eventPool.set(n,[]),this.eventPool.get(n).push(e)}notifyListeners(e,n){const r=e.currentTarget._events[n];if(r&&e.currentTarget.isInteractive())if("fn"in r)r.once&&e.currentTarget.removeListener(n,r.fn,void 0,!0),r.fn.call(r.context,e);else for(let i=0,s=r.length;i<s&&!e.propagationImmediatelyStopped;i++)r[i].once&&e.currentTarget.removeListener(n,r[i].fn,void 0,!0),r[i].fn.call(r[i].context,e)}}const v2={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},Ng=class{constructor(t){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=t,this.rootBoundary=new y2(null),Oi.init(this),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new wr(null),this.rootWheelEvent=new Rg(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.features=new Proxy({...Ng.defaultEventFeatures},{set:(e,n,r)=>("globalMove"===n&&(this.rootBoundary.enableGlobalMoveEvents=r),e[n]=r,!0)}),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init(t){const{view:e,resolution:n}=this.renderer;this.setTargetElement(e),this.resolution=n,Ng._defaultEventMode=t.eventMode??"auto",Object.assign(this.features,t.eventFeatures??{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove}resolutionChange(t){this.resolution=t}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(t){t=t||"default";let e=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(e=!1),this.currentCursor===t)return;this.currentCursor=t;const n=this.cursorStyles[t];if(n)switch(typeof n){case"string":e&&(this.domElement.style.cursor=n);break;case"function":n(t);break;case"object":e&&Object.assign(this.domElement.style,n)}else e&&"string"==typeof t&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,t)&&(this.domElement.style.cursor=t)}get pointer(){return this.rootPointerEvent}onPointerDown(t){if(!this.features.click||(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&"touch"===t.pointerType))return;const e=this.normalizeToPointerData(t);this.autoPreventDefault&&e[0].isNormalized&&(t.cancelable||!("cancelable"in t))&&t.preventDefault();for(let n=0,r=e.length;n<r;n++){const s=this.bootstrapEvent(this.rootPointerEvent,e[n]);this.rootBoundary.mapEvent(s)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(t){if(!this.features.move||(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&"touch"===t.pointerType))return;Oi.pointerMoved();const e=this.normalizeToPointerData(t);for(let n=0,r=e.length;n<r;n++){const i=this.bootstrapEvent(this.rootPointerEvent,e[n]);this.rootBoundary.mapEvent(i)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(t){if(!this.features.click||(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&"touch"===t.pointerType))return;let e=t.target;t.composedPath&&t.composedPath().length>0&&(e=t.composedPath()[0]);const n=e!==this.domElement?"outside":"",r=this.normalizeToPointerData(t);for(let i=0,s=r.length;i<s;i++){const o=this.bootstrapEvent(this.rootPointerEvent,r[i]);o.type+=n,this.rootBoundary.mapEvent(o)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(t){if(!this.features.click||(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&"touch"===t.pointerType))return;const e=this.normalizeToPointerData(t);for(let n=0,r=e.length;n<r;n++){const i=this.bootstrapEvent(this.rootPointerEvent,e[n]);this.rootBoundary.mapEvent(i)}this.setCursor(this.rootBoundary.cursor)}onWheel(t){if(!this.features.wheel)return;const e=this.normalizeWheelEvent(t);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(e)}setTargetElement(t){this.removeEvents(),this.domElement=t,Oi.domElement=t,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;Oi.addTickerListener();const t=this.domElement.style;t&&(globalThis.navigator.msPointerEnabled?(t.msContentZooming="none",t.msTouchAction="none"):this.supportsPointerEvents&&(t.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0)),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;Oi.removeTickerListener();const t=this.domElement.style;globalThis.navigator.msPointerEnabled?(t.msContentZooming="",t.msTouchAction=""):this.supportsPointerEvents&&(t.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0)),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(t,e,n){let r;r=this.domElement.parentElement?this.domElement.getBoundingClientRect():{x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0};const i=1/this.resolution;t.x=this.domElement.width/r.width*(e-r.left)*i,t.y=this.domElement.height/r.height*(n-r.top)*i}normalizeToPointerData(t){const e=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(let n=0,r=t.changedTouches.length;n<r;n++){const i=t.changedTouches[n];typeof i.button>"u"&&(i.button=0),typeof i.buttons>"u"&&(i.buttons=1),typeof i.isPrimary>"u"&&(i.isPrimary=1===t.touches.length&&"touchstart"===t.type),typeof i.width>"u"&&(i.width=i.radiusX||1),typeof i.height>"u"&&(i.height=i.radiusY||1),typeof i.tiltX>"u"&&(i.tiltX=0),typeof i.tiltY>"u"&&(i.tiltY=0),typeof i.pointerType>"u"&&(i.pointerType="touch"),typeof i.pointerId>"u"&&(i.pointerId=i.identifier||0),typeof i.pressure>"u"&&(i.pressure=i.force||.5),typeof i.twist>"u"&&(i.twist=0),typeof i.tangentialPressure>"u"&&(i.tangentialPressure=0),typeof i.layerX>"u"&&(i.layerX=i.offsetX=i.clientX),typeof i.layerY>"u"&&(i.layerY=i.offsetY=i.clientY),i.isNormalized=!0,i.type=t.type,e.push(i)}else if(!globalThis.MouseEvent||t instanceof MouseEvent&&!(this.supportsPointerEvents&&t instanceof globalThis.PointerEvent)){const n=t;typeof n.isPrimary>"u"&&(n.isPrimary=!0),typeof n.width>"u"&&(n.width=1),typeof n.height>"u"&&(n.height=1),typeof n.tiltX>"u"&&(n.tiltX=0),typeof n.tiltY>"u"&&(n.tiltY=0),typeof n.pointerType>"u"&&(n.pointerType="mouse"),typeof n.pointerId>"u"&&(n.pointerId=1),typeof n.pressure>"u"&&(n.pressure=.5),typeof n.twist>"u"&&(n.twist=0),typeof n.tangentialPressure>"u"&&(n.tangentialPressure=0),n.isNormalized=!0,e.push(n)}else e.push(t);return e}normalizeWheelEvent(t){const e=this.rootWheelEvent;return this.transferMouseData(e,t),e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ,e.deltaMode=t.deltaMode,this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.nativeEvent=t,e.type=t.type,e}bootstrapEvent(t,e){return t.originalEvent=null,t.nativeEvent=e,t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,this.transferMouseData(t,e),this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.isTrusted=e.isTrusted,"pointerleave"===t.type&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=v2[t.type]||t.type),t}transferMouseData(t,e){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.x=e.clientX,t.client.y=e.clientY,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.x=e.movementX,t.movement.y=e.movementY,t.page.x=e.pageX,t.page.y=e.pageY,t.relatedTarget=null,t.shiftKey=e.shiftKey}};let rl=Ng;function dD(t){return"dynamic"===t||"static"===t}rl.extension={name:"events",type:[de.RendererSystem,de.CanvasRendererSystem]},rl.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0},Se.add(rl);const x2={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,_internalInteractive:void 0,get interactive(){return this._internalInteractive??dD(rl.defaultEventMode)},set interactive(t){Ye("7.2.0","Setting interactive is deprecated, use eventMode = 'none'/'passive'/'auto'/'static'/'dynamic' instead."),this._internalInteractive=t,this.eventMode=t?"static":"auto"},_internalEventMode:void 0,get eventMode(){return this._internalEventMode??rl.defaultEventMode},set eventMode(t){this._internalInteractive=dD(t),this._internalEventMode=t},isInteractive(){return"static"===this.eventMode||"dynamic"===this.eventMode},interactiveChildren:!0,hitArea:null,addEventListener(t,e,n){const i="function"==typeof e?void 0:e;this.on(t="boolean"==typeof n&&n||"object"==typeof n&&n.capture?`${t}capture`:t,e="function"==typeof e?e:e.handleEvent,i)},removeEventListener(t,e,n){const i="function"==typeof e?void 0:e;this.off(t="boolean"==typeof n&&n||"object"==typeof n&&n.capture?`${t}capture`:t,e="function"==typeof e?e:e.handleEvent,i)},dispatchEvent(t){if(!(t instanceof nl))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return t.defaultPrevented=!1,t.path=null,t.target=this,t.manager.dispatchEvent(t),!t.defaultPrevented}};Bt.mixin(x2),Bt.mixin({accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1});class gD{constructor(e){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(di.tablet||di.phone)&&this.createTouchHook();const n=document.createElement("div");n.style.width="100px",n.style.height="100px",n.style.position="absolute",n.style.top="0px",n.style.left="0px",n.style.zIndex=2..toString(),this.div=n,this.renderer=e,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){const e=document.createElement("button");e.style.width="1px",e.style.height="1px",e.style.position="absolute",e.style.top="-1000px",e.style.left="-1000px",e.style.zIndex=2..toString(),e.style.backgroundColor="#FF0000",e.title="select to enable accessibility for this content",e.addEventListener("focus",()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()}),document.body.appendChild(e),this._hookDiv=e}destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),this.renderer.view.parentNode?.appendChild(this.div))}deactivate(){!this._isActive||this._isMobileAccessibility||(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),this.div.parentNode?.removeChild(this.div))}updateAccessibleObjects(e){if(!e.visible||!e.accessibleChildren)return;e.accessible&&e.isInteractive()&&(e._accessibleActive||this.addChild(e),e.renderId=this.renderId);const n=e.children;if(n)for(let r=0;r<n.length;r++)this.updateAccessibleObjects(n[r])}update(){const e=performance.now();if(di.android.device&&e<this.androidUpdateCount||(this.androidUpdateCount=e+this.androidUpdateFrequency,!this.renderer.renderingToScreen))return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);const{x:n,y:r,width:i,height:s}=this.renderer.view.getBoundingClientRect(),{width:o,height:a,resolution:l}=this.renderer,c=i/o*l,u=s/a*l;let h=this.div;h.style.left=`${n}px`,h.style.top=`${r}px`,h.style.width=`${o}px`,h.style.height=`${a}px`;for(let d=0;d<this.children.length;d++){const f=this.children[d];if(f.renderId!==this.renderId)f._accessibleActive=!1,wo(this.children,d,1),this.div.removeChild(f._accessibleDiv),this.pool.push(f._accessibleDiv),f._accessibleDiv=null,d--;else{h=f._accessibleDiv;let p=f.hitArea;const g=f.worldTransform;f.hitArea?(h.style.left=(g.tx+p.x*g.a)*c+"px",h.style.top=(g.ty+p.y*g.d)*u+"px",h.style.width=p.width*g.a*c+"px",h.style.height=p.height*g.d*u+"px"):(p=f.getBounds(),this.capHitArea(p),h.style.left=p.x*c+"px",h.style.top=p.y*u+"px",h.style.width=p.width*c+"px",h.style.height=p.height*u+"px",h.title!==f.accessibleTitle&&null!==f.accessibleTitle&&(h.title=f.accessibleTitle),h.getAttribute("aria-label")!==f.accessibleHint&&null!==f.accessibleHint&&h.setAttribute("aria-label",f.accessibleHint)),(f.accessibleTitle!==h.title||f.tabIndex!==h.tabIndex)&&(h.title=f.accessibleTitle,h.tabIndex=f.tabIndex,this.debug&&this.updateDebugHTML(h))}}this.renderId++}updateDebugHTML(e){e.innerHTML=`type: ${e.type}</br> title : ${e.title}</br> tabIndex: ${e.tabIndex}`}capHitArea(e){e.x<0&&(e.width+=e.x,e.x=0),e.y<0&&(e.height+=e.y,e.y=0);const{width:n,height:r}=this.renderer;e.x+e.width>n&&(e.width=n-e.x),e.y+e.height>r&&(e.height=r-e.y)}addChild(e){let n=this.pool.pop();n||(n=document.createElement("button"),n.style.width="100px",n.style.height="100px",n.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",n.style.position="absolute",n.style.zIndex=2..toString(),n.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?n.setAttribute("aria-live","off"):n.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?n.setAttribute("aria-relevant","additions"):n.setAttribute("aria-relevant","text"),n.addEventListener("click",this._onClick.bind(this)),n.addEventListener("focus",this._onFocus.bind(this)),n.addEventListener("focusout",this._onFocusOut.bind(this))),n.style.pointerEvents=e.accessiblePointerEvents,n.type=e.accessibleType,e.accessibleTitle&&null!==e.accessibleTitle?n.title=e.accessibleTitle:(!e.accessibleHint||null===e.accessibleHint)&&(n.title=`displayObject ${e.tabIndex}`),e.accessibleHint&&null!==e.accessibleHint&&n.setAttribute("aria-label",e.accessibleHint),this.debug&&this.updateDebugHTML(n),e._accessibleActive=!0,e._accessibleDiv=n,n.displayObject=e,this.children.push(e),this.div.appendChild(e._accessibleDiv),e._accessibleDiv.tabIndex=e.tabIndex}_dispatchEvent(e,n){const{displayObject:r}=e.target,i=this.renderer.events.rootBoundary,s=Object.assign(new nl(i),{target:r});i.rootTarget=this.renderer.lastObjectRendered,n.forEach(o=>i.dispatchEvent(s,o))}_onClick(e){this._dispatchEvent(e,["click","pointertap","tap"])}_onFocus(e){e.target.getAttribute("aria-live")||e.target.setAttribute("aria-live","assertive"),this._dispatchEvent(e,["mouseover"])}_onFocusOut(e){e.target.getAttribute("aria-live")||e.target.setAttribute("aria-live","polite"),this._dispatchEvent(e,["mouseout"])}_onKeyDown(e){9===e.keyCode&&this.activate()}_onMouseMove(e){0===e.movementX&&0===e.movementY||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}}gD.extension={name:"accessibility",type:[de.RendererPlugin,de.CanvasRendererPlugin]},Se.add(gD);const Fg=class{constructor(t){this.stage=new nn,t=Object.assign({forceCanvas:!1},t),this.renderer=function Mk(t){for(const e of qb)if(e.test(t))return new e(t);throw new Error("Unable to auto-detect a suitable renderer.")}(t),Fg._plugins.forEach(e=>{e.init.call(this,t)})}render(){this.renderer.render(this.stage)}get view(){return this.renderer.view}get screen(){return this.renderer.screen}destroy(t,e){const n=Fg._plugins.slice(0);n.reverse(),n.forEach(r=>{r.destroy.call(this)}),this.stage.destroy(e),this.stage=null,this.renderer.destroy(t),this.renderer=null}};let Og=Fg;Og._plugins=[],Se.handleByList(de.Application,Og._plugins);class mD{static init(e){Object.defineProperty(this,"resizeTo",{set(n){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=n,n&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;let n,r;if(this.cancelResize(),this._resizeTo===globalThis.window)n=globalThis.innerWidth,r=globalThis.innerHeight;else{const{clientWidth:i,clientHeight:s}=this._resizeTo;n=i,r=s}this.renderer.resize(n,r),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=e.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}mD.extension=de.Application,Se.add(mD);const yD={loader:de.LoadParser,resolver:de.ResolveParser,cache:de.CacheParser,detection:de.DetectionParser};Se.handle(de.Asset,t=>{const e=t.ref;Object.entries(yD).filter(([n])=>!!e[n]).forEach(([n,r])=>Se.add(Object.assign(e[n],{extension:e[n].extension??r})))},t=>{const e=t.ref;Object.keys(yD).filter(n=>!!e[n]).forEach(n=>Se.remove(e[n]))});class I2{constructor(e,n=!1){this._loader=e,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=n}add(e){e.forEach(n=>{this._assetList.push(n)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}_next(){var e=this;return Z(function*(){if(e._assetList.length&&e._isActive){e._isLoading=!0;const n=[],r=Math.min(e._assetList.length,e._maxConcurrent);for(let i=0;i<r;i++)n.push(e._assetList.pop());yield e._loader.load(n),e._isLoading=!1,e._next()}})()}get active(){return this._isActive}set active(e){this._isActive!==e&&(this._isActive=e,e&&!this._isLoading&&this._next())}}function ps(t,e){const n=t.split("?")[0],r=pn.extname(n).toLowerCase();return Array.isArray(e)?e.includes(r):r===e}const gi=(t,e)=>(Array.isArray(t)||(t=[t]),e?t.map(n=>"string"==typeof n?e(n):n):t),il=new class A2{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(e){return this._cache.has(e)}get(e){const n=this._cache.get(e);return n||console.warn(`[Assets] Asset id ${e} was not found in the Cache`),n}set(e,n){const r=gi(e);let i;for(let a=0;a<this.parsers.length;a++){const l=this.parsers[a];if(l.test(n)){i=l.getCacheableAssets(r,n);break}}i||(i={},r.forEach(a=>{i[a]=n}));const s=Object.keys(i),o={cacheKeys:s,keys:r};if(r.forEach(a=>{this._cacheMap.set(a,o)}),s.forEach(a=>{this._cache.has(a)&&this._cache.get(a)!==n&&console.warn("[Cache] already has key:",a),this._cache.set(a,i[a])}),n instanceof ye){const a=n;r.forEach(l=>{a.baseTexture!==ye.EMPTY.baseTexture&&$e.addToCache(a.baseTexture,l),ye.addToCache(a,l)})}}remove(e){if(this._cacheMap.get(e),!this._cacheMap.has(e))return void console.warn(`[Assets] Asset id ${e} was not found in the Cache`);const n=this._cacheMap.get(e);n.cacheKeys.forEach(i=>{this._cache.delete(i)}),n.keys.forEach(i=>{this._cacheMap.delete(i)})}get parsers(){return this._parsers}},$u=t=>!Array.isArray(t);class M2{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(e,n,r)=>(this._parsersValidated=!1,e[n]=r,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(e,n){var r=this;const i={promise:null,parser:null};return i.promise=Z(function*(){let s=null,o=null;if(n.loadParser&&(o=r._parserHash[n.loadParser],o||console.warn(`[Assets] specified load parser "${n.loadParser}" not found while loading ${e}`)),!o){for(let a=0;a<r.parsers.length;a++){const l=r.parsers[a];if(l.load&&l.test?.(e,n,r)){o=l;break}}if(!o)return console.warn(`[Assets] ${e} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}s=yield o.load(e,n,r),i.parser=o;for(let a=0;a<r.parsers.length;a++){const l=r.parsers[a];l.parse&&l.parse&&(yield l.testParse?.(s,n,r))&&(s=(yield l.parse(s,n,r))||s,i.parser=l)}return s})(),i}load(e,n){var r=this;return Z(function*(){r._parsersValidated||r._validateParsers();let i=0;const s={},o=$u(e),a=gi(e,u=>({src:u})),l=a.length,c=a.map(function(){var u=Z(function*(h){const d=pn.toAbsolute(h.src);if(!s[h.src])try{r.promiseCache[d]||(r.promiseCache[d]=r._getLoadPromiseAndParser(d,h)),s[h.src]=yield r.promiseCache[d].promise,n&&n(++i/l)}catch(f){throw delete r.promiseCache[d],delete s[h.src],new Error(`[Loader.load] Failed to load ${d}.\n${f}`)}});return function(h){return u.apply(this,arguments)}}());return yield Promise.all(c),o?s[a[0].src]:s})()}unload(e){var n=this;return Z(function*(){const i=gi(e,s=>({src:s})).map(function(){var s=Z(function*(o){const a=pn.toAbsolute(o.src),l=n.promiseCache[a];if(l){const c=yield l.promise;l.parser?.unload?.(c,o,n),delete n.promiseCache[a]}});return function(o){return s.apply(this,arguments)}}());yield Promise.all(i)})()}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter(e=>e.name).reduce((e,n)=>(e[n.name]&&console.warn(`[Assets] loadParser name conflict "${n.name}"`),{...e,[n.name]:n}),{})}}var Yr=(t=>(t[t.Low=0]="Low",t[t.Normal=1]="Normal",t[t.High=2]="High",t))(Yr||{});function sl(t,e){if(Array.isArray(e)){for(const n of e)if(t.startsWith(`data:${n}`))return!0;return!1}return t.startsWith(`data:${e}`)}const N2={extension:{type:de.LoadParser,priority:Yr.Low},name:"loadJson",test:t=>sl(t,"application/json")||ps(t,".json"),load:t=>Z(function*(){return yield(yield ue.ADAPTER.fetch(t)).json()})()};Se.add(N2);const L2={name:"loadTxt",extension:{type:de.LoadParser,priority:Yr.Low},test:t=>sl(t,"text/plain")||ps(t,".txt"),load:t=>Z(function*(){return yield(yield ue.ADAPTER.fetch(t)).text()})()};Se.add(L2);const B2=["normal","bold","100","200","300","400","500","600","700","800","900"],k2=[".ttf",".otf",".woff",".woff2"],U2=["font/ttf","font/otf","font/woff","font/woff2"],H2=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i,G2={extension:{type:de.LoadParser,priority:Yr.Low},name:"loadWebFont",test:t=>sl(t,U2)||ps(t,k2),load:(t,e)=>Z(function*(){const n=ue.ADAPTER.getFontFaceSet();if(n){const r=[],i=e.data?.family??function V2(t){const e=pn.extname(t),i=pn.basename(t,e).replace(/(-|_)/g," ").toLowerCase().split(" ").map(a=>a.charAt(0).toUpperCase()+a.slice(1));let s=i.length>0;for(const a of i)if(!a.match(H2)){s=!1;break}let o=i.join(" ");return s||(o=`"${o.replace(/[\\"]/g,"\\$&")}"`),o}(t),s=e.data?.weights?.filter(a=>B2.includes(a))??["normal"],o=e.data??{};for(let a=0;a<s.length;a++){const l=s[a],c=new FontFace(i,`url(${encodeURI(t)})`,{...o,weight:l});yield c.load(),n.add(c),r.push(c)}return 1===r.length?r[0]:r}return console.warn("[loadWebFont] FontFace API is not supported. Skipping loading font"),null})(),unload(t){(Array.isArray(t)?t:[t]).forEach(e=>ue.ADAPTER.getFontFaceSet().delete(e))}};Se.add(G2);let Lg,_D=0;const j2_code="\n    async function checkImageBitmap()\n    {\n        try\n        {\n            if (typeof createImageBitmap !== 'function') return false;\n\n            const response = await fetch('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=');\n            const imageBlob =  await response.blob();\n            const imageBitmap = await createImageBitmap(imageBlob);\n\n            return imageBitmap.width === 1 && imageBitmap.height === 1;\n        }\n        catch (e)\n        {\n            return false;\n        }\n    }\n    checkImageBitmap().then((result) => { self.postMessage(result); });\n    ",$2_code="\n    async function loadImageBitmap(url)\n    {\n        const response = await fetch(url);\n\n        if (!response.ok)\n        {\n            throw new Error(`[WorkerManager.loadImageBitmap] Failed to fetch ${url}: `\n                + `${response.status} ${response.statusText}`);\n        }\n\n        const imageBlob =  await response.blob();\n        const imageBitmap = await createImageBitmap(imageBlob);\n\n        return imageBitmap;\n    }\n    self.onmessage = async (event) =>\n    {\n        try\n        {\n            const imageBitmap = await loadImageBitmap(event.data.data[0]);\n\n            self.postMessage({\n                data: imageBitmap,\n                uuid: event.data.uuid,\n                id: event.data.id,\n            }, [imageBitmap]);\n        }\n        catch(e)\n        {\n            self.postMessage({\n                error: e,\n                uuid: event.data.uuid,\n                id: event.data.id,\n            });\n        }\n    };";let Bg;const vD=new class z2{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return void 0!==this._isImageBitmapSupported||(this._isImageBitmapSupported=new Promise(e=>{const n=URL.createObjectURL(new Blob([j2_code],{type:"application/javascript"})),r=new Worker(n);r.addEventListener("message",i=>{r.terminate(),URL.revokeObjectURL(n),e(i.data)})})),this._isImageBitmapSupported}loadImageBitmap(e){return this._run("loadImageBitmap",[e])}_initWorkers(){var e=this;return Z(function*(){e._initialized||(e._initialized=!0)})()}getWorker(){void 0===Lg&&(Lg=navigator.hardwareConcurrency||4);let e=this.workerPool.pop();return!e&&this._createdWorkers<Lg&&(Bg||(Bg=URL.createObjectURL(new Blob([$2_code],{type:"application/javascript"}))),this._createdWorkers++,e=new Worker(Bg),e.addEventListener("message",n=>{this.complete(n.data),this.returnWorker(n.target),this.next()})),e}returnWorker(e){this.workerPool.push(e)}complete(e){void 0!==e.error?this.resolveHash[e.uuid].reject(e.error):this.resolveHash[e.uuid].resolve(e.data),this.resolveHash[e.uuid]=null}_run(e,n){var r=this;return Z(function*(){yield r._initWorkers();const i=new Promise((s,o)=>{r.queue.push({id:e,arguments:n,resolve:s,reject:o})});return r.next(),i})()}next(){if(!this.queue.length)return;const e=this.getWorker();if(!e)return;const n=this.queue.pop(),r=n.id;this.resolveHash[_D]={resolve:n.resolve,reject:n.reject},e.postMessage({data:n.arguments,uuid:_D++,id:r})}};function zu(t,e,n){const r=new ye(t);return r.baseTexture.on("dispose",()=>{delete e.promiseCache[n]}),r}const W2=[".jpeg",".jpg",".png",".webp",".avif"],X2=["image/jpeg","image/png","image/webp","image/avif"];function kg(){return(kg=Z(function*(t){const e=yield ue.ADAPTER.fetch(t);if(!e.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${t}: ${e.status} ${e.statusText}`);const n=yield e.blob();return yield createImageBitmap(n)})).apply(this,arguments)}const Wu={name:"loadTextures",extension:{type:de.LoadParser,priority:Yr.High},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test:t=>sl(t,X2)||ps(t,W2),load(t,e,n){var r=this;return Z(function*(){let i=null;i=globalThis.createImageBitmap&&r.config.preferCreateImageBitmap?r.config.preferWorkers&&(yield vD.isImageBitmapSupported())?yield vD.loadImageBitmap(t):yield function Y2(t){return kg.apply(this,arguments)}(t):yield new Promise(o=>{i=new Image,i.crossOrigin=r.config.crossOrigin,i.src=t,i.complete?o(i):i.onload=()=>{o(i)}});const s=new $e(i,{resolution:Mi(t),...e.data});return s.resource.src=t,zu(s,n,t)})()},unload(t){t.destroy(!0)}};Se.add(Wu);const K2={extension:{type:de.LoadParser,priority:Yr.High},name:"loadSVG",test:t=>sl(t,"image/svg+xml")||ps(t,".svg"),testParse:t=>Z(function*(){return Qa.test(t)})(),parse:(t,e,n)=>Z(function*(){const r=new Qa(t,e?.data?.resourceOptions);yield r.load();const i=new $e(r,{resolution:Mi(t),...e?.data});return i.resource.src=t,zu(i,n,t)})(),load:(t,e)=>Z(function*(){return(yield ue.ADAPTER.fetch(t)).text()})(),unload:Wu.unload};function xD(t,e,n,r,i){const s=e[n];for(let o=0;o<s.length;o++){const a=s[o];n<e.length-1?xD(t.replace(r[n],a),e,n+1,r,i):i.push(t.replace(r[n],a))}}function Q2(t){const n=t.match(/\{(.*?)\}/g),r=[];if(n){const i=[];n.forEach(s=>{const o=s.substring(1,s.length-1).split(",");i.push(o)}),xD(t,i,0,n,r)}else r.push(t);return r}Se.add(K2);class J2{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(e,n)=>`${e}${this._bundleIdConnector}${n}`,extractAssetIdFromBundle:(e,n)=>n.replace(`${e}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(e){if(this._bundleIdConnector=e.connector??this._bundleIdConnector,this._createBundleAssetId=e.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=e.extractAssetIdFromBundle??this._extractAssetIdFromBundle,"bar"!==this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar")))throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...e){e.forEach(n=>{this._preferredOrder.push(n),n.priority||(n.priority=Object.keys(n.params))}),this._resolverHash={}}set basePath(e){this._basePath=e}get basePath(){return this._basePath}set rootPath(e){this._rootPath=e}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(e){if("string"==typeof e)this._defaultSearchParams=e;else{const n=e;this._defaultSearchParams=Object.keys(n).map(r=>`${encodeURIComponent(r)}=${encodeURIComponent(n[r])}`).join("&")}}addManifest(e){this._manifest&&console.warn("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=e,e.bundles.forEach(n=>{this.addBundle(n.name,n.assets)})}addBundle(e,n){const r=[];Array.isArray(n)?n.forEach(i=>{if("string"==typeof i.name){const s=this._createBundleAssetId(e,i.name);r.push(s),this.add([i.name,s],i.srcs,i.data)}else{const s=i.name.map(o=>this._createBundleAssetId(e,o));s.forEach(o=>{r.push(o)}),this.add([...i.name,...s],i.srcs)}}):Object.keys(n).forEach(i=>{r.push(this._createBundleAssetId(e,i)),this.add([i,this._createBundleAssetId(e,i)],n[i])}),this._bundles[e]=r}add(e,n,r){const i=gi(e);i.forEach(o=>{this.hasKey(o)&&console.warn(`[Resolver] already has key: ${o} overwriting`)}),Array.isArray(n)||(n="string"==typeof n?Q2(n):[n]);const s=n.map(o=>{let a=o;if("string"==typeof o){let l=!1;for(let c=0;c<this._parsers.length;c++){const u=this._parsers[c];if(u.test(o)){a=u.parse(o),l=!0;break}}l||(a={src:o})}return a.format||(a.format=a.src.split(".").pop()),a.alias||(a.alias=i),(this._basePath||this._rootPath)&&(a.src=pn.toAbsolute(a.src,this._basePath,this._rootPath)),a.src=this._appendDefaultSearchParams(a.src),a.data=a.data??r,a});i.forEach(o=>{this._assetMap[o]=s})}resolveBundle(e){const n=$u(e);e=gi(e);const r={};return e.forEach(i=>{const s=this._bundles[i];if(s){const o=this.resolve(s),a={};for(const l in o){const c=o[l];a[this._extractAssetIdFromBundle(i,l)]=c}r[i]=a}}),n?r[e[0]]:r}resolveUrl(e){const n=this.resolve(e);if("string"!=typeof e){const r={};for(const i in n)r[i]=n[i].src;return r}return n.src}resolve(e){const n=$u(e);e=gi(e);const r={};return e.forEach(i=>{if(!this._resolverHash[i])if(this._assetMap[i]){let s=this._assetMap[i];const o=this._getPreferredOrder(s),a=s[0];o?.priority.forEach(l=>{o.params[l].forEach(c=>{const u=s.filter(h=>!!h[l]&&h[l]===c);u.length&&(s=u)})}),this._resolverHash[i]=s[0]??a}else{let s=i;(this._basePath||this._rootPath)&&(s=pn.toAbsolute(s,this._basePath,this._rootPath)),s=this._appendDefaultSearchParams(s),this._resolverHash[i]={src:s}}r[i]=this._resolverHash[i]}),n?r[e[0]]:r}hasKey(e){return!!this._assetMap[e]}hasBundle(e){return!!this._bundles[e]}_getPreferredOrder(e){for(let n=0;n<e.length;n++){const r=e[0],i=this._preferredOrder.find(s=>s.params.format.includes(r.format));if(i)return i}return this._preferredOrder[0]}_appendDefaultSearchParams(e){return this._defaultSearchParams?`${e}${/\?/.test(e)?"&":"?"}${this._defaultSearchParams}`:e}}const cn=new class e3{constructor(){this._detections=[],this._initialized=!1,this.resolver=new J2,this.loader=new M2,this.cache=il,this._backgroundLoader=new I2(this.loader),this._backgroundLoader.active=!0,this.reset()}init(e={}){var n=this;return Z(function*(){if(n._initialized)return void console.warn("[Assets]AssetManager already initialized, did you load before calling this Asset.init()?");if(n._initialized=!0,e.defaultSearchParams&&n.resolver.setDefaultSearchParams(e.defaultSearchParams),e.basePath&&(n.resolver.basePath=e.basePath),e.bundleIdentifier&&n.resolver.setBundleIdentifier(e.bundleIdentifier),e.manifest){let o=e.manifest;"string"==typeof o&&(o=yield n.load(o)),n.resolver.addManifest(o)}const r=e.texturePreference?.resolution??1,i="number"==typeof r?[r]:r;let s=[];if(e.texturePreference?.format){const o=e.texturePreference?.format;s="string"==typeof o?[o]:o;for(const a of n._detections)(yield a.test())||(s=yield a.remove(s))}else for(const o of n._detections)(yield o.test())&&(s=yield o.add(s));n.resolver.prefer({params:{format:s,resolution:i}}),e.preferences&&n.setPreferences(e.preferences)})()}add(e,n,r){this.resolver.add(e,n,r)}load(e,n){var r=this;return Z(function*(){r._initialized||(yield r.init());const i=$u(e),s=gi(e).map(l=>"string"!=typeof l?(r.resolver.add(l.src,l),l.src):(r.resolver.hasKey(l)||r.resolver.add(l,l),l)),o=r.resolver.resolve(s),a=yield r._mapLoadToResolve(o,n);return i?a[s[0]]:a})()}addBundle(e,n){this.resolver.addBundle(e,n)}loadBundle(e,n){var r=this;return Z(function*(){r._initialized||(yield r.init());let i=!1;"string"==typeof e&&(i=!0,e=[e]);const s=r.resolver.resolveBundle(e),o={},a=Object.keys(s);let l=0,c=0;const u=()=>{n?.(++l/c)},h=a.map(d=>{const f=s[d];return c+=Object.keys(f).length,r._mapLoadToResolve(f,u).then(p=>{o[d]=p})});return yield Promise.all(h),i?o[e[0]]:o})()}backgroundLoad(e){var n=this;return Z(function*(){n._initialized||(yield n.init()),"string"==typeof e&&(e=[e]);const r=n.resolver.resolve(e);n._backgroundLoader.add(Object.values(r))})()}backgroundLoadBundle(e){var n=this;return Z(function*(){n._initialized||(yield n.init()),"string"==typeof e&&(e=[e]);const r=n.resolver.resolveBundle(e);Object.values(r).forEach(i=>{n._backgroundLoader.add(Object.values(i))})})()}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(e){if("string"==typeof e)return il.get(e);const n={};for(let r=0;r<e.length;r++)n[r]=il.get(e[r]);return n}_mapLoadToResolve(e,n){var r=this;return Z(function*(){const i=Object.values(e),s=Object.keys(e);r._backgroundLoader.active=!1;const o=yield r.loader.load(i,n);r._backgroundLoader.active=!0;const a={};return i.forEach((l,c)=>{const u=o[l.src],h=[l.src];l.alias&&h.push(...l.alias),a[s[c]]=u,il.set(h,u)}),a})()}unload(e){var n=this;return Z(function*(){n._initialized||(yield n.init());const r=gi(e).map(s=>"string"!=typeof s?s.src:s),i=n.resolver.resolve(r);yield n._unloadFromResolved(i)})()}unloadBundle(e){var n=this;return Z(function*(){n._initialized||(yield n.init()),e=gi(e);const r=n.resolver.resolveBundle(e),i=Object.keys(r).map(s=>n._unloadFromResolved(r[s]));yield Promise.all(i)})()}_unloadFromResolved(e){var n=this;return Z(function*(){const r=Object.values(e);r.forEach(i=>{il.remove(i.src)}),yield n.loader.unload(r)})()}get detections(){return this._detections}get preferWorkers(){return Wu.config.preferWorkers}set preferWorkers(e){Ye("7.2.0","Assets.prefersWorkers is deprecated, use Assets.setPreferences({ preferWorkers: true }) instead."),this.setPreferences({preferWorkers:e})}setPreferences(e){this.loader.parsers.forEach(n=>{n.config&&Object.keys(n.config).filter(r=>r in e).forEach(r=>{n.config[r]=e[r]})})}};Se.handleByList(de.LoadParser,cn.loader.parsers).handleByList(de.ResolveParser,cn.resolver.parsers).handleByList(de.CacheParser,cn.cache.parsers).handleByList(de.DetectionParser,cn.detections);const t3={extension:de.CacheParser,test:t=>Array.isArray(t)&&t.every(e=>e instanceof ye),getCacheableAssets:(t,e)=>{const n={};return t.forEach(r=>{e.forEach((i,s)=>{n[r+(0===s?"":s+1)]=i})}),n}};Se.add(t3);const n3={extension:{type:de.DetectionParser,priority:1},test:(t=Z(function*(){if(!globalThis.createImageBitmap)return!1;const n=yield ue.ADAPTER.fetch("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A=").then(r=>r.blob());return createImageBitmap(n).then(()=>!0,()=>!1)}),function(){return t.apply(this,arguments)}),add:function(){var t=Z(function*(e){return[...e,"avif"]});return function(n){return t.apply(this,arguments)}}(),remove:function(){var t=Z(function*(e){return e.filter(n=>"avif"!==n)});return function(n){return t.apply(this,arguments)}}()};var t;Se.add(n3);const r3={extension:{type:de.DetectionParser,priority:0},test:function(){var t=Z(function*(){if(!globalThis.createImageBitmap)return!1;const n=yield ue.ADAPTER.fetch("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA=").then(r=>r.blob());return createImageBitmap(n).then(()=>!0,()=>!1)});return function(){return t.apply(this,arguments)}}(),add:function(){var t=Z(function*(e){return[...e,"webp"]});return function(n){return t.apply(this,arguments)}}(),remove:function(){var t=Z(function*(e){return e.filter(n=>"webp"!==n)});return function(n){return t.apply(this,arguments)}}()};Se.add(r3);const wD=["png","jpg","jpeg"],i3={extension:{type:de.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:function(){var t=Z(function*(e){return[...e,...wD]});return function(n){return t.apply(this,arguments)}}(),remove:function(){var t=Z(function*(e){return e.filter(n=>!wD.includes(n))});return function(n){return t.apply(this,arguments)}}()};Se.add(i3);const s3={extension:de.ResolveParser,test:Wu.test,parse:t=>({resolution:parseFloat(ue.RETINA_PREFIX.exec(t)?.[1]??"1"),format:t.split(".").pop(),src:t})};Se.add(s3);const Ug=(t,e)=>{const n=e.split("?")[1];return n&&(t+=`?${n}`),t};var $n=(t=>(t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t))($n||{});const Xu={33776:.5,33777:.5,33778:1,33779:1,35916:.5,35917:.5,35918:1,35919:1,37488:.5,37489:.5,37490:1,37491:1,37492:.5,37496:1,37493:.5,37497:1,37494:.5,37495:.5,35840:.5,35842:.5,35841:.25,35843:.25,36196:.5,35986:.5,35986:1,34798:1,37808:1};let mi,Ao;function ED(){Ao={s3tc:mi.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:mi.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:mi.getExtension("WEBGL_compressed_texture_etc"),etc1:mi.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:mi.getExtension("WEBGL_compressed_texture_pvrtc")||mi.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:mi.getExtension("WEBGL_compressed_texture_atc"),astc:mi.getExtension("WEBGL_compressed_texture_astc")}}const o3={extension:{type:de.DetectionParser,priority:2},test:function(){var t=Z(function*(){const n=ue.ADAPTER.createCanvas().getContext("webgl");return n?(mi=n,!0):(console.warn("WebGL not available for compressed textures."),!1)});return function(){return t.apply(this,arguments)}}(),add:function(){var t=Z(function*(e){Ao||ED();const n=[];for(const r in Ao)Ao[r]&&n.push(r);return[...n,...e]});return function(n){return t.apply(this,arguments)}}(),remove:function(){var t=Z(function*(e){return Ao||ED(),e.filter(n=>!(n in Ao))});return function(n){return t.apply(this,arguments)}}()};Se.add(o3);class a3 extends Wa{constructor(e,n={width:1,height:1,autoLoad:!0}){let r,i;"string"==typeof e?(r=e,i=new Uint8Array):(r=null,i=e),super(i,n),this.origin=r,this.buffer=i?new Kp(i):null,this._load=null,this.loaded=!1,null!==this.origin&&!1!==n.autoLoad&&this.load(),null===this.origin&&this.buffer&&(this._load=Promise.resolve(this),this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(e){}load(){return this._load||(this._load=fetch(this.origin).then(e=>e.blob()).then(e=>e.arrayBuffer()).then(e=>(this.data=new Uint32Array(e),this.buffer=new Kp(e),this.loaded=!0,this.onBlobLoaded(e),this.update(),this))),this._load}}class gs extends a3{constructor(e,n){super(e,n),this.format=n.format,this.levels=n.levels||1,this._width=n.width,this._height=n.height,this._extension=gs._formatToExtension(this.format),(n.levelBuffers||this.buffer)&&(this._levelBuffers=n.levelBuffers||gs._createLevelBuffers(e instanceof Uint8Array?e:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(e,n,r){const i=e.gl;if(!e.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;for(let o=0,a=this.levels;o<a;o++){const{levelID:l,levelWidth:c,levelHeight:u,levelBuffer:h}=this._levelBuffers[o];i.compressedTexImage2D(i.TEXTURE_2D,l,this.format,c,u,0,h)}return!0}onBlobLoaded(){this._levelBuffers=gs._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(e){if(e>=33776&&e<=33779)return"s3tc";if(e>=37488&&e<=37497)return"etc";if(e>=35840&&e<=35843)return"pvrtc";if(e>=36196)return"etc1";if(e>=35986&&e<=34798)return"atc";throw new Error("Invalid (compressed) texture format given!")}static _createLevelBuffers(e,n,r,i,s,o,a){const l=new Array(r);let c=e.byteOffset,u=o,h=a,d=u+i-1&~(i-1),f=h+s-1&~(s-1),p=d*f*Xu[n];for(let g=0;g<r;g++)l[g]={levelID:g,levelWidth:r>1?u:d,levelHeight:r>1?h:f,levelBuffer:new Uint8Array(e.buffer,c,p)},c+=p,u=u>>1||1,h=h>>1||1,d=u+i-1&~(i-1),f=h+s-1&~(s-1),p=d*f*Xu[n];return l}}const D3={827611204:$n.COMPRESSED_RGBA_S3TC_DXT1_EXT,861165636:$n.COMPRESSED_RGBA_S3TC_DXT3_EXT,894720068:$n.COMPRESSED_RGBA_S3TC_DXT5_EXT},S3={70:$n.COMPRESSED_RGBA_S3TC_DXT1_EXT,71:$n.COMPRESSED_RGBA_S3TC_DXT1_EXT,73:$n.COMPRESSED_RGBA_S3TC_DXT3_EXT,74:$n.COMPRESSED_RGBA_S3TC_DXT3_EXT,76:$n.COMPRESSED_RGBA_S3TC_DXT5_EXT,77:$n.COMPRESSED_RGBA_S3TC_DXT5_EXT,72:$n.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,75:$n.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,78:$n.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT},DD=[171,75,84,88,32,49,49,187,13,10,26,10],SD={[Me.UNSIGNED_BYTE]:1,[Me.UNSIGNED_SHORT]:2,[Me.INT]:4,[Me.UNSIGNED_INT]:4,[Me.FLOAT]:4,[Me.HALF_FLOAT]:8},I3={[Q.RGBA]:4,[Q.RGB]:3,[Q.RG]:2,[Q.RED]:1,[Q.LUMINANCE]:1,[Q.LUMINANCE_ALPHA]:2,[Q.ALPHA]:1},A3={[Me.UNSIGNED_SHORT_4_4_4_4]:2,[Me.UNSIGNED_SHORT_5_5_5_1]:2,[Me.UNSIGNED_SHORT_5_6_5]:2};function P3(t){switch(t){case Q.RGBA:return Q.RGBA_INTEGER;case Q.RGB:return Q.RGB_INTEGER;case Q.RG:return Q.RG_INTEGER;case Q.RED:return Q.RED_INTEGER;default:return t}}const F3={extension:{type:de.LoadParser,priority:Yr.High},name:"loadDDS",test:t=>ps(t,".dds"),load:(t,e,n)=>Z(function*(){const o=function T3(t){const e=new Uint32Array(t);if(542327876!==e[0])throw new Error("Invalid DDS file magic word");const r=new Uint32Array(t,0,124/Uint32Array.BYTES_PER_ELEMENT),i=r[3],s=r[4],o=r[7],a=new Uint32Array(t,19*Uint32Array.BYTES_PER_ELEMENT,32/Uint32Array.BYTES_PER_ELEMENT),l=a[1];if(4&l){const c=a[2];if(808540228!==c){const D=D3[c],$=new Uint8Array(t,128);return[new gs($,{format:D,width:s,height:i,levels:o})]}const h=new Uint32Array(e.buffer,128,20/Uint32Array.BYTES_PER_ELEMENT),d=h[0],f=h[1],p=h[2],g=h[3],m=S3[d];if(void 0===m)throw new Error(`DDSParser cannot parse texture data with DXGI format ${d}`);if(4===p)throw new Error("DDSParser does not support cubemap textures");if(6===f)throw new Error("DDSParser does not supported 3D texture data");const _=new Array,v=148;if(1===g)_.push(new Uint8Array(t,v));else{const D=Xu[m];let A=0,$=s,pe=i;for(let ee=0;ee<o;ee++)A+=Math.max(1,$+3&-4)*Math.max(1,pe+3&-4)*D,$>>>=1,pe>>>=1;let J=v;for(let ee=0;ee<g;ee++)_.push(new Uint8Array(t,J,A)),J+=A}return _.map(D=>new gs(D,{format:m,width:s,height:i,levels:o}))}throw 64&l?new Error("DDSParser does not support uncompressed texture data."):512&l?new Error("DDSParser does not supported YUV uncompressed texture data."):131072&l?new Error("DDSParser does not support single-channel (lumninance) texture data!"):2&l?new Error("DDSParser does not support single-channel (alpha) texture data!"):new Error("DDSParser failed to load a texture file due to an unknown reason!")}(yield(yield ue.ADAPTER.fetch(t)).arrayBuffer()).map(a=>zu(new $e(a,{mipmap:jr.OFF,alphaMode:hr.NO_PREMULTIPLIED_ALPHA,resolution:Mi(t),...e.data}),n,t));return 1===o.length?o[0]:o})(),unload(t){Array.isArray(t)?t.forEach(e=>e.destroy(!0)):t.destroy(!0)}};Se.add(F3);const O3={extension:{type:de.LoadParser,priority:Yr.High},name:"loadKTX",test:t=>ps(t,".ktx"),load:(t,e,n)=>Z(function*(){const i=yield(yield ue.ADAPTER.fetch(t)).arrayBuffer(),{compressed:s,uncompressed:o,kvData:a}=function M3(t,e,n=!1){const r=new DataView(e);if(!function R3(t,e){for(let n=0;n<DD.length;n++)if(e.getUint8(n)!==DD[n])return console.error(`${t} is not a valid *.ktx file!`),!1;return!0}(t,r))return null;const i=67305985===r.getUint32(12,!0),s=r.getUint32(16,i),o=r.getUint32(24,i),a=r.getUint32(28,i),l=r.getUint32(36,i),c=r.getUint32(40,i)||1,u=r.getUint32(44,i)||1,h=r.getUint32(48,i)||1,d=r.getUint32(52,i),f=r.getUint32(56,i),p=r.getUint32(60,i);if(0===c||1!==u)throw new Error("Only 2D textures are supported");if(1!==d)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(1!==h)throw new Error("WebGL does not support array textures");const _=l+3&-4,v=c+3&-4,D=new Array(h);let $,A=l*c;if(0===s&&(A=_*v),$=0!==s?SD[s]?SD[s]*I3[o]:A3[s]:Xu[a],void 0===$)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");const pe=n?function N3(t,e,n){const r=new Map;let i=0;for(;i<e;){const s=t.getUint32(64+i,n),o=64+i+4,a=3-(s+3)%4;if(0===s||s>e-i){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}let l=0;for(;l<s&&0!==t.getUint8(o+l);l++);if(-1===l){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}const c=(new TextDecoder).decode(new Uint8Array(t.buffer,o,l)),u=new DataView(t.buffer,o+l+1,s-l-1);r.set(c,u),i+=4+s+a}return r}(r,p,i):null;let ee=A*$,Ve=l,te=c,he=_,st=v,X=64+p;for(let Y=0;Y<f;Y++){const St=r.getUint32(X,i);let Qe=X+4;for(let qe=0;qe<h;qe++){let Tt=D[qe];Tt||(Tt=D[qe]=new Array(f)),Tt[Y]={levelID:Y,levelWidth:f>1||0!==s?Ve:he,levelHeight:f>1||0!==s?te:st,levelBuffer:new Uint8Array(e,Qe,ee)},Qe+=ee}X+=St+4,X=X%4!=0?X+4-X%4:X,Ve=Ve>>1||1,te=te>>1||1,he=Ve+4-1&-4,st=te+4-1&-4,ee=he*st*$}return 0!==s?{uncompressed:D.map(Y=>{let St=Y[0].levelBuffer,Qe=!1;return s===Me.FLOAT?St=new Float32Array(Y[0].levelBuffer.buffer,Y[0].levelBuffer.byteOffset,Y[0].levelBuffer.byteLength/4):s===Me.UNSIGNED_INT?(Qe=!0,St=new Uint32Array(Y[0].levelBuffer.buffer,Y[0].levelBuffer.byteOffset,Y[0].levelBuffer.byteLength/4)):s===Me.INT&&(Qe=!0,St=new Int32Array(Y[0].levelBuffer.buffer,Y[0].levelBuffer.byteOffset,Y[0].levelBuffer.byteLength/4)),{resource:new Wa(St,{width:Y[0].levelWidth,height:Y[0].levelHeight}),type:s,format:Qe?P3(o):o}}),kvData:pe}:{compressed:D.map(Y=>new gs(null,{format:a,width:l,height:c,levels:f,levelBuffers:Y})),kvData:pe}}(t,i),l=s??o,c={mipmap:jr.OFF,alphaMode:hr.NO_PREMULTIPLIED_ALPHA,resolution:Mi(t),...e.data},u=l.map(h=>{l===o&&Object.assign(c,{type:h.type,format:h.format});const d=new $e(h,c);return d.ktxKeyValueData=a,zu(d,n,t)});return 1===u.length?u[0]:u})(),unload(t){Array.isArray(t)?t.forEach(e=>e.destroy(!0)):t.destroy(!0)}};Se.add(O3);const L3={extension:de.ResolveParser,test:t=>{const n=t.split("?")[0].split(".").pop();return["basis","ktx","dds"].includes(n)},parse:t=>{if("ktx"===t.split("?")[0].split(".").pop()){const r=[".s3tc.ktx",".s3tc_sRGB.ktx",".etc.ktx",".etc1.ktx",".pvrt.ktx",".atc.ktx",".astc.ktx"];if(r.some(i=>t.endsWith(i)))return{resolution:parseFloat(ue.RETINA_PREFIX.exec(t)?.[1]??"1"),format:r.find(i=>t.endsWith(i)),src:t}}return{resolution:parseFloat(ue.RETINA_PREFIX.exec(t)?.[1]??"1"),format:t.split(".").pop(),src:t}}};Se.add(L3);const B3=new nt,ol=class{constructor(t){this.renderer=t}image(t,e,n){var r=this;return Z(function*(){const i=new Image;return i.src=yield r.base64(t,e,n),i})()}base64(t,e,n){var r=this;return Z(function*(){const i=r.canvas(t);if(void 0!==i.toBlob)return new Promise((s,o)=>{i.toBlob(a=>{if(!a)return void o(new Error("ICanvas.toBlob failed!"));const l=new FileReader;l.onload=()=>s(l.result),l.onerror=o,l.readAsDataURL(a)},e,n)});if(void 0!==i.toDataURL)return i.toDataURL(e,n);if(void 0!==i.convertToBlob){const s=yield i.convertToBlob({type:e,quality:n});return new Promise((o,a)=>{const l=new FileReader;l.onload=()=>o(l.result),l.onerror=a,l.readAsDataURL(s)})}throw new Error("Extract.base64() requires ICanvas.toDataURL, ICanvas.toBlob, or ICanvas.convertToBlob to be implemented")})()}canvas(t,e){const{pixels:n,width:r,height:i,flipY:s}=this._rawPixels(t,e);s&&ol._flipY(n,r,i),ol._unpremultiplyAlpha(n);const o=new vB(r,i,1),a=new ImageData(new Uint8ClampedArray(n.buffer),r,i);return o.context.putImageData(a,0,0),o.canvas}pixels(t,e){const{pixels:n,width:r,height:i,flipY:s}=this._rawPixels(t,e);return s&&ol._flipY(n,r,i),ol._unpremultiplyAlpha(n),n}_rawPixels(t,e){const n=this.renderer;if(!n)throw new Error("The Extract has already been destroyed");let r,s,i=!1,o=!1;if(t&&(t instanceof us?s=t:(s=n.generateTexture(t,{resolution:n.resolution,multisample:n.multisample}),o=!0)),s){if(r=s.baseTexture.resolution,e=e??s.frame,i=!1,!o){n.renderTexture.bind(s);const h=s.framebuffer.glFramebuffers[n.CONTEXT_UID];h.blitFramebuffer&&n.framebuffer.bind(h.blitFramebuffer)}}else r=n.resolution,e||((e=B3).width=n.width/r,e.height=n.height/r),i=!0,n.renderTexture.bind();const a=Math.round(e.width*r),l=Math.round(e.height*r),c=new Uint8Array(4*a*l),u=n.gl;return u.readPixels(Math.round(e.x*r),Math.round(e.y*r),a,l,u.RGBA,u.UNSIGNED_BYTE,c),o&&s?.destroy(!0),{pixels:c,width:a,height:l,flipY:i}}destroy(){this.renderer=null}static _flipY(t,e,n){const r=e<<2,i=n>>1,s=new Uint8Array(r);for(let o=0;o<i;o++){const a=o*r,l=(n-o-1)*r;s.set(t.subarray(a,a+r)),t.copyWithin(a,l,l+r),t.set(s,l)}}static _unpremultiplyAlpha(t){t instanceof Uint8ClampedArray&&(t=new Uint8Array(t.buffer));const e=t.length;for(let n=0;n<e;n+=4){const r=t[n+3];if(0!==r){const i=255.001/r;t[n]=t[n]*i+.5,t[n+1]=t[n+1]*i+.5,t[n+2]=t[n+2]*i+.5}}}};let TD=ol;TD.extension={name:"extract",type:de.RendererSystem},Se.add(TD);class U3{constructor(e,n){this.uvBuffer=e,this.uvMatrix=n,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(e){if(!e&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;const n=this.uvBuffer.data;(!this.data||this.data.length!==n.length)&&(this.data=new Float32Array(n.length)),this.uvMatrix.multiplyUvs(n,this.data),this._updateID++}}const Gg=new ct,CD=new ss,ID=class extends nn{constructor(t,e,n,r=Vr.TRIANGLES){super(),this.geometry=t,this.shader=e,this.state=n||pi.for2d(),this.drawMode=r,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=ue.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(t){this._geometry!==t&&(this._geometry&&(this._geometry.refCount--,0===this._geometry.refCount&&this._geometry.dispose()),this._geometry=t,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(t){this.shader=t}get material(){return this.shader}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(t){this.shader.tint=t}get tintValue(){return this.shader.tintValue}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(t){this.shader.texture=t}_render(t){this.shader.batchable&&this.drawMode===Vr.TRIANGLES&&this.geometry.buffers[0].data.length<2*ID.BATCHABLE_SIZE?this._renderToBatch(t):this._renderDefault(t)}_renderDefault(t){const e=this.shader;e.alpha=this.worldAlpha,e.update&&e.update(),t.batch.flush(),e.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),t.shader.bind(e),t.state.set(this.state),t.geometry.bind(this.geometry,e),t.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(t){const e=this.geometry,n=this.shader;n.uvMatrix&&(n.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=e.indexBuffer.data,this._tintRGB=n._tintRGB,this._texture=n.texture;const r=this.material.pluginName;t.batch.setObjectRenderer(t.plugins[r]),t.plugins[r].render(this)}calculateVertices(){const e=this.geometry.buffers[0],n=e.data,r=e._updateID;if(r===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==n.length&&(this.vertexData=new Float32Array(n.length));const i=this.transform.worldTransform,s=i.a,o=i.b,a=i.c,l=i.d,c=i.tx,u=i.ty,h=this.vertexData;for(let d=0;d<h.length/2;d++){const f=n[2*d],p=n[2*d+1];h[2*d]=s*f+a*p+c,h[2*d+1]=o*f+l*p+u}if(this._roundPixels){const d=ue.RESOLUTION;for(let f=0;f<h.length;++f)h[f]=Math.round(h[f]*d)/d}this.vertexDirty=r}calculateUvs(){const t=this.geometry.buffers[1],e=this.shader;e.uvMatrix.isSimple?this.uvs=t.data:(this.batchUvs||(this.batchUvs=new U3(t,e.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(t){if(!this.getBounds().contains(t.x,t.y))return!1;this.worldTransform.applyInverse(t,Gg);const e=this.geometry.getBuffer("aVertexPosition").data,n=CD.points,r=this.geometry.getIndex().data,i=r.length,s=4===this.drawMode?3:1;for(let o=0;o+2<i;o+=s){const a=2*r[o],l=2*r[o+1],c=2*r[o+2];if(n[0]=e[a],n[1]=e[a+1],n[2]=e[l],n[3]=e[l+1],n[4]=e[c],n[5]=e[c+1],CD.contains(Gg.x,Gg.y))return!0}return!1}destroy(t){super.destroy(t),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}};let jg=ID;jg.BATCHABLE_SIZE=100;class H3 extends Ri{constructor(e,n,r){super();const i=new jt(e),s=new jt(n,!0),o=new jt(r,!0,!0);this.addAttribute("aVertexPosition",i,2,!1,Me.FLOAT).addAttribute("aTextureCoord",s,2,!1,Me.FLOAT).addIndex(o),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}}class AD extends Xr{constructor(e,n){const r={uSampler:e,alpha:1,uTextureMatrix:Pt.IDENTITY,uColor:new Float32Array([1,1,1,1])};(n=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},n)).uniforms&&Object.assign(r,n.uniforms),super(n.program||pr.from("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTextureMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\n}\n","varying vec2 vTextureCoord;\nuniform vec4 uColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;\n}\n"),r),this._colorDirty=!1,this.uvMatrix=new Ab(e),this.batchable=void 0===n.program,this.pluginName=n.pluginName,this._tintColor=new ft(n.tint),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0,this.alpha=n.alpha}get texture(){return this.uniforms.uSampler}set texture(e){this.uniforms.uSampler!==e&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!e.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=e,this.uvMatrix.texture=e)}set alpha(e){e!==this._alpha&&(this._alpha=e,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(e){e!==this.tint&&(this._tintColor.setValue(e),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0)}get tint(){return this._tintColor.value}get tintValue(){return this._tintColor.toNumber()}update(){if(this._colorDirty){this._colorDirty=!1;const n=this.texture.baseTexture.alphaMode;ft.shared.setValue(this._tintColor).premultiply(this._alpha,n).toArray(this.uniforms.uColor)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}}class MD{constructor(e,n,r){this.geometry=new Ri,this.indexBuffer=null,this.size=r,this.dynamicProperties=[],this.staticProperties=[];for(let i=0;i<e.length;++i){let s=e[i];s={attributeName:s.attributeName,size:s.size,uploadFunction:s.uploadFunction,type:s.type||Me.FLOAT,offset:s.offset},n[i]?this.dynamicProperties.push(s):this.staticProperties.push(s)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){const e=this.geometry;let n=0;this.indexBuffer=new jt(function mB(t,e=null){const n=6*t;if((e=e||new Uint16Array(n)).length!==n)throw new Error(`Out buffer length is incorrect, got ${e.length} and expected ${n}`);for(let r=0,i=0;r<n;r+=6,i+=4)e[r+0]=i+0,e[r+1]=i+1,e[r+2]=i+2,e[r+3]=i+0,e[r+4]=i+2,e[r+5]=i+3;return e}(this.size),!0,!0),e.addIndex(this.indexBuffer),this.dynamicStride=0;for(let o=0;o<this.dynamicProperties.length;++o){const a=this.dynamicProperties[o];a.offset=n,n+=a.size,this.dynamicStride+=a.size}const r=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(r),this.dynamicDataUint32=new Uint32Array(r),this.dynamicBuffer=new jt(this.dynamicData,!1,!1);let i=0;this.staticStride=0;for(let o=0;o<this.staticProperties.length;++o){const a=this.staticProperties[o];a.offset=i,i+=a.size,this.staticStride+=a.size}const s=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(s),this.staticDataUint32=new Uint32Array(s),this.staticBuffer=new jt(this.staticData,!0,!1);for(let o=0;o<this.dynamicProperties.length;++o){const a=this.dynamicProperties[o];e.addAttribute(a.attributeName,this.dynamicBuffer,0,a.type===Me.UNSIGNED_BYTE,a.type,4*this.dynamicStride,4*a.offset)}for(let o=0;o<this.staticProperties.length;++o){const a=this.staticProperties[o];e.addAttribute(a.attributeName,this.staticBuffer,0,a.type===Me.UNSIGNED_BYTE,a.type,4*this.staticStride,4*a.offset)}}uploadDynamic(e,n,r){for(let i=0;i<this.dynamicProperties.length;i++){const s=this.dynamicProperties[i];s.uploadFunction(e,n,r,s.type===Me.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,s.offset)}this.dynamicBuffer._updateID++}uploadStatic(e,n,r){for(let i=0;i<this.staticProperties.length;i++){const s=this.staticProperties[i];s.uploadFunction(e,n,r,s.type===Me.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,s.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}}class RD extends Du{constructor(e){super(e),this.shader=null,this.properties=null,this.tempMatrix=new Pt,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:Me.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=Xr.from("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nattribute vec2 aPositionCoord;\nattribute float aRotation;\n\nuniform mat3 translationMatrix;\nuniform vec4 uColor;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nvoid main(void){\n    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);\n    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);\n\n    vec2 v = vec2(x, y);\n    v = v + aPositionCoord;\n\n    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vColor = aColor * uColor;\n}\n","varying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;\n    gl_FragColor = color;\n}",{}),this.state=pi.for2d()}render(e){const n=e.children,r=e._maxSize,i=e._batchSize,s=this.renderer;let o=n.length;if(0===o)return;o>r&&!e.autoResize&&(o=r);let a=e._buffers;a||(a=e._buffers=this.generateBuffers(e));const l=n[0]._texture.baseTexture,c=l.alphaMode>0;this.state.blendMode=eb(e.blendMode,c),s.state.set(this.state);const u=s.gl,h=e.worldTransform.copyTo(this.tempMatrix);h.prepend(s.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=h.toArray(!0),this.shader.uniforms.uColor=ft.shared.setValue(e.tintRgb).premultiply(e.worldAlpha,c).toArray(this.shader.uniforms.uColor),this.shader.uniforms.uSampler=l,this.renderer.shader.bind(this.shader);let d=!1;for(let f=0,p=0;f<o;f+=i,p+=1){let g=o-f;g>i&&(g=i),p>=a.length&&a.push(this._generateOneMoreBuffer(e));const m=a[p];m.uploadDynamic(n,f,g),d=d||m._updateID<(e._bufferUpdateIDs[p]||0),d&&(m._updateID=e._updateID,m.uploadStatic(n,f,g)),s.geometry.bind(m.geometry),u.drawElements(u.TRIANGLES,6*g,u.UNSIGNED_SHORT,0)}}generateBuffers(e){const n=[],r=e._maxSize,i=e._batchSize,s=e._properties;for(let o=0;o<r;o+=i)n.push(new MD(this.properties,s,i));return n}_generateOneMoreBuffer(e){return new MD(this.properties,e._properties,e._batchSize)}uploadVertices(e,n,r,i,s,o){let a=0,l=0,c=0,u=0;for(let h=0;h<r;++h){const d=e[n+h],f=d._texture,p=d.scale.x,g=d.scale.y,m=f.trim,_=f.orig;m?(l=m.x-d.anchor.x*_.width,a=l+m.width,u=m.y-d.anchor.y*_.height,c=u+m.height):(a=_.width*(1-d.anchor.x),l=_.width*-d.anchor.x,c=_.height*(1-d.anchor.y),u=_.height*-d.anchor.y),i[o]=l*p,i[o+1]=u*g,i[o+s]=a*p,i[o+s+1]=u*g,i[o+2*s]=a*p,i[o+2*s+1]=c*g,i[o+3*s]=l*p,i[o+3*s+1]=c*g,o+=4*s}}uploadPosition(e,n,r,i,s,o){for(let a=0;a<r;a++){const l=e[n+a].position;i[o]=l.x,i[o+1]=l.y,i[o+s]=l.x,i[o+s+1]=l.y,i[o+2*s]=l.x,i[o+2*s+1]=l.y,i[o+3*s]=l.x,i[o+3*s+1]=l.y,o+=4*s}}uploadRotation(e,n,r,i,s,o){for(let a=0;a<r;a++){const l=e[n+a].rotation;i[o]=l,i[o+s]=l,i[o+2*s]=l,i[o+3*s]=l,o+=4*s}}uploadUvs(e,n,r,i,s,o){for(let a=0;a<r;++a){const l=e[n+a]._texture._uvs;l?(i[o]=l.x0,i[o+1]=l.y0,i[o+s]=l.x1,i[o+s+1]=l.y1,i[o+2*s]=l.x2,i[o+2*s+1]=l.y2,i[o+3*s]=l.x3,i[o+3*s+1]=l.y3,o+=4*s):(i[o]=0,i[o+1]=0,i[o+s]=0,i[o+s+1]=0,i[o+2*s]=0,i[o+2*s+1]=0,i[o+3*s]=0,i[o+3*s+1]=0,o+=4*s)}}uploadTint(e,n,r,i,s,o){for(let a=0;a<r;++a){const l=e[n+a],c=ft.shared.setValue(l._tintRGB).toPremultiplied(l.alpha,l.texture.baseTexture.alphaMode>0);i[o]=c,i[o+s]=c,i[o+2*s]=c,i[o+3*s]=c,o+=4*s}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}}RD.extension={name:"particle",type:de.RendererPlugin},Se.add(RD);var Qu=(t=>(t[t.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",t[t.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",t))(Qu||{});const Ju={willReadFrequently:!0},De=class{static get experimentalLetterSpacingSupported(){let t=De._experimentalLetterSpacingSupported;if(void 0!==t){const e=ue.ADAPTER.getCanvasRenderingContext2D().prototype;t=De._experimentalLetterSpacingSupported="letterSpacing"in e||"textLetterSpacing"in e}return t}constructor(t,e,n,r,i,s,o,a,l){this.text=t,this.style=e,this.width=n,this.height=r,this.lines=i,this.lineWidths=s,this.lineHeight=o,this.maxLineWidth=a,this.fontProperties=l}static measureText(t,e,n,r=De._canvas){n=n??e.wordWrap;const i=e.toFontString(),s=De.measureFont(i);0===s.fontSize&&(s.fontSize=e.fontSize,s.ascent=e.fontSize);const o=r.getContext("2d",Ju);o.font=i;const l=(n?De.wordWrap(t,e,r):t).split(/(?:\r\n|\r|\n)/),c=new Array(l.length);let u=0;for(let p=0;p<l.length;p++){const g=De._measureText(l[p],e.letterSpacing,o);c[p]=g,u=Math.max(u,g)}let h=u+e.strokeThickness;e.dropShadow&&(h+=e.dropShadowDistance);const d=e.lineHeight||s.fontSize+e.strokeThickness;let f=Math.max(d,s.fontSize+2*e.strokeThickness)+(l.length-1)*(d+e.leading);return e.dropShadow&&(f+=e.dropShadowDistance),new De(t,e,h,f,l,c,d+e.leading,u,s)}static _measureText(t,e,n){let r=!1;De.experimentalLetterSpacingSupported&&(De.experimentalLetterSpacing?(n.letterSpacing=`${e}px`,n.textLetterSpacing=`${e}px`,r=!0):(n.letterSpacing="0px",n.textLetterSpacing="0px"));let i=n.measureText(t).width;return i>0&&(r?i-=e:i+=(De.graphemeSegmenter(t).length-1)*e),i}static wordWrap(t,e,n=De._canvas){const r=n.getContext("2d",Ju);let i=0,s="",o="";const a=Object.create(null),{letterSpacing:l,whiteSpace:c}=e,u=De.collapseSpaces(c),h=De.collapseNewlines(c);let d=!u;const f=e.wordWrapWidth+l,p=De.tokenize(t);for(let g=0;g<p.length;g++){let m=p[g];if(De.isNewline(m)){if(!h){o+=De.addLine(s),d=!u,s="",i=0;continue}m=" "}if(u){const v=De.isBreakingSpace(m),D=De.isBreakingSpace(s[s.length-1]);if(v&&D)continue}const _=De.getFromCache(m,l,a,r);if(_>f)if(""!==s&&(o+=De.addLine(s),s="",i=0),De.canBreakWords(m,e.breakWords)){const v=De.wordWrapSplit(m);for(let D=0;D<v.length;D++){let A=v[D],$=A,pe=1;for(;v[D+pe];){const ee=v[D+pe];if(De.canBreakChars($,ee,m,D,e.breakWords))break;A+=ee,$=ee,pe++}D+=pe-1;const J=De.getFromCache(A,l,a,r);J+i>f&&(o+=De.addLine(s),d=!1,s="",i=0),s+=A,i+=J}}else s.length>0&&(o+=De.addLine(s),s="",i=0),o+=De.addLine(m,!(g===p.length-1)),d=!1,s="",i=0;else _+i>f&&(d=!1,o+=De.addLine(s),s="",i=0),(s.length>0||!De.isBreakingSpace(m)||d)&&(s+=m,i+=_)}return o+=De.addLine(s,!1),o}static addLine(t,e=!0){return t=De.trimRight(t),e?`${t}\n`:t}static getFromCache(t,e,n,r){let i=n[t];return"number"!=typeof i&&(i=De._measureText(t,e,r)+e,n[t]=i),i}static collapseSpaces(t){return"normal"===t||"pre-line"===t}static collapseNewlines(t){return"normal"===t}static trimRight(t){if("string"!=typeof t)return"";for(let e=t.length-1;e>=0&&De.isBreakingSpace(t[e]);e--)t=t.slice(0,-1);return t}static isNewline(t){return"string"==typeof t&&De._newlines.includes(t.charCodeAt(0))}static isBreakingSpace(t,e){return"string"==typeof t&&De._breakingSpaces.includes(t.charCodeAt(0))}static tokenize(t){const e=[];let n="";if("string"!=typeof t)return e;for(let r=0;r<t.length;r++){const i=t[r];De.isBreakingSpace(i,t[r+1])||De.isNewline(i)?(""!==n&&(e.push(n),n=""),e.push(i)):n+=i}return""!==n&&e.push(n),e}static canBreakWords(t,e){return e}static canBreakChars(t,e,n,r,i){return!0}static wordWrapSplit(t){return De.graphemeSegmenter(t)}static measureFont(t){if(De._fonts[t])return De._fonts[t];const e={ascent:0,descent:0,fontSize:0},n=De._canvas,r=De._context;r.font=t;const i=De.METRICS_STRING+De.BASELINE_SYMBOL,s=Math.ceil(r.measureText(i).width);let o=Math.ceil(r.measureText(De.BASELINE_SYMBOL).width);const a=Math.ceil(De.HEIGHT_MULTIPLIER*o);if(o=o*De.BASELINE_MULTIPLIER|0,0===s||0===a)return De._fonts[t]=e,e;n.width=s,n.height=a,r.fillStyle="#f00",r.fillRect(0,0,s,a),r.font=t,r.textBaseline="alphabetic",r.fillStyle="#000",r.fillText(i,0,o);const l=r.getImageData(0,0,s,a).data,c=l.length,u=4*s;let h=0,d=0,f=!1;for(h=0;h<o;++h){for(let p=0;p<u;p+=4)if(255!==l[d+p]){f=!0;break}if(f)break;d+=u}for(e.ascent=o-h,d=c-u,f=!1,h=a;h>o;--h){for(let p=0;p<u;p+=4)if(255!==l[d+p]){f=!0;break}if(f)break;d-=u}return e.descent=h-o,e.fontSize=e.ascent+e.descent,De._fonts[t]=e,e}static clearMetrics(t=""){t?delete De._fonts[t]:De._fonts={}}static get _canvas(){if(!De.__canvas){let t;try{const e=new OffscreenCanvas(0,0);if(e.getContext("2d",Ju)?.measureText)return De.__canvas=e,e;t=ue.ADAPTER.createCanvas()}catch{t=ue.ADAPTER.createCanvas()}t.width=t.height=10,De.__canvas=t}return De.__canvas}static get _context(){return De.__context||(De.__context=De._canvas.getContext("2d",Ju)),De.__context}};let un=De;un.METRICS_STRING="|\xc9q\xc5",un.BASELINE_SYMBOL="M",un.BASELINE_MULTIPLIER=1.4,un.HEIGHT_MULTIPLIER=2,un.graphemeSegmenter=(()=>{if("function"==typeof Intl?.Segmenter){const t=new Intl.Segmenter;return e=>[...t.segment(e)].map(n=>n.segment)}return t=>[...t]})(),un.experimentalLetterSpacing=!1,un._fonts={},un._newlines=[10,13],un._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];const z3=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],al=class{constructor(t){this.styleID=0,this.reset(),zg(this,t,t)}clone(){const t={};return zg(t,this,al.defaultStyle),new al(t)}reset(){zg(this,al.defaultStyle,al.defaultStyle)}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(t){this._breakWords!==t&&(this._breakWords=t,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(t){this._dropShadow!==t&&(this._dropShadow=t,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(t){this._dropShadowAlpha!==t&&(this._dropShadowAlpha=t,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(t){this._dropShadowAngle!==t&&(this._dropShadowAngle=t,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(t){this._dropShadowBlur!==t&&(this._dropShadowBlur=t,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(t){const e=$g(t);this._dropShadowColor!==e&&(this._dropShadowColor=e,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(t){this._dropShadowDistance!==t&&(this._dropShadowDistance=t,this.styleID++)}get fill(){return this._fill}set fill(t){const e=$g(t);this._fill!==e&&(this._fill=e,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(t){this._fillGradientType!==t&&(this._fillGradientType=t,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(t){(function W3(t,e){if(!Array.isArray(t)||!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0})(this._fillGradientStops,t)||(this._fillGradientStops=t,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(t){this.fontFamily!==t&&(this._fontFamily=t,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle!==t&&(this._fontStyle=t,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant!==t&&(this._fontVariant=t,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight!==t&&(this._fontWeight=t,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight!==t&&(this._lineHeight=t,this.styleID++)}get leading(){return this._leading}set leading(t){this._leading!==t&&(this._leading=t,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(t){this._lineJoin!==t&&(this._lineJoin=t,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(t){this._miterLimit!==t&&(this._miterLimit=t,this.styleID++)}get padding(){return this._padding}set padding(t){this._padding!==t&&(this._padding=t,this.styleID++)}get stroke(){return this._stroke}set stroke(t){const e=$g(t);this._stroke!==e&&(this._stroke=e,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(t){this._strokeThickness!==t&&(this._strokeThickness=t,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline!==t&&(this._textBaseline=t,this.styleID++)}get trim(){return this._trim}set trim(t){this._trim!==t&&(this._trim=t,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(t){this._whiteSpace!==t&&(this._whiteSpace=t,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap!==t&&(this._wordWrap=t,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.styleID++)}toFontString(){const t="number"==typeof this.fontSize?`${this.fontSize}px`:this.fontSize;let e=this.fontFamily;Array.isArray(this.fontFamily)||(e=this.fontFamily.split(","));for(let n=e.length-1;n>=0;n--){let r=e[n].trim();!/([\"\'])[^\'\"]+\1/.test(r)&&!z3.includes(r)&&(r=`"${r}"`),e[n]=r}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${t} ${e.join(",")}`}};let Fn=al;function $g(t){const e=ft.shared;return Array.isArray(t)?t.map(n=>e.setValue(n).toHex()):e.setValue(t).toHex()}function zg(t,e,n){for(const r in n)t[r]=Array.isArray(e[r])?e[r].slice():e[r]}Fn.defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:Qu.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};const X3={texture:!0,children:!1,baseTexture:!0},Wg=class extends jn{constructor(t,e,n){let r=!1;n||(n=ue.ADAPTER.createCanvas(),r=!0),n.width=3,n.height=3;const i=ye.from(n);i.orig=new nt,i.trim=new nt,super(i),this._ownCanvas=r,this.canvas=n,this.context=n.getContext("2d",{willReadFrequently:!0}),this._resolution=Wg.defaultResolution??ue.RESOLUTION,this._autoResolution=Wg.defaultAutoResolution,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=t,this.style=e,this.localStyleID=-1}static get experimentalLetterSpacing(){return un.experimentalLetterSpacing}static set experimentalLetterSpacing(t){Ye("7.1.0","Text.experimentalLetterSpacing is deprecated, use TextMetrics.experimentalLetterSpacing"),un.experimentalLetterSpacing=t}updateText(t){const e=this._style;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&t)return;this._font=this._style.toFontString();const n=this.context,r=un.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),s=r.height,o=r.lines,a=r.lineHeight,l=r.lineWidths,c=r.maxLineWidth,u=r.fontProperties;let h,d;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,r.width)+2*e.padding)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,s)+2*e.padding)*this._resolution),n.scale(this._resolution,this._resolution),n.clearRect(0,0,this.canvas.width,this.canvas.height),n.font=this._font,n.lineWidth=e.strokeThickness,n.textBaseline=e.textBaseline,n.lineJoin=e.lineJoin,n.miterLimit=e.miterLimit;const f=e.dropShadow?2:1;for(let p=0;p<f;++p){const g=e.dropShadow&&0===p,m=g?Math.ceil(Math.max(1,s)+2*e.padding):0,_=m*this._resolution;if(g){n.fillStyle="black",n.strokeStyle="black";const A=e.dropShadowBlur*this._resolution,$=e.dropShadowDistance*this._resolution;n.shadowColor=ft.shared.setValue(e.dropShadowColor).setAlpha(e.dropShadowAlpha).toRgbaString(),n.shadowBlur=A,n.shadowOffsetX=Math.cos(e.dropShadowAngle)*$,n.shadowOffsetY=Math.sin(e.dropShadowAngle)*$+_}else n.fillStyle=this._generateFillStyle(e,o,r),n.strokeStyle=e.stroke,n.shadowColor="black",n.shadowBlur=0,n.shadowOffsetX=0,n.shadowOffsetY=0;let v=(a-u.fontSize)/2;a-u.fontSize<0&&(v=0);for(let D=0;D<o.length;D++)h=e.strokeThickness/2,d=e.strokeThickness/2+D*a+u.ascent+v,"right"===e.align?h+=c-l[D]:"center"===e.align&&(h+=(c-l[D])/2),e.stroke&&e.strokeThickness&&this.drawLetterSpacing(o[D],h+e.padding,d+e.padding-m,!0),e.fill&&this.drawLetterSpacing(o[D],h+e.padding,d+e.padding-m)}this.updateTexture()}drawLetterSpacing(t,e,n,r=!1){const s=this._style.letterSpacing;let o=!1;if(un.experimentalLetterSpacingSupported&&(un.experimentalLetterSpacing?(this.context.letterSpacing=`${s}px`,this.context.textLetterSpacing=`${s}px`,o=!0):(this.context.letterSpacing="0px",this.context.textLetterSpacing="0px")),0===s||o)return void(r?this.context.strokeText(t,e,n):this.context.fillText(t,e,n));let a=e;const l=un.graphemeSegmenter(t);let c=this.context.measureText(t).width,u=0;for(let h=0;h<l.length;++h){const d=l[h];r?this.context.strokeText(d,a,n):this.context.fillText(d,a,n);let f="";for(let p=h+1;p<l.length;++p)f+=l[p];u=this.context.measureText(f).width,a+=c-u+s,c=u}}updateTexture(){const t=this.canvas;if(this._style.trim){const s=function wB(t){const e=function xB(t){const{width:e,height:n}=t,r=t.getContext("2d",{willReadFrequently:!0});if(null===r)throw new TypeError("Failed to get canvas 2D context");const s=r.getImageData(0,0,e,n).data;let o=0,a=0,l=e-1,c=n-1;for(;a<n&&sb(s,e,a);)++a;if(a===n)return qp.EMPTY;for(;sb(s,e,c);)--c;for(;ob(s,e,o,a,c);)++o;for(;ob(s,e,l,a,c);)--l;return++l,++c,new qp(o,a,l,c)}(t),{width:n,height:r}=e;let i=null;if(!e.isEmpty()){const s=t.getContext("2d");if(null===s)throw new TypeError("Failed to get canvas 2D context");i=s.getImageData(e.left,e.top,n,r)}return{width:n,height:r,data:i}}(t);s.data&&(t.width=s.width,t.height=s.height,this.context.putImageData(s.data,0,0))}const e=this._texture,n=this._style,r=n.trim?0:n.padding,i=e.baseTexture;e.trim.width=e._frame.width=t.width/this._resolution,e.trim.height=e._frame.height=t.height/this._resolution,e.trim.x=-r,e.trim.y=-r,e.orig.width=e._frame.width-2*r,e.orig.height=e._frame.height-2*r,this._onTextureUpdate(),i.setRealSize(t.width,t.height,this._resolution),e.updateUvs(),this.dirty=!1}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._render(t)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(t,e){return this.updateText(!0),-1===this._textureID&&(t=!1),super.getBounds(t,e)}getLocalBounds(t){return this.updateText(!0),super.getLocalBounds.call(this,t)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(t,e,n){const r=t.fill;if(!Array.isArray(r))return r;if(1===r.length)return r[0];let i;const s=t.dropShadow?t.dropShadowDistance:0,o=t.padding||0,a=this.canvas.width/this._resolution-s-2*o,l=this.canvas.height/this._resolution-s-2*o,c=r.slice(),u=t.fillGradientStops.slice();if(!u.length){const h=c.length+1;for(let d=1;d<h;++d)u.push(d/h)}if(c.unshift(r[0]),u.unshift(0),c.push(r[r.length-1]),u.push(1),t.fillGradientType===Qu.LINEAR_VERTICAL){i=this.context.createLinearGradient(a/2,o,a/2,l+o);const h=n.fontProperties.fontSize+t.strokeThickness;for(let d=0;d<e.length;d++){const f=n.lineHeight*(d-1)+h,p=n.lineHeight*d;let g=p;d>0&&f>p&&(g=(p+f)/2);const m=p+h,_=n.lineHeight*(d+1);let v=m;d+1<e.length&&_<m&&(v=(m+_)/2);const D=(v-g)/l;for(let A=0;A<c.length;A++){let $=0;$="number"==typeof u[A]?u[A]:A/c.length;let pe=Math.min(1,Math.max(0,g/l+$*D));pe=Number(pe.toFixed(5)),i.addColorStop(pe,c[A])}}}else{i=this.context.createLinearGradient(o,l/2,a+o,l/2);const h=c.length+1;let d=1;for(let f=0;f<c.length;f++){let p;p="number"==typeof u[f]?u[f]:d/h,i.addColorStop(p,c[f]),d++}}return i}destroy(t){"boolean"==typeof t&&(t={children:t}),t=Object.assign({},X3,t),super.destroy(t),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(t){this.updateText(!0);const e=Ai(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(t){this.updateText(!0);const e=Ai(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get style(){return this._style}set style(t){this._style=(t=t||{})instanceof Fn?t:new Fn(t),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(t){t=String(t??""),this._text!==t&&(this._text=t,this.dirty=!0)}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}};let yi=Wg;yi.defaultAutoResolution=!0;class Y3{constructor(e){this.maxItemsPerFrame=e,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}}function q3(t,e){let n=!1;if(t?._textures?.length)for(let r=0;r<t._textures.length;r++)if(t._textures[r]instanceof ye){const i=t._textures[r].baseTexture;e.includes(i)||(e.push(i),n=!0)}return n}function Z3(t,e){if(t.baseTexture instanceof $e){const n=t.baseTexture;return e.includes(n)||e.push(n),!0}return!1}function K3(t,e){if(t._texture&&t._texture instanceof ye){const n=t._texture.baseTexture;return e.includes(n)||e.push(n),!0}return!1}function Q3(t,e){return e instanceof yi&&(e.updateText(!0),!0)}function J3(t,e){if(e instanceof Fn){const n=e.toFontString();return un.measureFont(n),!0}return!1}function eU(t,e){if(t instanceof yi){e.includes(t.style)||e.push(t.style),e.includes(t)||e.push(t);const n=t._texture.baseTexture;return e.includes(n)||e.push(n),!0}return!1}function tU(t,e){return t instanceof Fn&&(e.includes(t)||e.push(t),!0)}const PD=class{constructor(t){this.limiter=new Y3(PD.uploadsPerFrame),this.renderer=t,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{this.queue&&this.prepareItems()},this.registerFindHook(eU),this.registerFindHook(tU),this.registerFindHook(q3),this.registerFindHook(Z3),this.registerFindHook(K3),this.registerUploadHook(Q3),this.registerUploadHook(J3)}upload(t){return new Promise(e=>{t&&this.add(t),this.queue.length?(this.completes.push(e),this.ticking||(this.ticking=!0,Yt.system.addOnce(this.tick,this,Fi.UTILITY))):e()})}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){const t=this.queue[0];let e=!1;if(t&&!t._destroyed)for(let n=0,r=this.uploadHooks.length;n<r;n++)if(this.uploadHooks[n](this.uploadHookHelper,t)){this.queue.shift(),e=!0;break}e||this.queue.shift()}if(this.queue.length)Yt.system.addOnce(this.tick,this,Fi.UTILITY);else{this.ticking=!1;const t=this.completes.slice(0);this.completes.length=0;for(let e=0,n=t.length;e<n;e++)t[e]()}}registerFindHook(t){return t&&this.addHooks.push(t),this}registerUploadHook(t){return t&&this.uploadHooks.push(t),this}add(t){for(let e=0,n=this.addHooks.length;e<n&&!this.addHooks[e](t,this.queue);e++);if(t instanceof nn)for(let e=t.children.length-1;e>=0;e--)this.add(t.children[e]);return this}destroy(){this.ticking&&Yt.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}};let eh=PD;function ND(t,e){return e instanceof $e&&(e._glTextures[t.CONTEXT_UID]||t.texture.bind(e),!0)}function nU(t,e){if(!(e instanceof xr))return!1;const{geometry:n}=e;e.finishPoly(),n.updateBatches();const{batches:r}=n;for(let i=0;i<r.length;i++){const{texture:s}=r[i].style;s&&ND(t,s.baseTexture)}return n.batchable||t.geometry.bind(n,e._resolveDirectShader(t)),!0}function rU(t,e){return t instanceof xr&&(e.push(t),!0)}eh.uploadsPerFrame=4,Object.defineProperties(ue,{UPLOADS_PER_FRAME:{get:()=>eh.uploadsPerFrame,set(t){Ye("7.1.0","settings.UPLOADS_PER_FRAME is deprecated, use prepare.BasePrepare.uploadsPerFrame"),eh.uploadsPerFrame=t}}});class FD extends eh{constructor(e){super(e),this.uploadHookHelper=this.renderer,this.registerFindHook(rU),this.registerUploadHook(ND),this.registerUploadHook(nU)}}FD.extension={name:"prepare",type:de.RendererSystem},Se.add(FD);class th extends jn{constructor(e,n=!0){super(e[0]instanceof ye?e[0]:e[0].texture),this._textures=null,this._durations=null,this._autoUpdate=n,this._isConnectedToTicker=!1,this.animationSpeed=1,this.loop=!0,this.updateAnchor=!1,this.onComplete=null,this.onFrameChange=null,this.onLoop=null,this._currentTime=0,this._playing=!1,this._previousFrame=null,this.textures=e}stop(){this._playing&&(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(Yt.shared.remove(this.update,this),this._isConnectedToTicker=!1))}play(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(Yt.shared.add(this.update,this,Fi.HIGH),this._isConnectedToTicker=!0))}gotoAndStop(e){this.stop(),this.currentFrame=e}gotoAndPlay(e){this.currentFrame=e,this.play()}update(e){if(!this._playing)return;const n=this.animationSpeed*e,r=this.currentFrame;if(null!==this._durations){let i=this._currentTime%1*this._durations[this.currentFrame];for(i+=n/60*1e3;i<0;)this._currentTime--,i+=this._durations[this.currentFrame];const s=Math.sign(this.animationSpeed*e);for(this._currentTime=Math.floor(this._currentTime);i>=this._durations[this.currentFrame];)i-=this._durations[this.currentFrame]*s,this._currentTime+=s;this._currentTime+=i/this._durations[this.currentFrame]}else this._currentTime+=n;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):r!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<r||this.animationSpeed<0&&this.currentFrame>r)&&this.onLoop(),this.updateTexture())}updateTexture(){const e=this.currentFrame;this._previousFrame!==e&&(this._previousFrame=e,this._texture=this._textures[e],this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this.uvs=this._texture._uvs.uvsFloat32,this.updateAnchor&&this._anchor.copyFrom(this._texture.defaultAnchor),this.onFrameChange&&this.onFrameChange(this.currentFrame))}destroy(e){this.stop(),super.destroy(e),this.onComplete=null,this.onFrameChange=null,this.onLoop=null}static fromFrames(e){const n=[];for(let r=0;r<e.length;++r)n.push(ye.from(e[r]));return new th(n)}static fromImages(e){const n=[];for(let r=0;r<e.length;++r)n.push(ye.from(e[r]));return new th(n)}get totalFrames(){return this._textures.length}get textures(){return this._textures}set textures(e){if(e[0]instanceof ye)this._textures=e,this._durations=null;else{this._textures=[],this._durations=[];for(let n=0;n<e.length;n++)this._textures.push(e[n].texture),this._durations.push(e[n].time)}this._previousFrame=null,this.gotoAndStop(0),this.updateTexture()}get currentFrame(){let e=Math.floor(this._currentTime)%this._textures.length;return e<0&&(e+=this._textures.length),e}set currentFrame(e){if(e<0||e>this.totalFrames-1)throw new Error(`[AnimatedSprite]: Invalid frame index value ${e}, expected to be between 0 and totalFrames ${this.totalFrames}.`);const n=this.currentFrame;this._currentTime=e,n!==this.currentFrame&&this.updateTexture()}get playing(){return this._playing}get autoUpdate(){return this._autoUpdate}set autoUpdate(e){e!==this._autoUpdate&&(this._autoUpdate=e,!this._autoUpdate&&this._isConnectedToTicker?(Yt.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(Yt.shared.add(this.update,this),this._isConnectedToTicker=!0))}}new ct;var LD="#version 100\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n";const nh=new Pt;class BD extends Du{constructor(e){super(e),e.runners.contextChange.add(this),this.quad=new Db,this.state=pi.for2d()}contextChange(){const e=this.renderer,n={globals:e.globalUniforms};this.simpleShader=Xr.from(LD,"#version 100\n#define SHADER_NAME Tiling-Sprite-Simple-100\n\nprecision lowp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\n\nvoid main(void)\n{\n    vec4 texSample = texture2D(uSampler, vTextureCoord);\n    gl_FragColor = texSample * uColor;\n}\n",n),this.shader=e.context.webGLVersion>1?Xr.from("#version 300 es\n#define SHADER_NAME Tiling-Sprite-300\n\nprecision lowp float;\n\nin vec2 aVertexPosition;\nin vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nout vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n","#version 300 es\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nin vec2 vTextureCoord;\n\nout vec4 fragmentColor;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    vec2 unclamped = coord;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0\n\n    fragmentColor = texSample * uColor;\n}\n",n):Xr.from(LD,"#version 100\n#ifdef GL_EXT_shader_texture_lod\n    #extension GL_EXT_shader_texture_lod : enable\n#endif\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    vec2 unclamped = coord;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    #ifdef GL_EXT_shader_texture_lod\n        vec4 texSample = unclamped == coord\n            ? texture2D(uSampler, coord) \n            : texture2DLodEXT(uSampler, coord, 0);\n    #else\n        vec4 texSample = texture2D(uSampler, coord);\n    #endif\n\n    gl_FragColor = texSample * uColor;\n}\n",n)}render(e){const n=this.renderer,r=this.quad;let i=r.vertices;i[0]=i[6]=e._width*-e.anchor.x,i[1]=i[3]=e._height*-e.anchor.y,i[2]=i[4]=e._width*(1-e.anchor.x),i[5]=i[7]=e._height*(1-e.anchor.y);const s=e.uvRespectAnchor?e.anchor.x:0,o=e.uvRespectAnchor?e.anchor.y:0;i=r.uvs,i[0]=i[6]=-s,i[1]=i[3]=-o,i[2]=i[4]=1-s,i[5]=i[7]=1-o,r.invalidate();const a=e._texture,l=a.baseTexture,c=l.alphaMode>0,u=e.tileTransform.localTransform,h=e.uvMatrix;let d=l.isPowerOfTwo&&a.frame.width===l.width&&a.frame.height===l.height;d&&(l._glTextures[n.CONTEXT_UID]?d=l.wrapMode!==Ii.CLAMP:l.wrapMode===Ii.CLAMP&&(l.wrapMode=Ii.REPEAT));const f=d?this.simpleShader:this.shader,p=a.width,g=a.height,m=e._width,_=e._height;nh.set(u.a*p/m,u.b*p/_,u.c*g/m,u.d*g/_,u.tx/m,u.ty/_),nh.invert(),d?nh.prepend(h.mapCoord):(f.uniforms.uMapCoord=h.mapCoord.toArray(!0),f.uniforms.uClampFrame=h.uClampFrame,f.uniforms.uClampOffset=h.uClampOffset),f.uniforms.uTransform=nh.toArray(!0),f.uniforms.uColor=ft.shared.setValue(e.tint).premultiply(e.worldAlpha,c).toArray(f.uniforms.uColor),f.uniforms.translationMatrix=e.transform.worldTransform.toArray(!0),f.uniforms.uSampler=a,n.shader.bind(f),n.geometry.bind(r),this.state.blendMode=eb(e.blendMode,c),n.state.set(this.state),n.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}}BD.extension={name:"tilingSprite",type:de.RendererPlugin},Se.add(BD);const cl=class{constructor(t,e,n=null){this.linkedSheets=[],this._texture=t instanceof ye?t:null,this.baseTexture=t instanceof $e?t:this._texture.baseTexture,this.textures={},this.animations={},this.data=e;const r=this.baseTexture.resource;this.resolution=this._updateResolution(n||(r?r.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(t=null){const{scale:e}=this.data.meta;let n=Mi(t,null);return null===n&&(n=parseFloat(e??"1")),1!==n&&this.baseTexture.setResolution(n),n}parse(){return new Promise(t=>{this._callback=t,this._batchIndex=0,this._frameKeys.length<=cl.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(t){let e=t;const n=cl.BATCH_SIZE;for(;e-t<n&&e<this._frameKeys.length;){const r=this._frameKeys[e],i=this._frames[r],s=i.frame;if(s){let o=null,a=null;const l=!1!==i.trimmed&&i.sourceSize?i.sourceSize:i.frame,c=new nt(0,0,Math.floor(l.w)/this.resolution,Math.floor(l.h)/this.resolution);o=i.rotated?new nt(Math.floor(s.x)/this.resolution,Math.floor(s.y)/this.resolution,Math.floor(s.h)/this.resolution,Math.floor(s.w)/this.resolution):new nt(Math.floor(s.x)/this.resolution,Math.floor(s.y)/this.resolution,Math.floor(s.w)/this.resolution,Math.floor(s.h)/this.resolution),!1!==i.trimmed&&i.spriteSourceSize&&(a=new nt(Math.floor(i.spriteSourceSize.x)/this.resolution,Math.floor(i.spriteSourceSize.y)/this.resolution,Math.floor(s.w)/this.resolution,Math.floor(s.h)/this.resolution)),this.textures[r]=new ye(this.baseTexture,o,c,a,i.rotated?2:0,i.anchor,i.borders),ye.addToCache(this.textures[r],r)}e++}}_processAnimations(){const t=this.data.animations||{};for(const e in t){this.animations[e]=[];for(let n=0;n<t[e].length;n++)this.animations[e].push(this.textures[t[e][n]])}}_parseComplete(){const t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*cl.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*cl.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(t=!1){for(const e in this.textures)this.textures[e].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&(this._texture?.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};let Xg=cl;Xg.BATCH_SIZE=1e3;const lU=["jpg","png","jpeg","avif","webp"];function kD(t,e,n){const r={};if(t.forEach(i=>{r[i]=e}),Object.keys(e.textures).forEach(i=>{r[i]=e.textures[i]}),!n){const i=pn.dirname(t[0]);e.linkedSheets.forEach((s,o)=>{const a=kD([`${i}/${e.data.meta.related_multi_packs[o]}`],s,!0);Object.assign(r,a)})}return r}const cU={extension:de.Asset,cache:{test:t=>t instanceof Xg,getCacheableAssets:(t,e)=>kD(t,e,!1)},resolver:{test:t=>{const n=t.split("?")[0].split("."),r=n.pop(),i=n.pop();return"json"===r&&lU.includes(i)},parse:t=>{const e=t.split(".");return{resolution:parseFloat(ue.RETINA_PREFIX.exec(t)?.[1]??"1"),format:e[e.length-2],src:t}}},loader:{name:"spritesheetLoader",extension:{type:de.LoadParser,priority:Yr.Normal},testParse:(t,e)=>Z(function*(){return".json"===pn.extname(e.src).toLowerCase()&&!!t.frames})(),parse:(t,e,n)=>Z(function*(){let r=pn.dirname(e.src);r&&r.lastIndexOf("/")!==r.length-1&&(r+="/");let i=r+t.meta.image;i=Ug(i,e.src);const o=(yield n.load([i]))[i],a=new Xg(o.baseTexture,t,e.src);yield a.parse();const l=t?.meta?.related_multi_packs;if(Array.isArray(l)){const c=[];for(const h of l){if("string"!=typeof h)continue;let d=r+h;e.data?.ignoreMultiPack||(d=Ug(d,e.src),c.push(n.load({src:d,data:{ignoreMultiPack:!0}})))}const u=yield Promise.all(c);a.linkedSheets=u,u.forEach(h=>{h.linkedSheets=[a].concat(a.linkedSheets.filter(d=>d!==h))})}return a})(),unload(t){t.destroy(!0)}}};Se.add(cU);class rh{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}}class ih{static test(e){return"string"==typeof e&&e.startsWith("info face=")}static parse(e){const n=e.match(/^[a-z]+\s+.+$/gm),r={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const s in n){const o=n[s].match(/^[a-z]+/gm)[0],a=n[s].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),l={};for(const c in a){const u=a[c].split("="),h=u[0],d=u[1].replace(/"/gm,""),f=parseFloat(d),p=isNaN(f)?d:f;l[h]=p}r[o].push(l)}const i=new rh;return r.info.forEach(s=>i.info.push({face:s.face,size:parseInt(s.size,10)})),r.common.forEach(s=>i.common.push({lineHeight:parseInt(s.lineHeight,10)})),r.page.forEach(s=>i.page.push({id:parseInt(s.id,10),file:s.file})),r.char.forEach(s=>i.char.push({id:parseInt(s.id,10),page:parseInt(s.page,10),x:parseInt(s.x,10),y:parseInt(s.y,10),width:parseInt(s.width,10),height:parseInt(s.height,10),xoffset:parseInt(s.xoffset,10),yoffset:parseInt(s.yoffset,10),xadvance:parseInt(s.xadvance,10)})),r.kerning.forEach(s=>i.kerning.push({first:parseInt(s.first,10),second:parseInt(s.second,10),amount:parseInt(s.amount,10)})),r.distanceField.forEach(s=>i.distanceField.push({distanceRange:parseInt(s.distanceRange,10),fieldType:s.fieldType})),i}}class Yg{static test(e){const n=e;return"getElementsByTagName"in n&&n.getElementsByTagName("page").length&&null!==n.getElementsByTagName("info")[0].getAttribute("face")}static parse(e){const n=new rh,r=e.getElementsByTagName("info"),i=e.getElementsByTagName("common"),s=e.getElementsByTagName("page"),o=e.getElementsByTagName("char"),a=e.getElementsByTagName("kerning"),l=e.getElementsByTagName("distanceField");for(let c=0;c<r.length;c++)n.info.push({face:r[c].getAttribute("face"),size:parseInt(r[c].getAttribute("size"),10)});for(let c=0;c<i.length;c++)n.common.push({lineHeight:parseInt(i[c].getAttribute("lineHeight"),10)});for(let c=0;c<s.length;c++)n.page.push({id:parseInt(s[c].getAttribute("id"),10)||0,file:s[c].getAttribute("file")});for(let c=0;c<o.length;c++){const u=o[c];n.char.push({id:parseInt(u.getAttribute("id"),10),page:parseInt(u.getAttribute("page"),10)||0,x:parseInt(u.getAttribute("x"),10),y:parseInt(u.getAttribute("y"),10),width:parseInt(u.getAttribute("width"),10),height:parseInt(u.getAttribute("height"),10),xoffset:parseInt(u.getAttribute("xoffset"),10),yoffset:parseInt(u.getAttribute("yoffset"),10),xadvance:parseInt(u.getAttribute("xadvance"),10)})}for(let c=0;c<a.length;c++)n.kerning.push({first:parseInt(a[c].getAttribute("first"),10),second:parseInt(a[c].getAttribute("second"),10),amount:parseInt(a[c].getAttribute("amount"),10)});for(let c=0;c<l.length;c++)n.distanceField.push({fieldType:l[c].getAttribute("fieldType"),distanceRange:parseInt(l[c].getAttribute("distanceRange"),10)});return n}}class qg{static test(e){return!("string"!=typeof e||!e.includes("<font>"))&&Yg.test(ue.ADAPTER.parseXML(e))}static parse(e){return Yg.parse(ue.ADAPTER.parseXML(e))}}const Zg=[ih,Yg,qg];function dU(t,e,n,r,i,s,o){const a=n.text,l=n.fontProperties;e.translate(r,i),e.scale(s,s);const c=o.strokeThickness/2,u=-o.strokeThickness/2;if(e.font=o.toFontString(),e.lineWidth=o.strokeThickness,e.textBaseline=o.textBaseline,e.lineJoin=o.lineJoin,e.miterLimit=o.miterLimit,e.fillStyle=function hU(t,e,n,r,i,s){const o=n.fill;if(!Array.isArray(o))return o;if(1===o.length)return o[0];let a;const l=n.dropShadow?n.dropShadowDistance:0,c=n.padding||0,u=t.width/r-l-2*c,h=t.height/r-l-2*c,d=o.slice(),f=n.fillGradientStops.slice();if(!f.length){const p=d.length+1;for(let g=1;g<p;++g)f.push(g/p)}if(d.unshift(o[0]),f.unshift(0),d.push(o[o.length-1]),f.push(1),n.fillGradientType===Qu.LINEAR_VERTICAL){a=e.createLinearGradient(u/2,c,u/2,h+c);let p=0;const m=(s.fontProperties.fontSize+n.strokeThickness)/h;for(let _=0;_<i.length;_++){const v=s.lineHeight*_;for(let D=0;D<d.length;D++){let A=0;A="number"==typeof f[D]?f[D]:D/d.length;let pe=Math.max(p,v/h+A*m);pe=Math.min(pe,1),a.addColorStop(pe,d[D]),p=pe}}}else{a=e.createLinearGradient(c,h/2,u+c,h/2);const p=d.length+1;let g=1;for(let m=0;m<d.length;m++){let _;_="number"==typeof f[m]?f[m]:g/p,a.addColorStop(_,d[m]),g++}}return a}(t,e,o,s,[a],n),e.strokeStyle=o.stroke,o.dropShadow){const d=o.dropShadowBlur*s,f=o.dropShadowDistance*s;e.shadowColor=ft.shared.setValue(o.dropShadowColor).setAlpha(o.dropShadowAlpha).toRgbaString(),e.shadowBlur=d,e.shadowOffsetX=Math.cos(o.dropShadowAngle)*f,e.shadowOffsetY=Math.sin(o.dropShadowAngle)*f}else e.shadowColor="black",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0;o.stroke&&o.strokeThickness&&e.strokeText(a,c,u+n.lineHeight-l.descent),o.fill&&e.fillText(a,c,u+n.lineHeight-l.descent),e.setTransform(1,0,0,1,0,0),e.fillStyle="rgba(0, 0, 0, 0)"}function UD(t){return Array.from?Array.from(t):t.split("")}function sh(t){return t.codePointAt?t.codePointAt(0):t.charCodeAt(0)}const br=class{constructor(t,e,n){const[r]=t.info,[i]=t.common,[s]=t.page,[o]=t.distanceField,a=Mi(s.file),l={};this._ownsTextures=n,this.font=r.face,this.size=r.size,this.lineHeight=i.lineHeight/a,this.chars={},this.pageTextures=l;for(let c=0;c<t.page.length;c++){const{id:u,file:h}=t.page[c];l[u]=e instanceof Array?e[c]:e[h],o?.fieldType&&"none"!==o.fieldType&&(l[u].baseTexture.alphaMode=hr.NO_PREMULTIPLIED_ALPHA,l[u].baseTexture.mipmap=jr.OFF)}for(let c=0;c<t.char.length;c++){const{id:u,page:h}=t.char[c];let{x:d,y:f,width:p,height:g,xoffset:m,yoffset:_,xadvance:v}=t.char[c];d/=a,f/=a,p/=a,g/=a,m/=a,_/=a,v/=a;const D=new nt(d+l[h].frame.x/a,f+l[h].frame.y/a,p,g);this.chars[u]={xOffset:m,yOffset:_,xAdvance:v,kerning:{},texture:new ye(l[h].baseTexture,D),page:h}}for(let c=0;c<t.kerning.length;c++){let{first:u,second:h,amount:d}=t.kerning[c];u/=a,h/=a,d/=a,this.chars[h]&&(this.chars[h].kerning[u]=d)}this.distanceFieldRange=o?.distanceRange,this.distanceFieldType=o?.fieldType?.toLowerCase()??"none"}destroy(){for(const t in this.chars)this.chars[t].texture.destroy(),this.chars[t].texture=null;for(const t in this.pageTextures)this._ownsTextures&&this.pageTextures[t].destroy(!0),this.pageTextures[t]=null;this.chars=null,this.pageTextures=null}static install(t,e,n){let r;if(t instanceof rh)r=t;else{const s=function uU(t){for(let e=0;e<Zg.length;e++)if(Zg[e].test(t))return Zg[e];return null}(t);if(!s)throw new Error("Unrecognized data format for font.");r=s.parse(t)}e instanceof ye&&(e=[e]);const i=new br(r,e,n);return br.available[i.font]=i,i}static uninstall(t){const e=br.available[t];if(!e)throw new Error(`No font found named '${t}'`);e.destroy(),delete br.available[t]}static from(t,e,n){if(!t)throw new Error("[BitmapFont] Property `name` is required.");const{chars:r,padding:i,resolution:s,textureWidth:o,textureHeight:a,...l}=Object.assign({},br.defaultOptions,n),c=function fU(t){"string"==typeof t&&(t=[t]);const e=[];for(let n=0,r=t.length;n<r;n++){const i=t[n];if(Array.isArray(i)){if(2!==i.length)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${i.length}.`);const s=i[0].charCodeAt(0),o=i[1].charCodeAt(0);if(o<s)throw new Error("[BitmapFont]: Invalid character range.");for(let a=s,l=o;a<=l;a++)e.push(String.fromCharCode(a))}else e.push(...UD(i))}if(0===e.length)throw new Error("[BitmapFont]: Empty set when resolving characters.");return e}(r),u=e instanceof Fn?e:new Fn(e),h=o,d=new rh;d.info[0]={face:u.fontFamily,size:u.fontSize},d.common[0]={lineHeight:u.fontSize};let g,m,_,f=0,p=0,v=0;const D=[],A=[];for(let pe=0;pe<c.length;pe++){g||(g=ue.ADAPTER.createCanvas(),g.width=o,g.height=a,m=g.getContext("2d"),_=new $e(g,{resolution:s,...l}),D.push(_),A.push(new ye(_)),d.page.push({id:A.length-1,file:""}));const J=c[pe],ee=un.measureText(J,u,!1,g),Ve=ee.width,te=Math.ceil(ee.height),he=Math.ceil(("italic"===u.fontStyle?2:1)*Ve);if(p>=a-te*s){if(0===p)throw new Error(`[BitmapFont] textureHeight ${a}px is too small (fontFamily: '${u.fontFamily}', fontSize: ${u.fontSize}px, char: '${J}')`);--pe,g=null,m=null,_=null,p=0,f=0,v=0;continue}if(v=Math.max(te+ee.fontProperties.descent,v),he*s+f>=h){if(0===f)throw new Error(`[BitmapFont] textureWidth ${o}px is too small (fontFamily: '${u.fontFamily}', fontSize: ${u.fontSize}px, char: '${J}')`);--pe,p+=v*s,p=Math.ceil(p),f=0,v=0;continue}dU(g,m,ee,f,p,s,u);const st=sh(ee.text);d.char.push({id:st,page:A.length-1,x:f/s,y:p/s,width:he,height:te,xoffset:0,yoffset:0,xadvance:Ve-(u.dropShadow?u.dropShadowDistance:0)-(u.stroke?u.strokeThickness:0)}),f+=(he+2*i)*s,f=Math.ceil(f)}for(let pe=0,J=c.length;pe<J;pe++){const ee=c[pe];for(let Ve=0;Ve<J;Ve++){const te=c[Ve],he=m.measureText(ee).width,st=m.measureText(te).width,Y=m.measureText(ee+te).width-(he+st);Y&&d.kerning.push({first:sh(ee),second:sh(te),amount:Y})}}const $=new br(d,A,!0);return void 0!==br.available[t]&&br.uninstall(t),br.available[t]=$,$}};let On=br;On.ALPHA=[["a","z"],["A","Z"]," "],On.NUMERIC=[["0","9"]],On.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],On.ASCII=[[" ","~"]],On.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:br.ALPHANUMERIC},On.available={};const HD=[],VD=[],GD=[],jD=class extends nn{constructor(t,e={}){super();const{align:n,tint:r,maxWidth:i,letterSpacing:s,fontName:o,fontSize:a}=Object.assign({},jD.styleDefaults,e);if(!On.available[o])throw new Error(`Missing BitmapFont "${o}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=n,this._tintColor=new ft(r),this._font=void 0,this._fontName=o,this._fontSize=a,this.text=t,this._maxWidth=i,this._maxLineHeight=0,this._letterSpacing=s,this._anchor=new Pi(()=>{this.dirty=!0},this,0,0),this._roundPixels=ue.ROUND_PIXELS,this.dirty=!0,this._resolution=ue.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){const t=On.available[this._fontName],e=this.fontSize,n=e/t.size,r=new ct,i=[],s=[],o=[],l=UD(this._text.replace(/(?:\r\n|\r)/g,"\n")||" "),c=this._maxWidth*t.size/e,u="none"===t.distanceFieldType?HD:VD;let h=null,d=0,f=0,p=0,g=-1,m=0,_=0,v=0,D=0;for(let te=0;te<l.length;te++){const he=l[te],st=sh(he);if(/(?:\s)/.test(he)&&(g=te,m=d,D++),"\r"===he||"\n"===he){s.push(d),o.push(-1),f=Math.max(f,d),++p,++_,r.x=0,r.y+=t.lineHeight,h=null,D=0;continue}const X=t.chars[st];if(!X)continue;h&&X.kerning[h]&&(r.x+=X.kerning[h]);const Y=GD.pop()||{texture:ye.EMPTY,line:0,charCode:0,prevSpaces:0,position:new ct};Y.texture=X.texture,Y.line=p,Y.charCode=st,Y.position.x=Math.round(r.x+X.xOffset+this._letterSpacing/2),Y.position.y=Math.round(r.y+X.yOffset),Y.prevSpaces=D,i.push(Y),d=Y.position.x+Math.max(X.xAdvance-X.xOffset,X.texture.orig.width),r.x+=X.xAdvance+this._letterSpacing,v=Math.max(v,X.yOffset+X.texture.height),h=st,-1!==g&&c>0&&r.x>c&&(++_,wo(i,1+g-_,1+te-g),te=g,g=-1,s.push(m),o.push(i.length>0?i[i.length-1].prevSpaces:0),f=Math.max(f,m),p++,r.x=0,r.y+=t.lineHeight,h=null,D=0)}const A=l[l.length-1];"\r"!==A&&"\n"!==A&&(/(?:\s)/.test(A)&&(d=m),s.push(d),f=Math.max(f,d),o.push(-1));const $=[];for(let te=0;te<=p;te++){let he=0;"right"===this._align?he=f-s[te]:"center"===this._align?he=(f-s[te])/2:"justify"===this._align&&(he=o[te]<0?0:(f-s[te])/o[te]),$.push(he)}const pe=i.length,J={},ee=[],Ve=this._activePagesMeshData;u.push(...Ve);for(let te=0;te<pe;te++){const he=i[te].texture,st=he.baseTexture.uid;if(!J[st]){let X=u.pop();if(!X){const St=new H3;let Qe,qe;"none"===t.distanceFieldType?(Qe=new AD(ye.EMPTY),qe=Ne.NORMAL):(Qe=new AD(ye.EMPTY,{program:pr.from("// Mesh material default fragment\r\nattribute vec2 aVertexPosition;\r\nattribute vec2 aTextureCoord;\r\n\r\nuniform mat3 projectionMatrix;\r\nuniform mat3 translationMatrix;\r\nuniform mat3 uTextureMatrix;\r\n\r\nvarying vec2 vTextureCoord;\r\n\r\nvoid main(void)\r\n{\r\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r\n\r\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r\n}\r\n","// Pixi texture info\r\nvarying vec2 vTextureCoord;\r\nuniform sampler2D uSampler;\r\n\r\n// Tint\r\nuniform vec4 uColor;\r\n\r\n// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r\nuniform float uFWidth;\r\n\r\nvoid main(void) {\r\n\r\n  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r\n  vec4 texColor = texture2D(uSampler, vTextureCoord);\r\n\r\n  // MSDF\r\n  float median = texColor.r + texColor.g + texColor.b -\r\n                  min(texColor.r, min(texColor.g, texColor.b)) -\r\n                  max(texColor.r, max(texColor.g, texColor.b));\r\n  // SDF\r\n  median = min(median, texColor.a);\r\n\r\n  float screenPxDistance = uFWidth * (median - 0.5);\r\n  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r\n  if (median < 0.01) {\r\n    alpha = 0.0;\r\n  } else if (median > 0.99) {\r\n    alpha = 1.0;\r\n  }\r\n\r\n  // Gamma correction for coverage-like alpha\r\n  float luma = dot(uColor.rgb, vec3(0.299, 0.587, 0.114));\r\n  float gamma = mix(1.0, 1.0 / 2.2, luma);\r\n  float coverage = pow(uColor.a * alpha, gamma);  \r\n\r\n  // NPM Textures, NPM outputs\r\n  gl_FragColor = vec4(uColor.rgb, coverage);\r\n}\r\n"),uniforms:{uFWidth:0}}),qe=Ne.NORMAL_NPM);const Tt=new jg(St,Qe);Tt.blendMode=qe,X={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:Tt,vertices:null,uvs:null,indices:null}}X.index=0,X.indexCount=0,X.vertexCount=0,X.uvsCount=0,X.total=0;const{_textureCache:Y}=this;Y[st]=Y[st]||new ye(he.baseTexture),X.mesh.texture=Y[st],X.mesh.tint=this._tintColor.value,ee.push(X),J[st]=X}J[st].total++}for(let te=0;te<Ve.length;te++)ee.includes(Ve[te])||this.removeChild(Ve[te].mesh);for(let te=0;te<ee.length;te++)ee[te].mesh.parent!==this&&this.addChild(ee[te].mesh);this._activePagesMeshData=ee;for(const te in J){const he=J[te],st=he.total;if(!(he.indices?.length>6*st)||he.vertices.length<2*jg.BATCHABLE_SIZE)he.vertices=new Float32Array(8*st),he.uvs=new Float32Array(8*st),he.indices=new Uint16Array(6*st);else{const Y=he.vertices;for(let St=4*he.total*2;St<Y.length;St++)Y[St]=0}he.mesh.size=6*st}for(let te=0;te<pe;te++){const he=i[te];let st=he.position.x+$[he.line]*("justify"===this._align?he.prevSpaces:1);this._roundPixels&&(st=Math.round(st));const X=st*n,Y=he.position.y*n,St=he.texture,Qe=J[St.baseTexture.uid],qe=St.frame,Tt=St._uvs,ut=Qe.index++;Qe.indices[6*ut+0]=0+4*ut,Qe.indices[6*ut+1]=1+4*ut,Qe.indices[6*ut+2]=2+4*ut,Qe.indices[6*ut+3]=0+4*ut,Qe.indices[6*ut+4]=2+4*ut,Qe.indices[6*ut+5]=3+4*ut,Qe.vertices[8*ut+0]=X,Qe.vertices[8*ut+1]=Y,Qe.vertices[8*ut+2]=X+qe.width*n,Qe.vertices[8*ut+3]=Y,Qe.vertices[8*ut+4]=X+qe.width*n,Qe.vertices[8*ut+5]=Y+qe.height*n,Qe.vertices[8*ut+6]=X,Qe.vertices[8*ut+7]=Y+qe.height*n,Qe.uvs[8*ut+0]=Tt.x0,Qe.uvs[8*ut+1]=Tt.y0,Qe.uvs[8*ut+2]=Tt.x1,Qe.uvs[8*ut+3]=Tt.y1,Qe.uvs[8*ut+4]=Tt.x2,Qe.uvs[8*ut+5]=Tt.y2,Qe.uvs[8*ut+6]=Tt.x3,Qe.uvs[8*ut+7]=Tt.y3}this._textWidth=f*n,this._textHeight=(r.y+t.lineHeight)*n;for(const te in J){const he=J[te];if(0!==this.anchor.x||0!==this.anchor.y){let St=0;const Qe=this._textWidth*this.anchor.x,qe=this._textHeight*this.anchor.y;for(let Tt=0;Tt<he.total;Tt++)he.vertices[St++]-=Qe,he.vertices[St++]-=qe,he.vertices[St++]-=Qe,he.vertices[St++]-=qe,he.vertices[St++]-=Qe,he.vertices[St++]-=qe,he.vertices[St++]-=Qe,he.vertices[St++]-=qe}this._maxLineHeight=v*n;const st=he.mesh.geometry.getBuffer("aVertexPosition"),X=he.mesh.geometry.getBuffer("aTextureCoord"),Y=he.mesh.geometry.getIndex();st.data=he.vertices,X.data=he.uvs,Y.data=he.indices,st.update(),X.update(),Y.update()}for(let te=0;te<i.length;te++)GD.push(i[te]);this._font=t,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0);const{distanceFieldRange:e,distanceFieldType:n,size:r}=On.available[this._fontName];if("none"!==n){const{a:i,b:s,c:o,d:a}=this.worldTransform,l=Math.sqrt(i*i+s*s),c=Math.sqrt(o*o+a*a),u=(Math.abs(l)+Math.abs(c))/2,h=this.fontSize/r,d=t._view.resolution;for(const f of this._activePagesMeshData)f.mesh.shader.uniforms.uFWidth=u*e*h*d}super._render(t)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){const t=On.available[this._fontName];if(!t)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==t&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tintColor.value}set tint(t){if(this.tint!==t){this._tintColor.setValue(t);for(let e=0;e<this._activePagesMeshData.length;e++)this._activePagesMeshData[e].mesh.tint=t}}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.dirty=!0)}get fontName(){return this._fontName}set fontName(t){if(!On.available[t])throw new Error(`Missing BitmapFont "${t}"`);this._fontName!==t&&(this._fontName=t,this.dirty=!0)}get fontSize(){return this._fontSize??On.available[this._fontName].size}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.dirty=!0)}get anchor(){return this._anchor}set anchor(t){"number"==typeof t?this._anchor.set(t):this._anchor.copyFrom(t)}get text(){return this._text}set text(t){t=String(t??""),this._text!==t&&(this._text=t,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(t){this._maxWidth!==t&&(this._maxWidth=t,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(t){t!==this._roundPixels&&(this._roundPixels=t,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}destroy(t){const{_textureCache:e}=this,r="none"===On.available[this._fontName].distanceFieldType?HD:VD;r.push(...this._activePagesMeshData);for(const i of this._activePagesMeshData)this.removeChild(i.mesh);this._activePagesMeshData=[],r.filter(i=>e[i.mesh.texture.baseTexture.uid]).forEach(i=>{i.mesh.texture=ye.EMPTY});for(const i in e)e[i].destroy(),delete e[i];this._font=null,this._tintColor=null,this._textureCache=null,super.destroy(t)}};jD.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};const yU=[".xml",".fnt"],_U={extension:{type:de.LoadParser,priority:Yr.Normal},name:"loadBitmapFont",test:t=>yU.includes(pn.extname(t).toLowerCase()),testParse:t=>Z(function*(){return ih.test(t)||qg.test(t)})(),parse:(t,e,n)=>Z(function*(){const r=ih.test(t)?ih.parse(t):qg.parse(t),{src:i}=e,{page:s}=r,o=[];for(let c=0;c<s.length;++c){const u=s[c].file;let h=pn.join(pn.dirname(i),u);h=Ug(h,i),o.push(h)}const a=yield n.load(o),l=o.map(c=>a[c]);return On.install(r,l,!0)})(),load:(t,e)=>Z(function*(){return(yield ue.ADAPTER.fetch(t)).text()})(),unload(t){t.destroy()}};Se.add(_U);const Mo=class extends Fn{constructor(){super(...arguments),this._fonts=[],this._overrides=[],this._stylesheet="",this.fontsDirty=!1}static from(t){return new Mo(Object.keys(Mo.defaultOptions).reduce((e,n)=>({...e,[n]:t[n]}),{}))}cleanFonts(){this._fonts.length>0&&(this._fonts.forEach(t=>{URL.revokeObjectURL(t.src),t.refs--,0===t.refs&&(t.fontFace&&document.fonts.delete(t.fontFace),delete Mo.availableFonts[t.originalUrl])}),this.fontFamily="Arial",this._fonts.length=0,this.styleID++,this.fontsDirty=!0)}loadFont(t,e={}){var n=this;const{availableFonts:r}=Mo;if(r[t]){const i=r[t];return this._fonts.push(i),i.refs++,this.styleID++,this.fontsDirty=!0,Promise.resolve()}return ue.ADAPTER.fetch(t).then(i=>i.blob()).then(function(){var i=Z(function*(s){return new Promise((o,a)=>{const l=URL.createObjectURL(s),c=new FileReader;c.onload=()=>o([l,c.result]),c.onerror=a,c.readAsDataURL(s)})});return function(s){return i.apply(this,arguments)}}()).then(function(){var i=Z(function*([s,o]){const a=Object.assign({family:pn.basename(t,pn.extname(t)),weight:"normal",style:"normal",src:s,dataSrc:o,refs:1,originalUrl:t,fontFace:null},e);r[t]=a,n._fonts.push(a),n.styleID++;const l=new FontFace(a.family,`url(${a.src})`,{weight:a.weight,style:a.style});a.fontFace=l,yield l.load(),document.fonts.add(l),yield document.fonts.ready,n.styleID++,n.fontsDirty=!0});return function(s){return i.apply(this,arguments)}}())}addOverride(...t){const e=t.filter(n=>!this._overrides.includes(n));e.length>0&&(this._overrides.push(...e),this.styleID++)}removeOverride(...t){const e=t.filter(n=>this._overrides.includes(n));e.length>0&&(this._overrides=this._overrides.filter(n=>!e.includes(n)),this.styleID++)}toCSS(t){return[`transform: scale(${t})`,"transform-origin: top left","display: inline-block",`color: ${this.normalizeColor(this.fill)}`,`font-size: ${this.fontSize}px`,`font-family: ${this.fontFamily}`,`font-weight: ${this.fontWeight}`,`font-style: ${this.fontStyle}`,`font-variant: ${this.fontVariant}`,`letter-spacing: ${this.letterSpacing}px`,`text-align: ${this.align}`,`padding: ${this.padding}px`,`white-space: ${this.whiteSpace}`,...this.lineHeight?[`line-height: ${this.lineHeight}px`]:[],...this.wordWrap?["word-wrap: "+(this.breakWords?"break-all":"break-word"),`max-width: ${this.wordWrapWidth}px`]:[],...this.strokeThickness?[`-webkit-text-stroke-width: ${this.strokeThickness}px`,`-webkit-text-stroke-color: ${this.normalizeColor(this.stroke)}`,`text-stroke-width: ${this.strokeThickness}px`,`text-stroke-color: ${this.normalizeColor(this.stroke)}`,"paint-order: stroke"]:[],...this.dropShadow?[this.dropShadowToCSS()]:[],...this._overrides].join(";")}toGlobalCSS(){return this._fonts.reduce((t,e)=>`${t}\n            @font-face {\n                font-family: "${e.family}";\n                src: url('${e.dataSrc}');\n                font-weight: ${e.weight};\n                font-style: ${e.style}; \n            }`,this._stylesheet)}get stylesheet(){return this._stylesheet}set stylesheet(t){this._stylesheet!==t&&(this._stylesheet=t,this.styleID++)}normalizeColor(t){return Array.isArray(t)&&(t=function fB(t){return Ye("7.2.0","utils.rgb2hex is deprecated, use Color#toNumber instead"),ft.shared.setValue(t).toNumber()}(t)),"number"==typeof t?function dB(t){return Ye("7.2.0","utils.hex2string is deprecated, use Color#toHex instead"),ft.shared.setValue(t).toHex()}(t):t}dropShadowToCSS(){let t=this.normalizeColor(this.dropShadowColor);const e=this.dropShadowAlpha,n=Math.round(Math.cos(this.dropShadowAngle)*this.dropShadowDistance),r=Math.round(Math.sin(this.dropShadowAngle)*this.dropShadowDistance);t.startsWith("#")&&e<1&&(t+=(255*e|0).toString(16).padStart(2,"0"));const i=`${n}px ${r}px`;return this.dropShadowBlur>0?`text-shadow: ${i} ${this.dropShadowBlur}px ${t}`:`text-shadow: ${i} ${t}`}reset(){Object.assign(this,Mo.defaultOptions)}onBeforeDraw(){const{fontsDirty:t}=this;return this.fontsDirty=!1,this.isSafari&&this._fonts.length>0&&t?new Promise(e=>setTimeout(e,100)):Promise.resolve()}get isSafari(){const{userAgent:t}=ue.ADAPTER.getNavigator();return/^((?!chrome|android).)*safari/i.test(t)}set fillGradientStops(t){console.warn("[HTMLTextStyle] fillGradientStops is not supported by HTMLText")}get fillGradientStops(){return super.fillGradientStops}set fillGradientType(t){console.warn("[HTMLTextStyle] fillGradientType is not supported by HTMLText")}get fillGradientType(){return super.fillGradientType}set miterLimit(t){console.warn("[HTMLTextStyle] miterLimit is not supported by HTMLText")}get miterLimit(){return super.miterLimit}set trim(t){console.warn("[HTMLTextStyle] trim is not supported by HTMLText")}get trim(){return super.trim}set textBaseline(t){console.warn("[HTMLTextStyle] textBaseline is not supported by HTMLText")}get textBaseline(){return super.textBaseline}set leading(t){console.warn("[HTMLTextStyle] leading is not supported by HTMLText")}get leading(){return super.leading}set lineJoin(t){console.warn("[HTMLTextStyle] lineJoin is not supported by HTMLText")}get lineJoin(){return super.lineJoin}};let ul=Mo;ul.availableFonts={},ul.defaultOptions={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,padding:0,stroke:"black",strokeThickness:0,whiteSpace:"normal",wordWrap:!1,wordWrapWidth:100};const Ro=class extends jn{constructor(t="",e={}){super(ye.EMPTY),this._text=null,this._style=null,this._autoResolution=!0,this._loading=!1,this.localStyleID=-1,this.dirty=!1,this.ownsStyle=!1;const n=new Image,r=ye.from(n,{scaleMode:ue.SCALE_MODE,resourceOptions:{autoLoad:!1}});r.orig=new nt,r.trim=new nt,this.texture=r;const i="http://www.w3.org/2000/svg",s="http://www.w3.org/1999/xhtml",o=document.createElementNS(i,"svg"),a=document.createElementNS(i,"foreignObject"),l=document.createElementNS(s,"div"),c=document.createElementNS(s,"style");a.setAttribute("width","10000"),a.setAttribute("height","10000"),a.style.overflow="hidden",o.appendChild(a),this.maxWidth=Ro.defaultMaxWidth,this.maxHeight=Ro.defaultMaxHeight,this._domElement=l,this._styleElement=c,this._svgRoot=o,this._foreignObject=a,this._foreignObject.appendChild(c),this._foreignObject.appendChild(l),this._image=n,this._loadImage=new Image,this._autoResolution=Ro.defaultAutoResolution,this._resolution=Ro.defaultResolution??ue.RESOLUTION,this.text=t,this.style=e}measureText(t){const{text:e,style:n,resolution:r}=Object.assign({text:this._text,style:this._style,resolution:this._resolution},t);Object.assign(this._domElement,{innerHTML:e,style:n.toCSS(r)}),this._styleElement.textContent=n.toGlobalCSS(),document.body.appendChild(this._svgRoot);const i=this._domElement.getBoundingClientRect();this._svgRoot.remove();const s=Math.min(this.maxWidth,Math.ceil(i.width)),o=Math.min(this.maxHeight,Math.ceil(i.height));return this._svgRoot.setAttribute("width",s.toString()),this._svgRoot.setAttribute("height",o.toString()),e!==this._text&&(this._domElement.innerHTML=this._text),n!==this._style&&(Object.assign(this._domElement,{style:this._style?.toCSS(r)}),this._styleElement.textContent=this._style?.toGlobalCSS()),{width:s+2*n.padding,height:o+2*n.padding}}updateText(t=!0){var e=this;return Z(function*(){const{style:n,_image:r,_loadImage:i}=e;if(e.localStyleID!==n.styleID&&(e.dirty=!0,e.localStyleID=n.styleID),!e.dirty&&t)return;const{width:s,height:o}=e.measureText();r.width=i.width=Math.ceil(Math.max(1,s)),r.height=i.height=Math.ceil(Math.max(1,o)),e._loading||(e._loading=!0,yield new Promise(a=>{i.onload=Z(function*(){yield n.onBeforeDraw(),e._loading=!1,r.src=i.src,i.onload=null,i.src="",e.updateTexture(),a()});const l=(new XMLSerializer).serializeToString(e._svgRoot);i.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(l)}`}))})()}get source(){return this._image}updateTexture(){const{style:t,texture:e,_image:n,resolution:r}=this,{padding:i}=t,{baseTexture:s}=e;e.trim.width=e._frame.width=n.width/r,e.trim.height=e._frame.height=n.height/r,e.trim.x=-i,e.trim.y=-i,e.orig.width=e._frame.width-2*i,e.orig.height=e._frame.height-2*i,this._onTextureUpdate(),s.setRealSize(n.width,n.height,r),this.dirty=!1}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._render(t)}_renderCanvas(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._renderCanvas(t)}getLocalBounds(t){return this.updateText(!0),super.getLocalBounds(t)}_calculateBounds(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_onStyleChange(){this.dirty=!0}destroy(t){"boolean"==typeof t&&(t={children:t}),t=Object.assign({},Ro.defaultDestroyOptions,t),super.destroy(t);const e=null;this.ownsStyle&&this._style?.cleanFonts(),this._style=e,this._svgRoot?.remove(),this._svgRoot=e,this._domElement?.remove(),this._domElement=e,this._foreignObject?.remove(),this._foreignObject=e,this._styleElement?.remove(),this._styleElement=e,this._loadImage.src="",this._loadImage.onload=null,this._loadImage=e,this._image.src="",this._image=e}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._image.width/this.resolution}set width(t){this.updateText(!0);const e=Ai(this.scale.x)||1;this.scale.x=e*t/this._image.width/this.resolution,this._width=t}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._image.height/this.resolution}set height(t){this.updateText(!0);const e=Ai(this.scale.y)||1;this.scale.y=e*t/this._image.height/this.resolution,this._height=t}get style(){return this._style}set style(t){this._style!==t&&((t=t||{})instanceof ul?(this.ownsStyle=!1,this._style=t):t instanceof Fn?(console.warn("[HTMLText] Cloning TextStyle, if this is not what you want, use HTMLTextStyle"),this.ownsStyle=!0,this._style=ul.from(t)):(this.ownsStyle=!0,this._style=new ul(t)),this.localStyleID=-1,this.dirty=!0)}get text(){return this._text}set text(t){t=String(""===t||null==t?" ":t),t=this.sanitiseText(t),this._text!==t&&(this._text=t,this.dirty=!0)}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}sanitiseText(t){return t.replace(/<br>/gi,"<br/>").replace(/<hr>/gi,"<hr/>").replace(/&nbsp;/gi,"&#160;")}};let oh=Ro;oh.defaultDestroyOptions={texture:!0,children:!1,baseTexture:!0},oh.defaultMaxWidth=2024,oh.defaultMaxHeight=2024,oh.defaultAutoResolution=!0;class vU{constructor(e){this.app=e,this.frames=new Map}has(e){return this.frames.has(e)}get(e){return this.frames.has(e)?this.frames.get(e):null}getAsCanvas(e){var n=this;return Z(function*(){return n.frames.has(e)?n.textureToCanvas(n.frames.get(e)):null})()}add(e,n){if(Array.isArray(e))for(const r of e)for(const i of r.frames)this.frames.has(i.frameId)||this.frames.set(i.frameId,new ye(n[r.textureName],this.rectToRectangle(i.rect)))}textureToCanvas(e){var n=this;return Z(function*(){const r=n.app.renderer.generateTexture(jn.from(e)),i=yield n.app.renderer.extract.canvas(r);if(!i)return console.error("textureToCanvas: empty iCanvas"),null;const s=i.toDataURL?.();if(!s)return console.error("textureToCanvas: empty iCanvas to dataUrl"),null;const o=document.createElement("canvas"),a=o.getContext("2d");return a?new Promise(l=>{const c=new Image;c.src=s,c.onload=()=>{o.width=c.width,o.height=c.height,a.drawImage(c,0,0),URL.revokeObjectURL(c.src),l(o)}}):(console.error("textureToCanvas: empty ctx"),null)})()}rectToRectangle(e){return new nt(e.x,e.y,e.width,e.height)}}class xU extends nn{constructor(e,n,r,i,s){super(),this.cellX=e,this.cellY=n,this.cellWidth=r,this.cellHeight=i,this.properties=s,this.cellKey=`${this.cellX}x${this.cellY}`}addItem(e,n){var r=this;return Z(function*(){r.sprite=new jn(n),r.sprite.width=r.cellWidth,r.sprite.height=r.cellHeight,r.sprite.zIndex=e.zIndex,r.addChild(r.sprite)})()}}class wU{constructor(e){this.info=e}get holdTexture(){return this.info?.holdTexture??null}get mapInfo(){return this.info?.mapInfo??null}get tileInfo(){return this.info?.tileInfo??null}find(e){return(this.info?.cells||[]).find(n=>e(n))??null}filter(e){return(this.info?.cells||[]).filter(n=>e(n))}[Symbol.iterator](){let e=-1;const n=this.info.cells;return{next:()=>({value:n[++e],done:!(e in n)})}}}class EU{constructor(e){this.framesResources=e,this.grids=new Map}get(e){return this.grids.has(e)?this.grids.get(e):null}add(e,n){var r=this;return Z(function*(){cn.addBundle(e,{frames:`${n}/frames-def.json`,grid:`${n}/grid-def.json`});const i=yield cn.loadBundle(e);yield r.initFrames(i.frames,n),yield r.addGrid(i.grid)})()}addGrid(e){var n=this;return Z(function*(){if(n.grids.has(e.id))return;const r={holdTexture:null,mapInfo:e.mapInfo,tileInfo:e.tileInfo,cells:[]},i=e.items.filter(o=>!o.properties?.canAction);if(i.length>0){const o=yield n.createHoldTexture(i,e.mapInfo,e.tileInfo);o&&(r.holdTexture=o)}const s=e.items.filter(o=>o.properties?.canAction);for(const o of s){const a=n.framesResources.get(o.referenceId);if(!a){console.error("no texture",o.referenceId);continue}const l=new xU(o.x,o.y,e.tileInfo.width,e.tileInfo.height,o.properties);yield l.addItem(o,a),r.cells.push(l)}n.grids.set(e.id,new wU(r))})()}createHoldTexture(e,n,r){var i=this;return Z(function*(){const s=document.createElement("canvas"),o=s.getContext("2d");if(!o)return console.error("createHoldTexture: empty ctx"),null;s.width=n.width*r.width,s.height=n.height*r.height;for(const a of e){const l=i.framesResources.get(a.referenceId);if(!l)continue;const c=yield i.framesResources.textureToCanvas(l);c&&o.drawImage(c,a.x*r.width,a.y*r.height)}return ye.from(s)})()}initFrames(e,n){var r=this;return Z(function*(){if(!Array.isArray(e))return;const i={};e.forEach(o=>{i[o.textureName]=`${n}/${o.textureName}`}),cn.addBundle("frames",i);const s=yield cn.loadBundle("frames");r.framesResources.add(e,s)})()}}class bU extends nn{constructor(e){super(),this.spriteInfo=e,this.stopSpriteEvent=new $t}blink(){this.sprite.tint=16711680,setTimeout(()=>{this.sprite.tint=16777215,setTimeout(()=>{this.sprite.tint=16711680,setTimeout(()=>{this.sprite.tint=16777215,setTimeout(()=>{this.sprite.tint=16711680,setTimeout(()=>{this.sprite.tint=16777215},500)},500)},500)},500)},500)}playOnce(){return this.sprite.stop(),new Promise(e=>{this.sprite.currentFrame=0,this.sprite.onComplete=()=>e(),this.sprite.gotoAndPlay(0)})}play(){this.sprite.currentFrame=0,this.sprite.play()}playSubst(){return new x(e=>{this.sprite.currentFrame=0,this.sprite.play(),this.stopSpriteEvent.subscribe(()=>{e.next(),e.complete()})})}stop(){this.sprite.stop(),this.sprite.currentFrame=0,this.stopSpriteEvent.emit()}setAnimation(e,n){this.sprite.animationSpeed=n,this.sprite.loop=e}initialize(e){var n=this;return Z(function*(){n.addChild((new xr).beginFill(16777215,.001).drawRect(0,0,n.spriteInfo.width,n.spriteInfo.height).endFill()),e.textures&&(n.sprite=new th(e.textures),n.addChild(n.sprite),n.x=e.x,n.y=e.y,n.zIndex=e.zIndex)})()}}var zn=function(t){return t[t.none=0]="none",t[t.left=1]="left",t[t.right=2]="right",t[t.up=4]="up",t[t.down=8]="down",t}(zn||{});class DU extends nn{constructor(){super(...arguments),this.layers=new Map,this.animations=[],this.groundPoint=null,this.currentAnimationId=null,this.playing=!1,this.isBusyValue=!1}get isBusy(){return this.isBusyValue}blink(){this.layers.forEach(e=>{e.visible&&e.blink()})}getGroundPoint(){return this.groundPoint?{...this.groundPoint}:null}get centerPoint(){return this.groundPoint?{x:this.x+this.groundPoint.x,y:this.y+this.groundPoint.y}:{x:this.x+this.width/2,y:this.y+this.height/2}}playOnce(){var e=this;return Z(function*(){return e.isBusyValue=!0,new Promise(n=>{const r=[];e.layers.forEach(i=>{i.visible&&r.push(i.playOnce())}),Promise.all(r).then(()=>{e.isBusyValue=!1,n()})})})()}play(){this.playing=!0,this.layers.forEach(e=>{e.visible&&e.play()})}stop(){this.playing=!1,this.layers.forEach(e=>{e.stop()})}setDefAnimation(){const e=this.animations.find(n=>n.default);e&&this.setAnimation(e.id)}getDynamicCollisionFrame(e){const n=this.getAnimation(e);return n?.collisionFrame?{x:this.x+n.collisionFrame.x,y:this.y+n.collisionFrame.y,width:n.collisionFrame.width,height:n.collisionFrame.height}:{x:this.x,y:this.y,width:this.width,height:this.height}}getAnimation(e){return this.animations.find(r=>r.id===e)??null}setAnimation(e,n=!1,r){if(!e)return this.layers.forEach(i=>i.visible=!0),this.currentAnimationId=null,void this.stop();if(this.currentAnimationId!==e){this.stop(),this.currentAnimationId=e;const i=this.animations.find(s=>s.id===e);i&&this.layers.forEach((s,o)=>{const a=i.layers.find(l=>l.layerId===o);a?(s.setAnimation(a.loop,r??a.speed),s.visible=!0):s.visible=!1})}n&&!this.playing&&this.play()}initialize(e){var n=this;return Z(function*(){n.addChild((new xr).beginFill(0,.001).drawRect(0,0,e.width,e.height).endFill()),n.animations=e.animations,n.groundPoint=e.groundPoint;for(const r of e.layers){const i=new bU(e);yield i.initialize(r),n.addChild(i),n.layers.set(r.id,i)}})()}}class SU{constructor(e){this.framesResources=e,this.sprites=new Map}showFlash(e,n){var r=this;return Z(function*(){const i=yield r.generateById(e.spriteId);if(i){const s=i.centerPoint;i.x=e.showCoords.x-s.x,i.y=e.showCoords.y-s.y,i.setDefAnimation(),n.addChild(i),yield i.playOnce(),i.destroy()}})()}get(e){return this.sprites.has(e)?this.sprites.get(e):null}generateById(e){var n=this;return Z(function*(){const r=n.get(e);if(!r)return null;const i=new DU;return yield i.initialize(r),i})()}add(e,n){var r=this;return Z(function*(){cn.addBundle(e,{frames:`${n}/frames-def.json`,texture:`${n}/texture.png`,sprite:`${n}/sprite-def.json`});const i=yield cn.loadBundle(e);r.framesResources.add(i.frames,{"texture.png":i.texture}),yield r.addSprite(i.sprite)})()}addSprite(e){var n=this;return Z(function*(){if(!n.sprites.has(e.id)){for(const r of e.layers)r.textures=yield n.generateTexturesByFrames(r.frames,e.width,e.height,n.framesResources);n.sprites.set(e.id,e)}})()}generateTexturesByFrames(e,n,r,i){return Z(function*(){const s=[];for(const o of e){const a=document.createElement("canvas");a.width=n,a.height=r;const l=a.getContext("2d"),c=yield i.getAsCanvas(o.fileId);l&&c&&(l.drawImage(c,o.x,o.y),s.push(ye.from(a)))}return s})()}}class $D extends nn{constructor(e){super(),this.app=e,this.framesResources=new vU(this.app),this.gridResources=new EU(this.framesResources),this.spriteResources=new SU(this.framesResources)}}class TU{constructor(e){this.app=e,this.scenes=new Map}add(e,n){return this.scenes.has(e)?(console.error("\u0414\u0443\u0431\u043b\u0438\u043a\u0430\u0442 \u0441\u0446\u0435\u043d\u044b"),this.scenes.get(e)):(this.scenes.set(e,n),n.name=e,n.visible=!1,this.app.stage.addChild(n),n)}show(e){if(this.scenes.has(e)){this.scenes.forEach((r,i)=>{i!==e&&(r.visible=!1)});const n=this.scenes.get(e);if(n)return n.visible=!0,n}throw new Error("\u0421\u0446\u0435\u043d\u0430 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u0430")}}class CU extends $D{initialize(){var e=this;return Z(function*(){e.addChild((new xr).beginFill(0,1).drawRect(0,0,e.app.screen.width,e.app.screen.height).endFill());const n=yield cn.load("logo.png"),r=new jn(n);r.x=(e.app.screen.width-r.width)/2,r.y=100,e.addChild(r),e.title=new yi("",new Fn({fontFamily:"Arial",fontSize:28,fill:"#ff0000"})),e.addChild(e.title);const i=new yi("\u0421\u0442\u0440\u0435\u043b\u044f\u0442\u044c - \u043f\u0440\u043e\u0431\u0435\u043b",new Fn({fontFamily:"Arial",fontSize:18,fill:"#ffffff"}));i.x=e.app.screen.width-i.width-20,i.y=e.app.screen.height-i.height-50,e.addChild(i);const s=new yi("\u0423\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435 WASD \u0438\u043b\u0438 \u0441\u0442\u0440\u0435\u043b\u043e\u0447\u043a\u0438",new Fn({fontFamily:"Arial",fontSize:18,fill:"#ffffff"}));s.x=e.app.screen.width-s.width-20,s.y=i.y-s.height-10,e.addChild(s)})()}run(e){var n=this;return Z(function*(){n.setTitle(e.title)})()}setTitle(e){this.title.text=e,this.title.x=(this.app.screen.width-this.title.width)/2,this.title.y=(this.app.screen.height-this.title.height)/2}}function hl(t){return q((e,n)=>{Wn(t).subscribe(oe(n,()=>n.complete(),se)),!n.closed&&e.subscribe(n)})}class Jt{static lineIntersect(e,n){const r=e.p1.x,i=e.p1.y,s=e.p2.x,o=e.p2.y,a=n.p1.x,l=n.p1.y,c=n.p2.x,u=n.p2.y;if(r===s&&i===o||a===c&&l===u)return null;const h=(u-l)*(s-r)-(c-a)*(o-i);if(0===h)return null;const d=((c-a)*(i-l)-(u-l)*(r-a))/h,f=((s-r)*(i-l)-(o-i)*(r-a))/h;return d<0||d>1||f<0||f>1?null:{x:r+d*(s-r),y:i+d*(o-i)}}static angleOfVector(e){let n=Math.acos(e.x);return e.y<0&&(n=Math.PI+Math.PI-n),Jt.rad2grad(n)}static angleToVector(e){const n=Jt.grad2rad(e);return{x:Math.cos(n),y:Math.sin(n)}}static isRectangleCollision(e,n){return!(n.x>e.x+e.width||n.x+n.width<e.x||n.y>e.y+e.height||n.y+n.height<e.y)}static pointInRect(e,n){return e.x>=n.x&&e.x<=n.x+n.width&&e.y>=n.y&&e.y<=n.y+n.height}static grad2rad(e){return e*Math.PI/180}static rad2grad(e){return 180/Math.PI*e}static distance(e,n){return Math.sqrt((n.x-e.x)*(n.x-e.x)+(n.y-e.y)*(n.y-e.y))}static getBezierCurve(e,n){const r={x:0,y:0};for(let i=0;i<e.length;i++){const s=Jt.getBezierBasis(i,e.length-1,n);r.x+=e[i].x*s,r.y+=e[i].y*s}return r}static getBezierCurves(e,n=.01){const r=[];for(let i=0;i<1+n;i+=n)i>1&&(i=1),r[r.length]=Jt.getBezierCurve(e,i);return r}static getBezierBasis(e,n,r){const i=s=>s<=1?1:s*i(s-1);return i(n)/(i(e)*i(n-e))*Math.pow(r,e)*Math.pow(1-r,n-e)}}const zD={linear:t=>t,quad:t=>Math.pow(t,2),circ:t=>1-Math.sin(Math.acos(t)),back:(t,e)=>Math.pow(e,2)*((t+1)*e-t),bounce:t=>{for(let e=0,n=1;;e+=n,n/=2)if(t>=(7-4*e)/11)return-Math.pow((11-6*e-11*t)/4,2)+Math.pow(n,2);return 0},elastic:(t,e)=>Math.pow(2,10*(e-1))*Math.cos(20*Math.PI*t/3*e),makeEaseOut:t=>e=>1-t(1-e)};class nr{static getDistanceTo(e,n,r,i){let s={p1:{x:e.x,y:e.y},p2:{x:e.x,y:e.y}};const o=[];switch(n){case"down":case"up":s={p1:{x:e.x,y:0},p2:{x:e.x,y:i.height}};break;case"left":case"right":s={p1:{x:0,y:e.y},p2:{x:i.width,y:e.y}}}for(const a of r){let l={p1:{x:a.x,y:a.y},p2:{x:a.x,y:a.y}};switch(n){case"up":if(l={p1:{x:a.x,y:a.y+a.height},p2:{x:a.x+a.width,y:a.y+a.height}},l.p1.y>e.y)continue;break;case"right":if(l={p1:{x:a.x,y:a.y},p2:{x:a.x,y:a.y+a.height}},l.p1.x<e.x)continue;break;case"left":if(l={p1:{x:a.x+a.width,y:a.y},p2:{x:a.x+a.width,y:a.y+a.height}},l.p1.x>e.x)continue;break;case"down":if(l={p1:{x:a.x,y:a.y},p2:{x:a.x+a.width,y:a.y}},l.p1.y<e.y)continue}const c=Jt.lineIntersect(s,l);if(c){const u=Jt.distance(e,c);o.push(u)}}return o.length>0?Math.min(...o):null}static getRandomInt(e,n){return Math.floor(Math.random()*(n-e+1))+e}static animate({timing:e,draw:n,duration:r}){const i=performance.now(),s=o=>{let a=(o-i)/r;a>1&&(a=1);const l=e(a);n(l),a<1&&requestAnimationFrame(s)};requestAnimationFrame(s)}}var Ue=function(t){return t[t.stayLeft=27]="stayLeft",t[t.runningLeft=21]="runningLeft",t[t.stayRight=25]="stayRight",t[t.runningRight=20]="runningRight",t[t.stayUp=28]="stayUp",t[t.runningUp=22]="runningUp",t[t.stayDown=26]="stayDown",t[t.runningDown=23]="runningDown",t[t.swim=30]="swim",t[t.toWaterDown=34]="toWaterDown",t[t.toWaterUp=33]="toWaterUp",t[t.toWaterLeft=31]="toWaterLeft",t[t.toWaterRight=32]="toWaterRight",t[t.fromWaterDown=37]="fromWaterDown",t[t.fromWaterUp=38]="fromWaterUp",t[t.fromWaterLeft=35]="fromWaterLeft",t[t.fromWaterRight=36]="fromWaterRight",t[t.stayFireLeft=43]="stayFireLeft",t[t.stayFireRight=42]="stayFireRight",t[t.stayFireUp=41]="stayFireUp",t[t.stayFireDown=44]="stayFireDown",t[t.runningFireUp=45]="runningFireUp",t[t.runningFireDown=40]="runningFireDown",t[t.runningFireRight=46]="runningFireRight",t[t.runningFireLeft=47]="runningFireLeft",t}(Ue||{});class MU{constructor(e){this.app=e,this.stateFire=!1,this.eventCollisionEvent=new $t,this.flashEvent=new $t,this.firedEvent=new $t,this.isBusy=!1,this.actorDirectionType="left",this.actorMoveVector={x:0,y:0},this.sceneMoveVector={x:0,y:0},this.isSwiming=!1,this.gridCellsDynamic=[],this.grounds=[],this.events=[],this.lastTime=null,this.screenWidth=this.app.screen.width,this.screenHeight=this.app.screen.height,this.screenHalfWidth=this.app.screen.width/2,this.screenHalfHeight=this.app.screen.height/2}addGridCellDynamic(e){this.gridCellsDynamic.push(e)}setEffectsList(e){this.effectsList=e}setEvents(e){this.events=e}setGround(e){this.grounds=e}setScene(e){this.scene=e}setActor(e){this.actorSprite=e}update(e,n){if(!this.actorSprite||this.isBusy)return;const r=this.actorSprite.centerPoint,i=r.x*this.scene.scale.x+this.scene.x,s=r.y*this.scene.scale.y+this.scene.y;let o={x:0,y:0,width:0,height:0};if(zn.left&n)this.actorDirectionType="left",this.actorMoveVector={x:-1,y:0},this.screenHalfWidth+20>i&&(this.sceneMoveVector={x:1,y:0}),this.isSwiming||(this.stateFire?(this.actorSprite.setAnimation(Ue.runningFireLeft,!0),o=this.actorSprite.getDynamicCollisionFrame(Ue.runningFireLeft)):(this.actorSprite.setAnimation(Ue.runningLeft,!0),o=this.actorSprite.getDynamicCollisionFrame(Ue.runningLeft)));else if(zn.right&n)this.actorDirectionType="right",this.actorMoveVector={x:1,y:0},this.screenHalfWidth-20<i&&(this.sceneMoveVector={x:-1,y:0}),this.isSwiming||(this.stateFire?(this.actorSprite.setAnimation(Ue.runningFireRight,!0),o=this.actorSprite.getDynamicCollisionFrame(Ue.runningFireRight)):(this.actorSprite.setAnimation(Ue.runningRight,!0),o=this.actorSprite.getDynamicCollisionFrame(Ue.runningRight)));else if(zn.up&n)this.actorDirectionType="up",this.actorMoveVector={x:0,y:-1},this.screenHalfHeight+20>s&&(this.sceneMoveVector={x:0,y:1}),this.isSwiming||(this.stateFire?(this.actorSprite.setAnimation(Ue.runningFireUp,!0),o=this.actorSprite.getDynamicCollisionFrame(Ue.runningFireUp)):(this.actorSprite.setAnimation(Ue.runningUp,!0),o=this.actorSprite.getDynamicCollisionFrame(Ue.runningUp)));else if(zn.down&n)this.actorDirectionType="down",this.actorMoveVector={x:0,y:1},this.screenHalfHeight-20<s&&(this.sceneMoveVector={x:0,y:-1}),this.isSwiming||(this.stateFire?(this.actorSprite.setAnimation(Ue.runningFireDown,!0),o=this.actorSprite.getDynamicCollisionFrame(Ue.runningFireDown)):(this.actorSprite.setAnimation(Ue.runningDown,!0),o=this.actorSprite.getDynamicCollisionFrame(Ue.runningDown)));else if(this.actorMoveVector={x:0,y:0},this.sceneMoveVector={x:0,y:0},!this.isSwiming)switch(this.actorDirectionType){case"left":this.stateFire?(this.actorSprite.setAnimation(Ue.stayFireLeft),o=this.actorSprite.getDynamicCollisionFrame(Ue.stayFireLeft)):(this.actorSprite.setAnimation(Ue.stayLeft),o=this.actorSprite.getDynamicCollisionFrame(Ue.stayLeft));break;case"right":this.stateFire?(this.actorSprite.setAnimation(Ue.stayFireRight),o=this.actorSprite.getDynamicCollisionFrame(Ue.stayFireRight)):(this.actorSprite.setAnimation(Ue.stayRight),o=this.actorSprite.getDynamicCollisionFrame(Ue.stayRight));break;case"up":this.stateFire?(this.actorSprite.setAnimation(Ue.stayFireUp),o=this.actorSprite.getDynamicCollisionFrame(Ue.stayFireUp)):(this.actorSprite.setAnimation(Ue.stayUp),o=this.actorSprite.getDynamicCollisionFrame(Ue.stayUp));break;case"down":this.stateFire?(this.actorSprite.setAnimation(Ue.stayFireDown),o=this.actorSprite.getDynamicCollisionFrame(Ue.stayFireDown)):(this.actorSprite.setAnimation(Ue.stayDown),o=this.actorSprite.getDynamicCollisionFrame(Ue.stayDown))}const a=r.x+2.5*this.actorMoveVector.x*e,l=r.y+2*this.actorMoveVector.y*e;if(o.x=o.x+2.5*this.actorMoveVector.x*e,o.y=o.y+2*this.actorMoveVector.y*e,this.stateFire?(!this.lastTime||performance.now()-this.lastTime>500)&&(this.firedEvent.emit({coords:{x:r.x+5,y:r.y-18},direction:this.actorDirectionType,heroPoint:r}),this.lastTime=performance.now()):this.lastTime=null,this.hasStopCollision(a,l))return;this.updateActorZIndex(a,l);let c=this.scene.x+8*this.sceneMoveVector.x*e,u=this.scene.y+7.5*this.sceneMoveVector.y*e;this.scene.width-this.screenWidth<=Math.abs(c)&&(c=-1*(this.scene.width-this.screenWidth)),this.scene.height-this.screenHeight<=Math.abs(u)&&(u=-1*(this.scene.height-this.screenHeight)),this.scene.x=c>0?0:c,this.scene.y=u>0?0:u;const h=this.actorSprite.x+2.5*this.actorMoveVector.x*e,d=this.actorSprite.y+2*this.actorMoveVector.y*e;this.actorSprite.x=h<0?0:h,this.actorSprite.y=d<0?0:d}hasStopCollision(e,n){let r=!1;for(const i of this.grounds)if(Jt.pointInRect({x:e,y:n},i)){r=!0;break}return!!this.checkEventCollision({x:e,y:n})&&r}checkEventCollision(e){for(const n of this.events)if(Jt.pointInRect(e,n.rect)){if("switch-water"===String(n.properties?.type))return this.isSwiming?this.switchFromWater(String(n.properties?.mode)):this.switchToWater(String(n.properties?.mode)),!1;"in-water"===String(n.properties?.type)?(this.isSwiming=!0,this.actorSprite.setAnimation(Ue.swim,!0)):(n.properties.coords={type:"coords",value:e},this.eventCollisionEvent.emit(n.properties))}return!0}updateActorZIndex(e,n){for(const r of this.gridCellsDynamic)if(Jt.pointInRect({x:e,y:n},r.rect)){this.actorSprite.zIndex="bottom"===String(r.cell.properties?.dynamicZIndexMode)?n>r.cell.y+r.cell.height?2:0:n>r.cell.y+r.cell.height/2?2:0;break}}switchFromWater(e){var n=this;return Z(function*(){switch(n.isBusy=!0,e){case"s-n":"down"===n.actorDirectionType?(yield n.jumpDown(Ue.fromWaterDown),n.actorSprite.setAnimation(Ue.stayDown)):"up"===n.actorDirectionType&&(yield n.jumpUp(Ue.fromWaterUp),n.actorSprite.setAnimation(Ue.stayUp));break;case"w-e":"right"===n.actorDirectionType?(yield n.jumpRight(Ue.fromWaterRight),n.actorSprite.setAnimation(Ue.stayRight)):"left"===n.actorDirectionType&&(yield n.jumpLeft(Ue.fromWaterLeft),n.actorSprite.setAnimation(Ue.stayRight))}n.isSwiming=!1,n.isBusy=!1})()}switchToWater(e){var n=this;return Z(function*(){switch(n.isBusy=!0,e){case"s-n":"down"===n.actorDirectionType?yield n.jumpDown(Ue.toWaterDown):"up"===n.actorDirectionType&&(yield n.jumpUp(Ue.toWaterUp));break;case"w-e":"right"===n.actorDirectionType?yield n.jumpRight(Ue.toWaterRight):"left"===n.actorDirectionType&&(yield n.jumpLeft(Ue.toWaterLeft))}n.flashEvent.emit({spriteId:n.effectsList.gurgle,showCoords:n.actorSprite.centerPoint}),n.isBusy=!1})()}jumpLeft(e){var n=this;return Z(function*(){n.actorSprite&&(yield n.flyHero([{x:n.actorSprite.x,y:n.actorSprite.y},{x:n.actorSprite.x-10,y:n.actorSprite.y-20},{x:n.actorSprite.x-20,y:n.actorSprite.y}],500,e))})()}jumpRight(e){var n=this;return Z(function*(){n.actorSprite&&(yield n.flyHero([{x:n.actorSprite.x,y:n.actorSprite.y},{x:n.actorSprite.x+10,y:n.actorSprite.y-20},{x:n.actorSprite.x+20,y:n.actorSprite.y}],500,e))})()}jumpUp(e){var n=this;return Z(function*(){n.actorSprite&&(yield n.flyHero([{x:n.actorSprite.x,y:n.actorSprite.y},{x:n.actorSprite.x-10,y:n.actorSprite.y-20},{x:n.actorSprite.x,y:n.actorSprite.y-20}],500,e))})()}jumpDown(e){var n=this;return Z(function*(){n.actorSprite&&(yield n.flyHero([{x:n.actorSprite.x,y:n.actorSprite.y},{x:n.actorSprite.x+10,y:n.actorSprite.y-20},{x:n.actorSprite.x,y:n.actorSprite.y+20}],500,e))})()}flyHero(e,n=1e3,r=null){return new Promise(i=>{r&&(this.actorSprite.setAnimation(r),this.actorSprite.playOnce()),nr.animate({draw:s=>{const o=Jt.getBezierCurve(e,s);this.actorSprite&&(this.actorSprite.x=o.x,this.actorSprite.y=o.y),s>=1&&i()},duration:n,timing:zD.linear})})}}var Dr=function(t){return t[t.appearing=53]="appearing",t[t.death=54]="death",t[t.up=55]="up",t[t.right=56]="right",t[t.down=57]="down",t[t.left=58]="left",t}(Dr||{});class NU{constructor(e,n,r,i,s){this.actorSprite=e,this.grounds=n,this.events=r,this.gridCellsDynamic=i,this.heroSprite=s,this.eatNeighborEvent=new $t,this.eatHeroEvent=new $t,this.actorDirectionType="none",this.lastDirectionType="none",this.actorMoveVector={x:0,y:0},this.zombieSpeed={x:.5,y:.2},this.holdHungy=!1,this.actorSprite.setAnimation(Dr.appearing);const o=this.getAppearingPlace();this.actorSprite.x=o.x,this.actorSprite.y=o.y,this.actorSprite.playOnce()}die(){var e=this;return Z(function*(){e.actorSprite.setAnimation(Dr.death),yield e.actorSprite.playOnce(),e.actorSprite.destroy()})()}update(e){if(this.actorSprite.isBusy)return;const n=this.actorSprite.centerPoint;"none"===this.actorDirectionType&&this.generationDirection(n);let r=.04;const i=this.holdHungy?"none":this.getEatDirection(n);"none"!==i?(this.actorDirectionType=i,this.zombieSpeed.x=1.5,this.zombieSpeed.y=.6,r=.1):(this.zombieSpeed.x=.5,this.zombieSpeed.y=.2);let s=this.canMoveOn(n,e);switch(s.canMove||(!this.holdHungy&&"none"!==i&&(this.holdHungy=!0,setTimeout(()=>this.holdHungy=!1,2e3)),this.generationDirection(n),s=this.canMoveOn(n,e),s.canMove||(this.actorDirectionType="none")),this.actorDirectionType){case"left":this.actorSprite.setAnimation(Dr.left,!0,r);break;case"right":this.actorSprite.setAnimation(Dr.right,!0,r);break;case"up":this.actorSprite.setAnimation(Dr.up,!0,r);break;case"down":this.actorSprite.setAnimation(Dr.down,!0,r)}this.updateActorZIndex(s.toX,s.toY);const o=this.actorSprite.x+this.actorMoveVector.x*this.zombieSpeed.x*e,a=this.actorSprite.y+this.actorMoveVector.y*this.zombieSpeed.y*e;this.actorSprite.x=o<0?0:o,this.actorSprite.y=a<0?0:a}updateActorZIndex(e,n){for(const r of this.gridCellsDynamic)if(Jt.pointInRect({x:e,y:n},r.rect)){this.actorSprite.zIndex="bottom"===String(r.cell.properties?.dynamicZIndexMode)?n>r.cell.y+r.cell.height?2:0:n>r.cell.y+r.cell.height/2?2:0;break}}hasStopCollision(e,n,r){let i=!1;for(const s of this.grounds)if(Jt.pointInRect({x:e,y:n},s)){i=!0;break}return!this.checkEventCollision({x:e,y:n},r)||i}checkEventCollision(e,n){if(n&&Jt.pointInRect(this.heroSprite.centerPoint,n))return this.holdHungy=!0,this.actorDirectionType="none",this.heroSprite.blink(),setTimeout(()=>this.holdHungy=!1,5e3),this.eatHeroEvent.emit(),!1;for(const r of this.events)if(Jt.pointInRect(e,r.rect)){if("neighbor"===String(r.properties?.type)){this.eatNeighborEvent.emit(r.properties),this.actorDirectionType="none";break}if(["switch-water","in-water"].includes(String(r.properties?.type)))return!1}return!0}generationDirection(e){const r=[{key:"left",d:this.getDistanceToStop(e,"left")},{key:"right",d:this.getDistanceToStop(e,"right")},{key:"down",d:this.getDistanceToStop(e,"down")},{key:"up",d:this.getDistanceToStop(e,"up")}].reduce((i,s)=>+s?.d>+i?.d?s:i).key;if(r===this.lastDirectionType){const i=this.lastDirectionType;switch(this.lastDirectionType=this.actorDirectionType,i){case"down":case"up":this.actorDirectionType=0===nr.getRandomInt(0,1)?"left":"right";break;case"left":case"right":this.actorDirectionType=0===nr.getRandomInt(0,1)?"up":"down"}}else this.lastDirectionType=this.actorDirectionType,this.actorDirectionType=r}getDistanceToStop(e,n){const r=this.events.filter(a=>["switch-water","in-water"].includes(String(a.properties.type))).map(a=>a.rect),i=nr.getDistanceTo(e,n,this.grounds,{x:0,y:0,width:this.actorSprite.parent.width,height:this.actorSprite.parent.height}),s=nr.getDistanceTo(e,n,r,{x:0,y:0,width:this.actorSprite.parent.width,height:this.actorSprite.parent.height}),o=[];return null!==i&&o.push(i),null!==s&&o.push(s),Math.min(...o)}getAppearingPlace(){const e=this.actorSprite.getGroundPoint()??{x:0,y:0};let n=nr.getRandomInt(10,this.actorSprite.parent.width/this.actorSprite.parent.scale.x-10),r=nr.getRandomInt(10,this.actorSprite.parent.height/this.actorSprite.parent.scale.y-10);for(;this.hasStopCollision(n,r);)n=nr.getRandomInt(10,this.actorSprite.parent.width/this.actorSprite.parent.scale.x-10),r=nr.getRandomInt(10,this.actorSprite.parent.height/this.actorSprite.parent.scale.y-10);return{x:n-e.x/this.actorSprite.parent.scale.x,y:r-e.y/this.actorSprite.parent.scale.y}}getEatDirection(e){const n=[],r=Jt.distance(e,this.heroSprite.centerPoint);if(r<150)n.push({x:this.heroSprite.centerPoint.x,y:this.heroSprite.centerPoint.y,d:r});else{const i=this.events.filter(s=>["neighbor"].includes(String(s.properties.type)));for(const s of i){const o=s.rect.x+s.rect.width/2,a=s.rect.y+s.rect.height/2,l=Jt.distance(e,{x:o,y:a});l<150&&n.push({x:o,y:a,d:l})}}if(n.length>0){const i=n.reduce((l,c)=>+c?.d>+l?.d?c:l),s=i.x-e.x,o=i.y-e.y,a=15/this.actorSprite.parent.scale.x;return Math.abs(s)<=a?o>0?"down":"up":Math.abs(o)<=a||Math.abs(s)<Math.abs(o)?s>0?"right":"left":o>0?"down":"up"}return"none"}canMoveOn(e,n){let r={x:0,y:0,width:0,height:0};switch(this.actorDirectionType){case"left":this.actorMoveVector={x:-1,y:0},r=this.actorSprite.getDynamicCollisionFrame(Dr.left);break;case"right":this.actorMoveVector={x:1,y:0},r=this.actorSprite.getDynamicCollisionFrame(Dr.right);break;case"up":this.actorMoveVector={x:0,y:-1},r=this.actorSprite.getDynamicCollisionFrame(Dr.up);break;case"down":this.actorMoveVector={x:0,y:1},r=this.actorSprite.getDynamicCollisionFrame(Dr.down)}const i=e.x+this.actorMoveVector.x*this.zombieSpeed.x*n,s=e.y+.2*this.actorMoveVector.y*n;return r.x=r.x+this.actorMoveVector.x*this.zombieSpeed.x*n,r.y=r.y+this.actorMoveVector.y*this.zombieSpeed.y*n,{canMove:!this.hasStopCollision(i,s,r),toX:i,toY:s}}}class OU{constructor(e,n){this.app=e,this.spriteResources=n,this.eatNeighborEvent=new $t,this.eatHeroEvent=new $t,this.zombies=new Map,this.grounds=[],this.events=[],this.idxZombie=0,this.gridCellsDynamic=[]}dieZombie(e){this.zombies.has(e)&&(this.zombies.get(e)?.die(),this.zombies.delete(e))}addGridCellDynamic(e){this.gridCellsDynamic.push(e)}setEvents(e){this.events=e}setGround(e){this.grounds=e}setScene(e){this.scene=e}setActor(e){this.actorSprite=e}update(e){this.zombies.forEach(n=>n.update(e))}apperingZombie(e){var n=this;return Z(function*(){const r=yield n.spriteResources.generateById(21);if(r){n.scene.addChild(r);const i=new NU(r,n.grounds,n.events,n.gridCellsDynamic,n.actorSprite);i.eatNeighborEvent.subscribe(s=>n.eatNeighborEvent.emit(s)),i.eatHeroEvent.subscribe(()=>n.eatHeroEvent.emit()),n.zombies.set(n.idxZombie,i),n.idxZombie++,e&&(i.actorSprite.x=e.x,i.actorSprite.y=e.y)}})()}}var qr=function(t){return t[t.left=48]="left",t[t.right=49]="right",t[t.up=50]="up",t[t.down=51]="down",t[t.explode=52]="explode",t}(qr||{});class UU{constructor(e){this.spriteResources=e,this.bullets=new Map,this.idxBullets=0}update(e){this.bullets.forEach((n,r)=>{if(n.busy)return;let i={x:0,y:0};switch(n.direction){case"left":i={x:-1,y:0};break;case"right":i={x:1,y:0};break;case"up":i={x:0,y:-1};break;case"down":i={x:0,y:1}}const s=n.bullet.x+4.5*i.x*e,o=n.bullet.y+3*i.y*e;s*this.scene.scale.x+this.scene.x<0||o*this.scene.scale.y+this.scene.y<0?this.removeBullet(r):this.isGroundCollision({x:s+(n.offsetCoords?.x??0),y:o+(n.offsetCoords?.y??0)})?this.explodeBullet(r):(n.bullet.x=s,n.bullet.y=o)})}fireBullet(e){var n=this;return Z(function*(){const r=yield n.spriteResources.generateById(20);if(!r)return;let i=null,s=e.coords.x,o=e.coords.y,a=null,l=!1;switch(e.direction){case"up":s=e.coords.x-r.width/2-2,o=e.coords.y-r.height,a=nr.getDistanceTo(e.heroPoint,"up",n.grounds,{x:0,y:0,width:n.scene.width,height:n.scene.height}),l=null!==a&&a<5,i=r.getAnimation(qr.up),r.setAnimation(qr.up);break;case"down":s=e.coords.x-r.width/2-2,o=e.coords.y,i=r.getAnimation(qr.down),r.setAnimation(qr.down);break;case"left":s=e.coords.x-15-r.width,o=e.coords.y-7,a=nr.getDistanceTo(e.heroPoint,"left",n.grounds,{x:0,y:0,width:n.scene.width,height:n.scene.height}),l=null!==a&&a<5,i=r.getAnimation(qr.left),r.setAnimation(qr.left);break;case"right":s=e.coords.x-r.width/2+3,o=e.coords.y-7,i=r.getAnimation(qr.right),r.setAnimation(qr.right)}r.x=s,r.y=o,r.zIndex=0,n.bullets.set(n.idxBullets,{offsetCoords:i?.groundPoint??null,direction:e.direction,busy:!1,bullet:r}),n.scene.addChild(r),l&&n.explodeBullet(n.idxBullets),n.idxBullets++})()}setGround(e){this.grounds=e}setScene(e){this.scene=e}removeBullet(e){this.bullets.has(e)&&(this.bullets.get(e).bullet.destroy(),this.bullets.delete(e))}explodeBullet(e){var n=this;return Z(function*(){if(n.bullets.has(e)){const r=n.bullets.get(e);r.busy=!0,r.bullet.setAnimation(qr.explode),yield r.bullet.playOnce(),n.removeBullet(e)}})()}isGroundCollision(e){let n=!1;for(const r of this.grounds)if(Jt.pointInRect(e,r)){n=!0;break}return n}}class VU{constructor(e,n,r){var i=this;this.app=e,this.spriteResources=n,this.interfaceContainer=r,this.eventCollisionEvent=new $t,this.flashEvent=new $t,this.eatNeighborEvent=new $t,this.controlHero=new MU(this.app),this.controlZombie=new OU(this.app,this.spriteResources),this.controlBullets=new UU(this.spriteResources),this.moveState=0,this.hApperingZombie=null,this.unSubscrite=new O,this.countOfShots=100,this.countHeroLife=10,this.countHeroScore=0,this.keyDown=s=>{switch(s.code){case"Space":this.controlHero.stateFire=this.countOfShots>0;break;case"KeyA":case"ArrowLeft":this.moveState|=zn.left;break;case"KeyD":case"ArrowRight":this.moveState|=zn.right;break;case"KeyW":case"ArrowUp":this.moveState|=zn.up;break;case"KeyS":case"ArrowDown":this.moveState|=zn.down}},this.keyUp=s=>{switch(s.code){case"KeyZ":this.controlZombie.apperingZombie({x:230,y:500});break;case"Space":this.controlHero.stateFire=!1;break;case"KeyA":case"ArrowLeft":this.moveState&=~zn.left;break;case"KeyD":case"ArrowRight":this.moveState&=~zn.right;break;case"KeyW":case"ArrowUp":this.moveState&=~zn.up;break;case"KeyS":case"ArrowDown":this.moveState&=~zn.down}},this.tickerUpdate=s=>{this.controlHero.update(s,this.moveState),this.controlZombie.update(s),this.controlBullets.update(s);for(const[o,a]of this.controlBullets.bullets){if(a.busy)continue;let l=!1;for(const[c,u]of this.controlZombie.zombies)if(Jt.isRectangleCollision(a.bullet.getBounds(),u.actorSprite.getBounds())){l=!0,this.countHeroScore+=10,this.interfaceContainer.setCountScore(this.countHeroScore),this.controlZombie.dieZombie(c);break}if(l){this.controlBullets.removeBullet(o);break}}},this.controlHero.eventCollisionEvent.pipe(hl(this.unSubscrite)).subscribe(s=>{if(this.eventCollisionEvent.emit(s),"neighbor"===String(s.type)){const o=s.coords?.value;let a=0;switch(console.log("colision",String(s["neighbor-type"]),o),String(s["neighbor-type"])){case"cook":case"bather":a=105}o&&a>0&&(this.countHeroScore+=a,this.interfaceContainer.setCountScore(this.countHeroScore),this.flyScore(o,a))}}),this.controlHero.flashEvent.pipe(hl(this.unSubscrite)).subscribe(s=>this.flashEvent.emit(s)),this.controlHero.firedEvent.pipe(hl(this.unSubscrite)).subscribe(function(){var s=Z(function*(o){i.controlBullets.fireBullet(o),i.countOfShots--,i.interfaceContainer.setCountShots(i.countOfShots)});return function(o){return s.apply(this,arguments)}}()),this.controlZombie.eatNeighborEvent.pipe(hl(this.unSubscrite)).subscribe(s=>this.eatNeighborEvent.emit(s)),this.controlZombie.eatHeroEvent.pipe(hl(this.unSubscrite)).subscribe(()=>{this.countHeroLife--,this.interfaceContainer.setCountLife(this.countHeroLife),this.countHeroLife<=0&&console.log("GAME OVER")})}run(){this.interfaceContainer.setCountLife(this.countHeroLife),this.interfaceContainer.setCountScore(this.countHeroScore),this.interfaceContainer.setCountShots(this.countOfShots),window.addEventListener("keydown",this.keyDown),window.addEventListener("keyup",this.keyUp),this.app.ticker.add(this.tickerUpdate);for(let e=0;e<10;e++)this.controlZombie.apperingZombie();this.hApperingZombie=window.setInterval(()=>this.controlZombie.apperingZombie(),1e4)}setEffectsList(e){this.controlHero.setEffectsList(e)}setEvents(e){this.controlHero.setEvents(e),this.controlZombie.setEvents(e)}setGround(e){this.controlHero.setGround(e),this.controlZombie.setGround(e),this.controlBullets.setGround(e)}setScene(e){this.scene=e,this.controlHero.setScene(e),this.controlZombie.setScene(e),this.controlBullets.setScene(e)}addGridCellDynamic(e){this.controlHero.addGridCellDynamic(e),this.controlZombie.addGridCellDynamic(e)}setActor(e){this.controlHero.setActor(e),this.controlZombie.setActor(e)}flyScore(e,n){const r=new Fn({fontFamily:"DisneyPark",fontSize:22,fill:16777215}),i=new yi(String(n),r);i.x=e.x,i.y=e.y,this.scene.addChild(i),nr.animate({draw:s=>{i.y-=75*s,s>=1&&i.destroy()},duration:1500,timing:zD.back.bind(null,.05)})}}class WU extends nn{constructor(e,n){super(),this.app=e,this.spriteResources=n,this.lifes=new Map}setCountLife(e){for(let n=0;n<10;n++)this.lifes.has(n)&&this.lifes.get(n).setAnimation(n<e?59:60)}setCountScore(e){this.txtScore.text=e,this.txtScore.x=(102-this.txtScore.width)/2}setCountShots(e){this.txtShots.text=e}initialize(){var e=this;return Z(function*(){e.addChild((new xr).beginFill(0,.7).drawRect(0,0,102,38).endFill());const n=yield cn.load("interface/zekke-face.png"),r=new jn(n);r.x=2,r.y=2,e.addChild(r);const i=new nn;for(let l=0;l<10;l++){const c=yield e.spriteResources.generateById(22);c&&(c.x=l*c?.width,c.y=0,i.addChild(c),e.lifes.set(l,c))}i.x=14,i.y=4,e.addChild(i);const s=yield cn.load("interface/gun.png"),o=new jn(s);o.x=i.x+i.width+3,o.y=5,e.addChild(o);const a=new Fn({fontFamily:"DisneyPark",fontSize:18,fill:16777215});e.txtShots=new yi("",a),e.txtShots.x=o.x+o.width+4,e.txtShots.y=0,e.addChild(e.txtShots),e.txtScore=new yi("0",a),e.txtScore.x=(102-e.txtScore.width)/2,e.txtScore.y=17,e.addChild(e.txtScore)})()}}var YD=function(t){return t[t.gurgle=19]="gurgle",t}(YD||{});class ZU extends $D{constructor(e){super(e),this.app=e,this.assetsPath="scenes/level-1",this.interfaceContainer=new WU(this.app,this.spriteResources),this.controlScene=new VU(this.app,this.spriteResources,this.interfaceContainer),this.debugGraphics=new xr,this.sceneObjects=new Map,this.sceneEvents=[],this.sortableChildren=!0,this.debugGraphics.zIndex=100001,this.addChild(this.debugGraphics)}initialize(){var e=this;return Z(function*(){cn.addBundle("fonts",{DisneyPark:"fonts/DisneyPark.ttf"}),yield cn.loadBundle("fonts"),yield e.gridResources.add("level-1-grids",`${e.assetsPath}/grids`),yield e.spriteResources.add("npc-cook","actors/npc/cook"),yield e.spriteResources.add("npc-bather","actors/npc/bather"),yield e.spriteResources.add("zombie","actors/enemies/zombie"),yield e.spriteResources.add("flash-gurgle","effects/gurgle"),yield e.spriteResources.add("gun-bullet","effects/bullet"),yield e.spriteResources.add("interface-life","interface/life"),yield e.spriteResources.add("zeke","actors/zeke");const n=yield cn.load(`${e.assetsPath}/level.json`);yield e.initializeScene(n)})()}run(){var e=this;return Z(function*(){e.controlScene.run()})()}initializeScene(e){var n=this;return Z(function*(){n.addChild((new xr).beginFill(0,.001).drawRect(0,0,e.width,e.height).endFill());for(const i of e.objects)switch(i.type){case"layer-grid":i.externalId&&n.initializeGrid(i.externalId);break;case"layer-sprites":for(const s of i.children||[])if(!n.sceneObjects.has(s.id)){const o=yield n.generateSprite(s);o&&(n.sceneObjects.set(s.id,o),n.addChild(o))}}n.sceneEvents=e.events||[],n.controlScene.setScene(n),n.controlScene.setGround(e.ground||[]),n.controlScene.setEvents(e.events||[]),n.controlScene.setEffectsList({gurgle:YD.gurgle}),n.controlScene.eventCollisionEvent.subscribe(i=>{n.executeEvent(i)}),n.controlScene.flashEvent.subscribe(i=>{n.spriteResources.showFlash(i,n)}),n.controlScene.eatNeighborEvent.subscribe(i=>{n.eatNeighbor(i)});const r=yield n.generateSprite(null,17);if(r){r.x=e.actorX,r.y=e.actorY,r.setAnimation(Ue.stayLeft);const i=n.app.screen.width/2-3*r.centerPoint.x,s=n.app.screen.height/2-3*r.centerPoint.y;n.x=i>0?0:i,n.y=s>0?0:s,n.addChild(r),n.controlScene.setActor(r)}yield n.interfaceContainer.initialize(),n.interfaceContainer.x=10,n.interfaceContainer.y=10,n.app.stage.sortableChildren=!0,n.app.stage.addChild(n.interfaceContainer),n.interfaceContainer.scale.set(3),n.scale.set(3)})()}initializeGrid(e){const n=this.gridResources.get(e);if(n){if(n.holdTexture){const r=new jn(n.holdTexture);this.addChild(r)}for(const r of n)r.x=r.cellX*r.cellWidth,r.y=r.cellY*r.cellHeight,r.properties?.dynamicZIndex&&(r.zIndex=1,this.controlScene.addGridCellDynamic({rect:{x:r.x,y:r.y,width:r.width,height:r.height},cell:r})),r.properties?.zIndex&&(r.zIndex=Number(r.properties.zIndex)),"boolean"==typeof r.properties?.visible&&(r.visible=!!r.properties.visible),this.addChild(r)}}generateSprite(e,n){var r=this;return Z(function*(){if(!e&&n)return yield r.spriteResources.generateById(n);if(!e||!e.externalId)return null;const i=yield r.spriteResources.generateById(e.externalId);return i?(i.x=e.x,i.y=e.y,i.visible=e.visible,i.zIndex=e.zIndex,i.setAnimation(e.animationId??null,!!e.playing),i):null})()}eatNeighbor(e){const n=this.sceneEvents.findIndex(r=>r.properties.id===e.id);"neighbor"===(n>=0&&this.sceneEvents.splice(n,1),String(e.type))&&this.removeObject(Number(e["object-id"]))}executeEvent(e){if(e.once){const n=this.sceneEvents.findIndex(r=>r.properties.id===e.id);n>=0&&this.sceneEvents.splice(n,1)}if(["open-door","open-trashcan","open-locker"].includes(String(e.type))){const n=this.gridResources.get(Number(e.gridId));if(!n)return;const r=n.filter(i=>i.cellKey===String(e.cell));if(0===r.length)return;switch(String(e.type)){case"open-trashcan":r.forEach(i=>{i.visible="opened-trashcan"===String(i.properties?.type)});break;case"open-door":r.forEach(i=>{i.visible=["opened-door","above-door"].includes(String(i.properties?.type))});break;case"open-locker":r.forEach(i=>{i.visible="opened-locker"===String(i.properties?.type)})}}else"neighbor"===String(e.type)&&this.removeObject(Number(e["object-id"]))}removeObject(e){this.sceneObjects.has(e)&&(this.sceneObjects.get(e).destroy({children:!0}),this.sceneObjects.delete(e))}}class KU{constructor(e){this.app=e,this.scenesManager=new TU(this.app)}initializaion(){var e=this;return Z(function*(){cn.init({basePath:"assets"}),yield e.scenesManager.add("loading",new CU(e.app)).initialize(),e.scenesManager.show("loading").run({title:"\u0418\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u044f..."}),yield e.scenesManager.add("level-1",new ZU(e.app)).initialize(),e.scenesManager.show("level-1").run()})()}}!function BL(t,e){QN({rootComponent:t,...DE(e)})}((()=>{var t;class e{constructor(r,i){this.elementRef=r,i.detach(),$e.defaultOptions.scaleMode=Gr.NEAREST;const s=new Og({antialias:!1,resolution:1,backgroundColor:0,autoDensity:!0});this.elementRef.nativeElement.appendChild(s.view),s.resizeTo=this.elementRef.nativeElement,new KU(s).initializaion()}}return(t=e).\u0275fac=function(r){return new(r||t)(Ke(qi),Ke(Nw))},t.\u0275cmp=Tm({type:t,selectors:[["app-root"]],standalone:!0,features:[Ex],decls:0,vars:0,template:function(r,i){},styles:["[_nghost-%COMP%]{flex:auto}"],changeDetection:0}),e})())},98:(Re,et,re)=>{"use strict";var F=re(491),_e=re(436),we=_e(F("String.prototype.indexOf"));Re.exports=function(ie,ae){var ne=F(ie,!!ae);return"function"==typeof ne&&we(ie,".prototype.")>-1?_e(ne):ne}},436:(Re,et,re)=>{"use strict";var F=re(333),_e=re(491),we=_e("%Function.prototype.apply%"),ve=_e("%Function.prototype.call%"),ie=_e("%Reflect.apply%",!0)||F.call(ve,we),ae=_e("%Object.getOwnPropertyDescriptor%",!0),ne=_e("%Object.defineProperty%",!0),ge=_e("%Math.max%");if(ne)try{ne({},"a",{value:1})}catch{ne=null}Re.exports=function(xe){var se=ie(F,ve,arguments);return ae&&ne&&ae(se,"length").configurable&&ne(se,"length",{value:1+ge(0,xe.length-(arguments.length-1))}),se};var le=function(){return ie(F,we,arguments)};ne?ne(Re.exports,"apply",{value:le}):Re.exports.apply=le},145:Re=>{"use strict";function et(y,w,x){x=x||2;var O,V,W,H,q,oe,Ce,C=w&&w.length,P=C?w[0]*x:y.length,b=re(y,0,P,x,!0),I=[];if(!b||b.next===b.prev)return I;if(C&&(b=function ne(y,w,x,C){var b,I,W,P=[];for(b=0,I=w.length;b<I;b++)(W=re(y,w[b]*C,b<I-1?w[b+1]*C:y.length,C,!1))===W.next&&(W.steiner=!0),P.push(be(W));for(P.sort(ge),b=0;b<P.length;b++)x=le(P[b],x);return x}(y,w,b,x)),y.length>80*x){O=W=y[0],V=H=y[1];for(var Te=x;Te<P;Te+=x)(q=y[Te])<O&&(O=q),(oe=y[Te+1])<V&&(V=oe),q>W&&(W=q),oe>H&&(H=oe);Ce=0!==(Ce=Math.max(W-O,H-V))?32767/Ce:0}return _e(b,I,x,O,V,Ce,0),I}function re(y,w,x,C,P){var b,I;if(P===j(y,w,x,C)>0)for(b=w;b<x;b+=C)I=Oe(b,y[b],y[b+1],I);else for(b=x-C;b>=w;b-=C)I=Oe(b,y[b],y[b+1],I);return I&&B(I,I.next)&&(rt(I),I=I.next),I}function F(y,w){if(!y)return y;w||(w=y);var C,x=y;do{if(C=!1,x.steiner||!B(x,x.next)&&0!==S(x.prev,x,x.next))x=x.next;else{if(rt(x),(x=w=x.prev)===x.next)break;C=!0}}while(C||x!==w);return w}function _e(y,w,x,C,P,b,I){if(y){!I&&b&&function se(y,w,x,C){var P=y;do{0===P.z&&(P.z=L(P.x,P.y,w,x,C)),P.prevZ=P.prev,P.nextZ=P.next,P=P.next}while(P!==y);P.prevZ.nextZ=null,P.prevZ=null,function Ee(y){var w,x,C,P,b,I,O,V,W=1;do{for(x=y,y=null,b=null,I=0;x;){for(I++,C=x,O=0,w=0;w<W&&(O++,C=C.nextZ);w++);for(V=W;O>0||V>0&&C;)0!==O&&(0===V||!C||x.z<=C.z)?(P=x,x=x.nextZ,O--):(P=C,C=C.nextZ,V--),b?b.nextZ=P:y=P,P.prevZ=b,b=P;x=C}b.nextZ=null,W*=2}while(I>1)}(P)}(y,C,P,b);for(var V,W,O=y;y.prev!==y.next;)if(V=y.prev,W=y.next,b?ve(y,C,P,b):we(y))w.push(V.i/x|0),w.push(y.i/x|0),w.push(W.i/x|0),rt(y),y=W.next,O=W.next;else if((y=W)===O){I?1===I?_e(y=ie(F(y),w,x),w,x,C,P,b,2):2===I&&ae(y,w,x,C,P,b):_e(F(y),w,x,C,P,b,1);break}}}function we(y){var w=y.prev,x=y,C=y.next;if(S(w,x,C)>=0)return!1;for(var P=w.x,b=x.x,I=C.x,O=w.y,V=x.y,W=C.y,H=P<b?P<I?P:I:b<I?b:I,q=O<V?O<W?O:W:V<W?V:W,oe=P>b?P>I?P:I:b>I?b:I,Ce=O>V?O>W?O:W:V>W?V:W,Te=C.next;Te!==w;){if(Te.x>=H&&Te.x<=oe&&Te.y>=q&&Te.y<=Ce&&fe(P,O,b,V,I,W,Te.x,Te.y)&&S(Te.prev,Te,Te.next)>=0)return!1;Te=Te.next}return!0}function ve(y,w,x,C){var P=y.prev,b=y,I=y.next;if(S(P,b,I)>=0)return!1;for(var O=P.x,V=b.x,W=I.x,H=P.y,q=b.y,oe=I.y,Ce=O<V?O<W?O:W:V<W?V:W,Te=H<q?H<oe?H:oe:q<oe?q:oe,_t=O>V?O>W?O:W:V>W?V:W,tt=H>q?H>oe?H:oe:q>oe?q:oe,Ze=L(Ce,Te,w,x,C),wt=L(_t,tt,w,x,C),Fe=y.prevZ,Ie=y.nextZ;Fe&&Fe.z>=Ze&&Ie&&Ie.z<=wt;){if(Fe.x>=Ce&&Fe.x<=_t&&Fe.y>=Te&&Fe.y<=tt&&Fe!==P&&Fe!==I&&fe(O,H,V,q,W,oe,Fe.x,Fe.y)&&S(Fe.prev,Fe,Fe.next)>=0||(Fe=Fe.prevZ,Ie.x>=Ce&&Ie.x<=_t&&Ie.y>=Te&&Ie.y<=tt&&Ie!==P&&Ie!==I&&fe(O,H,V,q,W,oe,Ie.x,Ie.y)&&S(Ie.prev,Ie,Ie.next)>=0))return!1;Ie=Ie.nextZ}for(;Fe&&Fe.z>=Ze;){if(Fe.x>=Ce&&Fe.x<=_t&&Fe.y>=Te&&Fe.y<=tt&&Fe!==P&&Fe!==I&&fe(O,H,V,q,W,oe,Fe.x,Fe.y)&&S(Fe.prev,Fe,Fe.next)>=0)return!1;Fe=Fe.prevZ}for(;Ie&&Ie.z<=wt;){if(Ie.x>=Ce&&Ie.x<=_t&&Ie.y>=Te&&Ie.y<=tt&&Ie!==P&&Ie!==I&&fe(O,H,V,q,W,oe,Ie.x,Ie.y)&&S(Ie.prev,Ie,Ie.next)>=0)return!1;Ie=Ie.nextZ}return!0}function ie(y,w,x){var C=y;do{var P=C.prev,b=C.next.next;!B(P,b)&&k(P,C,C.next,b)&&K(P,b)&&K(b,P)&&(w.push(P.i/x|0),w.push(C.i/x|0),w.push(b.i/x|0),rt(C),rt(C.next),C=y=b),C=C.next}while(C!==y);return F(C)}function ae(y,w,x,C,P,b){var I=y;do{for(var O=I.next.next;O!==I.prev;){if(I.i!==O.i&&R(I,O)){var V=He(I,O);return I=F(I,I.next),V=F(V,V.next),_e(I,w,x,C,P,b,0),void _e(V,w,x,C,P,b,0)}O=O.next}I=I.next}while(I!==y)}function ge(y,w){return y.x-w.x}function le(y,w){var x=function Ae(y,w){var I,x=w,C=y.x,P=y.y,b=-1/0;do{if(P<=x.y&&P>=x.next.y&&x.next.y!==x.y){var O=x.x+(P-x.y)*(x.next.x-x.x)/(x.next.y-x.y);if(O<=C&&O>b&&(b=O,I=x.x<x.next.x?x:x.next,O===C))return I}x=x.next}while(x!==w);if(!I)return null;var oe,V=I,W=I.x,H=I.y,q=1/0;x=I;do{C>=x.x&&x.x>=W&&C!==x.x&&fe(P<H?C:b,P,W,H,P<H?b:C,P,x.x,x.y)&&(oe=Math.abs(P-x.y)/(C-x.x),K(x,y)&&(oe<q||oe===q&&(x.x>I.x||x.x===I.x&&xe(I,x)))&&(I=x,q=oe)),x=x.next}while(x!==V);return I}(y,w);if(!x)return w;var C=He(x,y);return F(C,C.next),F(x,x.next)}function xe(y,w){return S(y.prev,y,w.prev)<0&&S(w.next,y,y.next)<0}function L(y,w,x,C,P){return(y=1431655765&((y=858993459&((y=252645135&((y=16711935&((y=(y-x)*P|0)|y<<8))|y<<4))|y<<2))|y<<1))|(w=1431655765&((w=858993459&((w=252645135&((w=16711935&((w=(w-C)*P|0)|w<<8))|w<<4))|w<<2))|w<<1))<<1}function be(y){var w=y,x=y;do{(w.x<x.x||w.x===x.x&&w.y<x.y)&&(x=w),w=w.next}while(w!==y);return x}function fe(y,w,x,C,P,b,I,O){return(P-I)*(w-O)>=(y-I)*(b-O)&&(y-I)*(C-O)>=(x-I)*(w-O)&&(x-I)*(b-O)>=(P-I)*(C-O)}function R(y,w){return y.next.i!==w.i&&y.prev.i!==w.i&&!function T(y,w){var x=y;do{if(x.i!==y.i&&x.next.i!==y.i&&x.i!==w.i&&x.next.i!==w.i&&k(x,x.next,y,w))return!0;x=x.next}while(x!==y);return!1}(y,w)&&(K(y,w)&&K(w,y)&&function E(y,w){var x=y,C=!1,P=(y.x+w.x)/2,b=(y.y+w.y)/2;do{x.y>b!=x.next.y>b&&x.next.y!==x.y&&P<(x.next.x-x.x)*(b-x.y)/(x.next.y-x.y)+x.x&&(C=!C),x=x.next}while(x!==y);return C}(y,w)&&(S(y.prev,y,w.prev)||S(y,w.prev,w))||B(y,w)&&S(y.prev,y,y.next)>0&&S(w.prev,w,w.next)>0)}function S(y,w,x){return(w.y-y.y)*(x.x-w.x)-(w.x-y.x)*(x.y-w.y)}function B(y,w){return y.x===w.x&&y.y===w.y}function k(y,w,x,C){var P=G(S(y,w,x)),b=G(S(y,w,C)),I=G(S(x,C,y)),O=G(S(x,C,w));return!!(P!==b&&I!==O||0===P&&z(y,x,w)||0===b&&z(y,C,w)||0===I&&z(x,y,C)||0===O&&z(x,w,C))}function z(y,w,x){return w.x<=Math.max(y.x,x.x)&&w.x>=Math.min(y.x,x.x)&&w.y<=Math.max(y.y,x.y)&&w.y>=Math.min(y.y,x.y)}function G(y){return y>0?1:y<0?-1:0}function K(y,w){return S(y.prev,y,y.next)<0?S(y,w,y.next)>=0&&S(y,y.prev,w)>=0:S(y,w,y.prev)<0||S(y,y.next,w)<0}function He(y,w){var x=new Pe(y.i,y.x,y.y),C=new Pe(w.i,w.x,w.y),P=y.next,b=w.prev;return y.next=w,w.prev=y,x.next=P,P.prev=x,C.next=x,x.prev=C,b.next=C,C.prev=b,C}function Oe(y,w,x,C){var P=new Pe(y,w,x);return C?(P.next=C.next,P.prev=C,C.next.prev=P,C.next=P):(P.prev=P,P.next=P),P}function rt(y){y.next.prev=y.prev,y.prev.next=y.next,y.prevZ&&(y.prevZ.nextZ=y.nextZ),y.nextZ&&(y.nextZ.prevZ=y.prevZ)}function Pe(y,w,x){this.i=y,this.x=w,this.y=x,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function j(y,w,x,C){for(var P=0,b=w,I=x-C;b<x;b+=C)P+=(y[I]-y[b])*(y[b+1]+y[I+1]),I=b;return P}Re.exports=et,Re.exports.default=et,et.deviation=function(y,w,x,C){var P=w&&w.length,I=Math.abs(j(y,0,P?w[0]*x:y.length,x));if(P)for(var O=0,V=w.length;O<V;O++)I-=Math.abs(j(y,w[O]*x,O<V-1?w[O+1]*x:y.length,x));var q=0;for(O=0;O<C.length;O+=3){var oe=C[O]*x,Ce=C[O+1]*x,Te=C[O+2]*x;q+=Math.abs((y[oe]-y[Te])*(y[Ce+1]-y[oe+1])-(y[oe]-y[Ce])*(y[Te+1]-y[oe+1]))}return 0===I&&0===q?0:Math.abs((q-I)/I)},et.flatten=function(y){for(var w=y[0][0].length,x={vertices:[],holes:[],dimensions:w},C=0,P=0;P<y.length;P++){for(var b=0;b<y[P].length;b++)for(var I=0;I<w;I++)x.vertices.push(y[P][b][I]);P>0&&x.holes.push(C+=y[P-1].length)}return x}},472:Re=>{"use strict";var et=Object.prototype.hasOwnProperty,re="~";function F(){}function _e(ae,ne,ge){this.fn=ae,this.context=ne,this.once=ge||!1}function we(ae,ne,ge,le,Ae){if("function"!=typeof ge)throw new TypeError("The listener must be a function");var xe=new _e(ge,le||ae,Ae),se=re?re+ne:ne;return ae._events[se]?ae._events[se].fn?ae._events[se]=[ae._events[se],xe]:ae._events[se].push(xe):(ae._events[se]=xe,ae._eventsCount++),ae}function ve(ae,ne){0==--ae._eventsCount?ae._events=new F:delete ae._events[ne]}function ie(){this._events=new F,this._eventsCount=0}Object.create&&(F.prototype=Object.create(null),(new F).__proto__||(re=!1)),ie.prototype.eventNames=function(){var ge,le,ne=[];if(0===this._eventsCount)return ne;for(le in ge=this._events)et.call(ge,le)&&ne.push(re?le.slice(1):le);return Object.getOwnPropertySymbols?ne.concat(Object.getOwnPropertySymbols(ge)):ne},ie.prototype.listeners=function(ne){var le=this._events[re?re+ne:ne];if(!le)return[];if(le.fn)return[le.fn];for(var Ae=0,xe=le.length,se=new Array(xe);Ae<xe;Ae++)se[Ae]=le[Ae].fn;return se},ie.prototype.listenerCount=function(ne){var le=this._events[re?re+ne:ne];return le?le.fn?1:le.length:0},ie.prototype.emit=function(ne,ge,le,Ae,xe,se){var Ee=re?re+ne:ne;if(!this._events[Ee])return!1;var fe,R,L=this._events[Ee],be=arguments.length;if(L.fn){switch(L.once&&this.removeListener(ne,L.fn,void 0,!0),be){case 1:return L.fn.call(L.context),!0;case 2:return L.fn.call(L.context,ge),!0;case 3:return L.fn.call(L.context,ge,le),!0;case 4:return L.fn.call(L.context,ge,le,Ae),!0;case 5:return L.fn.call(L.context,ge,le,Ae,xe),!0;case 6:return L.fn.call(L.context,ge,le,Ae,xe,se),!0}for(R=1,fe=new Array(be-1);R<be;R++)fe[R-1]=arguments[R];L.fn.apply(L.context,fe)}else{var B,S=L.length;for(R=0;R<S;R++)switch(L[R].once&&this.removeListener(ne,L[R].fn,void 0,!0),be){case 1:L[R].fn.call(L[R].context);break;case 2:L[R].fn.call(L[R].context,ge);break;case 3:L[R].fn.call(L[R].context,ge,le);break;case 4:L[R].fn.call(L[R].context,ge,le,Ae);break;default:if(!fe)for(B=1,fe=new Array(be-1);B<be;B++)fe[B-1]=arguments[B];L[R].fn.apply(L[R].context,fe)}}return!0},ie.prototype.on=function(ne,ge,le){return we(this,ne,ge,le,!1)},ie.prototype.once=function(ne,ge,le){return we(this,ne,ge,le,!0)},ie.prototype.removeListener=function(ne,ge,le,Ae){var xe=re?re+ne:ne;if(!this._events[xe])return this;if(!ge)return ve(this,xe),this;var se=this._events[xe];if(se.fn)se.fn===ge&&(!Ae||se.once)&&(!le||se.context===le)&&ve(this,xe);else{for(var Ee=0,L=[],be=se.length;Ee<be;Ee++)(se[Ee].fn!==ge||Ae&&!se[Ee].once||le&&se[Ee].context!==le)&&L.push(se[Ee]);L.length?this._events[xe]=1===L.length?L[0]:L:ve(this,xe)}return this},ie.prototype.removeAllListeners=function(ne){var ge;return ne?this._events[ge=re?re+ne:ne]&&ve(this,ge):(this._events=new F,this._eventsCount=0),this},ie.prototype.off=ie.prototype.removeListener,ie.prototype.addListener=ie.prototype.on,ie.prefixed=re,ie.EventEmitter=ie,Re.exports=ie},238:Re=>{"use strict";var re=Array.prototype.slice,F=Object.prototype.toString;Re.exports=function(ve){var ie=this;if("function"!=typeof ie||"[object Function]"!==F.call(ie))throw new TypeError("Function.prototype.bind called on incompatible "+ie);for(var ne,ae=re.call(arguments,1),le=Math.max(0,ie.length-ae.length),Ae=[],xe=0;xe<le;xe++)Ae.push("$"+xe);if(ne=Function("binder","return function ("+Ae.join(",")+"){ return binder.apply(this,arguments); }")(function(){if(this instanceof ne){var Ee=ie.apply(this,ae.concat(re.call(arguments)));return Object(Ee)===Ee?Ee:this}return ie.apply(ve,ae.concat(re.call(arguments)))}),ie.prototype){var se=function(){};se.prototype=ie.prototype,ne.prototype=new se,se.prototype=null}return ne}},333:(Re,et,re)=>{"use strict";var F=re(238);Re.exports=Function.prototype.bind||F},491:(Re,et,re)=>{"use strict";var F,_e=SyntaxError,we=Function,ve=TypeError,ie=function(Pe){try{return we('"use strict"; return ('+Pe+").constructor;")()}catch{}},ae=Object.getOwnPropertyDescriptor;if(ae)try{ae({},"")}catch{ae=null}var ne=function(){throw new ve},ge=ae?function(){try{return ne}catch{try{return ae(arguments,"callee").get}catch{return ne}}}():ne,le=re(152)(),Ae=re(28)(),xe=Object.getPrototypeOf||(Ae?function(Pe){return Pe.__proto__}:null),se={},Ee=typeof Uint8Array>"u"||!xe?F:xe(Uint8Array),L={"%AggregateError%":typeof AggregateError>"u"?F:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?F:ArrayBuffer,"%ArrayIteratorPrototype%":le&&xe?xe([][Symbol.iterator]()):F,"%AsyncFromSyncIteratorPrototype%":F,"%AsyncFunction%":se,"%AsyncGenerator%":se,"%AsyncGeneratorFunction%":se,"%AsyncIteratorPrototype%":se,"%Atomics%":typeof Atomics>"u"?F:Atomics,"%BigInt%":typeof BigInt>"u"?F:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?F:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?F:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?F:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":typeof Float32Array>"u"?F:Float32Array,"%Float64Array%":typeof Float64Array>"u"?F:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?F:FinalizationRegistry,"%Function%":we,"%GeneratorFunction%":se,"%Int8Array%":typeof Int8Array>"u"?F:Int8Array,"%Int16Array%":typeof Int16Array>"u"?F:Int16Array,"%Int32Array%":typeof Int32Array>"u"?F:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":le&&xe?xe(xe([][Symbol.iterator]())):F,"%JSON%":"object"==typeof JSON?JSON:F,"%Map%":typeof Map>"u"?F:Map,"%MapIteratorPrototype%":typeof Map>"u"||!le||!xe?F:xe((new Map)[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?F:Promise,"%Proxy%":typeof Proxy>"u"?F:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":typeof Reflect>"u"?F:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?F:Set,"%SetIteratorPrototype%":typeof Set>"u"||!le||!xe?F:xe((new Set)[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?F:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":le&&xe?xe(""[Symbol.iterator]()):F,"%Symbol%":le?Symbol:F,"%SyntaxError%":_e,"%ThrowTypeError%":ge,"%TypedArray%":Ee,"%TypeError%":ve,"%Uint8Array%":typeof Uint8Array>"u"?F:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?F:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?F:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?F:Uint32Array,"%URIError%":URIError,"%WeakMap%":typeof WeakMap>"u"?F:WeakMap,"%WeakRef%":typeof WeakRef>"u"?F:WeakRef,"%WeakSet%":typeof WeakSet>"u"?F:WeakSet};if(xe)try{null.error}catch(Pe){var be=xe(xe(Pe));L["%Error.prototype%"]=be}var fe=function Pe(j){var y;if("%AsyncFunction%"===j)y=ie("async function () {}");else if("%GeneratorFunction%"===j)y=ie("function* () {}");else if("%AsyncGeneratorFunction%"===j)y=ie("async function* () {}");else if("%AsyncGenerator%"===j){var w=Pe("%AsyncGeneratorFunction%");w&&(y=w.prototype)}else if("%AsyncIteratorPrototype%"===j){var x=Pe("%AsyncGenerator%");x&&xe&&(y=xe(x.prototype))}return L[j]=y,y},R={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},S=re(333),B=re(533),k=S.call(Function.call,Array.prototype.concat),z=S.call(Function.apply,Array.prototype.splice),G=S.call(Function.call,String.prototype.replace),T=S.call(Function.call,String.prototype.slice),K=S.call(Function.call,RegExp.prototype.exec),E=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,He=/\\(\\)?/g,rt=function(j,y){var x,w=j;if(B(R,w)&&(w="%"+(x=R[w])[0]+"%"),B(L,w)){var C=L[w];if(C===se&&(C=fe(w)),typeof C>"u"&&!y)throw new ve("intrinsic "+j+" exists, but is not available. Please file an issue!");return{alias:x,name:w,value:C}}throw new _e("intrinsic "+j+" does not exist!")};Re.exports=function(j,y){if("string"!=typeof j||0===j.length)throw new ve("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof y)throw new ve('"allowMissing" argument must be a boolean');if(null===K(/^%?[^%]*%?$/,j))throw new _e("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var w=function(j){var y=T(j,0,1),w=T(j,-1);if("%"===y&&"%"!==w)throw new _e("invalid intrinsic syntax, expected closing `%`");if("%"===w&&"%"!==y)throw new _e("invalid intrinsic syntax, expected opening `%`");var x=[];return G(j,E,function(C,P,b,I){x[x.length]=b?G(I,He,"$1"):P||C}),x}(j),x=w.length>0?w[0]:"",C=rt("%"+x+"%",y),P=C.name,b=C.value,I=!1,O=C.alias;O&&(x=O[0],z(w,k([0,1],O)));for(var V=1,W=!0;V<w.length;V+=1){var H=w[V],q=T(H,0,1),oe=T(H,-1);if(('"'===q||"'"===q||"`"===q||'"'===oe||"'"===oe||"`"===oe)&&q!==oe)throw new _e("property names with quotes must have matching quotes");if(("constructor"===H||!W)&&(I=!0),B(L,P="%"+(x+="."+H)+"%"))b=L[P];else if(null!=b){if(!(H in b)){if(!y)throw new ve("base intrinsic for "+j+" exists, but the property is not available.");return}if(ae&&V+1>=w.length){var Ce=ae(b,H);b=(W=!!Ce)&&"get"in Ce&&!("originalValue"in Ce.get)?Ce.get:b[H]}else W=B(b,H),b=b[H];W&&!I&&(L[P]=b)}}return b}},28:Re=>{"use strict";var et={foo:{}},re=Object;Re.exports=function(){return{__proto__:et}.foo===et.foo&&!({__proto__:null}instanceof re)}},152:(Re,et,re)=>{"use strict";var F=typeof Symbol<"u"&&Symbol,_e=re(441);Re.exports=function(){return"function"==typeof F&&"function"==typeof Symbol&&"symbol"==typeof F("foo")&&"symbol"==typeof Symbol("bar")&&_e()}},441:Re=>{"use strict";Re.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var re={},F=Symbol("test"),_e=Object(F);if("string"==typeof F||"[object Symbol]"!==Object.prototype.toString.call(F)||"[object Symbol]"!==Object.prototype.toString.call(_e))return!1;for(F in re[F]=42,re)return!1;if("function"==typeof Object.keys&&0!==Object.keys(re).length||"function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(re).length)return!1;var ve=Object.getOwnPropertySymbols(re);if(1!==ve.length||ve[0]!==F||!Object.prototype.propertyIsEnumerable.call(re,F))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var ie=Object.getOwnPropertyDescriptor(re,F);if(42!==ie.value||!0!==ie.enumerable)return!1}return!0}},533:(Re,et,re)=>{"use strict";var F=re(333);Re.exports=F.call(Function.call,Object.prototype.hasOwnProperty)},826:(Re,et,re)=>{var F="function"==typeof Map&&Map.prototype,_e=Object.getOwnPropertyDescriptor&&F?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,we=F&&_e&&"function"==typeof _e.get?_e.get:null,ve=F&&Map.prototype.forEach,ie="function"==typeof Set&&Set.prototype,ae=Object.getOwnPropertyDescriptor&&ie?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,ne=ie&&ae&&"function"==typeof ae.get?ae.get:null,ge=ie&&Set.prototype.forEach,Ae="function"==typeof WeakMap&&WeakMap.prototype?WeakMap.prototype.has:null,se="function"==typeof WeakSet&&WeakSet.prototype?WeakSet.prototype.has:null,L="function"==typeof WeakRef&&WeakRef.prototype?WeakRef.prototype.deref:null,be=Boolean.prototype.valueOf,fe=Object.prototype.toString,R=Function.prototype.toString,S=String.prototype.match,B=String.prototype.slice,k=String.prototype.replace,z=String.prototype.toUpperCase,G=String.prototype.toLowerCase,T=RegExp.prototype.test,K=Array.prototype.concat,E=Array.prototype.join,He=Array.prototype.slice,Oe=Math.floor,rt="function"==typeof BigInt?BigInt.prototype.valueOf:null,Pe=Object.getOwnPropertySymbols,j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?Symbol.prototype.toString:null,y="function"==typeof Symbol&&"object"==typeof Symbol.iterator,w="function"==typeof Symbol&&Symbol.toStringTag&&(Symbol,1)?Symbol.toStringTag:null,x=Object.prototype.propertyIsEnumerable,C=("function"==typeof Reflect?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(M){return M.__proto__}:null);function P(M,N){if(M===1/0||M===-1/0||M!=M||M&&M>-1e3&&M<1e3||T.call(/e/,N))return N;var ht=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if("number"==typeof M){var vt=M<0?-Oe(-M):Oe(M);if(vt!==M){var Ft=String(vt),Je=B.call(N,Ft.length+1);return k.call(Ft,ht,"$&_")+"."+k.call(k.call(Je,/([0-9]{3})/g,"$&_"),/_$/,"")}}return k.call(N,ht,"$&_")}var b=re(654),I=b.custom,O=Ze(I)?I:null;function V(M,N,ht){var vt="double"===(ht.quoteStyle||N)?'"':"'";return vt+M+vt}function W(M){return k.call(String(M),/"/g,"&quot;")}function H(M){return!("[object Array]"!==Nt(M)||w&&"object"==typeof M&&w in M)}function oe(M){return!("[object RegExp]"!==Nt(M)||w&&"object"==typeof M&&w in M)}function Ze(M){if(y)return M&&"object"==typeof M&&M instanceof Symbol;if("symbol"==typeof M)return!0;if(!M||"object"!=typeof M||!j)return!1;try{return j.call(M),!0}catch{}return!1}Re.exports=function M(N,ht,vt,Ft){var Je=ht||{};if(Ie(Je,"quoteStyle")&&"single"!==Je.quoteStyle&&"double"!==Je.quoteStyle)throw new TypeError('option "quoteStyle" must be "single" or "double"');if(Ie(Je,"maxStringLength")&&("number"==typeof Je.maxStringLength?Je.maxStringLength<0&&Je.maxStringLength!==1/0:null!==Je.maxStringLength))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var Tr=!Ie(Je,"customInspect")||Je.customInspect;if("boolean"!=typeof Tr&&"symbol"!==Tr)throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(Ie(Je,"indent")&&null!==Je.indent&&"\t"!==Je.indent&&!(parseInt(Je.indent,10)===Je.indent&&Je.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(Ie(Je,"numericSeparator")&&"boolean"!=typeof Je.numericSeparator)throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var Zr=Je.numericSeparator;if(typeof N>"u")return"undefined";if(null===N)return"null";if("boolean"==typeof N)return N?"true":"false";if("string"==typeof N)return ws(N,Je);if("number"==typeof N){if(0===N)return 1/0/N>0?"0":"-0";var gn=String(N);return Zr?P(N,gn):gn}if("bigint"==typeof N){var Cr=String(N)+"n";return Zr?P(N,Cr):Cr}var vl=typeof Je.depth>"u"?5:Je.depth;if(typeof vt>"u"&&(vt=0),vt>=vl&&vl>0&&"object"==typeof N)return H(N)?"[Array]":"[Object]";var Kr=function _l(M,N){var ht;if("\t"===M.indent)ht="\t";else{if(!("number"==typeof M.indent&&M.indent>0))return null;ht=E.call(Array(M.indent+1)," ")}return{base:ht,prev:E.call(Array(N+1),ht)}}(Je,vt);if(typeof Ft>"u")Ft=[];else if(Li(Ft,N)>=0)return"[Circular]";function Dn(mn,Ss,El){if(Ss&&(Ft=He.call(Ft)).push(Ss),El){var bl={depth:Je.depth};return Ie(Je,"quoteStyle")&&(bl.quoteStyle=Je.quoteStyle),M(mn,bl,vt+1,Ft)}return M(mn,Je,vt+1,Ft)}if("function"==typeof N&&!oe(N)){var Lo=function xs(M){if(M.name)return M.name;var N=S.call(R.call(M),/^function\s*([\w$]+)/);return N?N[1]:null}(N),Bo=Ui(N,Dn);return"[Function"+(Lo?": "+Lo:" (anonymous)")+"]"+(Bo.length>0?" { "+E.call(Bo,", ")+" }":"")}if(Ze(N)){var ko=y?k.call(String(N),/^(Symbol\(.*\))_[^)]*$/,"$1"):j.call(N);return"object"!=typeof N||y?ko:ki(ko)}if(function fh(M){return!(!M||"object"!=typeof M)&&(typeof HTMLElement<"u"&&M instanceof HTMLElement||"string"==typeof M.nodeName&&"function"==typeof M.getAttribute)}(N)){for(var Hi="<"+G.call(String(N.nodeName)),Es=N.attributes||[],Vi=0;Vi<Es.length;Vi++)Hi+=" "+Es[Vi].name+"="+V(W(Es[Vi].value),"double",Je);return Hi+=">",N.childNodes&&N.childNodes.length&&(Hi+="..."),Hi+"</"+G.call(String(N.nodeName))+">"}if(H(N)){if(0===N.length)return"[]";var bs=Ui(N,Dn);return Kr&&!function Sr(M){for(var N=0;N<M.length;N++)if(Li(M[N],"\n")>=0)return!1;return!0}(bs)?"["+Oo(bs,Kr)+"]":"[ "+E.call(bs,", ")+" ]"}if(function Ce(M){return!("[object Error]"!==Nt(M)||w&&"object"==typeof M&&w in M)}(N)){var Ds=Ui(N,Dn);return"cause"in Error.prototype||!("cause"in N)||x.call(N,"cause")?0===Ds.length?"["+String(N)+"]":"{ ["+String(N)+"] "+E.call(Ds,", ")+" }":"{ ["+String(N)+"] "+E.call(K.call("[cause]: "+Dn(N.cause),Ds),", ")+" }"}if("object"==typeof N&&Tr){if(O&&"function"==typeof N[O]&&b)return b(N,{depth:vl-vt});if("symbol"!==Tr&&"function"==typeof N.inspect)return N.inspect()}if(function Bi(M){if(!we||!M||"object"!=typeof M)return!1;try{we.call(M);try{ne.call(M)}catch{return!0}return M instanceof Map}catch{}return!1}(N)){var Wn=[];return ve&&ve.call(N,function(mn,Ss){Wn.push(Dn(Ss,N,!0)+" => "+Dn(mn,N))}),yl("Map",we.call(N),Wn,Kr)}if(function dh(M){if(!ne||!M||"object"!=typeof M)return!1;try{ne.call(M);try{we.call(M)}catch{return!0}return M instanceof Set}catch{}return!1}(N)){var xl=[];return ge&&ge.call(N,function(mn){xl.push(Dn(mn,N))}),yl("Set",ne.call(N),xl,Kr)}if(function Po(M){if(!Ae||!M||"object"!=typeof M)return!1;try{Ae.call(M,Ae);try{se.call(M,se)}catch{return!0}return M instanceof WeakMap}catch{}return!1}(N))return Fo("WeakMap");if(function No(M){if(!se||!M||"object"!=typeof M)return!1;try{se.call(M,se);try{Ae.call(M,Ae)}catch{return!0}return M instanceof WeakSet}catch{}return!1}(N))return Fo("WeakSet");if(function gl(M){if(!L||!M||"object"!=typeof M)return!1;try{return L.call(M),!0}catch{}return!1}(N))return Fo("WeakRef");if(function _t(M){return!("[object Number]"!==Nt(M)||w&&"object"==typeof M&&w in M)}(N))return ki(Dn(Number(N)));if(function wt(M){if(!M||"object"!=typeof M||!rt)return!1;try{return rt.call(M),!0}catch{}return!1}(N))return ki(Dn(rt.call(N)));if(function tt(M){return!("[object Boolean]"!==Nt(M)||w&&"object"==typeof M&&w in M)}(N))return ki(be.call(N));if(function Te(M){return!("[object String]"!==Nt(M)||w&&"object"==typeof M&&w in M)}(N))return ki(Dn(String(N)));if(!function q(M){return!("[object Date]"!==Nt(M)||w&&"object"==typeof M&&w in M)}(N)&&!oe(N)){var Uo=Ui(N,Dn),wl=C?C(N)===Object.prototype:N instanceof Object||N.constructor===Object,Ho=N instanceof Object?"":"null prototype",Vo=!wl&&w&&Object(N)===N&&w in N?B.call(Nt(N),8,-1):Ho?"Object":"",Go=(wl||"function"!=typeof N.constructor?"":N.constructor.name?N.constructor.name+" ":"")+(Vo||Ho?"["+E.call(K.call([],Vo||[],Ho||[]),": ")+"] ":"");return 0===Uo.length?Go+"{}":Kr?Go+"{"+Oo(Uo,Kr)+"}":Go+"{ "+E.call(Uo,", ")+" }"}return String(N)};var Fe=Object.prototype.hasOwnProperty||function(M){return M in this};function Ie(M,N){return Fe.call(M,N)}function Nt(M){return fe.call(M)}function Li(M,N){if(M.indexOf)return M.indexOf(N);for(var ht=0,vt=M.length;ht<vt;ht++)if(M[ht]===N)return ht;return-1}function ws(M,N){if(M.length>N.maxStringLength){var ht=M.length-N.maxStringLength,vt="... "+ht+" more character"+(ht>1?"s":"");return ws(B.call(M,0,N.maxStringLength),N)+vt}return V(k.call(k.call(M,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,ml),"single",N)}function ml(M){var N=M.charCodeAt(0),ht={8:"b",9:"t",10:"n",12:"f",13:"r"}[N];return ht?"\\"+ht:"\\x"+(N<16?"0":"")+z.call(N.toString(16))}function ki(M){return"Object("+M+")"}function Fo(M){return M+" { ? }"}function yl(M,N,ht,vt){return M+" ("+N+") {"+(vt?Oo(ht,vt):E.call(ht,", "))+"}"}function Oo(M,N){if(0===M.length)return"";var ht="\n"+N.prev+N.base;return ht+E.call(M,","+ht)+"\n"+N.prev}function Ui(M,N){var ht=H(M),vt=[];if(ht){vt.length=M.length;for(var Ft=0;Ft<M.length;Ft++)vt[Ft]=Ie(M,Ft)?N(M[Ft],M):""}var Tr,Je="function"==typeof Pe?Pe(M):[];if(y){Tr={};for(var Zr=0;Zr<Je.length;Zr++)Tr["$"+Je[Zr]]=Je[Zr]}for(var gn in M)Ie(M,gn)&&(ht&&String(Number(gn))===gn&&gn<M.length||y&&Tr["$"+gn]instanceof Symbol||(T.call(/[^\w$]/,gn)?vt.push(N(gn,M)+": "+N(M[gn],M)):vt.push(gn+": "+N(M[gn],M))));if("function"==typeof Pe)for(var Cr=0;Cr<Je.length;Cr++)x.call(M,Je[Cr])&&vt.push("["+N(Je[Cr])+"]: "+N(M[Je[Cr]],M));return vt}},439:Re=>{"use strict";var et=String.prototype.replace,re=/%20/g;Re.exports={default:"RFC3986",formatters:{RFC1738:function(_e){return et.call(_e,re,"+")},RFC3986:function(_e){return String(_e)}},RFC1738:"RFC1738",RFC3986:"RFC3986"}},956:(Re,et,re)=>{"use strict";var F=re(562),_e=re(625),we=re(439);Re.exports={formats:we,parse:_e,stringify:F}},625:(Re,et,re)=>{"use strict";var F=re(978),_e=Object.prototype.hasOwnProperty,we=Array.isArray,ve={allowDots:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:F.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},ae=function(Ee,L){return Ee&&"string"==typeof Ee&&L.comma&&Ee.indexOf(",")>-1?Ee.split(","):Ee},xe=function(L,be,fe,R){if(L){var S=fe.allowDots?L.replace(/\.([^.[]+)/g,"[$1]"):L,k=/(\[[^[\]]*])/g,z=fe.depth>0&&/(\[[^[\]]*])/.exec(S),G=z?S.slice(0,z.index):S,T=[];if(G){if(!fe.plainObjects&&_e.call(Object.prototype,G)&&!fe.allowPrototypes)return;T.push(G)}for(var K=0;fe.depth>0&&null!==(z=k.exec(S))&&K<fe.depth;){if(K+=1,!fe.plainObjects&&_e.call(Object.prototype,z[1].slice(1,-1))&&!fe.allowPrototypes)return;T.push(z[1])}return z&&T.push("["+S.slice(z.index)+"]"),function(Ee,L,be,fe){for(var R=fe?L:ae(L,be),S=Ee.length-1;S>=0;--S){var B,k=Ee[S];if("[]"===k&&be.parseArrays)B=[].concat(R);else{B=be.plainObjects?Object.create(null):{};var z="["===k.charAt(0)&&"]"===k.charAt(k.length-1)?k.slice(1,-1):k,G=parseInt(z,10);be.parseArrays||""!==z?!isNaN(G)&&k!==z&&String(G)===z&&G>=0&&be.parseArrays&&G<=be.arrayLimit?(B=[])[G]=R:"__proto__"!==z&&(B[z]=R):B={0:R}}R=B}return R}(T,be,fe,R)}};Re.exports=function(Ee,L){var be=function(L){if(!L)return ve;if(null!=L.decoder&&"function"!=typeof L.decoder)throw new TypeError("Decoder has to be a function.");if(typeof L.charset<"u"&&"utf-8"!==L.charset&&"iso-8859-1"!==L.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");return{allowDots:typeof L.allowDots>"u"?ve.allowDots:!!L.allowDots,allowPrototypes:"boolean"==typeof L.allowPrototypes?L.allowPrototypes:ve.allowPrototypes,allowSparse:"boolean"==typeof L.allowSparse?L.allowSparse:ve.allowSparse,arrayLimit:"number"==typeof L.arrayLimit?L.arrayLimit:ve.arrayLimit,charset:typeof L.charset>"u"?ve.charset:L.charset,charsetSentinel:"boolean"==typeof L.charsetSentinel?L.charsetSentinel:ve.charsetSentinel,comma:"boolean"==typeof L.comma?L.comma:ve.comma,decoder:"function"==typeof L.decoder?L.decoder:ve.decoder,delimiter:"string"==typeof L.delimiter||F.isRegExp(L.delimiter)?L.delimiter:ve.delimiter,depth:"number"==typeof L.depth||!1===L.depth?+L.depth:ve.depth,ignoreQueryPrefix:!0===L.ignoreQueryPrefix,interpretNumericEntities:"boolean"==typeof L.interpretNumericEntities?L.interpretNumericEntities:ve.interpretNumericEntities,parameterLimit:"number"==typeof L.parameterLimit?L.parameterLimit:ve.parameterLimit,parseArrays:!1!==L.parseArrays,plainObjects:"boolean"==typeof L.plainObjects?L.plainObjects:ve.plainObjects,strictNullHandling:"boolean"==typeof L.strictNullHandling?L.strictNullHandling:ve.strictNullHandling}}(L);if(""===Ee||null===Ee||typeof Ee>"u")return be.plainObjects?Object.create(null):{};for(var fe="string"==typeof Ee?function(L,be){var z,fe={},B=(be.ignoreQueryPrefix?L.replace(/^\?/,""):L).split(be.delimiter,be.parameterLimit===1/0?void 0:be.parameterLimit),k=-1,G=be.charset;if(be.charsetSentinel)for(z=0;z<B.length;++z)0===B[z].indexOf("utf8=")&&("utf8=%E2%9C%93"===B[z]?G="utf-8":"utf8=%26%2310003%3B"===B[z]&&(G="iso-8859-1"),k=z,z=B.length);for(z=0;z<B.length;++z)if(z!==k){var He,Oe,T=B[z],K=T.indexOf("]="),E=-1===K?T.indexOf("="):K+1;-1===E?(He=be.decoder(T,ve.decoder,G,"key"),Oe=be.strictNullHandling?null:""):(He=be.decoder(T.slice(0,E),ve.decoder,G,"key"),Oe=F.maybeMap(ae(T.slice(E+1),be),function(rt){return be.decoder(rt,ve.decoder,G,"value")})),Oe&&be.interpretNumericEntities&&"iso-8859-1"===G&&(Oe=Oe.replace(/&#(\d+);/g,function(L,be){return String.fromCharCode(parseInt(be,10))})),T.indexOf("[]=")>-1&&(Oe=we(Oe)?[Oe]:Oe),fe[He]=_e.call(fe,He)?F.combine(fe[He],Oe):Oe}return fe}(Ee,be):Ee,R=be.plainObjects?Object.create(null):{},S=Object.keys(fe),B=0;B<S.length;++B){var k=S[B],z=xe(k,fe[k],be,"string"==typeof Ee);R=F.merge(R,z,be)}return!0===be.allowSparse?R:F.compact(R)}},562:(Re,et,re)=>{"use strict";var F=re(379),_e=re(978),we=re(439),ve=Object.prototype.hasOwnProperty,ie={brackets:function(S){return S+"[]"},comma:"comma",indices:function(S,B){return S+"["+B+"]"},repeat:function(S){return S}},ae=Array.isArray,ne=String.prototype.split,ge=Array.prototype.push,le=function(R,S){ge.apply(R,ae(S)?S:[S])},Ae=Date.prototype.toISOString,xe=we.default,se={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:_e.encode,encodeValuesOnly:!1,format:xe,formatter:we.formatters[xe],indices:!1,serializeDate:function(S){return Ae.call(S)},skipNulls:!1,strictNullHandling:!1},L={},be=function R(S,B,k,z,G,T,K,E,He,Oe,rt,Pe,j,y,w,x){for(var C=S,P=x,b=0,I=!1;void 0!==(P=P.get(L))&&!I;){var O=P.get(S);if(b+=1,typeof O<"u"){if(O===b)throw new RangeError("Cyclic object value");I=!0}typeof P.get(L)>"u"&&(b=0)}if("function"==typeof E?C=E(B,C):C instanceof Date?C=rt(C):"comma"===k&&ae(C)&&(C=_e.maybeMap(C,function(Nt){return Nt instanceof Date?rt(Nt):Nt})),null===C){if(G)return K&&!y?K(B,se.encoder,w,"key",Pe):B;C=""}if(function(S){return"string"==typeof S||"number"==typeof S||"boolean"==typeof S||"symbol"==typeof S||"bigint"==typeof S}(C)||_e.isBuffer(C)){if(K){var V=y?B:K(B,se.encoder,w,"key",Pe);if("comma"===k&&y){for(var W=ne.call(String(C),","),H="",q=0;q<W.length;++q)H+=(0===q?"":",")+j(K(W[q],se.encoder,w,"value",Pe));return[j(V)+(z&&ae(C)&&1===W.length?"[]":"")+"="+H]}return[j(V)+"="+j(K(C,se.encoder,w,"value",Pe))]}return[j(B)+"="+j(String(C))]}var Ce,oe=[];if(typeof C>"u")return oe;if("comma"===k&&ae(C))Ce=[{value:C.length>0?C.join(",")||null:void 0}];else if(ae(E))Ce=E;else{var Te=Object.keys(C);Ce=He?Te.sort(He):Te}for(var _t=z&&ae(C)&&1===C.length?B+"[]":B,tt=0;tt<Ce.length;++tt){var Ze=Ce[tt],wt="object"==typeof Ze&&typeof Ze.value<"u"?Ze.value:C[Ze];if(!T||null!==wt){var Fe=ae(C)?"function"==typeof k?k(_t,Ze):_t:_t+(Oe?"."+Ze:"["+Ze+"]");x.set(S,b);var Ie=F();Ie.set(L,x),le(oe,R(wt,Fe,k,z,G,T,K,E,He,Oe,rt,Pe,j,y,w,Ie))}}return oe};Re.exports=function(R,S){var z,B=R,k=function(S){if(!S)return se;if(null!==S.encoder&&typeof S.encoder<"u"&&"function"!=typeof S.encoder)throw new TypeError("Encoder has to be a function.");var B=S.charset||se.charset;if(typeof S.charset<"u"&&"utf-8"!==S.charset&&"iso-8859-1"!==S.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var k=we.default;if(typeof S.format<"u"){if(!ve.call(we.formatters,S.format))throw new TypeError("Unknown format option provided.");k=S.format}var z=we.formatters[k],G=se.filter;return("function"==typeof S.filter||ae(S.filter))&&(G=S.filter),{addQueryPrefix:"boolean"==typeof S.addQueryPrefix?S.addQueryPrefix:se.addQueryPrefix,allowDots:typeof S.allowDots>"u"?se.allowDots:!!S.allowDots,charset:B,charsetSentinel:"boolean"==typeof S.charsetSentinel?S.charsetSentinel:se.charsetSentinel,delimiter:typeof S.delimiter>"u"?se.delimiter:S.delimiter,encode:"boolean"==typeof S.encode?S.encode:se.encode,encoder:"function"==typeof S.encoder?S.encoder:se.encoder,encodeValuesOnly:"boolean"==typeof S.encodeValuesOnly?S.encodeValuesOnly:se.encodeValuesOnly,filter:G,format:k,formatter:z,serializeDate:"function"==typeof S.serializeDate?S.serializeDate:se.serializeDate,skipNulls:"boolean"==typeof S.skipNulls?S.skipNulls:se.skipNulls,sort:"function"==typeof S.sort?S.sort:null,strictNullHandling:"boolean"==typeof S.strictNullHandling?S.strictNullHandling:se.strictNullHandling}}(S);"function"==typeof k.filter?B=(0,k.filter)("",B):ae(k.filter)&&(z=k.filter);var T=[];if("object"!=typeof B||null===B)return"";var E=ie[S&&S.arrayFormat in ie?S.arrayFormat:S&&"indices"in S?S.indices?"indices":"repeat":"indices"];if(S&&"commaRoundTrip"in S&&"boolean"!=typeof S.commaRoundTrip)throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var He="comma"===E&&S&&S.commaRoundTrip;z||(z=Object.keys(B)),k.sort&&z.sort(k.sort);for(var Oe=F(),rt=0;rt<z.length;++rt){var Pe=z[rt];k.skipNulls&&null===B[Pe]||le(T,be(B[Pe],Pe,E,He,k.strictNullHandling,k.skipNulls,k.encode?k.encoder:null,k.filter,k.sort,k.allowDots,k.serializeDate,k.format,k.formatter,k.encodeValuesOnly,k.charset,Oe))}var j=T.join(k.delimiter),y=!0===k.addQueryPrefix?"?":"";return k.charsetSentinel&&(y+="iso-8859-1"===k.charset?"utf8=%26%2310003%3B&":"utf8=%E2%9C%93&"),j.length>0?y+j:""}},978:(Re,et,re)=>{"use strict";var F=re(439),_e=Object.prototype.hasOwnProperty,we=Array.isArray,ve=function(){for(var fe=[],R=0;R<256;++R)fe.push("%"+((R<16?"0":"")+R.toString(16)).toUpperCase());return fe}(),ae=function(R,S){for(var B=S&&S.plainObjects?Object.create(null):{},k=0;k<R.length;++k)typeof R[k]<"u"&&(B[k]=R[k]);return B};Re.exports={arrayToObject:ae,assign:function(R,S){return Object.keys(S).reduce(function(B,k){return B[k]=S[k],B},R)},combine:function(R,S){return[].concat(R,S)},compact:function(R){for(var S=[{obj:{o:R},prop:"o"}],B=[],k=0;k<S.length;++k)for(var z=S[k],G=z.obj[z.prop],T=Object.keys(G),K=0;K<T.length;++K){var E=T[K],He=G[E];"object"==typeof He&&null!==He&&-1===B.indexOf(He)&&(S.push({obj:G,prop:E}),B.push(He))}return function(R){for(;R.length>1;){var S=R.pop(),B=S.obj[S.prop];if(we(B)){for(var k=[],z=0;z<B.length;++z)typeof B[z]<"u"&&k.push(B[z]);S.obj[S.prop]=k}}}(S),R},decode:function(fe,R,S){var B=fe.replace(/\+/g," ");if("iso-8859-1"===S)return B.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(B)}catch{return B}},encode:function(R,S,B,k,z){if(0===R.length)return R;var G=R;if("symbol"==typeof R?G=Symbol.prototype.toString.call(R):"string"!=typeof R&&(G=String(R)),"iso-8859-1"===B)return escape(G).replace(/%u[0-9a-f]{4}/gi,function(He){return"%26%23"+parseInt(He.slice(2),16)+"%3B"});for(var T="",K=0;K<G.length;++K){var E=G.charCodeAt(K);45===E||46===E||95===E||126===E||E>=48&&E<=57||E>=65&&E<=90||E>=97&&E<=122||z===F.RFC1738&&(40===E||41===E)?T+=G.charAt(K):E<128?T+=ve[E]:E<2048?T+=ve[192|E>>6]+ve[128|63&E]:E<55296||E>=57344?T+=ve[224|E>>12]+ve[128|E>>6&63]+ve[128|63&E]:(E=65536+((1023&E)<<10|1023&G.charCodeAt(K+=1)),T+=ve[240|E>>18]+ve[128|E>>12&63]+ve[128|E>>6&63]+ve[128|63&E])}return T},isBuffer:function(R){return!(!R||"object"!=typeof R||!(R.constructor&&R.constructor.isBuffer&&R.constructor.isBuffer(R)))},isRegExp:function(R){return"[object RegExp]"===Object.prototype.toString.call(R)},maybeMap:function(R,S){if(we(R)){for(var B=[],k=0;k<R.length;k+=1)B.push(S(R[k]));return B}return S(R)},merge:function fe(R,S,B){if(!S)return R;if("object"!=typeof S){if(we(R))R.push(S);else{if(!R||"object"!=typeof R)return[R,S];(B&&(B.plainObjects||B.allowPrototypes)||!_e.call(Object.prototype,S))&&(R[S]=!0)}return R}if(!R||"object"!=typeof R)return[R].concat(S);var k=R;return we(R)&&!we(S)&&(k=ae(R,B)),we(R)&&we(S)?(S.forEach(function(z,G){if(_e.call(R,G)){var T=R[G];T&&"object"==typeof T&&z&&"object"==typeof z?R[G]=fe(T,z,B):R.push(z)}else R[G]=z}),R):Object.keys(S).reduce(function(z,G){var T=S[G];return z[G]=_e.call(z,G)?fe(z[G],T,B):T,z},k)}}},379:(Re,et,re)=>{"use strict";var F=re(491),_e=re(98),we=re(826),ve=F("%TypeError%"),ie=F("%WeakMap%",!0),ae=F("%Map%",!0),ne=_e("WeakMap.prototype.get",!0),ge=_e("WeakMap.prototype.set",!0),le=_e("WeakMap.prototype.has",!0),Ae=_e("Map.prototype.get",!0),xe=_e("Map.prototype.set",!0),se=_e("Map.prototype.has",!0),Ee=function(R,S){for(var k,B=R;null!==(k=B.next);B=k)if(k.key===S)return B.next=k.next,k.next=R.next,R.next=k,k};Re.exports=function(){var S,B,k,z={assert:function(G){if(!z.has(G))throw new ve("Side channel does not contain "+we(G))},get:function(G){if(ie&&G&&("object"==typeof G||"function"==typeof G)){if(S)return ne(S,G)}else if(ae){if(B)return Ae(B,G)}else if(k)return function(R,S){var B=Ee(R,S);return B&&B.value}(k,G)},has:function(G){if(ie&&G&&("object"==typeof G||"function"==typeof G)){if(S)return le(S,G)}else if(ae){if(B)return se(B,G)}else if(k)return function(R,S){return!!Ee(R,S)}(k,G);return!1},set:function(G,T){ie&&G&&("object"==typeof G||"function"==typeof G)?(S||(S=new ie),ge(S,G,T)):ae?(B||(B=new ae),xe(B,G,T)):(k||(k={key:{},next:null}),function(R,S,B){var k=Ee(R,S);k?k.value=B:R.next={key:S,next:R.next,value:B}}(k,G,T))}};return z}},630:function(Re,et,re){var F;Re=re.nmd(Re),function(_e){"object"==typeof global&&global;var ae,ne=2147483647,ge=36,Ae=26,xe=38,se=700,fe=/^xn--/,R=/[^\x20-\x7E]/,S=/[\x2E\u3002\uFF0E\uFF61]/g,B={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},k=ge-1,z=Math.floor,G=String.fromCharCode;function K(b){throw new RangeError(B[b])}function E(b,I){for(var O=b.length,V=[];O--;)V[O]=I(b[O]);return V}function He(b,I){var O=b.split("@"),V="";return O.length>1&&(V=O[0]+"@",b=O[1]),V+E((b=b.replace(S,".")).split("."),I).join(".")}function Oe(b){for(var W,H,I=[],O=0,V=b.length;O<V;)(W=b.charCodeAt(O++))>=55296&&W<=56319&&O<V?56320==(64512&(H=b.charCodeAt(O++)))?I.push(((1023&W)<<10)+(1023&H)+65536):(I.push(W),O--):I.push(W);return I}function rt(b){return E(b,function(I){var O="";return I>65535&&(O+=G((I-=65536)>>>10&1023|55296),I=56320|1023&I),O+G(I)}).join("")}function Pe(b){return b-48<10?b-22:b-65<26?b-65:b-97<26?b-97:ge}function j(b,I){return b+22+75*(b<26)-((0!=I)<<5)}function y(b,I,O){var V=0;for(b=O?z(b/se):b>>1,b+=z(b/I);b>k*Ae>>1;V+=ge)b=z(b/k);return z(V+(k+1)*b/(b+xe))}function w(b){var V,oe,Ce,Te,_t,tt,Ze,wt,Fe,Ie,I=[],O=b.length,W=0,H=128,q=72;for((oe=b.lastIndexOf("-"))<0&&(oe=0),Ce=0;Ce<oe;++Ce)b.charCodeAt(Ce)>=128&&K("not-basic"),I.push(b.charCodeAt(Ce));for(Te=oe>0?oe+1:0;Te<O;){for(_t=W,tt=1,Ze=ge;Te>=O&&K("invalid-input"),((wt=Pe(b.charCodeAt(Te++)))>=ge||wt>z((ne-W)/tt))&&K("overflow"),W+=wt*tt,!(wt<(Fe=Ze<=q?1:Ze>=q+Ae?Ae:Ze-q));Ze+=ge)tt>z(ne/(Ie=ge-Fe))&&K("overflow"),tt*=Ie;q=y(W-_t,V=I.length+1,0==_t),z(W/V)>ne-H&&K("overflow"),H+=z(W/V),W%=V,I.splice(W++,0,H)}return rt(I)}function x(b){var I,O,V,W,H,q,oe,Ce,Te,_t,tt,wt,Fe,Ie,Nt,Ze=[];for(wt=(b=Oe(b)).length,I=128,O=0,H=72,q=0;q<wt;++q)(tt=b[q])<128&&Ze.push(G(tt));for(V=W=Ze.length,W&&Ze.push("-");V<wt;){for(oe=ne,q=0;q<wt;++q)(tt=b[q])>=I&&tt<oe&&(oe=tt);for(oe-I>z((ne-O)/(Fe=V+1))&&K("overflow"),O+=(oe-I)*Fe,I=oe,q=0;q<wt;++q)if((tt=b[q])<I&&++O>ne&&K("overflow"),tt==I){for(Ce=O,Te=ge;!(Ce<(_t=Te<=H?1:Te>=H+Ae?Ae:Te-H));Te+=ge)Ze.push(G(j(_t+(Nt=Ce-_t)%(Ie=ge-_t),0))),Ce=z(Nt/Ie);Ze.push(G(j(Ce,0))),H=y(O,Fe,V==W),O=0,++V}++O,++I}return Ze.join("")}ae={version:"1.4.1",ucs2:{decode:Oe,encode:rt},decode:w,encode:x,toASCII:function P(b){return He(b,function(I){return R.test(I)?"xn--"+x(I):I})},toUnicode:function C(b){return He(b,function(I){return fe.test(I)?w(I.slice(4).toLowerCase()):I})}},void 0!==(F=function(){return ae}.call(et,re,et,Re))&&(Re.exports=F)}()},445:(Re,et,re)=>{"use strict";var _e=re(630);function we(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var ve=/^([a-z0-9.+-]+:)/i,ie=/:[0-9]*$/,ae=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,ge=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),le=["'"].concat(ge),Ae=["%","/","?",";","#"].concat(le),xe=["/","?","#"],Ee=/^[+a-z0-9A-Z_-]{0,63}$/,L=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,be={javascript:!0,"javascript:":!0},fe={javascript:!0,"javascript:":!0},R={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},S=re(956);function B(T,K,E){if(T&&"object"==typeof T&&T instanceof we)return T;var He=new we;return He.parse(T,K,E),He}we.prototype.parse=function(T,K,E){if("string"!=typeof T)throw new TypeError("Parameter 'url' must be a string, not "+typeof T);var He=T.indexOf("?"),Oe=-1!==He&&He<T.indexOf("#")?"?":"#",rt=T.split(Oe);rt[0]=rt[0].replace(/\\/g,"/");var j=T=rt.join(Oe);if(j=j.trim(),!E&&1===T.split("#").length){var y=ae.exec(j);if(y)return this.path=j,this.href=j,this.pathname=y[1],y[2]?(this.search=y[2],this.query=K?S.parse(this.search.substr(1)):this.search.substr(1)):K&&(this.search="",this.query={}),this}var w=ve.exec(j);if(w){var x=(w=w[0]).toLowerCase();this.protocol=x,j=j.substr(w.length)}if(E||w||j.match(/^\/\/[^@/]+@[^@/]+/)){var C="//"===j.substr(0,2);C&&(!w||!fe[w])&&(j=j.substr(2),this.slashes=!0)}if(!fe[w]&&(C||w&&!R[w])){for(var P=-1,b=0;b<xe.length;b++)-1!==(I=j.indexOf(xe[b]))&&(-1===P||I<P)&&(P=I);var O,V;for(-1!==(V=-1===P?j.lastIndexOf("@"):j.lastIndexOf("@",P))&&(O=j.slice(0,V),j=j.slice(V+1),this.auth=decodeURIComponent(O)),P=-1,b=0;b<Ae.length;b++){var I;-1!==(I=j.indexOf(Ae[b]))&&(-1===P||I<P)&&(P=I)}-1===P&&(P=j.length),this.host=j.slice(0,P),j=j.slice(P),this.parseHost(),this.hostname=this.hostname||"";var W="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!W)for(var H=this.hostname.split(/\./),q=(b=0,H.length);b<q;b++){var oe=H[b];if(oe&&!oe.match(Ee)){for(var Ce="",Te=0,_t=oe.length;Te<_t;Te++)oe.charCodeAt(Te)>127?Ce+="x":Ce+=oe[Te];if(!Ce.match(Ee)){var tt=H.slice(0,b),Ze=H.slice(b+1),wt=oe.match(L);wt&&(tt.push(wt[1]),Ze.unshift(wt[2])),Ze.length&&(j="/"+Ze.join(".")+j),this.hostname=tt.join(".");break}}}this.hostname=this.hostname.length>255?"":this.hostname.toLowerCase(),W||(this.hostname=_e.toASCII(this.hostname)),this.host=(this.hostname||"")+(this.port?":"+this.port:""),this.href+=this.host,W&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==j[0]&&(j="/"+j))}if(!be[x])for(b=0,q=le.length;b<q;b++){var Nt=le[b];if(-1!==j.indexOf(Nt)){var xs=encodeURIComponent(Nt);xs===Nt&&(xs=escape(Nt)),j=j.split(Nt).join(xs)}}var Li=j.indexOf("#");-1!==Li&&(this.hash=j.substr(Li),j=j.slice(0,Li));var Bi=j.indexOf("?");return-1!==Bi?(this.search=j.substr(Bi),this.query=j.substr(Bi+1),K&&(this.query=S.parse(this.query)),j=j.slice(0,Bi)):K&&(this.search="",this.query={}),j&&(this.pathname=j),R[x]&&this.hostname&&!this.pathname&&(this.pathname="/"),(this.pathname||this.search)&&(this.path=(this.pathname||"")+(this.search||"")),this.href=this.format(),this},we.prototype.format=function(){var T=this.auth||"";T&&(T=(T=encodeURIComponent(T)).replace(/%3A/i,":"),T+="@");var K=this.protocol||"",E=this.pathname||"",He=this.hash||"",Oe=!1,rt="";this.host?Oe=T+this.host:this.hostname&&(Oe=T+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(Oe+=":"+this.port)),this.query&&"object"==typeof this.query&&Object.keys(this.query).length&&(rt=S.stringify(this.query));var Pe=this.search||rt&&"?"+rt||"";return K&&":"!==K.substr(-1)&&(K+=":"),this.slashes||(!K||R[K])&&!1!==Oe?(Oe="//"+(Oe||""),E&&"/"!==E.charAt(0)&&(E="/"+E)):Oe||(Oe=""),He&&"#"!==He.charAt(0)&&(He="#"+He),Pe&&"?"!==Pe.charAt(0)&&(Pe="?"+Pe),K+Oe+(E=E.replace(/[?#]/g,function(j){return encodeURIComponent(j)}))+(Pe=Pe.replace("#","%23"))+He},we.prototype.resolve=function(T){return this.resolveObject(B(T,!1,!0)).format()},we.prototype.resolveObject=function(T){if("string"==typeof T){var K=new we;K.parse(T,!1,!0),T=K}for(var E=new we,He=Object.keys(this),Oe=0;Oe<He.length;Oe++){var rt=He[Oe];E[rt]=this[rt]}if(E.hash=T.hash,""===T.href)return E.href=E.format(),E;if(T.slashes&&!T.protocol){for(var Pe=Object.keys(T),j=0;j<Pe.length;j++){var y=Pe[j];"protocol"!==y&&(E[y]=T[y])}return R[E.protocol]&&E.hostname&&!E.pathname&&(E.pathname="/",E.path=E.pathname),E.href=E.format(),E}if(T.protocol&&T.protocol!==E.protocol){if(!R[T.protocol]){for(var w=Object.keys(T),x=0;x<w.length;x++){var C=w[x];E[C]=T[C]}return E.href=E.format(),E}if(E.protocol=T.protocol,T.host||fe[T.protocol])E.pathname=T.pathname;else{for(var q=(T.pathname||"").split("/");q.length&&!(T.host=q.shift()););T.host||(T.host=""),T.hostname||(T.hostname=""),""!==q[0]&&q.unshift(""),q.length<2&&q.unshift(""),E.pathname=q.join("/")}return E.search=T.search,E.query=T.query,E.host=T.host||"",E.auth=T.auth,E.hostname=T.hostname||T.host,E.port=T.port,(E.pathname||E.search)&&(E.path=(E.pathname||"")+(E.search||"")),E.slashes=E.slashes||T.slashes,E.href=E.format(),E}var I=E.pathname&&"/"===E.pathname.charAt(0),O=T.host||T.pathname&&"/"===T.pathname.charAt(0),V=O||I||E.host&&T.pathname,W=V,H=E.pathname&&E.pathname.split("/")||[],oe=(q=T.pathname&&T.pathname.split("/")||[],E.protocol&&!R[E.protocol]);if(oe&&(E.hostname="",E.port=null,E.host&&(""===H[0]?H[0]=E.host:H.unshift(E.host)),E.host="",T.protocol&&(T.hostname=null,T.port=null,T.host&&(""===q[0]?q[0]=T.host:q.unshift(T.host)),T.host=null),V=V&&(""===q[0]||""===H[0])),O)E.host=T.host||""===T.host?T.host:E.host,E.hostname=T.hostname||""===T.hostname?T.hostname:E.hostname,E.search=T.search,E.query=T.query,H=q;else if(q.length)H||(H=[]),H.pop(),H=H.concat(q),E.search=T.search,E.query=T.query;else if(null!=T.search)return oe&&(E.host=H.shift(),E.hostname=E.host,(Ce=!!(E.host&&E.host.indexOf("@")>0)&&E.host.split("@"))&&(E.auth=Ce.shift(),E.hostname=Ce.shift(),E.host=E.hostname)),E.search=T.search,E.query=T.query,(null!==E.pathname||null!==E.search)&&(E.path=(E.pathname?E.pathname:"")+(E.search?E.search:"")),E.href=E.format(),E;if(!H.length)return E.pathname=null,E.path=E.search?"/"+E.search:null,E.href=E.format(),E;for(var Te=H.slice(-1)[0],_t=(E.host||T.host||H.length>1)&&("."===Te||".."===Te)||""===Te,tt=0,Ze=H.length;Ze>=0;Ze--)"."===(Te=H[Ze])?H.splice(Ze,1):".."===Te?(H.splice(Ze,1),tt++):tt&&(H.splice(Ze,1),tt--);if(!V&&!W)for(;tt--;tt)H.unshift("..");V&&""!==H[0]&&(!H[0]||"/"!==H[0].charAt(0))&&H.unshift(""),_t&&"/"!==H.join("/").substr(-1)&&H.push("");var Ce,wt=""===H[0]||H[0]&&"/"===H[0].charAt(0);return oe&&(E.hostname=wt?"":H.length?H.shift():"",E.host=E.hostname,(Ce=!!(E.host&&E.host.indexOf("@")>0)&&E.host.split("@"))&&(E.auth=Ce.shift(),E.hostname=Ce.shift(),E.host=E.hostname)),(V=V||E.host&&H.length)&&!wt&&H.unshift(""),H.length>0?E.pathname=H.join("/"):(E.pathname=null,E.path=null),(null!==E.pathname||null!==E.search)&&(E.path=(E.pathname?E.pathname:"")+(E.search?E.search:"")),E.auth=T.auth||E.auth,E.slashes=E.slashes||T.slashes,E.href=E.format(),E},we.prototype.parseHost=function(){var T=this.host,K=ie.exec(T);K&&(":"!==(K=K[0])&&(this.port=K.substr(1)),T=T.substr(0,T.length-K.length)),T&&(this.hostname=T)},et.Qc=B,et.DB=function z(T,K){return B(T,!1,!0).resolve(K)},et.WU=function k(T){return"string"==typeof T&&(T=B(T)),T instanceof we?T.format():we.prototype.format.call(T)}},654:()=>{}},Re=>{Re(Re.s=142)}]);